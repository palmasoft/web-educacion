var HotspotsConfig={"rootUrl":"https:\/\/educacion-jpllinas.c9users.io\/","baseUrl":"https:\/\/educacion-jpllinas.c9users.io\/index.php","mapStartPosition":"Karlsruhe, Germany","mapStartZoom":10,"mapStartZoomSingle":10,"centerType":1,"customUserZoom":15,"searchZoom":14,"startCat":[],"apiKey":"","mapHeight":600,"mapHeightSingle":300,"startFullscreen":0,"getDirections":1,"mapBackgroundColor":"#E5E3DF","mapType":1,"panControl":1,"panControlPosition":"TOP_LEFT","zoomControl":1,"zoomControlStyle":"DEFAULT","zoomControlPosition":"TOP_LEFT","mapTypeControl":1,"mapTypeControlStyle":"DEFAULT","mapTypeControlPosition":"TOP_RIGHT","scaleControl":1,"fullscreenControl":1,"streetViewControl":1,"streetViewPosition":"TOP_LEFT","overviewMapControl":1,"scrollwheel":1,"gestureHandling":"greedy","styledMaps":"","userInterface":1,"print":1,"resizeMap":1,"mailMap":0,"listLength":20,"showDirections":1,"showAddress":1,"showCountry":0,"showZoomButton":1,"showAuthor":1,"showDate":1,"numOfCatsToShow":5,"categoryInfo":1,"showMarkerCount":1,"weatherLayer":0,"weatherLayerApiKey":"","weatherTemperatureUnit":"CELSIUS","trafficLayer":0,"transitLayer":0,"bicyclingLayer":0,"visualRefresh":1,"draggableDirections":1,"startClosedMenu":0,"startTab":"hotspots","language":"es-ES","tiles":0,"categories":[{"id":"91","cat_name":"Comuna 1","cat_description":"","cat_icon":"https:\/\/educacion-jpllinas.c9users.io\/media\/com_hotspots\/images\/categories\/1536290294_S_school.png","params":{"category_layout":"","image":"","image_alt":"","icon":"media\/com_hotspots\/images\/categories\/1536290294_S_school.png","hs-marker-image":"","tile_marker_color":"250,5,5","import_table":"","import_id":""}},{"id":"92","cat_name":"Comuna 2","cat_description":"","cat_icon":"https:\/\/educacion-jpllinas.c9users.io\/media\/com_hotspots\/images\/categories\/1536290361_S_school.png","params":{"category_layout":"","image":"","image_alt":"","icon":"media\/com_hotspots\/images\/categories\/1536290361_S_school.png","hs-marker-image":"","tile_marker_color":"255,5,143","import_table":"","import_id":""}},{"id":"93","cat_name":"Comuna 3","cat_description":"","cat_icon":"https:\/\/educacion-jpllinas.c9users.io\/media\/com_hotspots\/images\/categories\/1536290361_S_school.png","params":{"category_layout":"","image":"","image_alt":"","icon":"media\/com_hotspots\/images\/categories\/1536290361_S_school.png","hs-marker-image":"","tile_marker_color":"176,5,255","import_table":"","import_id":""}},{"id":"94","cat_name":"Comuna 4","cat_description":"","cat_icon":"https:\/\/educacion-jpllinas.c9users.io\/images\/marcador-mapa-educacion-32x52.png","params":{"category_layout":"","image":"","image_alt":"","icon":"images\/marcador-mapa-educacion-32x52.png","hs-marker-image":"images\/marcador-mapa-educacion-32x52.png","tile_marker_color":"5,13,255","import_table":"","import_id":""},"boundaries":{"catid":"94","south":"11.243361","north":"11.243361","east":"-74.203499","west":"-74.203499"}},{"id":"95","cat_name":"Comuna 5","cat_description":"","cat_icon":"https:\/\/educacion-jpllinas.c9users.io\/media\/com_hotspots\/images\/categories\/1536290361_S_school.png","params":{"category_layout":"","image":"","image_alt":"","icon":"media\/com_hotspots\/images\/categories\/1536290361_S_school.png","hs-marker-image":"","tile_marker_color":"5,205,255","import_table":"","import_id":""}},{"id":"96","cat_name":"Comuna 6","cat_description":"","cat_icon":"https:\/\/educacion-jpllinas.c9users.io\/media\/com_hotspots\/images\/categories\/1536290361_S_school.png","params":{"category_layout":"","image":"","image_alt":"","icon":"media\/com_hotspots\/images\/categories\/1536290361_S_school.png","hs-marker-image":"","tile_marker_color":"5,255,168","import_table":"","import_id":""}},{"id":"97","cat_name":"Comuna 7","cat_description":"","cat_icon":"https:\/\/educacion-jpllinas.c9users.io\/media\/com_hotspots\/images\/categories\/1536290361_S_school.png","params":{"category_layout":"","image":"","image_alt":"","icon":"media\/com_hotspots\/images\/categories\/1536290361_S_school.png","hs-marker-image":"","tile_marker_color":"22,255,5","import_table":"","import_id":""}},{"id":"98","cat_name":"Comuna 8","cat_description":"","cat_icon":"https:\/\/educacion-jpllinas.c9users.io\/media\/com_hotspots\/images\/categories\/1536290361_S_school.png","params":{"category_layout":"","image":"","image_alt":"","icon":"media\/com_hotspots\/images\/categories\/1536290361_S_school.png","hs-marker-image":"","tile_marker_color":"255,255,5","import_table":"","import_id":""}},{"id":"99","cat_name":"Comuna 9","cat_description":"","cat_icon":"https:\/\/educacion-jpllinas.c9users.io\/media\/com_hotspots\/images\/categories\/1536290361_S_school.png","params":{"category_layout":"","image":"","image_alt":"","icon":"media\/com_hotspots\/images\/categories\/1536290361_S_school.png","hs-marker-image":"","tile_marker_color":"255,168,5","import_table":"","import_id":""}},{"id":"100","cat_name":"Taganga","cat_description":"","cat_icon":"https:\/\/educacion-jpllinas.c9users.io\/images\/marcador-mapa-educacion.png","params":{"category_layout":"","image":"","image_alt":"","icon":"images\/marcador-mapa-educacion.png","hs-marker-image":"images\/marcador-mapa-educacion.png","tile_marker_color":"255,68,5","import_table":"","import_id":""},"boundaries":{"catid":"100","south":"11.265763","north":"11.265763","east":"-74.187767","west":"-74.187767"}},{"id":"101","cat_name":"Bonda","cat_description":"","cat_icon":"https:\/\/educacion-jpllinas.c9users.io\/media\/com_hotspots\/images\/categories\/1536290361_S_school.png","params":{"category_layout":"","image":"","image_alt":"","icon":"media\/com_hotspots\/images\/categories\/1536290361_S_school.png","hs-marker-image":"","tile_marker_color":"255,5,5","import_table":"","import_id":""}},{"id":"102","cat_name":"Minca","cat_description":"","cat_icon":"https:\/\/educacion-jpllinas.c9users.io\/media\/com_hotspots\/images\/categories\/1536290361_S_school.png","params":{"category_layout":"","image":"","image_alt":"","icon":"media\/com_hotspots\/images\/categories\/1536290361_S_school.png","hs-marker-image":"","tile_marker_color":"255,5,72","import_table":"","import_id":""}},{"id":"103","cat_name":"Sierra Nevada de Santa Marta","cat_description":"","cat_icon":"https:\/\/educacion-jpllinas.c9users.io\/media\/com_hotspots\/images\/categories\/1536290361_S_school.png","params":{"category_layout":"","image":"","image_alt":"","icon":"media\/com_hotspots\/images\/categories\/1536290361_S_school.png","hs-marker-image":"","tile_marker_color":"26,5,255","import_table":"","import_id":""}},{"id":"104","cat_name":"Troncal del Caribe","cat_description":"","cat_icon":"https:\/\/educacion-jpllinas.c9users.io\/media\/com_hotspots\/images\/categories\/1536290361_S_school.png","params":{"category_layout":"","image":"","image_alt":"","icon":"media\/com_hotspots\/images\/categories\/1536290361_S_school.png","hs-marker-image":"","tile_marker_color":"43,255,5","import_table":"","import_id":""}}],"tabs":[{"id":1,"tabName":"<span class=\"fa fa-location-arrow\"><\/span> Directions","dataName":"directions","content":""},{"id":2,"tabName":"<span class=\"fa fa-map-marker\"><\/span> Instituciones","dataName":"hotspots","content":""},{"id":3,"tabName":"<span class=\"fa fa-cog\"><\/span> Settings","dataName":"settings","content":""}],"translations":{"enterValidAddress":"Please enter a valid address","provideStartAddress":"Please provide start address","provideEndAddress":"Please provide end address","myLocation":"My location"}};;(function($){$.fn.onImpression=function(options){var settings=$.extend({offset:0,callback:null,attribute:"",alwayscallback:false,scrollable:""},options);var $window=$(window),$scrollable=$(settings.scrollable),onImpressionElements=this,loaded;this.one("onImpression",function(){if(typeof settings.callback==="function")settings.callback.call(this,this.getAttribute(settings.attribute));});this.on("alwaysOnImpression",function(){if(typeof settings.callback==="function")settings.callback.call(this,this.getAttribute(settings.attribute));});function onImpression(){var inview=onImpressionElements.filter(function(){var $e=$(this);if($e.is(":hidden"))return;var wt=$window.scrollTop(),wb=wt+$window.height(),et=$e.offset().top,eb=et+$e.height();var inScrollable=false;if($scrollable.length){var scrollTop=$scrollable.scrollTop(),scrollBottom=scrollTop+$scrollable.height();inScrollable=(eb>=scrollTop-settings.offset&&et<=scrollBottom+settings.offset);}
return(eb>=wt-settings.offset&&et<=wb+settings.offset)||inScrollable;});if(settings.alwayscallback){loaded=inview.trigger("alwaysOnImpression");}
else{loaded=inview.trigger("onImpression");onImpressionElements=onImpressionElements.not(loaded);}}
if(typeof settings.callback==="function"){if($scrollable.length){$scrollable.on("scroll.onImpression resize.onImpression lookup.onImpression",onImpression);}else{$window.on("scroll.onImpression resize.onImpression lookup.onImpression",onImpression);}
onImpression();}
return this;};})(window.jQuery);(function($,window,Galleria,undef){var doc=window.document,$doc=$(doc),$win=$(window),protoArray=Array.prototype,VERSION=1.56,DEBUG=true,TIMEOUT=30000,DUMMY=false,NAV=navigator.userAgent.toLowerCase(),HASH=window.location.hash.replace(/#\//,''),PROT=window.location.protocol=="file:"?"http:":window.location.protocol,M=Math,F=function(){},FALSE=function(){return false;},IE=(function(){var v=3,div=doc.createElement('div'),all=div.getElementsByTagName('i');do{div.innerHTML='<!--[if gt IE '+(++v)+']><i></i><![endif]-->';}while(all[0]);return v>4?v:doc.documentMode||undef;}()),DOM=function(){return{html:doc.documentElement,body:doc.body,head:doc.getElementsByTagName('head')[0],title:doc.title};},IFRAME=window.parent!==window.self,_eventlist='data ready thumbnail loadstart loadfinish image play pause progress '+'fullscreen_enter fullscreen_exit idle_enter idle_exit rescale '+'lightbox_open lightbox_close lightbox_image',_events=(function(){var evs=[];$.each(_eventlist.split(' '),function(i,ev){evs.push(ev);if(/_/.test(ev)){evs.push(ev.replace(/_/g,''));}});return evs;}()),_legacyOptions=function(options){var n;if(typeof options!=='object'){return options;}
$.each(options,function(key,value){if(/^[a-z]+_/.test(key)){n='';$.each(key.split('_'),function(i,k){n+=i>0?k.substr(0,1).toUpperCase()+k.substr(1):k;});options[n]=value;delete options[key];}});return options;},_patchEvent=function(type){if($.inArray(type,_events)>-1){return Galleria[type.toUpperCase()];}
return type;},_video={youtube:{reg:/https?:\/\/(?:[a-zA_Z]{2,3}.)?(?:youtube\.com\/watch\?)((?:[\w\d\-\_\=]+&amp;(?:amp;)?)*v(?:&lt;[A-Z]+&gt;)?=([0-9a-zA-Z\-\_]+))/i,embed:function(){return PROT+'//www.youtube.com/embed/'+this.id;},get_thumb:function(data){return PROT+'//img.youtube.com/vi/'+this.id+'/default.jpg';},get_image:function(data){return PROT+'//img.youtube.com/vi/'+this.id+'/hqdefault.jpg';}},vimeo:{reg:/https?:\/\/(?:www\.)?(vimeo\.com)\/(?:hd#)?([0-9]+)/i,embed:function(){return PROT+'//player.vimeo.com/video/'+this.id;},getUrl:function(){return PROT+'//vimeo.com/api/v2/video/'+this.id+'.json?callback=?';},get_thumb:function(data){return data[0].thumbnail_medium;},get_image:function(data){return data[0].thumbnail_large;}},dailymotion:{reg:/https?:\/\/(?:www\.)?(dailymotion\.com)\/video\/([^_]+)/,embed:function(){return PROT+'//www.dailymotion.com/embed/video/'+this.id;},getUrl:function(){return'https://api.dailymotion.com/video/'+this.id+'?fields=thumbnail_240_url,thumbnail_720_url&callback=?';},get_thumb:function(data){return data.thumbnail_240_url;},get_image:function(data){return data.thumbnail_720_url;}},_inst:[]},Video=function(type,id){for(var i=0;i<_video._inst.length;i++){if(_video._inst[i].id===id&&_video._inst[i].type==type){return _video._inst[i];}}
this.type=type;this.id=id;this.readys=[];_video._inst.push(this);var self=this;$.extend(this,_video[type]);_videoThumbs=function(data){self.data=data;$.each(self.readys,function(i,fn){fn(self.data);});self.readys=[];};if(this.hasOwnProperty('getUrl')){$.getJSON(this.getUrl(),_videoThumbs);}else{window.setTimeout(_videoThumbs,400);}
this.getMedia=function(type,callback,fail){fail=fail||F;var self=this;var success=function(data){callback(self['get_'+type](data));};try{if(self.data){success(self.data);}else{self.readys.push(success);}}catch(e){fail();}};},_videoTest=function(url){var match;for(var v in _video){match=url&&_video[v].reg&&url.match(_video[v].reg);if(match&&match.length){return{id:match[2],provider:v};}}
return false;},_nativeFullscreen={support:(function(){var html=DOM().html;return!IFRAME&&(html.requestFullscreen||html.msRequestFullscreen||html.mozRequestFullScreen||html.webkitRequestFullScreen);}()),callback:F,enter:function(instance,callback,elem){this.instance=instance;this.callback=callback||F;elem=elem||DOM().html;if(elem.requestFullscreen){elem.requestFullscreen();}
else if(elem.msRequestFullscreen){elem.msRequestFullscreen();}
else if(elem.mozRequestFullScreen){elem.mozRequestFullScreen();}
else if(elem.webkitRequestFullScreen){elem.webkitRequestFullScreen();}},exit:function(callback){this.callback=callback||F;if(doc.exitFullscreen){doc.exitFullscreen();}
else if(doc.msExitFullscreen){doc.msExitFullscreen();}
else if(doc.mozCancelFullScreen){doc.mozCancelFullScreen();}
else if(doc.webkitCancelFullScreen){doc.webkitCancelFullScreen();}},instance:null,listen:function(){if(!this.support){return;}
var handler=function(){if(!_nativeFullscreen.instance){return;}
var fs=_nativeFullscreen.instance._fullscreen;if(doc.fullscreen||doc.mozFullScreen||doc.webkitIsFullScreen||(doc.msFullscreenElement&&doc.msFullscreenElement!==null)){fs._enter(_nativeFullscreen.callback);}else{fs._exit(_nativeFullscreen.callback);}};doc.addEventListener('fullscreenchange',handler,false);doc.addEventListener('MSFullscreenChange',handler,false);doc.addEventListener('mozfullscreenchange',handler,false);doc.addEventListener('webkitfullscreenchange',handler,false);}},_galleries=[],_instances=[],_hasError=false,_canvas=false,_pool=[],_loadedThemes=[],_themeLoad=function(theme){_loadedThemes.push(theme);$.each(_pool,function(i,instance){if(instance._options.theme==theme.name||(!instance._initialized&&!instance._options.theme)){instance.theme=theme;instance._init.call(instance);}});},Utils=(function(){return{clearTimer:function(id){$.each(Galleria.get(),function(){this.clearTimer(id);});},addTimer:function(id){$.each(Galleria.get(),function(){this.addTimer(id);});},array:function(obj){return protoArray.slice.call(obj,0);},create:function(className,nodeName){nodeName=nodeName||'div';var elem=doc.createElement(nodeName);elem.className=className;return elem;},removeFromArray:function(arr,elem){$.each(arr,function(i,el){if(el==elem){arr.splice(i,1);return false;}});return arr;},getScriptPath:function(src){src=src||$('script:last').attr('src');var slices=src.split('/');if(slices.length==1){return'';}
slices.pop();return slices.join('/')+'/';},animate:(function(){var transition=(function(style){var props='transition WebkitTransition MozTransition OTransition'.split(' '),i;if(window.opera){return false;}
for(i=0;props[i];i++){if(typeof style[props[i]]!=='undefined'){return props[i];}}
return false;}((doc.body||doc.documentElement).style));var endEvent={MozTransition:'transitionend',OTransition:'oTransitionEnd',WebkitTransition:'webkitTransitionEnd',transition:'transitionend'}[transition];var easings={_default:[0.25,0.1,0.25,1],galleria:[0.645,0.045,0.355,1],galleriaIn:[0.55,0.085,0.68,0.53],galleriaOut:[0.25,0.46,0.45,0.94],ease:[0.25,0,0.25,1],linear:[0.25,0.25,0.75,0.75],'ease-in':[0.42,0,1,1],'ease-out':[0,0,0.58,1],'ease-in-out':[0.42,0,0.58,1]};var setStyle=function(elem,value,suffix){var css={};suffix=suffix||'transition';$.each('webkit moz ms o'.split(' '),function(){css['-'+this+'-'+suffix]=value;});elem.css(css);};var clearStyle=function(elem){setStyle(elem,'none','transition');if(Galleria.WEBKIT&&Galleria.TOUCH){setStyle(elem,'translate3d(0,0,0)','transform');if(elem.data('revert')){elem.css(elem.data('revert'));elem.data('revert',null);}}};var change,strings,easing,syntax,revert,form,css;return function(elem,to,options){options=$.extend({duration:400,complete:F,stop:false},options);elem=$(elem);if(!options.duration){elem.css(to);options.complete.call(elem[0]);return;}
if(!transition){elem.animate(to,options);return;}
if(options.stop){elem.off(endEvent);clearStyle(elem);}
change=false;$.each(to,function(key,val){css=elem.css(key);if(Utils.parseValue(css)!=Utils.parseValue(val)){change=true;}
elem.css(key,css);});if(!change){window.setTimeout(function(){options.complete.call(elem[0]);},options.duration);return;}
strings=[];easing=options.easing in easings?easings[options.easing]:easings._default;syntax=' '+options.duration+'ms'+' cubic-bezier('+easing.join(',')+')';window.setTimeout((function(elem,endEvent,to,syntax){return function(){elem.one(endEvent,(function(elem){return function(){clearStyle(elem);options.complete.call(elem[0]);};}(elem)));if(Galleria.WEBKIT&&Galleria.TOUCH){revert={};form=[0,0,0];$.each(['left','top'],function(i,m){if(m in to){form[i]=(Utils.parseValue(to[m])-Utils.parseValue(elem.css(m)))+'px';revert[m]=to[m];delete to[m];}});if(form[0]||form[1]){elem.data('revert',revert);strings.push('-webkit-transform'+syntax);setStyle(elem,'translate3d('+form.join(',')+')','transform');}}
$.each(to,function(p,val){strings.push(p+syntax);});setStyle(elem,strings.join(','));elem.css(to);};}(elem,endEvent,to,syntax)),2);};}()),removeAlpha:function(elem){if(elem instanceof jQuery){elem=elem[0];}
if(IE<9&&elem){var style=elem.style,currentStyle=elem.currentStyle,filter=currentStyle&&currentStyle.filter||style.filter||"";if(/alpha/.test(filter)){style.filter=filter.replace(/alpha\([^)]*\)/i,'');}}},forceStyles:function(elem,styles){elem=$(elem);if(elem.attr('style')){elem.data('styles',elem.attr('style')).removeAttr('style');}
elem.css(styles);},revertStyles:function(){$.each(Utils.array(arguments),function(i,elem){elem=$(elem);elem.removeAttr('style');elem.attr('style','');if(elem.data('styles')){elem.attr('style',elem.data('styles')).data('styles',null);}});},moveOut:function(elem){Utils.forceStyles(elem,{position:'absolute',left:-10000});},moveIn:function(){Utils.revertStyles.apply(Utils,Utils.array(arguments));},hide:function(elem,speed,callback){callback=callback||F;var $elem=$(elem);elem=$elem[0];if(!$elem.data('opacity')){$elem.data('opacity',$elem.css('opacity'));}
var style={opacity:0};if(speed){var complete=IE<9&&elem?function(){Utils.removeAlpha(elem);elem.style.visibility='hidden';callback.call(elem);}:callback;Utils.animate(elem,style,{duration:speed,complete:complete,stop:true});}else{if(IE<9&&elem){Utils.removeAlpha(elem);elem.style.visibility='hidden';}else{$elem.css(style);}}},show:function(elem,speed,callback){callback=callback||F;var $elem=$(elem);elem=$elem[0];var saved=parseFloat($elem.data('opacity'))||1,style={opacity:saved};if(speed){if(IE<9){$elem.css('opacity',0);elem.style.visibility='visible';}
var complete=IE<9&&elem?function(){if(style.opacity==1){Utils.removeAlpha(elem);}
callback.call(elem);}:callback;Utils.animate(elem,style,{duration:speed,complete:complete,stop:true});}else{if(IE<9&&style.opacity==1&&elem){Utils.removeAlpha(elem);elem.style.visibility='visible';}else{$elem.css(style);}}},wait:function(options){Galleria._waiters=Galleria._waiters||[];options=$.extend({until:FALSE,success:F,error:function(){Galleria.raise('Could not complete wait function.');},timeout:3000},options);var start=Utils.timestamp(),elapsed,now,tid,fn=function(){now=Utils.timestamp();elapsed=now-start;Utils.removeFromArray(Galleria._waiters,tid);if(options.until(elapsed)){options.success();return false;}
if(typeof options.timeout=='number'&&now>=start+options.timeout){options.error();return false;}
Galleria._waiters.push(tid=window.setTimeout(fn,10));};Galleria._waiters.push(tid=window.setTimeout(fn,10));},toggleQuality:function(img,force){if((IE!==7&&IE!==8)||!img||img.nodeName.toUpperCase()!='IMG'){return;}
if(typeof force==='undefined'){force=img.style.msInterpolationMode==='nearest-neighbor';}
img.style.msInterpolationMode=force?'bicubic':'nearest-neighbor';},insertStyleTag:function(styles,id){if(id&&$('#'+id).length){return;}
var style=doc.createElement('style');if(id){style.id=id;}
DOM().head.appendChild(style);if(style.styleSheet){style.styleSheet.cssText=styles;}else{var cssText=doc.createTextNode(styles);style.appendChild(cssText);}},loadScript:function(url,callback){var done=false,script=$('<scr'+'ipt>').attr({src:url,async:true}).get(0);script.onload=script.onreadystatechange=function(){if(!done&&(!this.readyState||this.readyState==='loaded'||this.readyState==='complete')){done=true;script.onload=script.onreadystatechange=null;if(typeof callback==='function'){callback.call(this,this);}}};DOM().head.appendChild(script);},parseValue:function(val){if(typeof val==='number'){return val;}else if(typeof val==='string'){var arr=val.match(/\-?\d|\./g);return arr&&arr.constructor===Array?arr.join('')*1:0;}else{return 0;}},timestamp:function(){return new Date().getTime();},loadCSS:function(href,id,callback){var link,length;$('link[rel=stylesheet]').each(function(){if(new RegExp(href).test(this.href)){link=this;return false;}});if(typeof id==='function'){callback=id;id=undef;}
callback=callback||F;if(link){callback.call(link,link);return link;}
length=doc.styleSheets.length;if($('#'+id).length){$('#'+id).attr('href',href);length--;}else{link=$('<link>').attr({rel:'stylesheet',href:href,id:id}).get(0);var styles=$('link[rel="stylesheet"], style');if(styles.length){styles.get(0).parentNode.insertBefore(link,styles[0]);}else{DOM().head.appendChild(link);}
if(IE&&length>=31){Galleria.raise('You have reached the browser stylesheet limit (31)',true);return;}}
if(typeof callback==='function'){var $loader=$('<s>').attr('id','galleria-loader').hide().appendTo(DOM().body);Utils.wait({until:function(){return $loader.height()>0;},success:function(){$loader.remove();callback.call(link,link);},error:function(){$loader.remove();Galleria.raise('Theme CSS could not load after 20 sec. '+(Galleria.QUIRK?'Your browser is in Quirks Mode, please add a correct doctype.':'Please download the latest theme at http://galleria.io/customer/.'),true);},timeout:5000});}
return link;}};}()),_playIcon=function(container){var css='.galleria-videoicon{width:60px;height:60px;position:absolute;top:50%;left:50%;z-index:1;'+'margin:-30px 0 0 -30px;cursor:pointer;background:#000;background:rgba(0,0,0,.8);border-radius:3px;-webkit-transition:all 150ms}'+'.galleria-videoicon i{width:0px;height:0px;border-style:solid;border-width:10px 0 10px 16px;display:block;'+'border-color:transparent transparent transparent #ffffff;margin:20px 0 0 22px}.galleria-image:hover .galleria-videoicon{background:#000}';Utils.insertStyleTag(css,'galleria-videoicon');return $(Utils.create('galleria-videoicon')).html('<i></i>').appendTo(container).click(function(){$(this).siblings('img').mouseup();});},_transitions=(function(){var _slide=function(params,complete,fade,door){var easing=this.getOptions('easing'),distance=this.getStageWidth(),from={left:distance*(params.rewind?-1:1)},to={left:0};if(fade){from.opacity=0;to.opacity=1;}else{from.opacity=1;}
$(params.next).css(from);Utils.animate(params.next,to,{duration:params.speed,complete:(function(elems){return function(){complete();elems.css({left:0});};}($(params.next).add(params.prev))),queue:false,easing:easing});if(door){params.rewind=!params.rewind;}
if(params.prev){from={left:0};to={left:distance*(params.rewind?1:-1)};if(fade){from.opacity=1;to.opacity=0;}
$(params.prev).css(from);Utils.animate(params.prev,to,{duration:params.speed,queue:false,easing:easing,complete:function(){$(this).css('opacity',0);}});}};return{active:false,init:function(effect,params,complete){if(_transitions.effects.hasOwnProperty(effect)){_transitions.effects[effect].call(this,params,complete);}},effects:{fade:function(params,complete){$(params.next).css({opacity:0,left:0});Utils.animate(params.next,{opacity:1},{duration:params.speed,complete:complete});if(params.prev){$(params.prev).css('opacity',1).show();Utils.animate(params.prev,{opacity:0},{duration:params.speed});}},flash:function(params,complete){$(params.next).css({opacity:0,left:0});if(params.prev){Utils.animate(params.prev,{opacity:0},{duration:params.speed/2,complete:function(){Utils.animate(params.next,{opacity:1},{duration:params.speed,complete:complete});}});}else{Utils.animate(params.next,{opacity:1},{duration:params.speed,complete:complete});}},pulse:function(params,complete){if(params.prev){$(params.prev).hide();}
$(params.next).css({opacity:0,left:0}).show();Utils.animate(params.next,{opacity:1},{duration:params.speed,complete:complete});},slide:function(params,complete){_slide.apply(this,Utils.array(arguments));},fadeslide:function(params,complete){_slide.apply(this,Utils.array(arguments).concat([true]));},doorslide:function(params,complete){_slide.apply(this,Utils.array(arguments).concat([false,true]));}}};}());_nativeFullscreen.listen();$.event.special['click:fast']={propagate:true,add:function(handleObj){var getCoords=function(e){if(e.touches&&e.touches.length){var touch=e.touches[0];return{x:touch.pageX,y:touch.pageY};}};var def={touched:false,touchdown:false,coords:{x:0,y:0},evObj:{}};$(this).data({clickstate:def,timer:0}).on('touchstart.fast',function(e){window.clearTimeout($(this).data('timer'));$(this).data('clickstate',{touched:true,touchdown:true,coords:getCoords(e.originalEvent),evObj:e});}).on('touchmove.fast',function(e){var coords=getCoords(e.originalEvent),state=$(this).data('clickstate'),distance=Math.max(Math.abs(state.coords.x-coords.x),Math.abs(state.coords.y-coords.y));if(distance>6){$(this).data('clickstate',$.extend(state,{touchdown:false}));}}).on('touchend.fast',function(e){var $this=$(this),state=$this.data('clickstate');if(state.touchdown){handleObj.handler.call(this,e);}
$this.data('timer',window.setTimeout(function(){$this.data('clickstate',def);},400));}).on('click.fast',function(e){var state=$(this).data('clickstate');if(state.touched){return false;}
$(this).data('clickstate',def);handleObj.handler.call(this,e);});},remove:function(){$(this).off('touchstart.fast touchmove.fast touchend.fast click.fast');}};$win.on('orientationchange',function(){$(this).resize();});Galleria=function(){var self=this;this._options={};this._playing=false;this._playtime=5000;this._active=null;this._queue={length:0};this._data=[];this._dom={};this._thumbnails=[];this._layers=[];this._initialized=false;this._firstrun=false;this._stageWidth=0;this._stageHeight=0;this._target=undef;this._binds=[];this._id=parseInt(M.random()*10000,10);var divs='container stage images image-nav image-nav-left image-nav-right '+'info info-text info-title info-description '+'thumbnails thumbnails-list thumbnails-container thumb-nav-left thumb-nav-right '+'loader counter tooltip',spans='current total';$.each(divs.split(' '),function(i,elemId){self._dom[elemId]=Utils.create('galleria-'+elemId);});$.each(spans.split(' '),function(i,elemId){self._dom[elemId]=Utils.create('galleria-'+elemId,'span');});var keyboard=this._keyboard={keys:{'UP':38,'DOWN':40,'LEFT':37,'RIGHT':39,'RETURN':13,'ESCAPE':27,'BACKSPACE':8,'SPACE':32},map:{},bound:false,press:function(e){var key=e.keyCode||e.which;if(key in keyboard.map&&typeof keyboard.map[key]==='function'){keyboard.map[key].call(self,e);}},attach:function(map){var key,up;for(key in map){if(map.hasOwnProperty(key)){up=key.toUpperCase();if(up in keyboard.keys){keyboard.map[keyboard.keys[up]]=map[key];}else{keyboard.map[up]=map[key];}}}
if(!keyboard.bound){keyboard.bound=true;$doc.on('keydown',keyboard.press);}},detach:function(){keyboard.bound=false;keyboard.map={};$doc.off('keydown',keyboard.press);}};var controls=this._controls={0:undef,1:undef,active:0,swap:function(){controls.active=controls.active?0:1;},getActive:function(){return self._options.swipe?controls.slides[self._active]:controls[controls.active];},getNext:function(){return self._options.swipe?controls.slides[self.getNext(self._active)]:controls[1-controls.active];},slides:[],frames:[],layers:[]};var carousel=this._carousel={next:self.$('thumb-nav-right'),prev:self.$('thumb-nav-left'),width:0,current:0,max:0,hooks:[],update:function(){var w=0,h=0,hooks=[0];$.each(self._thumbnails,function(i,thumb){if(thumb.ready){w+=thumb.outerWidth||$(thumb.container).outerWidth(true);var containerWidth=$(thumb.container).width();w+=containerWidth-M.floor(containerWidth);hooks[i+1]=w;h=M.max(h,thumb.outerHeight||$(thumb.container).outerHeight(true));}});self.$('thumbnails').css({width:w,height:h});carousel.max=w;carousel.hooks=hooks;carousel.width=self.$('thumbnails-list').width();carousel.setClasses();self.$('thumbnails-container').toggleClass('galleria-carousel',w>carousel.width);carousel.width=self.$('thumbnails-list').width();},bindControls:function(){var i;carousel.next.on('click:fast',function(e){e.preventDefault();if(self._options.carouselSteps==='auto'){for(i=carousel.current;i<carousel.hooks.length;i++){if(carousel.hooks[i]-carousel.hooks[carousel.current]>carousel.width){carousel.set(i-2);break;}}}else{carousel.set(carousel.current+self._options.carouselSteps);}});carousel.prev.on('click:fast',function(e){e.preventDefault();if(self._options.carouselSteps==='auto'){for(i=carousel.current;i>=0;i--){if(carousel.hooks[carousel.current]-carousel.hooks[i]>carousel.width){carousel.set(i+2);break;}else if(i===0){carousel.set(0);break;}}}else{carousel.set(carousel.current-self._options.carouselSteps);}});},set:function(i){i=M.max(i,0);while(carousel.hooks[i-1]+carousel.width>=carousel.max&&i>=0){i--;}
carousel.current=i;carousel.animate();},getLast:function(i){return(i||carousel.current)-1;},follow:function(i){if(i===0||i===carousel.hooks.length-2){carousel.set(i);return;}
var last=carousel.current;while(carousel.hooks[last]-carousel.hooks[carousel.current]<carousel.width&&last<=carousel.hooks.length){last++;}
if(i-1<carousel.current){carousel.set(i-1);}else if(i+2>last){carousel.set(i-last+carousel.current+2);}},setClasses:function(){carousel.prev.toggleClass('disabled',!carousel.current);carousel.next.toggleClass('disabled',carousel.hooks[carousel.current]+carousel.width>=carousel.max);},animate:function(to){carousel.setClasses();var num=carousel.hooks[carousel.current]*-1;if(isNaN(num)){return;}
self.$('thumbnails').css('left',function(){return $(this).css('left');});Utils.animate(self.get('thumbnails'),{left:num},{duration:self._options.carouselSpeed,easing:self._options.easing,queue:false});}};var tooltip=this._tooltip={initialized:false,open:false,timer:'tooltip'+self._id,swapTimer:'swap'+self._id,init:function(){tooltip.initialized=true;var css='.galleria-tooltip{padding:3px 8px;max-width:50%;background:#ffe;color:#000;z-index:3;position:absolute;font-size:11px;line-height:1.3;'+'opacity:0;box-shadow:0 0 2px rgba(0,0,0,.4);-moz-box-shadow:0 0 2px rgba(0,0,0,.4);-webkit-box-shadow:0 0 2px rgba(0,0,0,.4);}';Utils.insertStyleTag(css,'galleria-tooltip');self.$('tooltip').css({opacity:0.8,visibility:'visible',display:'none'});},move:function(e){var mouseX=self.getMousePosition(e).x,mouseY=self.getMousePosition(e).y,$elem=self.$('tooltip'),x=mouseX,y=mouseY,height=$elem.outerHeight(true)+1,width=$elem.outerWidth(true),limitY=height+15;var maxX=self.$('container').width()-width-2,maxY=self.$('container').height()-height-2;if(!isNaN(x)&&!isNaN(y)){x+=10;y-=(height+8);x=M.max(0,M.min(maxX,x));y=M.max(0,M.min(maxY,y));if(mouseY<limitY){y=limitY;}
$elem.css({left:x,top:y});}},bind:function(elem,value){if(Galleria.TOUCH){return;}
if(!tooltip.initialized){tooltip.init();}
var mouseout=function(){self.$('container').off('mousemove',tooltip.move);self.clearTimer(tooltip.timer);self.$('tooltip').stop().animate({opacity:0},200,function(){self.$('tooltip').hide();self.addTimer(tooltip.swapTimer,function(){tooltip.open=false;},1000);});};var hover=function(elem,value){tooltip.define(elem,value);$(elem).hover(function(){self.clearTimer(tooltip.swapTimer);self.$('container').off('mousemove',tooltip.move).on('mousemove',tooltip.move).trigger('mousemove');tooltip.show(elem);self.addTimer(tooltip.timer,function(){self.$('tooltip').stop().show().animate({opacity:1});tooltip.open=true;},tooltip.open?0:500);},mouseout).click(mouseout);};if(typeof value==='string'){hover((elem in self._dom?self.get(elem):elem),value);}else{$.each(elem,function(elemID,val){hover(self.get(elemID),val);});}},show:function(elem){elem=$(elem in self._dom?self.get(elem):elem);var text=elem.data('tt'),mouseup=function(e){window.setTimeout((function(ev){return function(){tooltip.move(ev);};}(e)),10);elem.off('mouseup',mouseup);};text=typeof text==='function'?text():text;if(!text){return;}
self.$('tooltip').html(text.replace(/\s/,'&#160;'));elem.on('mouseup',mouseup);},define:function(elem,value){if(typeof value!=='function'){var s=value;value=function(){return s;};}
elem=$(elem in self._dom?self.get(elem):elem).data('tt',value);tooltip.show(elem);}};var fullscreen=this._fullscreen={scrolled:0,crop:undef,active:false,prev:$(),beforeEnter:function(fn){fn();},beforeExit:function(fn){fn();},keymap:self._keyboard.map,parseCallback:function(callback,enter){return _transitions.active?function(){if(typeof callback=='function'){callback.call(self);}
var active=self._controls.getActive(),next=self._controls.getNext();self._scaleImage(next);self._scaleImage(active);if(enter&&self._options.trueFullscreen){$(active.container).add(next.container).trigger('transitionend');}}:callback;},enter:function(callback){fullscreen.beforeEnter(function(){callback=fullscreen.parseCallback(callback,true);if(self._options.trueFullscreen&&_nativeFullscreen.support){fullscreen.active=true;Utils.forceStyles(self.get('container'),{width:'100%',height:'100%'});self.rescale();if(Galleria.MAC){if(!(Galleria.SAFARI&&/version\/[1-5]/.test(NAV))){self.$('container').css('opacity',0).addClass('fullscreen');window.setTimeout(function(){fullscreen.scale();self.$('container').css('opacity',1);},50);}else{self.$('stage').css('opacity',0);window.setTimeout(function(){fullscreen.scale();self.$('stage').css('opacity',1);},4);}}else{self.$('container').addClass('fullscreen');}
$win.resize(fullscreen.scale);_nativeFullscreen.enter(self,callback,self.get('container'));}else{fullscreen.scrolled=$win.scrollTop();if(!Galleria.TOUCH){window.scrollTo(0,0);}
fullscreen._enter(callback);}});},_enter:function(callback){fullscreen.active=true;if(IFRAME){fullscreen.iframe=(function(){var elem,refer=doc.referrer,test=doc.createElement('a'),loc=window.location;test.href=refer;if(test.protocol!=loc.protocol||test.hostname!=loc.hostname||test.port!=loc.port){Galleria.raise('Parent fullscreen not available. Iframe protocol, domains and ports must match.');return false;}
fullscreen.pd=window.parent.document;$(fullscreen.pd).find('iframe').each(function(){var idoc=this.contentDocument||this.contentWindow.document;if(idoc===doc){elem=this;return false;}});return elem;}());}
Utils.hide(self.getActiveImage());if(IFRAME&&fullscreen.iframe){fullscreen.iframe.scrolled=$(window.parent).scrollTop();window.parent.scrollTo(0,0);}
var data=self.getData(),options=self._options,inBrowser=!self._options.trueFullscreen||!_nativeFullscreen.support,htmlbody={height:'100%',overflow:'hidden',margin:0,padding:0};if(inBrowser){self.$('container').addClass('fullscreen');fullscreen.prev=self.$('container').prev();if(!fullscreen.prev.length){fullscreen.parent=self.$('container').parent();}
self.$('container').appendTo('body');Utils.forceStyles(self.get('container'),{position:Galleria.TOUCH?'absolute':'fixed',top:0,left:0,width:'100%',height:'100%',zIndex:10000});Utils.forceStyles(DOM().html,htmlbody);Utils.forceStyles(DOM().body,htmlbody);}
if(IFRAME&&fullscreen.iframe){Utils.forceStyles(fullscreen.pd.documentElement,htmlbody);Utils.forceStyles(fullscreen.pd.body,htmlbody);Utils.forceStyles(fullscreen.iframe,$.extend(htmlbody,{width:'100%',height:'100%',top:0,left:0,position:'fixed',zIndex:10000,border:'none'}));}
fullscreen.keymap=$.extend({},self._keyboard.map);self.attachKeyboard({escape:self.exitFullscreen,right:self.next,left:self.prev});fullscreen.crop=options.imageCrop;if(options.fullscreenCrop!=undef){options.imageCrop=options.fullscreenCrop;}
if(data&&data.big&&data.image!==data.big){var big=new Galleria.Picture(),cached=big.isCached(data.big),index=self.getIndex(),thumb=self._thumbnails[index];self.trigger({type:Galleria.LOADSTART,cached:cached,rewind:false,index:index,imageTarget:self.getActiveImage(),thumbTarget:thumb,galleriaData:data});big.load(data.big,function(big){self._scaleImage(big,{complete:function(big){self.trigger({type:Galleria.LOADFINISH,cached:cached,index:index,rewind:false,imageTarget:big.image,thumbTarget:thumb});var image=self._controls.getActive().image;if(image){$(image).width(big.image.width).height(big.image.height).attr('style',$(big.image).attr('style')).attr('src',big.image.src);}}});});var n=self.getNext(index),p=new Galleria.Picture(),ndata=self.getData(n);p.preload(self.isFullscreen()&&ndata.big?ndata.big:ndata.image);}
self.rescale(function(){self.addTimer(false,function(){if(inBrowser){Utils.show(self.getActiveImage());}
if(typeof callback==='function'){callback.call(self);}
self.rescale();},100);self.trigger(Galleria.FULLSCREEN_ENTER);});if(!inBrowser){Utils.show(self.getActiveImage());}else{$win.resize(fullscreen.scale);}},scale:function(){self.rescale();},exit:function(callback){fullscreen.beforeExit(function(){callback=fullscreen.parseCallback(callback);if(self._options.trueFullscreen&&_nativeFullscreen.support){_nativeFullscreen.exit(callback);}else{fullscreen._exit(callback);}});},_exit:function(callback){fullscreen.active=false;var inBrowser=!self._options.trueFullscreen||!_nativeFullscreen.support,$container=self.$('container').removeClass('fullscreen');if(fullscreen.parent){fullscreen.parent.prepend($container);}else{$container.insertAfter(fullscreen.prev);}
if(inBrowser){Utils.hide(self.getActiveImage());Utils.revertStyles(self.get('container'),DOM().html,DOM().body);if(!Galleria.TOUCH){window.scrollTo(0,fullscreen.scrolled);}
var frame=self._controls.frames[self._controls.active];if(frame&&frame.image){frame.image.src=frame.image.src;}}
if(IFRAME&&fullscreen.iframe){Utils.revertStyles(fullscreen.pd.documentElement,fullscreen.pd.body,fullscreen.iframe);if(fullscreen.iframe.scrolled){window.parent.scrollTo(0,fullscreen.iframe.scrolled);}}
self.detachKeyboard();self.attachKeyboard(fullscreen.keymap);self._options.imageCrop=fullscreen.crop;var big=self.getData().big,image=self._controls.getActive().image;if(!self.getData().iframe&&image&&big&&big==image.src){window.setTimeout(function(src){return function(){image.src=src;};}(self.getData().image),1);}
self.rescale(function(){self.addTimer(false,function(){if(inBrowser){Utils.show(self.getActiveImage());}
if(typeof callback==='function'){callback.call(self);}
$win.trigger('resize');},50);self.trigger(Galleria.FULLSCREEN_EXIT);});$win.off('resize',fullscreen.scale);}};var idle=this._idle={trunk:[],bound:false,active:false,add:function(elem,to,from,hide){if(!elem||Galleria.TOUCH){return;}
if(!idle.bound){idle.addEvent();}
elem=$(elem);if(typeof from=='boolean'){hide=from;from={};}
from=from||{};var extract={},style;for(style in to){if(to.hasOwnProperty(style)){extract[style]=elem.css(style);}}
elem.data('idle',{from:$.extend(extract,from),to:to,complete:true,busy:false});if(!hide){idle.addTimer();}else{elem.css(to);}
idle.trunk.push(elem);},remove:function(elem){elem=$(elem);$.each(idle.trunk,function(i,el){if(el&&el.length&&!el.not(elem).length){elem.css(elem.data('idle').from);idle.trunk.splice(i,1);}});if(!idle.trunk.length){idle.removeEvent();self.clearTimer(idle.timer);}},addEvent:function(){idle.bound=true;self.$('container').on('mousemove click',idle.showAll);if(self._options.idleMode=='hover'){self.$('container').on('mouseleave',idle.hide);}},removeEvent:function(){idle.bound=false;self.$('container').on('mousemove click',idle.showAll);if(self._options.idleMode=='hover'){self.$('container').off('mouseleave',idle.hide);}},addTimer:function(){if(self._options.idleMode=='hover'){return;}
self.addTimer('idle',function(){idle.hide();},self._options.idleTime);},hide:function(){if(!self._options.idleMode||self.getIndex()===false){return;}
self.trigger(Galleria.IDLE_ENTER);var len=idle.trunk.length;$.each(idle.trunk,function(i,elem){var data=elem.data('idle');if(!data){return;}
elem.data('idle').complete=false;Utils.animate(elem,data.to,{duration:self._options.idleSpeed,complete:function(){if(i==len-1){idle.active=false;}}});});},showAll:function(){self.clearTimer('idle');$.each(idle.trunk,function(i,elem){idle.show(elem);});},show:function(elem){var data=elem.data('idle');if(!idle.active||(!data.busy&&!data.complete)){data.busy=true;self.trigger(Galleria.IDLE_EXIT);self.clearTimer('idle');Utils.animate(elem,data.from,{duration:self._options.idleSpeed/2,complete:function(){idle.active=true;$(elem).data('idle').busy=false;$(elem).data('idle').complete=true;}});}
idle.addTimer();}};var lightbox=this._lightbox={width:0,height:0,initialized:false,active:null,image:null,elems:{},keymap:false,init:function(){if(lightbox.initialized){return;}
lightbox.initialized=true;var elems='overlay box content shadow title info close prevholder prev nextholder next counter image',el={},op=self._options,css='',abs='position:absolute;',prefix='lightbox-',cssMap={overlay:'position:fixed;display:none;opacity:'+op.overlayOpacity+';filter:alpha(opacity='+(op.overlayOpacity*100)+');top:0;left:0;width:100%;height:100%;background:'+op.overlayBackground+';z-index:99990',box:'position:fixed;display:none;width:400px;height:400px;top:50%;left:50%;margin-top:-200px;margin-left:-200px;z-index:99991',shadow:abs+'background:#000;width:100%;height:100%;',content:abs+'background-color:#fff;top:10px;left:10px;right:10px;bottom:10px;overflow:hidden',info:abs+'bottom:10px;left:10px;right:10px;color:#444;font:11px/13px arial,sans-serif;height:13px',close:abs+'top:10px;right:10px;height:20px;width:20px;background:#fff;text-align:center;cursor:pointer;color:#444;font:16px/22px arial,sans-serif;z-index:99999',image:abs+'top:10px;left:10px;right:10px;bottom:30px;overflow:hidden;display:block;',prevholder:abs+'width:50%;top:0;bottom:40px;cursor:pointer;',nextholder:abs+'width:50%;top:0;bottom:40px;right:-1px;cursor:pointer;',prev:abs+'top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;left:20px;display:none;text-align:center;color:#000;font:bold 16px/36px arial,sans-serif',next:abs+'top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;right:20px;left:auto;display:none;font:bold 16px/36px arial,sans-serif;text-align:center;color:#000',title:'float:left',counter:'float:right;margin-left:8px;'},hover=function(elem){return elem.hover(function(){$(this).css('color','#bbb');},function(){$(this).css('color','#444');});},appends={};var exs='';if(IE>7){exs=IE<9?'background:#000;filter:alpha(opacity=0);':'background:rgba(0,0,0,0);';}else{exs='z-index:99999';}
cssMap.nextholder+=exs;cssMap.prevholder+=exs;$.each(cssMap,function(key,value){css+='.galleria-'+prefix+key+'{'+value+'}';});css+='.galleria-'+prefix+'box.iframe .galleria-'+prefix+'prevholder,'+'.galleria-'+prefix+'box.iframe .galleria-'+prefix+'nextholder{'+'width:100px;height:100px;top:50%;margin-top:-70px}';Utils.insertStyleTag(css,'galleria-lightbox');$.each(elems.split(' '),function(i,elemId){self.addElement('lightbox-'+elemId);el[elemId]=lightbox.elems[elemId]=self.get('lightbox-'+elemId);});lightbox.image=new Galleria.Picture();$.each({box:'shadow content close prevholder nextholder',info:'title counter',content:'info image',prevholder:'prev',nextholder:'next'},function(key,val){var arr=[];$.each(val.split(' '),function(i,prop){arr.push(prefix+prop);});appends[prefix+key]=arr;});self.append(appends);$(el.image).append(lightbox.image.container);$(DOM().body).append(el.overlay,el.box);hover($(el.close).on('click:fast',lightbox.hide).html('&#215;'));$.each(['Prev','Next'],function(i,dir){var $d=$(el[dir.toLowerCase()]).html(/v/.test(dir)?'&#8249;&#160;':'&#160;&#8250;'),$e=$(el[dir.toLowerCase()+'holder']);$e.on('click:fast',function(){lightbox['show'+dir]();});if(IE<8||Galleria.TOUCH){$d.show();return;}
$e.hover(function(){$d.show();},function(e){$d.stop().fadeOut(200);});});$(el.overlay).on('click:fast',lightbox.hide);if(Galleria.IPAD){self._options.lightboxTransitionSpeed=0;}},rescale:function(event){var width=M.min($win.width()-40,lightbox.width),height=M.min($win.height()-60,lightbox.height),ratio=M.min(width / lightbox.width,height / lightbox.height),destWidth=M.round(lightbox.width*ratio)+40,destHeight=M.round(lightbox.height*ratio)+60,to={width:destWidth,height:destHeight,'margin-top':M.ceil(destHeight / 2)*-1,'margin-left':M.ceil(destWidth / 2)*-1};if(event){$(lightbox.elems.box).css(to);}else{$(lightbox.elems.box).animate(to,{duration:self._options.lightboxTransitionSpeed,easing:self._options.easing,complete:function(){var image=lightbox.image,speed=self._options.lightboxFadeSpeed;self.trigger({type:Galleria.LIGHTBOX_IMAGE,imageTarget:image.image});$(image.container).show();$(image.image).animate({opacity:1},speed);Utils.show(lightbox.elems.info,speed);}});}},hide:function(){lightbox.image.image=null;$win.off('resize',lightbox.rescale);$(lightbox.elems.box).hide().find('iframe').remove();Utils.hide(lightbox.elems.info);self.detachKeyboard();self.attachKeyboard(lightbox.keymap);lightbox.keymap=false;Utils.hide(lightbox.elems.overlay,200,function(){$(this).hide().css('opacity',self._options.overlayOpacity);self.trigger(Galleria.LIGHTBOX_CLOSE);});},showNext:function(){lightbox.show(self.getNext(lightbox.active));},showPrev:function(){lightbox.show(self.getPrev(lightbox.active));},show:function(index){lightbox.active=index=typeof index==='number'?index:self.getIndex()||0;if(!lightbox.initialized){lightbox.init();}
self.trigger(Galleria.LIGHTBOX_OPEN);if(!lightbox.keymap){lightbox.keymap=$.extend({},self._keyboard.map);self.attachKeyboard({escape:lightbox.hide,right:lightbox.showNext,left:lightbox.showPrev});}
$win.off('resize',lightbox.rescale);var data=self.getData(index),total=self.getDataLength(),n=self.getNext(index),ndata,p,i;Utils.hide(lightbox.elems.info);try{for(i=self._options.preload;i>0;i--){p=new Galleria.Picture();ndata=self.getData(n);p.preload(ndata.big?ndata.big:ndata.image);n=self.getNext(n);}}catch(e){}
lightbox.image.isIframe=(data.iframe&&!data.image);$(lightbox.elems.box).toggleClass('iframe',lightbox.image.isIframe);$(lightbox.image.container).find('.galleria-videoicon').remove();lightbox.image.load(data.big||data.image||data.iframe,function(image){if(image.isIframe){var cw=$(window).width(),ch=$(window).height();if(image.video&&self._options.maxVideoSize){var r=M.min(self._options.maxVideoSize/cw,self._options.maxVideoSize/ch);if(r<1){cw*=r;ch*=r;}}
lightbox.width=cw;lightbox.height=ch;}else{lightbox.width=image.original.width;lightbox.height=image.original.height;}
$(image.image).css({width:image.isIframe?'100%':'100.1%',height:image.isIframe?'100%':'100.1%',top:0,bottom:0,zIndex:99998,opacity:0,visibility:'visible'}).parent().height('100%');lightbox.elems.title.innerHTML=data.title||'';lightbox.elems.counter.innerHTML=(index+1)+' / '+total;$win.resize(lightbox.rescale);lightbox.rescale();if(data.image&&data.iframe){$(lightbox.elems.box).addClass('iframe');if(data.video){var $icon=_playIcon(image.container).hide();window.setTimeout(function(){$icon.fadeIn(200);},200);}
$(image.image).css('cursor','pointer').mouseup((function(data,image){return function(e){$(lightbox.image.container).find('.galleria-videoicon').remove();e.preventDefault();image.isIframe=true;image.load(data.iframe+(data.video?'&autoplay=1':''),{width:'100%',height:IE<8?$(lightbox.image.container).height():'100%'});};}(data,image)));}});$(lightbox.elems.overlay).show().css('visibility','visible');$(lightbox.elems.box).show();}};var _timer=this._timer={trunk:{},add:function(id,fn,delay,loop){id=id||new Date().getTime();loop=loop||false;this.clear(id);if(loop){var old=fn;fn=function(){old();_timer.add(id,fn,delay);};}
this.trunk[id]=window.setTimeout(fn,delay);},clear:function(id){var del=function(i){window.clearTimeout(this.trunk[i]);delete this.trunk[i];},i;if(!!id&&id in this.trunk){del.call(this,id);}else if(typeof id==='undefined'){for(i in this.trunk){if(this.trunk.hasOwnProperty(i)){del.call(this,i);}}}}};return this;};Galleria.prototype={constructor:Galleria,init:function(target,options){options=_legacyOptions(options);this._original={target:target,options:options,data:null};this._target=this._dom.target=target.nodeName?target:$(target).get(0);this._original.html=this._target.innerHTML;_instances.push(this);if(!this._target){Galleria.raise('Target not found',true);return;}
this._options={autoplay:false,carousel:true,carouselFollow:true,carouselSpeed:400,carouselSteps:'auto',clicknext:false,dailymotion:{foreground:'%23EEEEEE',highlight:'%235BCEC5',background:'%23222222',logo:0,hideInfos:1},dataConfig:function(elem){return{};},dataSelector:'img',dataSort:false,dataSource:this._target,debug:undef,dummy:undef,easing:'galleria',extend:function(options){},fullscreenCrop:undef,fullscreenDoubleTap:true,fullscreenTransition:undef,height:0,idleMode:true,idleTime:3000,idleSpeed:200,imageCrop:false,imageMargin:0,imagePan:false,imagePanSmoothness:12,imagePosition:'50%',imageTimeout:undef,initialTransition:undef,keepSource:false,layerFollow:true,lightbox:false,lightboxFadeSpeed:200,lightboxTransitionSpeed:200,linkSourceImages:true,maxScaleRatio:undef,maxVideoSize:undef,minScaleRatio:undef,overlayOpacity:0.85,overlayBackground:'#0b0b0b',pauseOnInteraction:true,popupLinks:false,preload:2,queue:true,responsive:true,show:0,showInfo:true,showCounter:true,showImagenav:true,swipe:'auto',theme:null,thumbCrop:true,thumbEventType:'click:fast',thumbMargin:0,thumbQuality:'auto',thumbDisplayOrder:true,thumbPosition:'50%',thumbnails:true,touchTransition:undef,transition:'fade',transitionInitial:undef,transitionSpeed:400,trueFullscreen:true,useCanvas:false,variation:'',videoPoster:true,vimeo:{title:0,byline:0,portrait:0,color:'aaaaaa'},wait:5000,width:'auto',youtube:{modestbranding:1,autohide:1,color:'white',hd:1,rel:0,showinfo:0}};this._options.initialTransition=this._options.initialTransition||this._options.transitionInitial;if(options){if(options.debug===false){DEBUG=false;}
if(typeof options.imageTimeout==='number'){TIMEOUT=options.imageTimeout;}
if(typeof options.dummy==='string'){DUMMY=options.dummy;}
if(typeof options.theme=='string'){this._options.theme=options.theme;}}
$(this._target).children().hide();if(Galleria.QUIRK){Galleria.raise('Your page is in Quirks mode, Galleria may not render correctly. Please validate your HTML and add a correct doctype.');}
if(_loadedThemes.length){if(this._options.theme){for(var i=0;i<_loadedThemes.length;i++){if(this._options.theme===_loadedThemes[i].name){this.theme=_loadedThemes[i];break;}}}else{this.theme=_loadedThemes[0];}}
if(typeof this.theme=='object'){this._init();}else{_pool.push(this);}
return this;},_init:function(){var self=this,options=this._options;if(this._initialized){Galleria.raise('Init failed: Gallery instance already initialized.');return this;}
this._initialized=true;if(!this.theme){Galleria.raise('Init failed: No theme found.',true);return this;}
$.extend(true,options,this.theme.defaults,this._original.options,Galleria.configure.options);options.swipe=(function(s){if(s=='enforced'){return true;}
if(s===false||s=='disabled'){return false;}
return!!Galleria.TOUCH;}(options.swipe));if(options.swipe){options.clicknext=false;options.imagePan=false;}
(function(can){if(!('getContext'in can)){can=null;return;}
_canvas=_canvas||{elem:can,context:can.getContext('2d'),cache:{},length:0};}(doc.createElement('canvas')));this.bind(Galleria.DATA,function(){if(window.screen&&window.screen.width&&Array.prototype.forEach){this._data.forEach(function(data){var density='devicePixelRatio'in window?window.devicePixelRatio:1,m=M.max(window.screen.width,window.screen.height);if(m*density<1024){data.big=data.image;}});}
this._original.data=this._data;this.get('total').innerHTML=this.getDataLength();var $container=this.$('container');if(self._options.height<2){self._userRatio=self._ratio=self._options.height;}
var num={width:0,height:0};var testHeight=function(){return self.$('stage').height();};Utils.wait({until:function(){num=self._getWH();$container.width(num.width).height(num.height);return testHeight()&&num.width&&num.height>50;},success:function(){self._width=num.width;self._height=num.height;self._ratio=self._ratio||num.height/num.width;if(Galleria.WEBKIT){window.setTimeout(function(){self._run();},1);}else{self._run();}},error:function(){if(testHeight()){Galleria.raise('Could not extract sufficient width/height of the gallery container. Traced measures: width:'+num.width+'px, height: '+num.height+'px.',true);}else{Galleria.raise('Could not extract a stage height from the CSS. Traced height: '+testHeight()+'px.',true);}},timeout:typeof this._options.wait=='number'?this._options.wait:false});});this.append({'info-text':['info-title','info-description'],'info':['info-text'],'image-nav':['image-nav-right','image-nav-left'],'stage':['images','loader','counter','image-nav'],'thumbnails-list':['thumbnails'],'thumbnails-container':['thumb-nav-left','thumbnails-list','thumb-nav-right'],'container':['stage','thumbnails-container','info','tooltip']});Utils.hide(this.$('counter').append(this.get('current'),doc.createTextNode(' / '),this.get('total')));this.setCounter('&#8211;');Utils.hide(self.get('tooltip'));this.$('container').addClass([(Galleria.TOUCH?'touch':'notouch'),this._options.variation,'galleria-theme-'+this.theme.name].join(' '));if(!this._options.swipe){$.each(new Array(2),function(i){var image=new Galleria.Picture();$(image.container).css({position:'absolute',top:0,left:0}).prepend(self._layers[i]=$(Utils.create('galleria-layer')).css({position:'absolute',top:0,left:0,right:0,bottom:0,zIndex:2})[0]);self.$('images').append(image.container);self._controls[i]=image;var frame=new Galleria.Picture();frame.isIframe=true;$(frame.container).attr('class','galleria-frame').css({position:'absolute',top:0,left:0,zIndex:4,background:'#000',display:'none'}).appendTo(image.container);self._controls.frames[i]=frame;});}
this.$('images').css({position:'relative',top:0,left:0,width:'100%',height:'100%'});if(options.swipe){this.$('images').css({position:'absolute',top:0,left:0,width:0,height:'100%'});this.finger=new Galleria.Finger(this.get('stage'),{onchange:function(page){self.pause().show(page);},oncomplete:function(page){var index=M.max(0,M.min(parseInt(page,10),self.getDataLength()-1)),data=self.getData(index);$(self._thumbnails[index].container).addClass('active').siblings('.active').removeClass('active');if(!data){return;}
self.$('images').find('.galleria-frame').css('opacity',0).hide().find('iframe').remove();if(self._options.carousel&&self._options.carouselFollow){self._carousel.follow(index);}}});this.bind(Galleria.RESCALE,function(){this.finger.setup();});this.$('stage').on('click',function(e){var data=self.getData();if(!data){return;}
if(data.iframe){if(self.isPlaying()){self.pause();}
var frame=self._controls.frames[self._active],w=self._stageWidth,h=self._stageHeight;if($(frame.container).find('iframe').length){return;}
$(frame.container).css({width:w,height:h,opacity:0}).show().animate({opacity:1},200);window.setTimeout(function(){frame.load(data.iframe+(data.video?'&autoplay=1':''),{width:w,height:h},function(frame){self.$('container').addClass('videoplay');frame.scale({width:self._stageWidth,height:self._stageHeight,iframelimit:data.video?self._options.maxVideoSize:undef});});},100);return;}
if(data.link){if(self._options.popupLinks){var win=window.open(data.link,'_blank');}else{window.location.href=data.link;}
return;}});this.bind(Galleria.IMAGE,function(e){self.setCounter(e.index);self.setInfo(e.index);var next=this.getNext(),prev=this.getPrev();var preloads=[prev,next];preloads.push(this.getNext(next),this.getPrev(prev),self._controls.slides.length-1);var filtered=[];$.each(preloads,function(i,val){if($.inArray(val,filtered)==-1){filtered.push(val);}});$.each(filtered,function(i,loadme){var d=self.getData(loadme),img=self._controls.slides[loadme],src=self.isFullscreen()&&d.big?d.big:(d.image||d.iframe);if(d.iframe&&!d.image){img.isIframe=true;}
if(!img.ready){self._controls.slides[loadme].load(src,function(img){if(!img.isIframe){$(img.image).css('visibility','hidden');}
self._scaleImage(img,{complete:function(img){if(!img.isIframe){$(img.image).css({opacity:0,visibility:'visible'}).animate({opacity:1},200);}}});});}});});}
this.$('thumbnails, thumbnails-list').css({overflow:'hidden',position:'relative'});this.$('image-nav-right, image-nav-left').on('click:fast',function(e){if(options.pauseOnInteraction){self.pause();}
var fn=/right/.test(this.className)?'next':'prev';self[fn]();}).on('click',function(e){e.preventDefault();if(options.clicknext||options.swipe){e.stopPropagation();}});$.each(['info','counter','image-nav'],function(i,el){if(options['show'+el.substr(0,1).toUpperCase()+el.substr(1).replace(/-/,'')]===false){Utils.moveOut(self.get(el.toLowerCase()));}});this.load();if(!options.keepSource&&!IE){this._target.innerHTML='';}
if(this.get('errors')){this.appendChild('target','errors');}
this.appendChild('target','container');if(options.carousel){var count=0,show=options.show;this.bind(Galleria.THUMBNAIL,function(){this.updateCarousel();if(++count==this.getDataLength()&&typeof show=='number'&&show>0){this._carousel.follow(show);}});}
if(options.responsive){$win.on('resize',function(){if(!self.isFullscreen()){self.resize();}});}
if(options.fullscreenDoubleTap){this.$('stage').on('touchstart',(function(){var last,cx,cy,lx,ly,now,getData=function(e){return e.originalEvent.touches?e.originalEvent.touches[0]:e;};self.$('stage').on('touchmove',function(){last=0;});return function(e){if(/(-left|-right)/.test(e.target.className)){return;}
now=Utils.timestamp();cx=getData(e).pageX;cy=getData(e).pageY;if(e.originalEvent.touches.length<2&&(now-last<300)&&(cx-lx<20)&&(cy-ly<20)){self.toggleFullscreen();e.preventDefault();return;}
last=now;lx=cx;ly=cy;};}()));}
$.each(Galleria.on.binds,function(i,bind){if($.inArray(bind.hash,self._binds)==-1){self.bind(bind.type,bind.callback);}});return this;},addTimer:function(){this._timer.add.apply(this._timer,Utils.array(arguments));return this;},clearTimer:function(){this._timer.clear.apply(this._timer,Utils.array(arguments));return this;},_getWH:function(){var $container=this.$('container'),$target=this.$('target'),self=this,num={},arr;$.each(['width','height'],function(i,m){if(self._options[m]&&typeof self._options[m]==='number'){num[m]=self._options[m];}else{arr=[Utils.parseValue($container.css(m)),Utils.parseValue($target.css(m)),$container[m](),$target[m]()];if(!self['_'+m]){arr.splice(arr.length,Utils.parseValue($container.css('min-'+m)),Utils.parseValue($target.css('min-'+m)));}
num[m]=M.max.apply(M,arr);}});if(self._userRatio){num.height=num.width*self._userRatio;}
return num;},_createThumbnails:function(push){this.get('total').innerHTML=this.getDataLength();var src,thumb,data,$container,self=this,o=this._options,i=push?this._data.length-push.length:0,chunk=i,thumbchunk=[],loadindex=0,gif=IE<8?'https://upload.wikimedia.org/wikipedia/commons/c/c0/Blank.gif':'data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw%3D%3D',active=(function(){var a=self.$('thumbnails').find('.active');if(!a.length){return false;}
return a.find('img').attr('src');}()),optval=typeof o.thumbnails==='string'?o.thumbnails.toLowerCase():null,getStyle=function(prop){return doc.defaultView&&doc.defaultView.getComputedStyle?doc.defaultView.getComputedStyle(thumb.container,null)[prop]:$container.css(prop);},fake=function(image,index,container){return function(){$(container).append(image);self.trigger({type:Galleria.THUMBNAIL,thumbTarget:image,index:index,galleriaData:self.getData(index)});};},onThumbEvent=function(e){if(o.pauseOnInteraction){self.pause();}
var index=$(e.currentTarget).data('index');if(self.getIndex()!==index){self.show(index);}
e.preventDefault();},thumbComplete=function(thumb,callback){$(thumb.container).css('visibility','visible');self.trigger({type:Galleria.THUMBNAIL,thumbTarget:thumb.image,index:thumb.data.order,galleriaData:self.getData(thumb.data.order)});if(typeof callback=='function'){callback.call(self,thumb);}},onThumbLoad=function(thumb,callback){thumb.scale({width:thumb.data.width,height:thumb.data.height,crop:o.thumbCrop,margin:o.thumbMargin,canvas:o.useCanvas,position:o.thumbPosition,complete:function(thumb){var top=['left','top'],arr=['Width','Height'],m,css,data=self.getData(thumb.index);$.each(arr,function(i,measure){m=measure.toLowerCase();if((o.thumbCrop!==true||o.thumbCrop===m)){css={};css[m]=thumb[m];$(thumb.container).css(css);css={};css[top[i]]=0;$(thumb.image).css(css);}
thumb['outer'+measure]=$(thumb.container)['outer'+measure](true);});Utils.toggleQuality(thumb.image,o.thumbQuality===true||(o.thumbQuality==='auto'&&thumb.original.width<thumb.width*3));if(o.thumbDisplayOrder&&!thumb.lazy){$.each(thumbchunk,function(i,th){if(i===loadindex&&th.ready&&!th.displayed){loadindex++;th.displayed=true;thumbComplete(th,callback);return;}});}else{thumbComplete(thumb,callback);}}});};if(!push){this._thumbnails=[];this.$('thumbnails').empty();}
for(;this._data[i];i++){data=this._data[i];src=data.thumb||data.image;if((o.thumbnails===true||optval=='lazy')&&(data.thumb||data.image)){thumb=new Galleria.Picture(i);thumb.index=i;thumb.displayed=false;thumb.lazy=false;thumb.video=false;this.$('thumbnails').append(thumb.container);$container=$(thumb.container);$container.css('visibility','hidden');thumb.data={width:Utils.parseValue(getStyle('width')),height:Utils.parseValue(getStyle('height')),order:i,src:src};if(o.thumbCrop!==true){$container.css({width:'auto',height:'auto'});}else{$container.css({width:thumb.data.width,height:thumb.data.height});}
if(optval=='lazy'){$container.addClass('lazy');thumb.lazy=true;thumb.load(gif,{height:thumb.data.height,width:thumb.data.width});}else{thumb.load(src,onThumbLoad);}
if(o.preload==='all'){thumb.preload(data.image);}}else if((data.iframe&&optval!==null)||optval==='empty'||optval==='numbers'){thumb={container:Utils.create('galleria-image'),image:Utils.create('img','span'),ready:true,data:{order:i}};if(optval==='numbers'){$(thumb.image).text(i+1);}
if(data.iframe){$(thumb.image).addClass('iframe');}
this.$('thumbnails').append(thumb.container);window.setTimeout((fake)(thumb.image,i,thumb.container),50+(i*20));}else{thumb={container:null,image:null};}
$(thumb.container).add(o.keepSource&&o.linkSourceImages?data.original:null).data('index',i).on(o.thumbEventType,onThumbEvent).data('thumbload',onThumbLoad);if(active===src){$(thumb.container).addClass('active');}
this._thumbnails.push(thumb);}
thumbchunk=this._thumbnails.slice(chunk);return this;},lazyLoad:function(index,complete){var arr=index.constructor==Array?index:[index],self=this,loaded=0;$.each(arr,function(i,ind){if(ind>self._thumbnails.length-1){return;}
var thumb=self._thumbnails[ind],data=thumb.data,callback=function(){if(++loaded==arr.length&&typeof complete=='function'){complete.call(self);}},thumbload=$(thumb.container).data('thumbload');if(thumb.video){thumbload.call(self,thumb,callback);}else{thumb.load(data.src,function(thumb){thumbload.call(self,thumb,callback);});}});return this;},lazyLoadChunks:function(size,delay){var len=this.getDataLength(),i=0,n=0,arr=[],temp=[],self=this;delay=delay||0;for(;i<len;i++){temp.push(i);if(++n==size||i==len-1){arr.push(temp);n=0;temp=[];}}
var init=function(wait){var a=arr.shift();if(a){window.setTimeout(function(){self.lazyLoad(a,function(){init(true);});},(delay&&wait)?delay:0);}};init(false);return this;},_run:function(){var self=this;self._createThumbnails();Utils.wait({timeout:10000,until:function(){if(Galleria.OPERA){self.$('stage').css('display','inline-block');}
self._stageWidth=self.$('stage').width();self._stageHeight=self.$('stage').height();return(self._stageWidth&&self._stageHeight>50);},success:function(){_galleries.push(self);if(self._options.swipe){var $images=self.$('images').width(self.getDataLength()*self._stageWidth);$.each(new Array(self.getDataLength()),function(i){var image=new Galleria.Picture(),data=self.getData(i);$(image.container).css({position:'absolute',top:0,left:self._stageWidth*i}).prepend(self._layers[i]=$(Utils.create('galleria-layer')).css({position:'absolute',top:0,left:0,right:0,bottom:0,zIndex:2})[0]).appendTo($images);if(data.video){_playIcon(image.container);}
self._controls.slides.push(image);var frame=new Galleria.Picture();frame.isIframe=true;$(frame.container).attr('class','galleria-frame').css({position:'absolute',top:0,left:0,zIndex:4,background:'#000',display:'none'}).appendTo(image.container);self._controls.frames.push(frame);});self.finger.setup();}
Utils.show(self.get('counter'));if(self._options.carousel){self._carousel.bindControls();}
if(self._options.autoplay){self.pause();if(typeof self._options.autoplay==='number'){self._playtime=self._options.autoplay;}
self._playing=true;}
if(self._firstrun){if(self._options.autoplay){self.trigger(Galleria.PLAY);}
if(typeof self._options.show==='number'){self.show(self._options.show);}
return;}
self._firstrun=true;if(Galleria.History){Galleria.History.change(function(value){if(isNaN(value)){window.history.go(-1);}else{self.show(value,undef,true);}});}
self.trigger(Galleria.READY);self.theme.init.call(self,self._options);$.each(Galleria.ready.callbacks,function(i,fn){if(typeof fn=='function'){fn.call(self,self._options);}});self._options.extend.call(self,self._options);if(/^[0-9]{1,4}$/.test(HASH)&&Galleria.History){self.show(HASH,undef,true);}else if(self._data[self._options.show]){self.show(self._options.show);}
if(self._options.autoplay){self.trigger(Galleria.PLAY);}},error:function(){Galleria.raise('Stage width or height is too small to show the gallery. Traced measures: width:'+self._stageWidth+'px, height: '+self._stageHeight+'px.',true);}});},load:function(source,selector,config){var self=this,o=this._options;this._data=[];this._thumbnails=[];this.$('thumbnails').empty();if(typeof selector==='function'){config=selector;selector=null;}
source=source||o.dataSource;selector=selector||o.dataSelector;config=config||o.dataConfig;if($.isPlainObject(source)){source=[source];}
if($.isArray(source)){if(this.validate(source)){this._data=source;}else{Galleria.raise('Load failed: JSON Array not valid.');}}else{selector+=',.video,.iframe';$(source).find(selector).each(function(i,elem){elem=$(elem);var data={},parent=elem.parent(),href=parent.attr('href'),rel=parent.attr('rel');if(href&&(elem[0].nodeName=='IMG'||elem.hasClass('video'))&&_videoTest(href)){data.video=href;}else if(href&&elem.hasClass('iframe')){data.iframe=href;}else{data.image=data.big=href;}
if(rel){data.big=rel;}
$.each('big title description link layer image'.split(' '),function(i,val){if(elem.data(val)){data[val]=elem.data(val).toString();}});if(!data.big){data.big=data.image;}
self._data.push($.extend({title:elem.attr('title')||'',thumb:elem.attr('src'),image:elem.attr('src'),big:elem.attr('src'),description:elem.attr('alt')||'',link:elem.attr('longdesc'),original:elem.get(0)},data,config(elem)));});}
if(typeof o.dataSort=='function'){protoArray.sort.call(this._data,o.dataSort);}else if(o.dataSort=='random'){this._data.sort(function(){return M.round(M.random())-0.5;});}
if(this.getDataLength()){this._parseData(function(){this.trigger(Galleria.DATA);});}
return this;},_parseData:function(callback){var self=this,current,ready=false,onload=function(){var complete=true;$.each(self._data,function(i,data){if(data.loading){complete=false;return false;}});if(complete&&!ready){ready=true;callback.call(self);}};$.each(this._data,function(i,data){current=self._data[i];if('thumb'in data===false){current.thumb=data.image;}
if(!data.big){current.big=data.image;}
if('video'in data){var result=_videoTest(data.video);if(result){current.iframe=new Video(result.provider,result.id).embed()+(function(){if(typeof self._options[result.provider]=='object'){var str='?',arr=[];$.each(self._options[result.provider],function(key,val){arr.push(key+'='+val);});if(result.provider=='youtube'){arr=['wmode=opaque'].concat(arr);}
return str+arr.join('&');}
return'';}());if(!current.thumb||!current.image){$.each(['thumb','image'],function(i,type){if(type=='image'&&!self._options.videoPoster){current.image=undef;return;}
var video=new Video(result.provider,result.id);if(!current[type]){current.loading=true;video.getMedia(type,(function(current,type){return function(src){current[type]=src;if(type=='image'&&!current.big){current.big=current.image;}
delete current.loading;onload();};}(current,type)));}});}}}});onload();return this;},destroy:function(){this.$('target').data('galleria',null);this.$('container').off('galleria');this.get('target').innerHTML=this._original.html;this.clearTimer();Utils.removeFromArray(_instances,this);Utils.removeFromArray(_galleries,this);if(Galleria._waiters.length){$.each(Galleria._waiters,function(i,w){if(w)window.clearTimeout(w);});}
return this;},splice:function(){var self=this,args=Utils.array(arguments);window.setTimeout(function(){protoArray.splice.apply(self._data,args);self._parseData(function(){self._createThumbnails();});},2);return self;},push:function(){var self=this,args=Utils.array(arguments);if(args.length==1&&args[0].constructor==Array){args=args[0];}
window.setTimeout(function(){protoArray.push.apply(self._data,args);self._parseData(function(){self._createThumbnails(args);});},2);return self;},_getActive:function(){return this._controls.getActive();},validate:function(data){return true;},bind:function(type,fn){type=_patchEvent(type);this.$('container').on(type,this.proxy(fn));return this;},unbind:function(type){type=_patchEvent(type);this.$('container').off(type);return this;},trigger:function(type){type=typeof type==='object'?$.extend(type,{scope:this}):{type:_patchEvent(type),scope:this};this.$('container').trigger(type);return this;},addIdleState:function(elem,styles,from,hide){this._idle.add.apply(this._idle,Utils.array(arguments));return this;},removeIdleState:function(elem){this._idle.remove.apply(this._idle,Utils.array(arguments));return this;},enterIdleMode:function(){this._idle.hide();return this;},exitIdleMode:function(){this._idle.showAll();return this;},enterFullscreen:function(callback){this._fullscreen.enter.apply(this,Utils.array(arguments));return this;},exitFullscreen:function(callback){this._fullscreen.exit.apply(this,Utils.array(arguments));return this;},toggleFullscreen:function(callback){this._fullscreen[this.isFullscreen()?'exit':'enter'].apply(this,Utils.array(arguments));return this;},bindTooltip:function(elem,value){this._tooltip.bind.apply(this._tooltip,Utils.array(arguments));return this;},defineTooltip:function(elem,value){this._tooltip.define.apply(this._tooltip,Utils.array(arguments));return this;},refreshTooltip:function(elem){this._tooltip.show.apply(this._tooltip,Utils.array(arguments));return this;},openLightbox:function(){this._lightbox.show.apply(this._lightbox,Utils.array(arguments));return this;},closeLightbox:function(){this._lightbox.hide.apply(this._lightbox,Utils.array(arguments));return this;},hasVariation:function(variation){return $.inArray(variation,this._options.variation.split(/\s+/))>-1;},getActiveImage:function(){var active=this._getActive();return active?active.image:undef;},getActiveThumb:function(){return this._thumbnails[this._active].image||undef;},getMousePosition:function(e){return{x:e.pageX-this.$('container').offset().left,y:e.pageY-this.$('container').offset().top};},addPan:function(img){if(this._options.imageCrop===false){return;}
img=$(img||this.getActiveImage());var self=this,x=img.width()/ 2,y=img.height()/ 2,destX=parseInt(img.css('left'),10),destY=parseInt(img.css('top'),10),curX=destX||0,curY=destY||0,distX=0,distY=0,active=false,ts=Utils.timestamp(),cache=0,move=0,position=function(dist,cur,pos){if(dist>0){move=M.round(M.max(dist*-1,M.min(0,cur)));if(cache!==move){cache=move;if(IE===8){img.parent()['scroll'+pos](move*-1);}else{var css={};css[pos.toLowerCase()]=move;img.css(css);}}}},calculate=function(e){if(Utils.timestamp()-ts<50){return;}
active=true;x=self.getMousePosition(e).x;y=self.getMousePosition(e).y;},loop=function(e){if(!active){return;}
distX=img.width()-self._stageWidth;distY=img.height()-self._stageHeight;destX=x / self._stageWidth*distX*-1;destY=y / self._stageHeight*distY*-1;curX+=(destX-curX)/ self._options.imagePanSmoothness;curY+=(destY-curY)/ self._options.imagePanSmoothness;position(distY,curY,'Top');position(distX,curX,'Left');};if(IE===8){img.parent().scrollTop(curY*-1).scrollLeft(curX*-1);img.css({top:0,left:0});}
this.$('stage').off('mousemove',calculate).on('mousemove',calculate);this.addTimer('pan'+self._id,loop,50,true);return this;},proxy:function(fn,scope){if(typeof fn!=='function'){return F;}
scope=scope||this;return function(){return fn.apply(scope,Utils.array(arguments));};},getThemeName:function(){return this.theme.name;},removePan:function(){this.$('stage').off('mousemove');this.clearTimer('pan'+this._id);return this;},addElement:function(id){var dom=this._dom;$.each(Utils.array(arguments),function(i,blueprint){dom[blueprint]=Utils.create('galleria-'+blueprint);});return this;},attachKeyboard:function(map){this._keyboard.attach.apply(this._keyboard,Utils.array(arguments));return this;},detachKeyboard:function(){this._keyboard.detach.apply(this._keyboard,Utils.array(arguments));return this;},appendChild:function(parentID,childID){this.$(parentID).append(this.get(childID)||childID);return this;},prependChild:function(parentID,childID){this.$(parentID).prepend(this.get(childID)||childID);return this;},remove:function(elemID){this.$(Utils.array(arguments).join(',')).remove();return this;},append:function(data){var i,j;for(i in data){if(data.hasOwnProperty(i)){if(data[i].constructor===Array){for(j=0;data[i][j];j++){this.appendChild(i,data[i][j]);}}else{this.appendChild(i,data[i]);}}}
return this;},_scaleImage:function(image,options){image=image||this._controls.getActive();if(!image){return;}
var complete,scaleLayer=function(img){$(img.container).children(':first').css({top:M.max(0,Utils.parseValue(img.image.style.top)),left:M.max(0,Utils.parseValue(img.image.style.left)),width:Utils.parseValue(img.image.width),height:Utils.parseValue(img.image.height)});};options=$.extend({width:this._stageWidth,height:this._stageHeight,crop:this._options.imageCrop,max:this._options.maxScaleRatio,min:this._options.minScaleRatio,margin:this._options.imageMargin,position:this._options.imagePosition,iframelimit:this._options.maxVideoSize},options);if(this._options.layerFollow&&this._options.imageCrop!==true){if(typeof options.complete=='function'){complete=options.complete;options.complete=function(){complete.call(image,image);scaleLayer(image);};}else{options.complete=scaleLayer;}}else{$(image.container).children(':first').css({top:0,left:0});}
image.scale(options);return this;},updateCarousel:function(){this._carousel.update();return this;},resize:function(measures,complete){if(typeof measures=='function'){complete=measures;measures=undef;}
measures=$.extend({width:0,height:0},measures);var self=this,$container=this.$('container');$.each(measures,function(m,val){if(!val){$container[m]('auto');measures[m]=self._getWH()[m];}});$.each(measures,function(m,val){$container[m](val);});return this.rescale(complete);},rescale:function(width,height,complete){var self=this;if(typeof width==='function'){complete=width;width=undef;}
var scale=function(){self._stageWidth=width||self.$('stage').width();self._stageHeight=height||self.$('stage').height();if(self._options.swipe){$.each(self._controls.slides,function(i,img){self._scaleImage(img);$(img.container).css('left',self._stageWidth*i);});self.$('images').css('width',self._stageWidth*self.getDataLength());}else{self._scaleImage();}
if(self._options.carousel){self.updateCarousel();}
var frame=self._controls.frames[self._controls.active];if(frame){self._controls.frames[self._controls.active].scale({width:self._stageWidth,height:self._stageHeight,iframelimit:self._options.maxVideoSize});}
self.trigger(Galleria.RESCALE);if(typeof complete==='function'){complete.call(self);}};scale.call(self);return this;},refreshImage:function(){this._scaleImage();if(this._options.imagePan){this.addPan();}
return this;},_preload:function(){if(this._options.preload){var p,i,n=this.getNext(),ndata;try{for(i=this._options.preload;i>0;i--){p=new Galleria.Picture();ndata=this.getData(n);p.preload(this.isFullscreen()&&ndata.big?ndata.big:ndata.image);n=this.getNext(n);}}catch(e){}}},show:function(index,rewind,_history){var swipe=this._options.swipe;if(!swipe&&(this._queue.length>3||index===false||(!this._options.queue&&this._queue.stalled))){return;}
index=M.max(0,M.min(parseInt(index,10),this.getDataLength()-1));rewind=typeof rewind!=='undefined'?!!rewind:index<this.getIndex();_history=_history||false;if(!_history&&Galleria.History){Galleria.History.set(index.toString());return;}
if(this.finger&&index!==this._active){this.finger.to=-(index*this.finger.width);this.finger.index=index;}
this._active=index;if(swipe){var data=this.getData(index),self=this;if(!data){return;}
var src=this.isFullscreen()&&data.big?data.big:(data.image||data.iframe),image=this._controls.slides[index],cached=image.isCached(src),thumb=this._thumbnails[index];var evObj={cached:cached,index:index,rewind:rewind,imageTarget:image.image,thumbTarget:thumb.image,galleriaData:data};this.trigger($.extend(evObj,{type:Galleria.LOADSTART}));self.$('container').removeClass('videoplay');var complete=function(){self._layers[index].innerHTML=self.getData().layer||'';self.trigger($.extend(evObj,{type:Galleria.LOADFINISH}));self._playCheck();};self._preload();window.setTimeout(function(){if(!image.ready||$(image.image).attr('src')!=src){if(data.iframe&&!data.image){image.isIframe=true;}
image.load(src,function(image){evObj.imageTarget=image.image;self._scaleImage(image,complete).trigger($.extend(evObj,{type:Galleria.IMAGE}));complete();});}else{self.trigger($.extend(evObj,{type:Galleria.IMAGE}));complete();}},100);}else{protoArray.push.call(this._queue,{index:index,rewind:rewind});if(!this._queue.stalled){this._show();}}
return this;},_show:function(){var self=this,queue=this._queue[0],data=this.getData(queue.index);if(!data){return;}
var src=this.isFullscreen()&&data.big?data.big:(data.image||data.iframe),active=this._controls.getActive(),next=this._controls.getNext(),cached=next.isCached(src),thumb=this._thumbnails[queue.index],mousetrigger=function(){$(next.image).trigger('mouseup');};self.$('container').toggleClass('iframe',!!data.isIframe).removeClass('videoplay');var complete=(function(data,next,active,queue,thumb){return function(){var win;_transitions.active=false;Utils.toggleQuality(next.image,self._options.imageQuality);self._layers[self._controls.active].innerHTML='';$(active.container).css({zIndex:0,opacity:0}).show();$(active.container).find('iframe, .galleria-videoicon').remove();$(self._controls.frames[self._controls.active].container).hide();$(next.container).css({zIndex:1,left:0,top:0}).show();self._controls.swap();if(self._options.imagePan){self.addPan(next.image);}
if((data.iframe&&data.image)||data.link||self._options.lightbox||self._options.clicknext){$(next.image).css({cursor:'pointer'}).on('mouseup',function(e){if(typeof e.which=='number'&&e.which>1){return;}
if(data.iframe){if(self.isPlaying()){self.pause();}
var frame=self._controls.frames[self._controls.active],w=self._stageWidth,h=self._stageHeight;$(frame.container).css({width:w,height:h,opacity:0}).show().animate({opacity:1},200);window.setTimeout(function(){frame.load(data.iframe+(data.video?'&autoplay=1':''),{width:w,height:h},function(frame){self.$('container').addClass('videoplay');frame.scale({width:self._stageWidth,height:self._stageHeight,iframelimit:data.video?self._options.maxVideoSize:undef});});},100);return;}
if(self._options.clicknext&&!Galleria.TOUCH){if(self._options.pauseOnInteraction){self.pause();}
self.next();return;}
if(data.link){if(self._options.popupLinks){win=window.open(data.link,'_blank');}else{window.location.href=data.link;}
return;}
if(self._options.lightbox){self.openLightbox();}});}
self._playCheck();self.trigger({type:Galleria.IMAGE,index:queue.index,imageTarget:next.image,thumbTarget:thumb.image,galleriaData:data});protoArray.shift.call(self._queue);self._queue.stalled=false;if(self._queue.length){self._show();}};}(data,next,active,queue,thumb));if(this._options.carousel&&this._options.carouselFollow){this._carousel.follow(queue.index);}
self._preload();Utils.show(next.container);next.isIframe=data.iframe&&!data.image;$(self._thumbnails[queue.index].container).addClass('active').siblings('.active').removeClass('active');self.trigger({type:Galleria.LOADSTART,cached:cached,index:queue.index,rewind:queue.rewind,imageTarget:next.image,thumbTarget:thumb.image,galleriaData:data});self._queue.stalled=true;next.load(src,function(next){var layer=$(self._layers[1-self._controls.active]).html(data.layer||'').hide();self._scaleImage(next,{complete:function(next){if('image'in active){Utils.toggleQuality(active.image,false);}
Utils.toggleQuality(next.image,false);self.removePan();self.setInfo(queue.index);self.setCounter(queue.index);if(data.layer){layer.show();if((data.iframe&&data.image)||data.link||self._options.lightbox||self._options.clicknext){layer.css('cursor','pointer').off('mouseup').mouseup(mousetrigger);}}
if(data.video&&data.image){_playIcon(next.container);}
var transition=self._options.transition;$.each({initial:active.image===null,touch:Galleria.TOUCH,fullscreen:self.isFullscreen()},function(type,arg){if(arg&&self._options[type+'Transition']!==undef){transition=self._options[type+'Transition'];return false;}});if(transition in _transitions.effects===false){complete();}else{var params={prev:active.container,next:next.container,rewind:queue.rewind,speed:self._options.transitionSpeed||400};_transitions.active=true;_transitions.init.call(self,transition,params,complete);}
self.trigger({type:Galleria.LOADFINISH,cached:cached,index:queue.index,rewind:queue.rewind,imageTarget:next.image,thumbTarget:self._thumbnails[queue.index].image,galleriaData:self.getData(queue.index)});}});});},getNext:function(base){base=typeof base==='number'?base:this.getIndex();return base===this.getDataLength()-1?0:base+1;},getPrev:function(base){base=typeof base==='number'?base:this.getIndex();return base===0?this.getDataLength()-1:base-1;},next:function(){if(this.getDataLength()>1){this.show(this.getNext(),false);}
return this;},prev:function(){if(this.getDataLength()>1){this.show(this.getPrev(),true);}
return this;},get:function(elemId){return elemId in this._dom?this._dom[elemId]:null;},getData:function(index){return index in this._data?this._data[index]:this._data[this._active];},getDataLength:function(){return this._data.length;},getIndex:function(){return typeof this._active==='number'?this._active:false;},getStageHeight:function(){return this._stageHeight;},getStageWidth:function(){return this._stageWidth;},getOptions:function(key){return typeof key==='undefined'?this._options:this._options[key];},setOptions:function(key,value){if(typeof key==='object'){$.extend(this._options,key);}else{this._options[key]=value;}
return this;},play:function(delay){this._playing=true;this._playtime=delay||this._playtime;this._playCheck();this.trigger(Galleria.PLAY);return this;},pause:function(){this._playing=false;this.trigger(Galleria.PAUSE);return this;},playToggle:function(delay){return(this._playing)?this.pause():this.play(delay);},isPlaying:function(){return this._playing;},isFullscreen:function(){return this._fullscreen.active;},_playCheck:function(){var self=this,played=0,interval=20,now=Utils.timestamp(),timer_id='play'+this._id;if(this._playing){this.clearTimer(timer_id);var fn=function(){played=Utils.timestamp()-now;if(played>=self._playtime&&self._playing){self.clearTimer(timer_id);self.next();return;}
if(self._playing){self.trigger({type:Galleria.PROGRESS,percent:M.ceil(played / self._playtime*100),seconds:M.floor(played / 1000),milliseconds:played});self.addTimer(timer_id,fn,interval);}};self.addTimer(timer_id,fn,interval);}},setPlaytime:function(delay){this._playtime=delay;return this;},setIndex:function(val){this._active=val;return this;},setCounter:function(index){if(typeof index==='number'){index++;}else if(typeof index==='undefined'){index=this.getIndex()+1;}
this.get('current').innerHTML=index;if(IE){var count=this.$('counter'),opacity=count.css('opacity');if(parseInt(opacity,10)===1){Utils.removeAlpha(count[0]);}else{this.$('counter').css('opacity',opacity);}}
return this;},setInfo:function(index){var self=this,data=this.getData(index);$.each(['title','description'],function(i,type){var elem=self.$('info-'+type);if(!!data[type]){elem[data[type].length?'show':'hide']().html(data[type]);}else{elem.empty().hide();}});return this;},hasInfo:function(index){var check='title description'.split(' '),i;for(i=0;check[i];i++){if(!!this.getData(index)[check[i]]){return true;}}
return false;},jQuery:function(str){var self=this,ret=[];$.each(str.split(','),function(i,elemId){elemId=$.trim(elemId);if(self.get(elemId)){ret.push(elemId);}});var jQ=$(self.get(ret.shift()));$.each(ret,function(i,elemId){jQ=jQ.add(self.get(elemId));});return jQ;},$:function(str){return this.jQuery.apply(this,Utils.array(arguments));}};$.each(_events,function(i,ev){var type=/_/.test(ev)?ev.replace(/_/g,''):ev;Galleria[ev.toUpperCase()]='galleria.'+type;});$.extend(Galleria,{IE9:IE===9,IE8:IE===8,IE7:IE===7,IE6:IE===6,IE:IE,WEBKIT:/webkit/.test(NAV),CHROME:/chrome/.test(NAV),SAFARI:/safari/.test(NAV)&&!(/chrome/.test(NAV)),QUIRK:(IE&&doc.compatMode&&doc.compatMode==="BackCompat"),MAC:/mac/.test(navigator.platform.toLowerCase()),OPERA:!!window.opera,IPHONE:/iphone/.test(NAV),IPAD:/ipad/.test(NAV),ANDROID:/android/.test(NAV),TOUCH:('ontouchstart'in doc)});Galleria.addTheme=function(theme){if(!theme.name){Galleria.raise('No theme name specified');}
if(!theme.version||parseInt(Galleria.version*10)>parseInt(theme.version*10)){Galleria.raise('This version of Galleria requires '+theme.name+' theme version '+parseInt(Galleria.version*10)/10+' or later',true);}
if(typeof theme.defaults!=='object'){theme.defaults={};}else{theme.defaults=_legacyOptions(theme.defaults);}
var css=false,reg,reg2;if(typeof theme.css==='string'){$('link').each(function(i,link){reg=new RegExp(theme.css);if(reg.test(link.href)){css=true;_themeLoad(theme);return false;}});if(!css){$(function(){var retryCount=0;var tryLoadCss=function(){$('script').each(function(i,script){reg=new RegExp('galleria\\.'+theme.name.toLowerCase()+'\\.');reg2=new RegExp('galleria\\.io\\/theme\\/'+theme.name.toLowerCase()+'\\/(\\d*\\.*)?(\\d*\\.*)?(\\d*\\/)?js');if(reg.test(script.src)||reg2.test(script.src)){css=script.src.replace(/[^\/]*$/,'')+theme.css;window.setTimeout(function(){Utils.loadCSS(css,'galleria-theme-'+theme.name,function(){_themeLoad(theme);});},1);}});if(!css){if(retryCount++>5){Galleria.raise('No theme CSS loaded');}else{window.setTimeout(tryLoadCss,500);}}};tryLoadCss();});}}else{_themeLoad(theme);}
return theme;};Galleria.loadTheme=function(src,options){if($('script').filter(function(){return $(this).attr('src')==src;}).length){return;}
var loaded=false,err;$(window).on('load',function(){if(!loaded){err=window.setTimeout(function(){if(!loaded){Galleria.raise("Galleria had problems loading theme at "+src+". Please check theme path or load manually.",true);}},20000);}});Utils.loadScript(src,function(){loaded=true;window.clearTimeout(err);});return Galleria;};Galleria.get=function(index){if(!!_instances[index]){return _instances[index];}else if(typeof index!=='number'){return _instances;}else{Galleria.raise('Gallery index '+index+' not found');}};Galleria.configure=function(key,value){var opts={};if(typeof key=='string'&&value){opts[key]=value;key=opts;}else{$.extend(opts,key);}
Galleria.configure.options=opts;$.each(Galleria.get(),function(i,instance){instance.setOptions(opts);});return Galleria;};Galleria.configure.options={};Galleria.on=function(type,callback){if(!type){return;}
callback=callback||F;var hash=type+callback.toString().replace(/\s/g,'')+Utils.timestamp();$.each(Galleria.get(),function(i,instance){instance._binds.push(hash);instance.bind(type,callback);});Galleria.on.binds.push({type:type,callback:callback,hash:hash});return Galleria;};Galleria.on.binds=[];Galleria.run=function(selector,options){if($.isFunction(options)){options={extend:options};}
$(selector||'#galleria').galleria(options);return Galleria;};Galleria.addTransition=function(name,fn){_transitions.effects[name]=fn;return Galleria;};Galleria.utils=Utils;Galleria.log=function(){var args=Utils.array(arguments);if('console'in window&&'log'in window.console){try{return window.console.log.apply(window.console,args);}catch(e){$.each(args,function(){window.console.log(this);});}}else{return window.alert(args.join('<br>'));}};Galleria.ready=function(fn){if(typeof fn!='function'){return Galleria;}
$.each(_galleries,function(i,gallery){fn.call(gallery,gallery._options);});Galleria.ready.callbacks.push(fn);return Galleria;};Galleria.ready.callbacks=[];Galleria.raise=function(msg,fatal){var type=fatal?'Fatal error':'Error',css={color:'#fff',position:'absolute',top:0,left:0,zIndex:100000},echo=function(msg){var html='<div style="padding:4px;margin:0 0 2px;background:#'+
(fatal?'811':'222')+';">'+
(fatal?'<strong>'+type+': </strong>':'')+
msg+'</div>';$.each(_instances,function(){var cont=this.$('errors'),target=this.$('target');if(!cont.length){target.css('position','relative');cont=this.addElement('errors').appendChild('target','errors').$('errors').css(css);}
cont.append(html);});if(!_instances.length){$('<div>').css($.extend(css,{position:'fixed'})).append(html).appendTo(DOM().body);}};if(DEBUG){echo(msg);if(fatal){throw new Error(type+': '+msg);}}else if(fatal){if(_hasError){return;}
_hasError=true;fatal=false;echo('Gallery could not load.');}};Galleria.version=VERSION;Galleria.getLoadedThemes=function(){return $.map(_loadedThemes,function(theme){return theme.name;});};Galleria.requires=function(version,msg){msg=msg||'You need to upgrade Galleria to version '+version+' to use one or more components.';if(Galleria.version<version){Galleria.raise(msg,true);}
return Galleria;};Galleria.Picture=function(id){this.id=id||null;this.image=null;this.container=Utils.create('galleria-image');$(this.container).css({overflow:'hidden',position:'relative'});this.original={width:0,height:0};this.ready=false;this.isIframe=false;};Galleria.Picture.prototype={cache:{},show:function(){Utils.show(this.image);},hide:function(){Utils.moveOut(this.image);},clear:function(){this.image=null;},isCached:function(src){return!!this.cache[src];},preload:function(src){$(new Image()).on('load',(function(src,cache){return function(){cache[src]=src;};}(src,this.cache))).attr('src',src);},load:function(src,size,callback){if(typeof size=='function'){callback=size;size=null;}
if(this.isIframe){var id='if'+new Date().getTime();var iframe=this.image=$('<iframe>',{src:src,frameborder:0,id:id,allowfullscreen:true,css:{visibility:'hidden'}})[0];if(size){$(iframe).css(size);}
$(this.container).find('iframe,img').remove();this.container.appendChild(this.image);$('#'+id).on('load',(function(self,callback){return function(){window.setTimeout(function(){$(self.image).css('visibility','visible');if(typeof callback=='function'){callback.call(self,self);}},10);};}(this,callback)));return this.container;}
this.image=new Image();if(Galleria.IE8){$(this.image).css('filter','inherit');}
if(!Galleria.IE&&!Galleria.CHROME&&!Galleria.SAFARI){$(this.image).css('image-rendering','optimizequality');}
var reload=false,resort=false,$container=$(this.container),$image=$(this.image),onerror=function(){if(!reload){reload=true;window.setTimeout((function(image,src){return function(){image.attr('src',src+(src.indexOf('?')>-1?'&':'?')+Utils.timestamp());};}($(this),src)),50);}else{if(DUMMY){$(this).attr('src',DUMMY);}else{Galleria.raise('Image not found: '+src);}}},onload=(function(self,callback,src){return function(){var complete=function(){$(this).off('load');self.original=size||{height:this.height,width:this.width};if(Galleria.HAS3D){this.style.MozTransform=this.style.webkitTransform='translate3d(0,0,0)';}
$container.append(this);self.cache[src]=src;if(typeof callback=='function'){window.setTimeout(function(){callback.call(self,self);},1);}};if((!this.width||!this.height)){(function(img){Utils.wait({until:function(){return img.width&&img.height;},success:function(){complete.call(img);},error:function(){if(!resort){$(new Image()).on('load',onload).attr('src',img.src);resort=true;}else{Galleria.raise('Could not extract width/height from image: '+img.src+'. Traced measures: width:'+img.width+'px, height: '+img.height+'px.');}},timeout:100});}(this));}else{complete.call(this);}};}(this,callback,src));$container.find('iframe,img').remove();$image.css('display','block');Utils.hide(this.image);$.each('minWidth minHeight maxWidth maxHeight'.split(' '),function(i,prop){$image.css(prop,(/min/.test(prop)?'0':'none'));});$image.on('load',onload).on('error',onerror).attr('src',src);return this.container;},scale:function(options){var self=this;options=$.extend({width:0,height:0,min:undef,max:undef,margin:0,complete:F,position:'center',crop:false,canvas:false,iframelimit:undef},options);if(this.isIframe){var cw=options.width,ch=options.height,nw,nh;if(options.iframelimit){var r=M.min(options.iframelimit/cw,options.iframelimit/ch);if(r<1){nw=cw*r;nh=ch*r;$(this.image).css({top:ch/2-nh/2,left:cw/2-nw/2,position:'absolute'});}else{$(this.image).css({top:0,left:0});}}
$(this.image).width(nw||cw).height(nh||ch).removeAttr('width').removeAttr('height');$(this.container).width(cw).height(ch);options.complete.call(self,self);try{if(this.image.contentWindow){$(this.image.contentWindow).trigger('resize');}}catch(e){}
return this.container;}
if(!this.image){return this.container;}
var width,height,$container=$(self.container),data;Utils.wait({until:function(){width=options.width||$container.width()||Utils.parseValue($container.css('width'));height=options.height||$container.height()||Utils.parseValue($container.css('height'));return width&&height;},success:function(){var newWidth=(width-options.margin*2)/ self.original.width,newHeight=(height-options.margin*2)/ self.original.height,min=M.min(newWidth,newHeight),max=M.max(newWidth,newHeight),cropMap={'true':max,'width':newWidth,'height':newHeight,'false':min,'landscape':self.original.width>self.original.height?max:min,'portrait':self.original.width<self.original.height?max:min},ratio=cropMap[options.crop.toString()],canvasKey='';if(options.max){ratio=M.min(options.max,ratio);}
if(options.min){ratio=M.max(options.min,ratio);}
$.each(['width','height'],function(i,m){$(self.image)[m](self[m]=self.image[m]=M.round(self.original[m]*ratio));});$(self.container).width(width).height(height);if(options.canvas&&_canvas){_canvas.elem.width=self.width;_canvas.elem.height=self.height;canvasKey=self.image.src+':'+self.width+'x'+self.height;self.image.src=_canvas.cache[canvasKey]||(function(key){_canvas.context.drawImage(self.image,0,0,self.original.width*ratio,self.original.height*ratio);try{data=_canvas.elem.toDataURL();_canvas.length+=data.length;_canvas.cache[key]=data;return data;}catch(e){return self.image.src;}}(canvasKey));}
var pos={},mix={},getPosition=function(value,measure,margin){var result=0;if(/\%/.test(value)){var flt=parseInt(value,10)/ 100,m=self.image[measure]||$(self.image)[measure]();result=M.ceil(m*-1*flt+margin*flt);}else{result=Utils.parseValue(value);}
return result;},positionMap={'top':{top:0},'left':{left:0},'right':{left:'100%'},'bottom':{top:'100%'}};$.each(options.position.toLowerCase().split(' '),function(i,value){if(value==='center'){value='50%';}
pos[i?'top':'left']=value;});$.each(pos,function(i,value){if(positionMap.hasOwnProperty(value)){$.extend(mix,positionMap[value]);}});pos=pos.top?$.extend(pos,mix):mix;pos=$.extend({top:'50%',left:'50%'},pos);$(self.image).css({position:'absolute',top:getPosition(pos.top,'height',height),left:getPosition(pos.left,'width',width)});self.show();self.ready=true;options.complete.call(self,self);},error:function(){Galleria.raise('Could not scale image: '+self.image.src);},timeout:1000});return this;}};$.extend($.easing,{galleria:function(_,t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t+b;}
return c/2*((t-=2)*t*t+2)+b;},galleriaIn:function(_,t,b,c,d){return c*(t/=d)*t+b;},galleriaOut:function(_,t,b,c,d){return-c*(t/=d)*(t-2)+b;}});Galleria.Finger=(function(){var abs=M.abs;var has3d=Galleria.HAS3D=(function(){var el=doc.createElement('p'),has3d,t=['webkit','O','ms','Moz',''],s,i=0,a='transform';DOM().html.insertBefore(el,null);for(;t[i];i++){s=t[i]?t[i]+'Transform':a;if(el.style[s]!==undefined){el.style[s]="translate3d(1px,1px,1px)";has3d=$(el).css(t[i]?'-'+t[i].toLowerCase()+'-'+a:a);}}
DOM().html.removeChild(el);return(has3d!==undefined&&has3d.length>0&&has3d!=="none");}());var requestFrame=(function(){var r='RequestAnimationFrame';return window.requestAnimationFrame||window['webkit'+r]||window['moz'+r]||window['o'+r]||window['ms'+r]||function(callback){window.setTimeout(callback,1000 / 60);};}());var Finger=function(elem,options){this.config={start:0,duration:500,onchange:function(){},oncomplete:function(){},easing:function(x,t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b;}};this.easeout=function(x,t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b;};if(!elem.children.length){return;}
var self=this;$.extend(this.config,options);this.elem=elem;this.child=elem.children[0];this.to=this.pos=0;this.touching=false;this.start={};this.index=this.config.start;this.anim=0;this.easing=this.config.easing;if(!has3d){this.child.style.position='absolute';this.elem.style.position='relative';}
$.each(['ontouchstart','ontouchmove','ontouchend','setup'],function(i,fn){self[fn]=(function(caller){return function(){caller.apply(self,arguments);};}(self[fn]));});this.setX=function(){var style=self.child.style;if(!has3d){style.left=self.pos+'px';return;}
style.MozTransform=style.webkitTransform=style.transform='translate3d('+self.pos+'px,0,0)';return;};$(elem).on('touchstart',this.ontouchstart);$(window).on('resize',this.setup);$(window).on('orientationchange',this.setup);this.setup();(function animloop(){requestFrame(animloop);self.loop.call(self);}());};Finger.prototype={constructor:Finger,setup:function(){this.width=$(this.elem).width();this.length=M.ceil($(this.child).width()/ this.width);if(this.index!==0){this.index=M.max(0,M.min(this.index,this.length-1));this.pos=this.to=-this.width*this.index;}},setPosition:function(pos){this.pos=pos;this.to=pos;},ontouchstart:function(e){var touch=e.originalEvent.touches;this.start={pageX:touch[0].pageX,pageY:touch[0].pageY,time:+new Date()};this.isScrolling=null;this.touching=true;this.deltaX=0;$doc.on('touchmove',this.ontouchmove);$doc.on('touchend',this.ontouchend);},ontouchmove:function(e){var touch=e.originalEvent.touches;if(touch&&touch.length>1||e.scale&&e.scale!==1){return;}
this.deltaX=touch[0].pageX-this.start.pageX;if(this.isScrolling===null){this.isScrolling=!!(this.isScrolling||M.abs(this.deltaX)<M.abs(touch[0].pageY-this.start.pageY));}
if(!this.isScrolling){e.preventDefault();this.deltaX /=((!this.index&&this.deltaX>0||this.index==this.length-1&&this.deltaX<0)?(M.abs(this.deltaX)/ this.width+1.8):1);this.to=this.deltaX-this.index*this.width;}
e.stopPropagation();},ontouchend:function(e){this.touching=false;var isValidSlide=+new Date()-this.start.time<250&&M.abs(this.deltaX)>40||M.abs(this.deltaX)>this.width/2,isPastBounds=!this.index&&this.deltaX>0||this.index==this.length-1&&this.deltaX<0;if(!this.isScrolling){this.show(this.index+(isValidSlide&&!isPastBounds?(this.deltaX<0?1:-1):0));}
$doc.off('touchmove',this.ontouchmove);$doc.off('touchend',this.ontouchend);},show:function(index){if(index!=this.index){this.config.onchange.call(this,index);}else{this.to=-(index*this.width);}},moveTo:function(index){if(index!=this.index){this.pos=this.to=-(index*this.width);this.index=index;}},loop:function(){var distance=this.to-this.pos,factor=1;if(this.width&&distance){factor=M.max(0.5,M.min(1.5,M.abs(distance / this.width)));}
if(this.touching||M.abs(distance)<=1){this.pos=this.to;distance=0;if(this.anim&&!this.touching){this.config.oncomplete(this.index);}
this.anim=0;this.easing=this.config.easing;}else{if(!this.anim){this.anim={start:this.pos,time:+new Date(),distance:distance,factor:factor,destination:this.to};}
var elapsed=+new Date()-this.anim.time;var duration=this.config.duration*this.anim.factor;if(elapsed>duration||this.anim.destination!=this.to){this.anim=0;this.easing=this.easeout;return;}
this.pos=this.easing(null,elapsed,this.anim.start,this.anim.distance,duration);}
this.setX();}};return Finger;}());$.fn.galleria=function(options){var selector=this.selector;if(!$(this).length){$(function(){if($(selector).length){$(selector).galleria(options);}else{Galleria.utils.wait({until:function(){return $(selector).length;},success:function(){$(selector).galleria(options);},error:function(){Galleria.raise('Init failed: Galleria could not find the element "'+selector+'".');},timeout:5000});}});return this;}
return this.each(function(){if($.data(this,'galleria')){$.data(this,'galleria').destroy();$(this).find('*').hide();}
$.data(this,'galleria',new Galleria().init(this,options));});};if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=Galleria;}else{window.Galleria=Galleria;if(typeof define==="function"&&define.amd){define("galleria",['jquery'],function(){return Galleria;});}}}(jQuery,this));(function($){Galleria.addTheme({name:'compojoom',author:'Daniel Dimitrov daniel@compojoom.com',version:1.5,defaults:{transition:'pulse',imageCrop:'landscape',carousel:true,transitionSpeed:500,_showFullscreen:true,_showPopout:true,_showProgress:true,_showTooltip:true,_toggleInfo:true},init:function(options){this.addElement('info-link','info-close','bar','fullscreen fa fa-arrows-alt','progress');this.append({'stage':'progress','container':'bar','info':['info-link','info-close'],'bar':["thumbnails-container",'fullscreen fa fa-arrows-alt']});var gallery=this,thumbs=this.$('thumbnails-container'),fs_link=this.$('fullscreen fa fa-arrows-alt'),transition=options.transition,bar=this.$('bar'),OPEN=false,FULLSCREEN=false;this.bind('image',function(e){$(e.imageTarget).unbind('dblclick').on('dblclick',function(){gallery.toggleFullscreen();});});fs_link.click(function(){if(FULLSCREEN){gallery.exitFullscreen();}else{gallery.enterFullscreen();}});toggleThumbs=function(e){if(OPEN&&CONTINUE){gallery.play();}else{CONTINUE=PLAYING;gallery.pause();}
Galleria.utils.animate(thumbs,{top:OPEN?gallery.getStageHeight()+30:0},{easing:'galleria',duration:400,complete:function(){gallery.defineTooltip('thumblink',OPEN?lang.show_thumbnails:lang.hide_thumbnails);thumb_link[OPEN?'removeClass':'addClass']('open');OPEN=!OPEN;}});};var info=this.$('info-link,info-close,info-text'),touch=Galleria.TOUCH;this.$('loader,counter').show().css('opacity',0.4);if(!touch){this.addIdleState(this.get('image-nav-left'),{left:-50});this.addIdleState(this.get('image-nav-right'),{right:-50});this.addIdleState(this.get('counter'),{opacity:0});}
if(options._toggleInfo===true){info.bind('click:fast',function(){info.toggle();});}else{info.show();this.$('info-link, info-close').hide();}
this.bind('thumbnail',function(e){if(!touch){$(e.thumbTarget).css('opacity',0.6).parent().hover(function(){$(this).not('.active').children().stop().fadeTo(100,1);},function(){$(this).not('.active').children().stop().fadeTo(400,0.6);});if(e.index===this.getIndex()){$(e.thumbTarget).css('opacity',1);}}else{$(e.thumbTarget).css('opacity',this.getIndex()?1:0.6).bind('click:fast',function(){$(this).css('opacity',1).parent().siblings().children().css('opacity',0.6);});}});var activate=function(e){$(e.thumbTarget).css('opacity',1).parent().siblings().children().css('opacity',0.6);};this.bind('loadstart',function(e){if(!e.cached){this.$('loader').show().fadeTo(200,0.4);}
window.setTimeout(function(){activate(e);},touch?300:0);this.$('info').toggle(this.hasInfo());});this.bind('loadfinish',function(e){this.$('loader').fadeOut(200);});this.bind('fullscreen_enter',function(e){FULLSCREEN=true;gallery.setOptions('transition',false);fs_link.addClass('open');bar.css('bottom',0);this.defineTooltip('fullscreen','afullscreen enter');});this.bind('fullscreen_exit',function(e){FULLSCREEN=false;Galleria.utils.clearTimer('bar');gallery.setOptions('transition',transition);fs_link.removeClass('open');bar.css('bottom',0);this.defineTooltip('fullscreen','fullscreen leave');});}});}(jQuery));
/*!

 handlebars v2.0.0

Copyright (C) 2011-2014 by Yehuda Katz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

@license
*/
(function(root,factory){if(typeof define==='function'&&define.amd){define([],factory);}else if(typeof exports==='object'){module.exports=factory();}else{root.Handlebars=root.Handlebars||factory();}}(this,function(){var __module4__=(function(){"use strict";var __exports__;function SafeString(string){this.string=string;}
SafeString.prototype.toString=function(){return""+this.string;};__exports__=SafeString;return __exports__;})();var __module3__=(function(__dependency1__){"use strict";var __exports__={};var SafeString=__dependency1__;var escape={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var badChars=/[&<>"'`]/g;var possible=/[&<>"'`]/;function escapeChar(chr){return escape[chr];}
function extend(obj){for(var i=1;i<arguments.length;i++){for(var key in arguments[i]){if(Object.prototype.hasOwnProperty.call(arguments[i],key)){obj[key]=arguments[i][key];}}}
return obj;}
__exports__.extend=extend;var toString=Object.prototype.toString;__exports__.toString=toString;var isFunction=function(value){return typeof value==='function';};if(isFunction(/x/)){isFunction=function(value){return typeof value==='function'&&toString.call(value)==='[object Function]';};}
var isFunction;__exports__.isFunction=isFunction;var isArray=Array.isArray||function(value){return(value&&typeof value==='object')?toString.call(value)==='[object Array]':false;};__exports__.isArray=isArray;function escapeExpression(string){if(string instanceof SafeString){return string.toString();}else if(string==null){return"";}else if(!string){return string+'';}
string=""+string;if(!possible.test(string)){return string;}
return string.replace(badChars,escapeChar);}
__exports__.escapeExpression=escapeExpression;function isEmpty(value){if(!value&&value!==0){return true;}else if(isArray(value)&&value.length===0){return true;}else{return false;}}
__exports__.isEmpty=isEmpty;function appendContextPath(contextPath,id){return(contextPath?contextPath+'.':'')+id;}
__exports__.appendContextPath=appendContextPath;return __exports__;})(__module4__);var __module5__=(function(){"use strict";var __exports__;var errorProps=['description','fileName','lineNumber','message','name','number','stack'];function Exception(message,node){var line;if(node&&node.firstLine){line=node.firstLine;message+=' - '+line+':'+node.firstColumn;}
var tmp=Error.prototype.constructor.call(this,message);for(var idx=0;idx<errorProps.length;idx++){this[errorProps[idx]]=tmp[errorProps[idx]];}
if(line){this.lineNumber=line;this.column=node.firstColumn;}}
Exception.prototype=new Error();__exports__=Exception;return __exports__;})();var __module2__=(function(__dependency1__,__dependency2__){"use strict";var __exports__={};var Utils=__dependency1__;var Exception=__dependency2__;var VERSION="2.0.0";__exports__.VERSION=VERSION;var COMPILER_REVISION=6;__exports__.COMPILER_REVISION=COMPILER_REVISION;var REVISION_CHANGES={1:'<= 1.0.rc.2',2:'== 1.0.0-rc.3',3:'== 1.0.0-rc.4',4:'== 1.x.x',5:'== 2.0.0-alpha.x',6:'>= 2.0.0-beta.1'};__exports__.REVISION_CHANGES=REVISION_CHANGES;var isArray=Utils.isArray,isFunction=Utils.isFunction,toString=Utils.toString,objectType='[object Object]';function HandlebarsEnvironment(helpers,partials){this.helpers=helpers||{};this.partials=partials||{};registerDefaultHelpers(this);}
__exports__.HandlebarsEnvironment=HandlebarsEnvironment;HandlebarsEnvironment.prototype={constructor:HandlebarsEnvironment,logger:logger,log:log,registerHelper:function(name,fn){if(toString.call(name)===objectType){if(fn){throw new Exception('Arg not supported with multiple helpers');}
Utils.extend(this.helpers,name);}else{this.helpers[name]=fn;}},unregisterHelper:function(name){delete this.helpers[name];},registerPartial:function(name,partial){if(toString.call(name)===objectType){Utils.extend(this.partials,name);}else{this.partials[name]=partial;}},unregisterPartial:function(name){delete this.partials[name];}};function registerDefaultHelpers(instance){instance.registerHelper('helperMissing',function(){if(arguments.length===1){return undefined;}else{throw new Exception("Missing helper: '"+arguments[arguments.length-1].name+"'");}});instance.registerHelper('blockHelperMissing',function(context,options){var inverse=options.inverse,fn=options.fn;if(context===true){return fn(this);}else if(context===false||context==null){return inverse(this);}else if(isArray(context)){if(context.length>0){if(options.ids){options.ids=[options.name];}
return instance.helpers.each(context,options);}else{return inverse(this);}}else{if(options.data&&options.ids){var data=createFrame(options.data);data.contextPath=Utils.appendContextPath(options.data.contextPath,options.name);options={data:data};}
return fn(context,options);}});instance.registerHelper('each',function(context,options){if(!options){throw new Exception('Must pass iterator to #each');}
var fn=options.fn,inverse=options.inverse;var i=0,ret="",data;var contextPath;if(options.data&&options.ids){contextPath=Utils.appendContextPath(options.data.contextPath,options.ids[0])+'.';}
if(isFunction(context)){context=context.call(this);}
if(options.data){data=createFrame(options.data);}
if(context&&typeof context==='object'){if(isArray(context)){for(var j=context.length;i<j;i++){if(data){data.index=i;data.first=(i===0);data.last=(i===(context.length-1));if(contextPath){data.contextPath=contextPath+i;}}
ret=ret+fn(context[i],{data:data});}}else{for(var key in context){if(context.hasOwnProperty(key)){if(data){data.key=key;data.index=i;data.first=(i===0);if(contextPath){data.contextPath=contextPath+key;}}
ret=ret+fn(context[key],{data:data});i++;}}}}
if(i===0){ret=inverse(this);}
return ret;});instance.registerHelper('if',function(conditional,options){if(isFunction(conditional)){conditional=conditional.call(this);}
if((!options.hash.includeZero&&!conditional)||Utils.isEmpty(conditional)){return options.inverse(this);}else{return options.fn(this);}});instance.registerHelper('unless',function(conditional,options){return instance.helpers['if'].call(this,conditional,{fn:options.inverse,inverse:options.fn,hash:options.hash});});instance.registerHelper('with',function(context,options){if(isFunction(context)){context=context.call(this);}
var fn=options.fn;if(!Utils.isEmpty(context)){if(options.data&&options.ids){var data=createFrame(options.data);data.contextPath=Utils.appendContextPath(options.data.contextPath,options.ids[0]);options={data:data};}
return fn(context,options);}else{return options.inverse(this);}});instance.registerHelper('log',function(message,options){var level=options.data&&options.data.level!=null?parseInt(options.data.level,10):1;instance.log(level,message);});instance.registerHelper('lookup',function(obj,field){return obj&&obj[field];});}
var logger={methodMap:{0:'debug',1:'info',2:'warn',3:'error'},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(level,message){if(logger.level<=level){var method=logger.methodMap[level];if(typeof console!=='undefined'&&console[method]){console[method].call(console,message);}}}};__exports__.logger=logger;var log=logger.log;__exports__.log=log;var createFrame=function(object){var frame=Utils.extend({},object);frame._parent=object;return frame;};__exports__.createFrame=createFrame;return __exports__;})(__module3__,__module5__);var __module6__=(function(__dependency1__,__dependency2__,__dependency3__){"use strict";var __exports__={};var Utils=__dependency1__;var Exception=__dependency2__;var COMPILER_REVISION=__dependency3__.COMPILER_REVISION;var REVISION_CHANGES=__dependency3__.REVISION_CHANGES;var createFrame=__dependency3__.createFrame;function checkRevision(compilerInfo){var compilerRevision=compilerInfo&&compilerInfo[0]||1,currentRevision=COMPILER_REVISION;if(compilerRevision!==currentRevision){if(compilerRevision<currentRevision){var runtimeVersions=REVISION_CHANGES[currentRevision],compilerVersions=REVISION_CHANGES[compilerRevision];throw new Exception("Template was precompiled with an older version of Handlebars than the current runtime. "+"Please update your precompiler to a newer version ("+runtimeVersions+") or downgrade your runtime to an older version ("+compilerVersions+").");}else{throw new Exception("Template was precompiled with a newer version of Handlebars than the current runtime. "+"Please update your runtime to a newer version ("+compilerInfo[1]+").");}}}
__exports__.checkRevision=checkRevision;function template(templateSpec,env){if(!env){throw new Exception("No environment passed to template");}
if(!templateSpec||!templateSpec.main){throw new Exception('Unknown template object: '+typeof templateSpec);}
env.VM.checkRevision(templateSpec.compiler);var invokePartialWrapper=function(partial,indent,name,context,hash,helpers,partials,data,depths){if(hash){context=Utils.extend({},context,hash);}
var result=env.VM.invokePartial.call(this,partial,name,context,helpers,partials,data,depths);if(result==null&&env.compile){var options={helpers:helpers,partials:partials,data:data,depths:depths};partials[name]=env.compile(partial,{data:data!==undefined,compat:templateSpec.compat},env);result=partials[name](context,options);}
if(result!=null){if(indent){var lines=result.split('\n');for(var i=0,l=lines.length;i<l;i++){if(!lines[i]&&i+1===l){break;}
lines[i]=indent+lines[i];}
result=lines.join('\n');}
return result;}else{throw new Exception("The partial "+name+" could not be compiled when running in runtime-only mode");}};var container={lookup:function(depths,name){var len=depths.length;for(var i=0;i<len;i++){if(depths[i]&&depths[i][name]!=null){return depths[i][name];}}},lambda:function(current,context){return typeof current==='function'?current.call(context):current;},escapeExpression:Utils.escapeExpression,invokePartial:invokePartialWrapper,fn:function(i){return templateSpec[i];},programs:[],program:function(i,data,depths){var programWrapper=this.programs[i],fn=this.fn(i);if(data||depths){programWrapper=program(this,i,fn,data,depths);}else if(!programWrapper){programWrapper=this.programs[i]=program(this,i,fn);}
return programWrapper;},data:function(data,depth){while(data&&depth--){data=data._parent;}
return data;},merge:function(param,common){var ret=param||common;if(param&&common&&(param!==common)){ret=Utils.extend({},common,param);}
return ret;},noop:env.VM.noop,compilerInfo:templateSpec.compiler};var ret=function(context,options){options=options||{};var data=options.data;ret._setup(options);if(!options.partial&&templateSpec.useData){data=initData(context,data);}
var depths;if(templateSpec.useDepths){depths=options.depths?[context].concat(options.depths):[context];}
return templateSpec.main.call(container,context,container.helpers,container.partials,data,depths);};ret.isTop=true;ret._setup=function(options){if(!options.partial){container.helpers=container.merge(options.helpers,env.helpers);if(templateSpec.usePartial){container.partials=container.merge(options.partials,env.partials);}}else{container.helpers=options.helpers;container.partials=options.partials;}};ret._child=function(i,data,depths){if(templateSpec.useDepths&&!depths){throw new Exception('must pass parent depths');}
return program(container,i,templateSpec[i],data,depths);};return ret;}
__exports__.template=template;function program(container,i,fn,data,depths){var prog=function(context,options){options=options||{};return fn.call(container,context,container.helpers,container.partials,options.data||data,depths&&[context].concat(depths));};prog.program=i;prog.depth=depths?depths.length:0;return prog;}
__exports__.program=program;function invokePartial(partial,name,context,helpers,partials,data,depths){var options={partial:true,helpers:helpers,partials:partials,data:data,depths:depths};if(partial===undefined){throw new Exception("The partial "+name+" could not be found");}else if(partial instanceof Function){return partial(context,options);}}
__exports__.invokePartial=invokePartial;function noop(){return"";}
__exports__.noop=noop;function initData(context,data){if(!data||!('root'in data)){data=data?createFrame(data):{};data.root=context;}
return data;}
return __exports__;})(__module3__,__module5__,__module2__);var __module1__=(function(__dependency1__,__dependency2__,__dependency3__,__dependency4__,__dependency5__){"use strict";var __exports__;var base=__dependency1__;var SafeString=__dependency2__;var Exception=__dependency3__;var Utils=__dependency4__;var runtime=__dependency5__;var create=function(){var hb=new base.HandlebarsEnvironment();Utils.extend(hb,base);hb.SafeString=SafeString;hb.Exception=Exception;hb.Utils=Utils;hb.escapeExpression=Utils.escapeExpression;hb.VM=runtime;hb.template=function(spec){return runtime.template(spec,hb);};return hb;};var Handlebars=create();Handlebars.create=create;Handlebars['default']=Handlebars;__exports__=Handlebars;return __exports__;})(__module2__,__module4__,__module5__,__module3__,__module6__);var __module7__=(function(__dependency1__){"use strict";var __exports__;var Exception=__dependency1__;function LocationInfo(locInfo){locInfo=locInfo||{};this.firstLine=locInfo.first_line;this.firstColumn=locInfo.first_column;this.lastColumn=locInfo.last_column;this.lastLine=locInfo.last_line;}
var AST={ProgramNode:function(statements,strip,locInfo){LocationInfo.call(this,locInfo);this.type="program";this.statements=statements;this.strip=strip;},MustacheNode:function(rawParams,hash,open,strip,locInfo){LocationInfo.call(this,locInfo);this.type="mustache";this.strip=strip;if(open!=null&&open.charAt){var escapeFlag=open.charAt(3)||open.charAt(2);this.escaped=escapeFlag!=='{'&&escapeFlag!=='&';}else{this.escaped=!!open;}
if(rawParams instanceof AST.SexprNode){this.sexpr=rawParams;}else{this.sexpr=new AST.SexprNode(rawParams,hash);}
this.id=this.sexpr.id;this.params=this.sexpr.params;this.hash=this.sexpr.hash;this.eligibleHelper=this.sexpr.eligibleHelper;this.isHelper=this.sexpr.isHelper;},SexprNode:function(rawParams,hash,locInfo){LocationInfo.call(this,locInfo);this.type="sexpr";this.hash=hash;var id=this.id=rawParams[0];var params=this.params=rawParams.slice(1);this.isHelper=!!(params.length||hash);this.eligibleHelper=this.isHelper||id.isSimple;},PartialNode:function(partialName,context,hash,strip,locInfo){LocationInfo.call(this,locInfo);this.type="partial";this.partialName=partialName;this.context=context;this.hash=hash;this.strip=strip;this.strip.inlineStandalone=true;},BlockNode:function(mustache,program,inverse,strip,locInfo){LocationInfo.call(this,locInfo);this.type='block';this.mustache=mustache;this.program=program;this.inverse=inverse;this.strip=strip;if(inverse&&!program){this.isInverse=true;}},RawBlockNode:function(mustache,content,close,locInfo){LocationInfo.call(this,locInfo);if(mustache.sexpr.id.original!==close){throw new Exception(mustache.sexpr.id.original+" doesn't match "+close,this);}
content=new AST.ContentNode(content,locInfo);this.type='block';this.mustache=mustache;this.program=new AST.ProgramNode([content],{},locInfo);},ContentNode:function(string,locInfo){LocationInfo.call(this,locInfo);this.type="content";this.original=this.string=string;},HashNode:function(pairs,locInfo){LocationInfo.call(this,locInfo);this.type="hash";this.pairs=pairs;},IdNode:function(parts,locInfo){LocationInfo.call(this,locInfo);this.type="ID";var original="",dig=[],depth=0,depthString='';for(var i=0,l=parts.length;i<l;i++){var part=parts[i].part;original+=(parts[i].separator||'')+part;if(part===".."||part==="."||part==="this"){if(dig.length>0){throw new Exception("Invalid path: "+original,this);}else if(part===".."){depth++;depthString+='../';}else{this.isScoped=true;}}else{dig.push(part);}}
this.original=original;this.parts=dig;this.string=dig.join('.');this.depth=depth;this.idName=depthString+this.string;this.isSimple=parts.length===1&&!this.isScoped&&depth===0;this.stringModeValue=this.string;},PartialNameNode:function(name,locInfo){LocationInfo.call(this,locInfo);this.type="PARTIAL_NAME";this.name=name.original;},DataNode:function(id,locInfo){LocationInfo.call(this,locInfo);this.type="DATA";this.id=id;this.stringModeValue=id.stringModeValue;this.idName='@'+id.stringModeValue;},StringNode:function(string,locInfo){LocationInfo.call(this,locInfo);this.type="STRING";this.original=this.string=this.stringModeValue=string;},NumberNode:function(number,locInfo){LocationInfo.call(this,locInfo);this.type="NUMBER";this.original=this.number=number;this.stringModeValue=Number(number);},BooleanNode:function(bool,locInfo){LocationInfo.call(this,locInfo);this.type="BOOLEAN";this.bool=bool;this.stringModeValue=bool==="true";},CommentNode:function(comment,locInfo){LocationInfo.call(this,locInfo);this.type="comment";this.comment=comment;this.strip={inlineStandalone:true};}};__exports__=AST;return __exports__;})(__module5__);var __module9__=(function(){"use strict";var __exports__;var handlebars=(function(){var parser={trace:function trace(){},yy:{},symbols_:{"error":2,"root":3,"program":4,"EOF":5,"program_repetition0":6,"statement":7,"mustache":8,"block":9,"rawBlock":10,"partial":11,"CONTENT":12,"COMMENT":13,"openRawBlock":14,"END_RAW_BLOCK":15,"OPEN_RAW_BLOCK":16,"sexpr":17,"CLOSE_RAW_BLOCK":18,"openBlock":19,"block_option0":20,"closeBlock":21,"openInverse":22,"block_option1":23,"OPEN_BLOCK":24,"CLOSE":25,"OPEN_INVERSE":26,"inverseAndProgram":27,"INVERSE":28,"OPEN_ENDBLOCK":29,"path":30,"OPEN":31,"OPEN_UNESCAPED":32,"CLOSE_UNESCAPED":33,"OPEN_PARTIAL":34,"partialName":35,"param":36,"partial_option0":37,"partial_option1":38,"sexpr_repetition0":39,"sexpr_option0":40,"dataName":41,"STRING":42,"NUMBER":43,"BOOLEAN":44,"OPEN_SEXPR":45,"CLOSE_SEXPR":46,"hash":47,"hash_repetition_plus0":48,"hashSegment":49,"ID":50,"EQUALS":51,"DATA":52,"pathSegments":53,"SEP":54,"$accept":0,"$end":1},terminals_:{2:"error",5:"EOF",12:"CONTENT",13:"COMMENT",15:"END_RAW_BLOCK",16:"OPEN_RAW_BLOCK",18:"CLOSE_RAW_BLOCK",24:"OPEN_BLOCK",25:"CLOSE",26:"OPEN_INVERSE",28:"INVERSE",29:"OPEN_ENDBLOCK",31:"OPEN",32:"OPEN_UNESCAPED",33:"CLOSE_UNESCAPED",34:"OPEN_PARTIAL",42:"STRING",43:"NUMBER",44:"BOOLEAN",45:"OPEN_SEXPR",46:"CLOSE_SEXPR",50:"ID",51:"EQUALS",52:"DATA",54:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[10,3],[14,3],[9,4],[9,4],[19,3],[22,3],[27,2],[21,3],[8,3],[8,3],[11,5],[11,4],[17,3],[17,1],[36,1],[36,1],[36,1],[36,1],[36,1],[36,3],[47,1],[49,3],[35,1],[35,1],[35,1],[41,2],[30,1],[53,3],[53,1],[6,0],[6,2],[20,0],[20,1],[23,0],[23,1],[37,0],[37,1],[38,0],[38,1],[39,0],[39,2],[40,0],[40,1],[48,1],[48,2]],performAction:function anonymous(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:yy.prepareProgram($$[$0-1].statements,true);return $$[$0-1];break;case 2:this.$=new yy.ProgramNode(yy.prepareProgram($$[$0]),{},this._$);break;case 3:this.$=$$[$0];break;case 4:this.$=$$[$0];break;case 5:this.$=$$[$0];break;case 6:this.$=$$[$0];break;case 7:this.$=new yy.ContentNode($$[$0],this._$);break;case 8:this.$=new yy.CommentNode($$[$0],this._$);break;case 9:this.$=new yy.RawBlockNode($$[$0-2],$$[$0-1],$$[$0],this._$);break;case 10:this.$=new yy.MustacheNode($$[$0-1],null,'','',this._$);break;case 11:this.$=yy.prepareBlock($$[$0-3],$$[$0-2],$$[$0-1],$$[$0],false,this._$);break;case 12:this.$=yy.prepareBlock($$[$0-3],$$[$0-2],$$[$0-1],$$[$0],true,this._$);break;case 13:this.$=new yy.MustacheNode($$[$0-1],null,$$[$0-2],yy.stripFlags($$[$0-2],$$[$0]),this._$);break;case 14:this.$=new yy.MustacheNode($$[$0-1],null,$$[$0-2],yy.stripFlags($$[$0-2],$$[$0]),this._$);break;case 15:this.$={strip:yy.stripFlags($$[$0-1],$$[$0-1]),program:$$[$0]};break;case 16:this.$={path:$$[$0-1],strip:yy.stripFlags($$[$0-2],$$[$0])};break;case 17:this.$=new yy.MustacheNode($$[$0-1],null,$$[$0-2],yy.stripFlags($$[$0-2],$$[$0]),this._$);break;case 18:this.$=new yy.MustacheNode($$[$0-1],null,$$[$0-2],yy.stripFlags($$[$0-2],$$[$0]),this._$);break;case 19:this.$=new yy.PartialNode($$[$0-3],$$[$0-2],$$[$0-1],yy.stripFlags($$[$0-4],$$[$0]),this._$);break;case 20:this.$=new yy.PartialNode($$[$0-2],undefined,$$[$0-1],yy.stripFlags($$[$0-3],$$[$0]),this._$);break;case 21:this.$=new yy.SexprNode([$$[$0-2]].concat($$[$0-1]),$$[$0],this._$);break;case 22:this.$=new yy.SexprNode([$$[$0]],null,this._$);break;case 23:this.$=$$[$0];break;case 24:this.$=new yy.StringNode($$[$0],this._$);break;case 25:this.$=new yy.NumberNode($$[$0],this._$);break;case 26:this.$=new yy.BooleanNode($$[$0],this._$);break;case 27:this.$=$$[$0];break;case 28:$$[$0-1].isHelper=true;this.$=$$[$0-1];break;case 29:this.$=new yy.HashNode($$[$0],this._$);break;case 30:this.$=[$$[$0-2],$$[$0]];break;case 31:this.$=new yy.PartialNameNode($$[$0],this._$);break;case 32:this.$=new yy.PartialNameNode(new yy.StringNode($$[$0],this._$),this._$);break;case 33:this.$=new yy.PartialNameNode(new yy.NumberNode($$[$0],this._$));break;case 34:this.$=new yy.DataNode($$[$0],this._$);break;case 35:this.$=new yy.IdNode($$[$0],this._$);break;case 36:$$[$0-2].push({part:$$[$0],separator:$$[$0-1]});this.$=$$[$0-2];break;case 37:this.$=[{part:$$[$0]}];break;case 38:this.$=[];break;case 39:$$[$0-1].push($$[$0]);break;case 48:this.$=[];break;case 49:$$[$0-1].push($$[$0]);break;case 52:this.$=[$$[$0]];break;case 53:$$[$0-1].push($$[$0]);break;}},table:[{3:1,4:2,5:[2,38],6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],31:[2,38],32:[2,38],34:[2,38]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:[1,10],13:[1,11],14:16,16:[1,20],19:14,22:15,24:[1,18],26:[1,19],28:[2,2],29:[2,2],31:[1,12],32:[1,13],34:[1,17]},{1:[2,1]},{5:[2,39],12:[2,39],13:[2,39],16:[2,39],24:[2,39],26:[2,39],28:[2,39],29:[2,39],31:[2,39],32:[2,39],34:[2,39]},{5:[2,3],12:[2,3],13:[2,3],16:[2,3],24:[2,3],26:[2,3],28:[2,3],29:[2,3],31:[2,3],32:[2,3],34:[2,3]},{5:[2,4],12:[2,4],13:[2,4],16:[2,4],24:[2,4],26:[2,4],28:[2,4],29:[2,4],31:[2,4],32:[2,4],34:[2,4]},{5:[2,5],12:[2,5],13:[2,5],16:[2,5],24:[2,5],26:[2,5],28:[2,5],29:[2,5],31:[2,5],32:[2,5],34:[2,5]},{5:[2,6],12:[2,6],13:[2,6],16:[2,6],24:[2,6],26:[2,6],28:[2,6],29:[2,6],31:[2,6],32:[2,6],34:[2,6]},{5:[2,7],12:[2,7],13:[2,7],16:[2,7],24:[2,7],26:[2,7],28:[2,7],29:[2,7],31:[2,7],32:[2,7],34:[2,7]},{5:[2,8],12:[2,8],13:[2,8],16:[2,8],24:[2,8],26:[2,8],28:[2,8],29:[2,8],31:[2,8],32:[2,8],34:[2,8]},{17:21,30:22,41:23,50:[1,26],52:[1,25],53:24},{17:27,30:22,41:23,50:[1,26],52:[1,25],53:24},{4:28,6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],28:[2,38],29:[2,38],31:[2,38],32:[2,38],34:[2,38]},{4:29,6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],28:[2,38],29:[2,38],31:[2,38],32:[2,38],34:[2,38]},{12:[1,30]},{30:32,35:31,42:[1,33],43:[1,34],50:[1,26],53:24},{17:35,30:22,41:23,50:[1,26],52:[1,25],53:24},{17:36,30:22,41:23,50:[1,26],52:[1,25],53:24},{17:37,30:22,41:23,50:[1,26],52:[1,25],53:24},{25:[1,38]},{18:[2,48],25:[2,48],33:[2,48],39:39,42:[2,48],43:[2,48],44:[2,48],45:[2,48],46:[2,48],50:[2,48],52:[2,48]},{18:[2,22],25:[2,22],33:[2,22],46:[2,22]},{18:[2,35],25:[2,35],33:[2,35],42:[2,35],43:[2,35],44:[2,35],45:[2,35],46:[2,35],50:[2,35],52:[2,35],54:[1,40]},{30:41,50:[1,26],53:24},{18:[2,37],25:[2,37],33:[2,37],42:[2,37],43:[2,37],44:[2,37],45:[2,37],46:[2,37],50:[2,37],52:[2,37],54:[2,37]},{33:[1,42]},{20:43,27:44,28:[1,45],29:[2,40]},{23:46,27:47,28:[1,45],29:[2,42]},{15:[1,48]},{25:[2,46],30:51,36:49,38:50,41:55,42:[1,52],43:[1,53],44:[1,54],45:[1,56],47:57,48:58,49:60,50:[1,59],52:[1,25],53:24},{25:[2,31],42:[2,31],43:[2,31],44:[2,31],45:[2,31],50:[2,31],52:[2,31]},{25:[2,32],42:[2,32],43:[2,32],44:[2,32],45:[2,32],50:[2,32],52:[2,32]},{25:[2,33],42:[2,33],43:[2,33],44:[2,33],45:[2,33],50:[2,33],52:[2,33]},{25:[1,61]},{25:[1,62]},{18:[1,63]},{5:[2,17],12:[2,17],13:[2,17],16:[2,17],24:[2,17],26:[2,17],28:[2,17],29:[2,17],31:[2,17],32:[2,17],34:[2,17]},{18:[2,50],25:[2,50],30:51,33:[2,50],36:65,40:64,41:55,42:[1,52],43:[1,53],44:[1,54],45:[1,56],46:[2,50],47:66,48:58,49:60,50:[1,59],52:[1,25],53:24},{50:[1,67]},{18:[2,34],25:[2,34],33:[2,34],42:[2,34],43:[2,34],44:[2,34],45:[2,34],46:[2,34],50:[2,34],52:[2,34]},{5:[2,18],12:[2,18],13:[2,18],16:[2,18],24:[2,18],26:[2,18],28:[2,18],29:[2,18],31:[2,18],32:[2,18],34:[2,18]},{21:68,29:[1,69]},{29:[2,41]},{4:70,6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],29:[2,38],31:[2,38],32:[2,38],34:[2,38]},{21:71,29:[1,69]},{29:[2,43]},{5:[2,9],12:[2,9],13:[2,9],16:[2,9],24:[2,9],26:[2,9],28:[2,9],29:[2,9],31:[2,9],32:[2,9],34:[2,9]},{25:[2,44],37:72,47:73,48:58,49:60,50:[1,74]},{25:[1,75]},{18:[2,23],25:[2,23],33:[2,23],42:[2,23],43:[2,23],44:[2,23],45:[2,23],46:[2,23],50:[2,23],52:[2,23]},{18:[2,24],25:[2,24],33:[2,24],42:[2,24],43:[2,24],44:[2,24],45:[2,24],46:[2,24],50:[2,24],52:[2,24]},{18:[2,25],25:[2,25],33:[2,25],42:[2,25],43:[2,25],44:[2,25],45:[2,25],46:[2,25],50:[2,25],52:[2,25]},{18:[2,26],25:[2,26],33:[2,26],42:[2,26],43:[2,26],44:[2,26],45:[2,26],46:[2,26],50:[2,26],52:[2,26]},{18:[2,27],25:[2,27],33:[2,27],42:[2,27],43:[2,27],44:[2,27],45:[2,27],46:[2,27],50:[2,27],52:[2,27]},{17:76,30:22,41:23,50:[1,26],52:[1,25],53:24},{25:[2,47]},{18:[2,29],25:[2,29],33:[2,29],46:[2,29],49:77,50:[1,74]},{18:[2,37],25:[2,37],33:[2,37],42:[2,37],43:[2,37],44:[2,37],45:[2,37],46:[2,37],50:[2,37],51:[1,78],52:[2,37],54:[2,37]},{18:[2,52],25:[2,52],33:[2,52],46:[2,52],50:[2,52]},{12:[2,13],13:[2,13],16:[2,13],24:[2,13],26:[2,13],28:[2,13],29:[2,13],31:[2,13],32:[2,13],34:[2,13]},{12:[2,14],13:[2,14],16:[2,14],24:[2,14],26:[2,14],28:[2,14],29:[2,14],31:[2,14],32:[2,14],34:[2,14]},{12:[2,10]},{18:[2,21],25:[2,21],33:[2,21],46:[2,21]},{18:[2,49],25:[2,49],33:[2,49],42:[2,49],43:[2,49],44:[2,49],45:[2,49],46:[2,49],50:[2,49],52:[2,49]},{18:[2,51],25:[2,51],33:[2,51],46:[2,51]},{18:[2,36],25:[2,36],33:[2,36],42:[2,36],43:[2,36],44:[2,36],45:[2,36],46:[2,36],50:[2,36],52:[2,36],54:[2,36]},{5:[2,11],12:[2,11],13:[2,11],16:[2,11],24:[2,11],26:[2,11],28:[2,11],29:[2,11],31:[2,11],32:[2,11],34:[2,11]},{30:79,50:[1,26],53:24},{29:[2,15]},{5:[2,12],12:[2,12],13:[2,12],16:[2,12],24:[2,12],26:[2,12],28:[2,12],29:[2,12],31:[2,12],32:[2,12],34:[2,12]},{25:[1,80]},{25:[2,45]},{51:[1,78]},{5:[2,20],12:[2,20],13:[2,20],16:[2,20],24:[2,20],26:[2,20],28:[2,20],29:[2,20],31:[2,20],32:[2,20],34:[2,20]},{46:[1,81]},{18:[2,53],25:[2,53],33:[2,53],46:[2,53],50:[2,53]},{30:51,36:82,41:55,42:[1,52],43:[1,53],44:[1,54],45:[1,56],50:[1,26],52:[1,25],53:24},{25:[1,83]},{5:[2,19],12:[2,19],13:[2,19],16:[2,19],24:[2,19],26:[2,19],28:[2,19],29:[2,19],31:[2,19],32:[2,19],34:[2,19]},{18:[2,28],25:[2,28],33:[2,28],42:[2,28],43:[2,28],44:[2,28],45:[2,28],46:[2,28],50:[2,28],52:[2,28]},{18:[2,30],25:[2,30],33:[2,30],46:[2,30],50:[2,30]},{5:[2,16],12:[2,16],13:[2,16],16:[2,16],24:[2,16],26:[2,16],28:[2,16],29:[2,16],31:[2,16],32:[2,16],34:[2,16]}],defaultActions:{4:[2,1],44:[2,41],47:[2,43],57:[2,47],63:[2,10],70:[2,15],73:[2,45]},parseError:function parseError(str,hash){throw new Error(str);},parse:function parse(input){var self=this,stack=[0],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0,TERROR=2,EOF=1;this.lexer.setInput(input);this.lexer.yy=this.yy;this.yy.lexer=this.lexer;this.yy.parser=this;if(typeof this.lexer.yylloc=="undefined")
this.lexer.yylloc={};var yyloc=this.lexer.yylloc;lstack.push(yyloc);var ranges=this.lexer.options&&this.lexer.options.ranges;if(typeof this.yy.parseError==="function")
this.parseError=this.yy.parseError;function popStack(n){stack.length=stack.length-2*n;vstack.length=vstack.length-n;lstack.length=lstack.length-n;}
function lex(){var token;token=self.lexer.lex()||1;if(typeof token!=="number"){token=self.symbols_[token]||token;}
return token;}
var symbol,preErrorSymbol,state,action,a,r,yyval={},p,len,newState,expected;while(true){state=stack[stack.length-1];if(this.defaultActions[state]){action=this.defaultActions[state];}else{if(symbol===null||typeof symbol=="undefined"){symbol=lex();}
action=table[state]&&table[state][symbol];}
if(typeof action==="undefined"||!action.length||!action[0]){var errStr="";if(!recovering){expected=[];for(p in table[state])
if(this.terminals_[p]&&p>2){expected.push("'"+this.terminals_[p]+"'");}
if(this.lexer.showPosition){errStr="Parse error on line "+(yylineno+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+(this.terminals_[symbol]||symbol)+"'";}else{errStr="Parse error on line "+(yylineno+1)+": Unexpected "+(symbol==1?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'");}
this.parseError(errStr,{text:this.lexer.match,token:this.terminals_[symbol]||symbol,line:this.lexer.yylineno,loc:yyloc,expected:expected});}}
if(action[0]instanceof Array&&action.length>1){throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol);}
switch(action[0]){case 1:stack.push(symbol);vstack.push(this.lexer.yytext);lstack.push(this.lexer.yylloc);stack.push(action[1]);symbol=null;if(!preErrorSymbol){yyleng=this.lexer.yyleng;yytext=this.lexer.yytext;yylineno=this.lexer.yylineno;yyloc=this.lexer.yylloc;if(recovering>0)
recovering--;}else{symbol=preErrorSymbol;preErrorSymbol=null;}
break;case 2:len=this.productions_[action[1]][1];yyval.$=vstack[vstack.length-len];yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column};if(ranges){yyval._$.range=[lstack[lstack.length-(len||1)].range[0],lstack[lstack.length-1].range[1]];}
r=this.performAction.call(yyval,yytext,yyleng,yylineno,this.yy,action[1],vstack,lstack);if(typeof r!=="undefined"){return r;}
if(len){stack=stack.slice(0,-1*len*2);vstack=vstack.slice(0,-1*len);lstack=lstack.slice(0,-1*len);}
stack.push(this.productions_[action[1]][0]);vstack.push(yyval.$);lstack.push(yyval._$);newState=table[stack[stack.length-2]][stack[stack.length-1]];stack.push(newState);break;case 3:return true;}}
return true;}};var lexer=(function(){var lexer=({EOF:1,parseError:function parseError(str,hash){if(this.yy.parser){this.yy.parser.parseError(str,hash);}else{throw new Error(str);}},setInput:function(input){this._input=input;this._more=this._less=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match='';this.conditionStack=['INITIAL'];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};if(this.options.ranges)this.yylloc.range=[0,0];this.offset=0;return this;},input:function(){var ch=this._input[0];this.yytext+=ch;this.yyleng++;this.offset++;this.match+=ch;this.matched+=ch;var lines=ch.match(/(?:\r\n?|\n).*/g);if(lines){this.yylineno++;this.yylloc.last_line++;}else{this.yylloc.last_column++;}
if(this.options.ranges)this.yylloc.range[1]++;this._input=this._input.slice(1);return ch;},unput:function(ch){var len=ch.length;var lines=ch.split(/(?:\r\n?|\n)/g);this._input=ch+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-len-1);this.offset-=len;var oldLines=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);if(lines.length-1)this.yylineno-=lines.length-1;var r=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:lines?(lines.length===oldLines.length?this.yylloc.first_column:0)+oldLines[oldLines.length-lines.length].length-lines[0].length:this.yylloc.first_column-len};if(this.options.ranges){this.yylloc.range=[r[0],r[0]+this.yyleng-len];}
return this;},more:function(){this._more=true;return this;},less:function(n){this.unput(this.match.slice(n));},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?'...':'')+past.substr(-20).replace(/\n/g,"");},upcomingInput:function(){var next=this.match;if(next.length<20){next+=this._input.substr(0,20-next.length);}
return(next.substr(0,20)+(next.length>20?'...':'')).replace(/\n/g,"");},showPosition:function(){var pre=this.pastInput();var c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^";},next:function(){if(this.done){return this.EOF;}
if(!this._input)this.done=true;var token,match,tempMatch,index,col,lines;if(!this._more){this.yytext='';this.match='';}
var rules=this._currentRules();for(var i=0;i<rules.length;i++){tempMatch=this._input.match(this.rules[rules[i]]);if(tempMatch&&(!match||tempMatch[0].length>match[0].length)){match=tempMatch;index=i;if(!this.options.flex)break;}}
if(match){lines=match[0].match(/(?:\r\n?|\n).*/g);if(lines)this.yylineno+=lines.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+match[0].length};this.yytext+=match[0];this.match+=match[0];this.matches=match;this.yyleng=this.yytext.length;if(this.options.ranges){this.yylloc.range=[this.offset,this.offset+=this.yyleng];}
this._more=false;this._input=this._input.slice(match[0].length);this.matched+=match[0];token=this.performAction.call(this,this.yy,this,rules[index],this.conditionStack[this.conditionStack.length-1]);if(this.done&&this._input)this.done=false;if(token)return token;else return;}
if(this._input===""){return this.EOF;}else{return this.parseError('Lexical error on line '+(this.yylineno+1)+'. Unrecognized text.\n'+this.showPosition(),{text:"",token:null,line:this.yylineno});}},lex:function lex(){var r=this.next();if(typeof r!=='undefined'){return r;}else{return this.lex();}},begin:function begin(condition){this.conditionStack.push(condition);},popState:function popState(){return this.conditionStack.pop();},_currentRules:function _currentRules(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules;},topState:function(){return this.conditionStack[this.conditionStack.length-2];},pushState:function begin(condition){this.begin(condition);}});lexer.options={};lexer.performAction=function anonymous(yy,yy_,$avoiding_name_collisions,YY_START){function strip(start,end){return yy_.yytext=yy_.yytext.substr(start,yy_.yyleng-end);}
var YYSTATE=YY_START
switch($avoiding_name_collisions){case 0:if(yy_.yytext.slice(-2)==="\\\\"){strip(0,1);this.begin("mu");}else if(yy_.yytext.slice(-1)==="\\"){strip(0,1);this.begin("emu");}else{this.begin("mu");}
if(yy_.yytext)return 12;break;case 1:return 12;break;case 2:this.popState();return 12;break;case 3:yy_.yytext=yy_.yytext.substr(5,yy_.yyleng-9);this.popState();return 15;break;case 4:return 12;break;case 5:strip(0,4);this.popState();return 13;break;case 6:return 45;break;case 7:return 46;break;case 8:return 16;break;case 9:this.popState();this.begin('raw');return 18;break;case 10:return 34;break;case 11:return 24;break;case 12:return 29;break;case 13:this.popState();return 28;break;case 14:this.popState();return 28;break;case 15:return 26;break;case 16:return 26;break;case 17:return 32;break;case 18:return 31;break;case 19:this.popState();this.begin('com');break;case 20:strip(3,5);this.popState();return 13;break;case 21:return 31;break;case 22:return 51;break;case 23:return 50;break;case 24:return 50;break;case 25:return 54;break;case 26:break;case 27:this.popState();return 33;break;case 28:this.popState();return 25;break;case 29:yy_.yytext=strip(1,2).replace(/\\"/g,'"');return 42;break;case 30:yy_.yytext=strip(1,2).replace(/\\'/g,"'");return 42;break;case 31:return 52;break;case 32:return 44;break;case 33:return 44;break;case 34:return 43;break;case 35:return 50;break;case 36:yy_.yytext=strip(1,2);return 50;break;case 37:return'INVALID';break;case 38:return 5;break;}};lexer.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]*?(?=(\{\{\{\{\/)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/];lexer.conditions={"mu":{"rules":[6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38],"inclusive":false},"emu":{"rules":[2],"inclusive":false},"com":{"rules":[5],"inclusive":false},"raw":{"rules":[3,4],"inclusive":false},"INITIAL":{"rules":[0,1,38],"inclusive":true}};return lexer;})()
parser.lexer=lexer;function Parser(){this.yy={};}Parser.prototype=parser;parser.Parser=Parser;return new Parser;})();__exports__=handlebars;return __exports__;})();var __module10__=(function(__dependency1__){"use strict";var __exports__={};var Exception=__dependency1__;function stripFlags(open,close){return{left:open.charAt(2)==='~',right:close.charAt(close.length-3)==='~'};}
__exports__.stripFlags=stripFlags;function prepareBlock(mustache,program,inverseAndProgram,close,inverted,locInfo){if(mustache.sexpr.id.original!==close.path.original){throw new Exception(mustache.sexpr.id.original+' doesn\'t match '+close.path.original,mustache);}
var inverse=inverseAndProgram&&inverseAndProgram.program;var strip={left:mustache.strip.left,right:close.strip.right,openStandalone:isNextWhitespace(program.statements),closeStandalone:isPrevWhitespace((inverse||program).statements)};if(mustache.strip.right){omitRight(program.statements,null,true);}
if(inverse){var inverseStrip=inverseAndProgram.strip;if(inverseStrip.left){omitLeft(program.statements,null,true);}
if(inverseStrip.right){omitRight(inverse.statements,null,true);}
if(close.strip.left){omitLeft(inverse.statements,null,true);}
if(isPrevWhitespace(program.statements)&&isNextWhitespace(inverse.statements)){omitLeft(program.statements);omitRight(inverse.statements);}}else{if(close.strip.left){omitLeft(program.statements,null,true);}}
if(inverted){return new this.BlockNode(mustache,inverse,program,strip,locInfo);}else{return new this.BlockNode(mustache,program,inverse,strip,locInfo);}}
__exports__.prepareBlock=prepareBlock;function prepareProgram(statements,isRoot){for(var i=0,l=statements.length;i<l;i++){var current=statements[i],strip=current.strip;if(!strip){continue;}
var _isPrevWhitespace=isPrevWhitespace(statements,i,isRoot,current.type==='partial'),_isNextWhitespace=isNextWhitespace(statements,i,isRoot),openStandalone=strip.openStandalone&&_isPrevWhitespace,closeStandalone=strip.closeStandalone&&_isNextWhitespace,inlineStandalone=strip.inlineStandalone&&_isPrevWhitespace&&_isNextWhitespace;if(strip.right){omitRight(statements,i,true);}
if(strip.left){omitLeft(statements,i,true);}
if(inlineStandalone){omitRight(statements,i);if(omitLeft(statements,i)){if(current.type==='partial'){current.indent=(/([ \t]+$)/).exec(statements[i-1].original)?RegExp.$1:'';}}}
if(openStandalone){omitRight((current.program||current.inverse).statements);omitLeft(statements,i);}
if(closeStandalone){omitRight(statements,i);omitLeft((current.inverse||current.program).statements);}}
return statements;}
__exports__.prepareProgram=prepareProgram;function isPrevWhitespace(statements,i,isRoot){if(i===undefined){i=statements.length;}
var prev=statements[i-1],sibling=statements[i-2];if(!prev){return isRoot;}
if(prev.type==='content'){return(sibling||!isRoot?(/\r?\n\s*?$/):(/(^|\r?\n)\s*?$/)).test(prev.original);}}
function isNextWhitespace(statements,i,isRoot){if(i===undefined){i=-1;}
var next=statements[i+1],sibling=statements[i+2];if(!next){return isRoot;}
if(next.type==='content'){return(sibling||!isRoot?(/^\s*?\r?\n/):(/^\s*?(\r?\n|$)/)).test(next.original);}}
function omitRight(statements,i,multiple){var current=statements[i==null?0:i+1];if(!current||current.type!=='content'||(!multiple&&current.rightStripped)){return;}
var original=current.string;current.string=current.string.replace(multiple?(/^\s+/):(/^[ \t]*\r?\n?/),'');current.rightStripped=current.string!==original;}
function omitLeft(statements,i,multiple){var current=statements[i==null?statements.length-1:i-1];if(!current||current.type!=='content'||(!multiple&&current.leftStripped)){return;}
var original=current.string;current.string=current.string.replace(multiple?(/\s+$/):(/[ \t]+$/),'');current.leftStripped=current.string!==original;return current.leftStripped;}
return __exports__;})(__module5__);var __module8__=(function(__dependency1__,__dependency2__,__dependency3__,__dependency4__){"use strict";var __exports__={};var parser=__dependency1__;var AST=__dependency2__;var Helpers=__dependency3__;var extend=__dependency4__.extend;__exports__.parser=parser;var yy={};extend(yy,Helpers,AST);function parse(input){if(input.constructor===AST.ProgramNode){return input;}
parser.yy=yy;return parser.parse(input);}
__exports__.parse=parse;return __exports__;})(__module9__,__module7__,__module10__,__module3__);var __module11__=(function(__dependency1__,__dependency2__){"use strict";var __exports__={};var Exception=__dependency1__;var isArray=__dependency2__.isArray;var slice=[].slice;function Compiler(){}
__exports__.Compiler=Compiler;Compiler.prototype={compiler:Compiler,equals:function(other){var len=this.opcodes.length;if(other.opcodes.length!==len){return false;}
for(var i=0;i<len;i++){var opcode=this.opcodes[i],otherOpcode=other.opcodes[i];if(opcode.opcode!==otherOpcode.opcode||!argEquals(opcode.args,otherOpcode.args)){return false;}}
len=this.children.length;for(i=0;i<len;i++){if(!this.children[i].equals(other.children[i])){return false;}}
return true;},guid:0,compile:function(program,options){this.opcodes=[];this.children=[];this.depths={list:[]};this.options=options;this.stringParams=options.stringParams;this.trackIds=options.trackIds;var knownHelpers=this.options.knownHelpers;this.options.knownHelpers={'helperMissing':true,'blockHelperMissing':true,'each':true,'if':true,'unless':true,'with':true,'log':true,'lookup':true};if(knownHelpers){for(var name in knownHelpers){this.options.knownHelpers[name]=knownHelpers[name];}}
return this.accept(program);},accept:function(node){return this[node.type](node);},program:function(program){var statements=program.statements;for(var i=0,l=statements.length;i<l;i++){this.accept(statements[i]);}
this.isSimple=l===1;this.depths.list=this.depths.list.sort(function(a,b){return a-b;});return this;},compileProgram:function(program){var result=new this.compiler().compile(program,this.options);var guid=this.guid++,depth;this.usePartial=this.usePartial||result.usePartial;this.children[guid]=result;for(var i=0,l=result.depths.list.length;i<l;i++){depth=result.depths.list[i];if(depth<2){continue;}
else{this.addDepth(depth-1);}}
return guid;},block:function(block){var mustache=block.mustache,program=block.program,inverse=block.inverse;if(program){program=this.compileProgram(program);}
if(inverse){inverse=this.compileProgram(inverse);}
var sexpr=mustache.sexpr;var type=this.classifySexpr(sexpr);if(type==="helper"){this.helperSexpr(sexpr,program,inverse);}else if(type==="simple"){this.simpleSexpr(sexpr);this.opcode('pushProgram',program);this.opcode('pushProgram',inverse);this.opcode('emptyHash');this.opcode('blockValue',sexpr.id.original);}else{this.ambiguousSexpr(sexpr,program,inverse);this.opcode('pushProgram',program);this.opcode('pushProgram',inverse);this.opcode('emptyHash');this.opcode('ambiguousBlockValue');}
this.opcode('append');},hash:function(hash){var pairs=hash.pairs,i,l;this.opcode('pushHash');for(i=0,l=pairs.length;i<l;i++){this.pushParam(pairs[i][1]);}
while(i--){this.opcode('assignToHash',pairs[i][0]);}
this.opcode('popHash');},partial:function(partial){var partialName=partial.partialName;this.usePartial=true;if(partial.hash){this.accept(partial.hash);}else{this.opcode('push','undefined');}
if(partial.context){this.accept(partial.context);}else{this.opcode('getContext',0);this.opcode('pushContext');}
this.opcode('invokePartial',partialName.name,partial.indent||'');this.opcode('append');},content:function(content){if(content.string){this.opcode('appendContent',content.string);}},mustache:function(mustache){this.sexpr(mustache.sexpr);if(mustache.escaped&&!this.options.noEscape){this.opcode('appendEscaped');}else{this.opcode('append');}},ambiguousSexpr:function(sexpr,program,inverse){var id=sexpr.id,name=id.parts[0],isBlock=program!=null||inverse!=null;this.opcode('getContext',id.depth);this.opcode('pushProgram',program);this.opcode('pushProgram',inverse);this.ID(id);this.opcode('invokeAmbiguous',name,isBlock);},simpleSexpr:function(sexpr){var id=sexpr.id;if(id.type==='DATA'){this.DATA(id);}else if(id.parts.length){this.ID(id);}else{this.addDepth(id.depth);this.opcode('getContext',id.depth);this.opcode('pushContext');}
this.opcode('resolvePossibleLambda');},helperSexpr:function(sexpr,program,inverse){var params=this.setupFullMustacheParams(sexpr,program,inverse),id=sexpr.id,name=id.parts[0];if(this.options.knownHelpers[name]){this.opcode('invokeKnownHelper',params.length,name);}else if(this.options.knownHelpersOnly){throw new Exception("You specified knownHelpersOnly, but used the unknown helper "+name,sexpr);}else{id.falsy=true;this.ID(id);this.opcode('invokeHelper',params.length,id.original,id.isSimple);}},sexpr:function(sexpr){var type=this.classifySexpr(sexpr);if(type==="simple"){this.simpleSexpr(sexpr);}else if(type==="helper"){this.helperSexpr(sexpr);}else{this.ambiguousSexpr(sexpr);}},ID:function(id){this.addDepth(id.depth);this.opcode('getContext',id.depth);var name=id.parts[0];if(!name){this.opcode('pushContext');}else{this.opcode('lookupOnContext',id.parts,id.falsy,id.isScoped);}},DATA:function(data){this.options.data=true;this.opcode('lookupData',data.id.depth,data.id.parts);},STRING:function(string){this.opcode('pushString',string.string);},NUMBER:function(number){this.opcode('pushLiteral',number.number);},BOOLEAN:function(bool){this.opcode('pushLiteral',bool.bool);},comment:function(){},opcode:function(name){this.opcodes.push({opcode:name,args:slice.call(arguments,1)});},addDepth:function(depth){if(depth===0){return;}
if(!this.depths[depth]){this.depths[depth]=true;this.depths.list.push(depth);}},classifySexpr:function(sexpr){var isHelper=sexpr.isHelper;var isEligible=sexpr.eligibleHelper;var options=this.options;if(isEligible&&!isHelper){var name=sexpr.id.parts[0];if(options.knownHelpers[name]){isHelper=true;}else if(options.knownHelpersOnly){isEligible=false;}}
if(isHelper){return"helper";}
else if(isEligible){return"ambiguous";}
else{return"simple";}},pushParams:function(params){for(var i=0,l=params.length;i<l;i++){this.pushParam(params[i]);}},pushParam:function(val){if(this.stringParams){if(val.depth){this.addDepth(val.depth);}
this.opcode('getContext',val.depth||0);this.opcode('pushStringParam',val.stringModeValue,val.type);if(val.type==='sexpr'){this.sexpr(val);}}else{if(this.trackIds){this.opcode('pushId',val.type,val.idName||val.stringModeValue);}
this.accept(val);}},setupFullMustacheParams:function(sexpr,program,inverse){var params=sexpr.params;this.pushParams(params);this.opcode('pushProgram',program);this.opcode('pushProgram',inverse);if(sexpr.hash){this.hash(sexpr.hash);}else{this.opcode('emptyHash');}
return params;}};function precompile(input,options,env){if(input==null||(typeof input!=='string'&&input.constructor!==env.AST.ProgramNode)){throw new Exception("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+input);}
options=options||{};if(!('data'in options)){options.data=true;}
if(options.compat){options.useDepths=true;}
var ast=env.parse(input);var environment=new env.Compiler().compile(ast,options);return new env.JavaScriptCompiler().compile(environment,options);}
__exports__.precompile=precompile;function compile(input,options,env){if(input==null||(typeof input!=='string'&&input.constructor!==env.AST.ProgramNode)){throw new Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+input);}
options=options||{};if(!('data'in options)){options.data=true;}
if(options.compat){options.useDepths=true;}
var compiled;function compileInput(){var ast=env.parse(input);var environment=new env.Compiler().compile(ast,options);var templateSpec=new env.JavaScriptCompiler().compile(environment,options,undefined,true);return env.template(templateSpec);}
var ret=function(context,options){if(!compiled){compiled=compileInput();}
return compiled.call(this,context,options);};ret._setup=function(options){if(!compiled){compiled=compileInput();}
return compiled._setup(options);};ret._child=function(i,data,depths){if(!compiled){compiled=compileInput();}
return compiled._child(i,data,depths);};return ret;}
__exports__.compile=compile;function argEquals(a,b){if(a===b){return true;}
if(isArray(a)&&isArray(b)&&a.length===b.length){for(var i=0;i<a.length;i++){if(!argEquals(a[i],b[i])){return false;}}
return true;}}
return __exports__;})(__module5__,__module3__);var __module12__=(function(__dependency1__,__dependency2__){"use strict";var __exports__;var COMPILER_REVISION=__dependency1__.COMPILER_REVISION;var REVISION_CHANGES=__dependency1__.REVISION_CHANGES;var Exception=__dependency2__;function Literal(value){this.value=value;}
function JavaScriptCompiler(){}
JavaScriptCompiler.prototype={nameLookup:function(parent,name){if(JavaScriptCompiler.isValidJavaScriptVariableName(name)){return parent+"."+name;}else{return parent+"['"+name+"']";}},depthedLookup:function(name){this.aliases.lookup='this.lookup';return'lookup(depths, "'+name+'")';},compilerInfo:function(){var revision=COMPILER_REVISION,versions=REVISION_CHANGES[revision];return[revision,versions];},appendToBuffer:function(string){if(this.environment.isSimple){return"return "+string+";";}else{return{appendToBuffer:true,content:string,toString:function(){return"buffer += "+string+";";}};}},initializeBuffer:function(){return this.quotedString("");},namespace:"Handlebars",compile:function(environment,options,context,asObject){this.environment=environment;this.options=options;this.stringParams=this.options.stringParams;this.trackIds=this.options.trackIds;this.precompile=!asObject;this.name=this.environment.name;this.isChild=!!context;this.context=context||{programs:[],environments:[]};this.preamble();this.stackSlot=0;this.stackVars=[];this.aliases={};this.registers={list:[]};this.hashes=[];this.compileStack=[];this.inlineStack=[];this.compileChildren(environment,options);this.useDepths=this.useDepths||environment.depths.list.length||this.options.compat;var opcodes=environment.opcodes,opcode,i,l;for(i=0,l=opcodes.length;i<l;i++){opcode=opcodes[i];this[opcode.opcode].apply(this,opcode.args);}
this.pushSource('');if(this.stackSlot||this.inlineStack.length||this.compileStack.length){throw new Exception('Compile completed with content left on stack');}
var fn=this.createFunctionContext(asObject);if(!this.isChild){var ret={compiler:this.compilerInfo(),main:fn};var programs=this.context.programs;for(i=0,l=programs.length;i<l;i++){if(programs[i]){ret[i]=programs[i];}}
if(this.environment.usePartial){ret.usePartial=true;}
if(this.options.data){ret.useData=true;}
if(this.useDepths){ret.useDepths=true;}
if(this.options.compat){ret.compat=true;}
if(!asObject){ret.compiler=JSON.stringify(ret.compiler);ret=this.objectLiteral(ret);}
return ret;}else{return fn;}},preamble:function(){this.lastContext=0;this.source=[];},createFunctionContext:function(asObject){var varDeclarations='';var locals=this.stackVars.concat(this.registers.list);if(locals.length>0){varDeclarations+=", "+locals.join(", ");}
for(var alias in this.aliases){if(this.aliases.hasOwnProperty(alias)){varDeclarations+=', '+alias+'='+this.aliases[alias];}}
var params=["depth0","helpers","partials","data"];if(this.useDepths){params.push('depths');}
var source=this.mergeSource(varDeclarations);if(asObject){params.push(source);return Function.apply(this,params);}else{return'function('+params.join(',')+') {\n  '+source+'}';}},mergeSource:function(varDeclarations){var source='',buffer,appendOnly=!this.forceBuffer,appendFirst;for(var i=0,len=this.source.length;i<len;i++){var line=this.source[i];if(line.appendToBuffer){if(buffer){buffer=buffer+'\n    + '+line.content;}else{buffer=line.content;}}else{if(buffer){if(!source){appendFirst=true;source=buffer+';\n  ';}else{source+='buffer += '+buffer+';\n  ';}
buffer=undefined;}
source+=line+'\n  ';if(!this.environment.isSimple){appendOnly=false;}}}
if(appendOnly){if(buffer||!source){source+='return '+(buffer||'""')+';\n';}}else{varDeclarations+=", buffer = "+(appendFirst?'':this.initializeBuffer());if(buffer){source+='return buffer + '+buffer+';\n';}else{source+='return buffer;\n';}}
if(varDeclarations){source='var '+varDeclarations.substring(2)+(appendFirst?'':';\n  ')+source;}
return source;},blockValue:function(name){this.aliases.blockHelperMissing='helpers.blockHelperMissing';var params=[this.contextName(0)];this.setupParams(name,0,params);var blockName=this.popStack();params.splice(1,0,blockName);this.push('blockHelperMissing.call('+params.join(', ')+')');},ambiguousBlockValue:function(){this.aliases.blockHelperMissing='helpers.blockHelperMissing';var params=[this.contextName(0)];this.setupParams('',0,params,true);this.flushInline();var current=this.topStack();params.splice(1,0,current);this.pushSource("if (!"+this.lastHelper+") { "+current+" = blockHelperMissing.call("+params.join(", ")+"); }");},appendContent:function(content){if(this.pendingContent){content=this.pendingContent+content;}
this.pendingContent=content;},append:function(){this.flushInline();var local=this.popStack();this.pushSource('if ('+local+' != null) { '+this.appendToBuffer(local)+' }');if(this.environment.isSimple){this.pushSource("else { "+this.appendToBuffer("''")+" }");}},appendEscaped:function(){this.aliases.escapeExpression='this.escapeExpression';this.pushSource(this.appendToBuffer("escapeExpression("+this.popStack()+")"));},getContext:function(depth){this.lastContext=depth;},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext));},lookupOnContext:function(parts,falsy,scoped){var i=0,len=parts.length;if(!scoped&&this.options.compat&&!this.lastContext){this.push(this.depthedLookup(parts[i++]));}else{this.pushContext();}
for(;i<len;i++){this.replaceStack(function(current){var lookup=this.nameLookup(current,parts[i],'context');if(!falsy){return' != null ? '+lookup+' : '+current;}else{return' && '+lookup;}});}},lookupData:function(depth,parts){if(!depth){this.pushStackLiteral('data');}else{this.pushStackLiteral('this.data(data, '+depth+')');}
var len=parts.length;for(var i=0;i<len;i++){this.replaceStack(function(current){return' && '+this.nameLookup(current,parts[i],'data');});}},resolvePossibleLambda:function(){this.aliases.lambda='this.lambda';this.push('lambda('+this.popStack()+', '+this.contextName(0)+')');},pushStringParam:function(string,type){this.pushContext();this.pushString(type);if(type!=='sexpr'){if(typeof string==='string'){this.pushString(string);}else{this.pushStackLiteral(string);}}},emptyHash:function(){this.pushStackLiteral('{}');if(this.trackIds){this.push('{}');}
if(this.stringParams){this.push('{}');this.push('{}');}},pushHash:function(){if(this.hash){this.hashes.push(this.hash);}
this.hash={values:[],types:[],contexts:[],ids:[]};},popHash:function(){var hash=this.hash;this.hash=this.hashes.pop();if(this.trackIds){this.push('{'+hash.ids.join(',')+'}');}
if(this.stringParams){this.push('{'+hash.contexts.join(',')+'}');this.push('{'+hash.types.join(',')+'}');}
this.push('{\n    '+hash.values.join(',\n    ')+'\n  }');},pushString:function(string){this.pushStackLiteral(this.quotedString(string));},push:function(expr){this.inlineStack.push(expr);return expr;},pushLiteral:function(value){this.pushStackLiteral(value);},pushProgram:function(guid){if(guid!=null){this.pushStackLiteral(this.programExpression(guid));}else{this.pushStackLiteral(null);}},invokeHelper:function(paramSize,name,isSimple){this.aliases.helperMissing='helpers.helperMissing';var nonHelper=this.popStack();var helper=this.setupHelper(paramSize,name);var lookup=(isSimple?helper.name+' || ':'')+nonHelper+' || helperMissing';this.push('(('+lookup+').call('+helper.callParams+'))');},invokeKnownHelper:function(paramSize,name){var helper=this.setupHelper(paramSize,name);this.push(helper.name+".call("+helper.callParams+")");},invokeAmbiguous:function(name,helperCall){this.aliases.functionType='"function"';this.aliases.helperMissing='helpers.helperMissing';this.useRegister('helper');var nonHelper=this.popStack();this.emptyHash();var helper=this.setupHelper(0,name,helperCall);var helperName=this.lastHelper=this.nameLookup('helpers',name,'helper');this.push('((helper = (helper = '+helperName+' || '+nonHelper+') != null ? helper : helperMissing'
+(helper.paramsInit?'),('+helper.paramsInit:'')+'),'
+'(typeof helper === functionType ? helper.call('+helper.callParams+') : helper))');},invokePartial:function(name,indent){var params=[this.nameLookup('partials',name,'partial'),"'"+indent+"'","'"+name+"'",this.popStack(),this.popStack(),"helpers","partials"];if(this.options.data){params.push("data");}else if(this.options.compat){params.push('undefined');}
if(this.options.compat){params.push('depths');}
this.push("this.invokePartial("+params.join(", ")+")");},assignToHash:function(key){var value=this.popStack(),context,type,id;if(this.trackIds){id=this.popStack();}
if(this.stringParams){type=this.popStack();context=this.popStack();}
var hash=this.hash;if(context){hash.contexts.push("'"+key+"': "+context);}
if(type){hash.types.push("'"+key+"': "+type);}
if(id){hash.ids.push("'"+key+"': "+id);}
hash.values.push("'"+key+"': ("+value+")");},pushId:function(type,name){if(type==='ID'||type==='DATA'){this.pushString(name);}else if(type==='sexpr'){this.pushStackLiteral('true');}else{this.pushStackLiteral('null');}},compiler:JavaScriptCompiler,compileChildren:function(environment,options){var children=environment.children,child,compiler;for(var i=0,l=children.length;i<l;i++){child=children[i];compiler=new this.compiler();var index=this.matchExistingProgram(child);if(index==null){this.context.programs.push('');index=this.context.programs.length;child.index=index;child.name='program'+index;this.context.programs[index]=compiler.compile(child,options,this.context,!this.precompile);this.context.environments[index]=child;this.useDepths=this.useDepths||compiler.useDepths;}else{child.index=index;child.name='program'+index;}}},matchExistingProgram:function(child){for(var i=0,len=this.context.environments.length;i<len;i++){var environment=this.context.environments[i];if(environment&&environment.equals(child)){return i;}}},programExpression:function(guid){var child=this.environment.children[guid],depths=child.depths.list,useDepths=this.useDepths,depth;var programParams=[child.index,'data'];if(useDepths){programParams.push('depths');}
return'this.program('+programParams.join(', ')+')';},useRegister:function(name){if(!this.registers[name]){this.registers[name]=true;this.registers.list.push(name);}},pushStackLiteral:function(item){return this.push(new Literal(item));},pushSource:function(source){if(this.pendingContent){this.source.push(this.appendToBuffer(this.quotedString(this.pendingContent)));this.pendingContent=undefined;}
if(source){this.source.push(source);}},pushStack:function(item){this.flushInline();var stack=this.incrStack();this.pushSource(stack+" = "+item+";");this.compileStack.push(stack);return stack;},replaceStack:function(callback){var prefix='',inline=this.isInline(),stack,createdStack,usedLiteral;if(!this.isInline()){throw new Exception('replaceStack on non-inline');}
var top=this.popStack(true);if(top instanceof Literal){prefix=stack=top.value;usedLiteral=true;}else{createdStack=!this.stackSlot;var name=!createdStack?this.topStackName():this.incrStack();prefix='('+this.push(name)+' = '+top+')';stack=this.topStack();}
var item=callback.call(this,stack);if(!usedLiteral){this.popStack();}
if(createdStack){this.stackSlot--;}
this.push('('+prefix+item+')');},incrStack:function(){this.stackSlot++;if(this.stackSlot>this.stackVars.length){this.stackVars.push("stack"+this.stackSlot);}
return this.topStackName();},topStackName:function(){return"stack"+this.stackSlot;},flushInline:function(){var inlineStack=this.inlineStack;if(inlineStack.length){this.inlineStack=[];for(var i=0,len=inlineStack.length;i<len;i++){var entry=inlineStack[i];if(entry instanceof Literal){this.compileStack.push(entry);}else{this.pushStack(entry);}}}},isInline:function(){return this.inlineStack.length;},popStack:function(wrapped){var inline=this.isInline(),item=(inline?this.inlineStack:this.compileStack).pop();if(!wrapped&&(item instanceof Literal)){return item.value;}else{if(!inline){if(!this.stackSlot){throw new Exception('Invalid stack pop');}
this.stackSlot--;}
return item;}},topStack:function(){var stack=(this.isInline()?this.inlineStack:this.compileStack),item=stack[stack.length-1];if(item instanceof Literal){return item.value;}else{return item;}},contextName:function(context){if(this.useDepths&&context){return'depths['+context+']';}else{return'depth'+context;}},quotedString:function(str){return'"'+str.replace(/\\/g,'\\\\').replace(/"/g,'\\"').replace(/\n/g,'\\n').replace(/\r/g,'\\r').replace(/\u2028/g,'\\u2028').replace(/\u2029/g,'\\u2029')+'"';},objectLiteral:function(obj){var pairs=[];for(var key in obj){if(obj.hasOwnProperty(key)){pairs.push(this.quotedString(key)+':'+obj[key]);}}
return'{'+pairs.join(',')+'}';},setupHelper:function(paramSize,name,blockHelper){var params=[],paramsInit=this.setupParams(name,paramSize,params,blockHelper);var foundHelper=this.nameLookup('helpers',name,'helper');return{params:params,paramsInit:paramsInit,name:foundHelper,callParams:[this.contextName(0)].concat(params).join(", ")};},setupOptions:function(helper,paramSize,params){var options={},contexts=[],types=[],ids=[],param,inverse,program;options.name=this.quotedString(helper);options.hash=this.popStack();if(this.trackIds){options.hashIds=this.popStack();}
if(this.stringParams){options.hashTypes=this.popStack();options.hashContexts=this.popStack();}
inverse=this.popStack();program=this.popStack();if(program||inverse){if(!program){program='this.noop';}
if(!inverse){inverse='this.noop';}
options.fn=program;options.inverse=inverse;}
var i=paramSize;while(i--){param=this.popStack();params[i]=param;if(this.trackIds){ids[i]=this.popStack();}
if(this.stringParams){types[i]=this.popStack();contexts[i]=this.popStack();}}
if(this.trackIds){options.ids="["+ids.join(",")+"]";}
if(this.stringParams){options.types="["+types.join(",")+"]";options.contexts="["+contexts.join(",")+"]";}
if(this.options.data){options.data="data";}
return options;},setupParams:function(helperName,paramSize,params,useRegister){var options=this.objectLiteral(this.setupOptions(helperName,paramSize,params));if(useRegister){this.useRegister('options');params.push('options');return'options='+options;}else{params.push(options);return'';}}};var reservedWords=("break else new var"+" case finally return void"+" catch for switch while"+" continue function this with"+" default if throw"+" delete in try"+" do instanceof typeof"+" abstract enum int short"+" boolean export interface static"+" byte extends long super"+" char final native synchronized"+" class float package throws"+" const goto private transient"+" debugger implements protected volatile"+" double import public let yield").split(" ");var compilerWords=JavaScriptCompiler.RESERVED_WORDS={};for(var i=0,l=reservedWords.length;i<l;i++){compilerWords[reservedWords[i]]=true;}
JavaScriptCompiler.isValidJavaScriptVariableName=function(name){return!JavaScriptCompiler.RESERVED_WORDS[name]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(name);};__exports__=JavaScriptCompiler;return __exports__;})(__module2__,__module5__);var __module0__=(function(__dependency1__,__dependency2__,__dependency3__,__dependency4__,__dependency5__){"use strict";var __exports__;var Handlebars=__dependency1__;var AST=__dependency2__;var Parser=__dependency3__.parser;var parse=__dependency3__.parse;var Compiler=__dependency4__.Compiler;var compile=__dependency4__.compile;var precompile=__dependency4__.precompile;var JavaScriptCompiler=__dependency5__;var _create=Handlebars.create;var create=function(){var hb=_create();hb.compile=function(input,options){return compile(input,options,hb);};hb.precompile=function(input,options){return precompile(input,options,hb);};hb.AST=AST;hb.Compiler=Compiler;hb.JavaScriptCompiler=JavaScriptCompiler;hb.Parser=Parser;hb.parse=parse;return hb;};Handlebars=create();Handlebars.create=create;Handlebars['default']=Handlebars;__exports__=Handlebars;return __exports__;})(__module1__,__module7__,__module8__,__module11__,__module12__);return __module0__;}));(function(context,namespace){var Hopscotch,HopscotchBubble,HopscotchCalloutManager,HopscotchI18N,customI18N,customRenderer,customEscape,templateToUse='bubble_default',Sizzle=window.Sizzle||null,utils,callbacks,helpers,winLoadHandler,defaultOpts,winHopscotch=context[namespace],undefinedStr='undefined',waitingToStart=false,hasJquery=(typeof window.jQuery!==undefinedStr),hasSessionStorage=false,isStorageWritable=false,document=window.document;try{if(typeof window.sessionStorage!==undefinedStr){hasSessionStorage=true;sessionStorage.setItem('hopscotch.test.storage','ok');sessionStorage.removeItem('hopscotch.test.storage');isStorageWritable=true;}}catch(err){}
defaultOpts={smoothScroll:true,scrollDuration:1000,scrollTopMargin:200,showCloseButton:true,showPrevButton:false,showNextButton:true,bubbleWidth:280,bubblePadding:15,arrowWidth:20,skipIfNoElement:true,cookieName:'hopscotch.tour.state'};if(winHopscotch){return;}
if(!Array.isArray){Array.isArray=function(obj){return Object.prototype.toString.call(obj)==='[object Array]';};}
winLoadHandler=function(){if(waitingToStart){winHopscotch.startTour();}};utils={addClass:function(domEl,classToAdd){var domClasses,classToAddArr,setClass,i,len;if(!domEl.className){domEl.className=classToAdd;}
else{classToAddArr=classToAdd.split(/\s+/);domClasses=' '+domEl.className+' ';for(i=0,len=classToAddArr.length;i<len;++i){if(domClasses.indexOf(' '+classToAddArr[i]+' ')<0){domClasses+=classToAddArr[i]+' ';}}
domEl.className=domClasses.replace(/^\s+|\s+$/g,'');}},removeClass:function(domEl,classToRemove){var domClasses,classToRemoveArr,currClass,i,len;classToRemoveArr=classToRemove.split(/\s+/);domClasses=' '+domEl.className+' ';for(i=0,len=classToRemoveArr.length;i<len;++i){domClasses=domClasses.replace(' '+classToRemoveArr[i]+' ',' ');}
domEl.className=domClasses.replace(/^\s+|\s+$/g,'');},hasClass:function(domEl,classToCheck){var classes;if(!domEl.className){return false;}
classes=' '+domEl.className+' ';return(classes.indexOf(' '+classToCheck+' ')!==-1);},getPixelValue:function(val){var valType=typeof val;if(valType==='number'){return val;}
if(valType==='string'){return parseInt(val,10);}
return 0;},valOrDefault:function(val,valDefault){return typeof val!==undefinedStr?val:valDefault;},invokeCallbackArrayHelper:function(arr){var fn;if(Array.isArray(arr)){fn=helpers[arr[0]];if(typeof fn==='function'){return fn.apply(this,arr.slice(1));}}},invokeCallbackArray:function(arr){var i,len;if(Array.isArray(arr)){if(typeof arr[0]==='string'){return utils.invokeCallbackArrayHelper(arr);}
else{for(i=0,len=arr.length;i<len;++i){utils.invokeCallback(arr[i]);}}}},invokeCallback:function(cb){if(typeof cb==='function'){return cb();}
if(typeof cb==='string'&&helpers[cb]){return helpers[cb]();}
else{return utils.invokeCallbackArray(cb);}},invokeEventCallbacks:function(evtType,stepCb){var cbArr=callbacks[evtType],callback,fn,i,len;if(stepCb){return this.invokeCallback(stepCb);}
for(i=0,len=cbArr.length;i<len;++i){this.invokeCallback(cbArr[i].cb);}},getScrollTop:function(){var scrollTop;if(typeof window.pageYOffset!==undefinedStr){scrollTop=window.pageYOffset;}
else{scrollTop=document.documentElement.scrollTop;}
return scrollTop;},getScrollLeft:function(){var scrollLeft;if(typeof window.pageXOffset!==undefinedStr){scrollLeft=window.pageXOffset;}
else{scrollLeft=document.documentElement.scrollLeft;}
return scrollLeft;},getWindowHeight:function(){return window.innerHeight||document.documentElement.clientHeight;},getWindowWidth:function(){return window.innerWidth||document.documentElement.clientWidth;},addEvtListener:function(el,evtName,fn){return el.addEventListener?el.addEventListener(evtName,fn,false):el.attachEvent('on'+evtName,fn);},removeEvtListener:function(el,evtName,fn){return el.removeEventListener?el.removeEventListener(evtName,fn,false):el.detachEvent('on'+evtName,fn);},documentIsReady:function(){return document.readyState==='complete'||document.readyState==='interactive';},evtPreventDefault:function(evt){if(evt.preventDefault){evt.preventDefault();}
else if(event){event.returnValue=false;}},extend:function(obj1,obj2){var prop;for(prop in obj2){if(obj2.hasOwnProperty(prop)){obj1[prop]=obj2[prop];}}},getStepTargetHelper:function(target){var result=document.getElementById(target);if(result){return result;}
if(hasJquery){result=jQuery(target);return result.length?result[0]:null;}
if(Sizzle){result=new Sizzle(target);return result.length?result[0]:null;}
if(document.querySelector){try{return document.querySelector(target);}catch(err){}}
if(/^#[a-zA-Z][\w-_:.]*$/.test(target)){return document.getElementById(target.substring(1));}
return null;},getStepTarget:function(step){var queriedTarget;if(!step||!step.target){return null;}
if(typeof step.target==='string'){return utils.getStepTargetHelper(step.target);}
else if(Array.isArray(step.target)){var i,len;for(i=0,len=step.target.length;i<len;i++){if(typeof step.target[i]==='string'){queriedTarget=utils.getStepTargetHelper(step.target[i]);if(queriedTarget){return queriedTarget;}}}
return null;}
return step.target;},getI18NString:function(key){return customI18N[key]||HopscotchI18N[key];},setState:function(name,value,days){var expires='',date;if(hasSessionStorage&&isStorageWritable){try{sessionStorage.setItem(name,value);}
catch(err){isStorageWritable=false;this.setState(name,value,days);}}
else{if(hasSessionStorage){sessionStorage.removeItem(name);}
if(days){date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires='; expires='+date.toGMTString();}
document.cookie=name+'='+value+expires+'; path=/';}},getState:function(name){var nameEQ=name+'=',ca=document.cookie.split(';'),i,c,state;if(hasSessionStorage){state=sessionStorage.getItem(name);if(state){return state;}}
for(i=0;i<ca.length;i++){c=ca[i];while(c.charAt(0)===' '){c=c.substring(1,c.length);}
if(c.indexOf(nameEQ)===0){state=c.substring(nameEQ.length,c.length);break;}}
return state;},clearState:function(name){if(hasSessionStorage){sessionStorage.removeItem(name);}
else{this.setState(name,'',-1);}}};utils.addEvtListener(window,'load',winLoadHandler);callbacks={next:[],prev:[],start:[],end:[],show:[],error:[],close:[]};helpers={};HopscotchI18N={stepNums:null,nextBtn:'Next',prevBtn:'Back',doneBtn:'Done',skipBtn:'Skip',closeTooltip:'Close'};customI18N={};HopscotchBubble=function(opt){this.init(opt);};HopscotchBubble.prototype={isShowing:false,currStep:undefined,setPosition:function(step){var bubbleBoundingHeight,bubbleBoundingWidth,boundingRect,top,left,arrowOffset,targetEl=utils.getStepTarget(step),el=this.element,arrowEl=this.arrowEl;bubbleBoundingWidth=el.offsetWidth;bubbleBoundingHeight=el.offsetHeight;utils.removeClass(el,'fade-in-down fade-in-up fade-in-left fade-in-right');if(!step.placement&&step.orientation){step.placement=step.orientation;}
boundingRect=targetEl.getBoundingClientRect();if(step.placement==='top'){top=(boundingRect.top-bubbleBoundingHeight)-this.opt.arrowWidth;left=boundingRect.left;}
else if(step.placement==='bottom'){top=boundingRect.bottom+this.opt.arrowWidth;left=boundingRect.left;}
else if(step.placement==='left'){top=boundingRect.top;left=boundingRect.left-bubbleBoundingWidth-this.opt.arrowWidth;}
else if(step.placement==='right'){top=boundingRect.top;left=boundingRect.right+this.opt.arrowWidth;}
else{throw'Bubble placement failed because step.placement is invalid or undefined!';}
if(step.arrowOffset!=='center'){arrowOffset=utils.getPixelValue(step.arrowOffset);}
else{arrowOffset=step.arrowOffset;}
if(!arrowOffset){arrowEl.style.top='';arrowEl.style.left='';}
else if(step.placement==='top'||step.placement==='bottom'){arrowEl.style.top='';if(arrowOffset==='center'){arrowEl.style.left=Math.floor((bubbleBoundingWidth / 2)-arrowEl.offsetWidth/2)+'px';}
else{arrowEl.style.left=arrowOffset+'px';}}
else if(step.placement==='left'||step.placement==='right'){arrowEl.style.left='';if(arrowOffset==='center'){arrowEl.style.top=Math.floor((bubbleBoundingHeight / 2)-arrowEl.offsetHeight/2)+'px';}
else{arrowEl.style.top=arrowOffset+'px';}}
if(step.xOffset==='center'){left=(boundingRect.left+targetEl.offsetWidth/2)-(bubbleBoundingWidth / 2);}
else{left+=utils.getPixelValue(step.xOffset);}
if(step.yOffset==='center'){top=(boundingRect.top+targetEl.offsetHeight/2)-(bubbleBoundingHeight / 2);}
else{top+=utils.getPixelValue(step.yOffset);}
if(!step.fixedElement){top+=utils.getScrollTop();left+=utils.getScrollLeft();}
el.style.position=(step.fixedElement?'fixed':'absolute');el.style.top=top+'px';el.style.left=left+'px';},render:function(step,idx,callback){var el=this.element,tourSpecificRenderer,customTourData,unsafe,currTour,totalSteps,nextBtnText,isLast,opts;if(step){this.currStep=step;}
else if(this.currStep){step=this.currStep;}
if(this.opt.isTourBubble){currTour=winHopscotch.getCurrTour();if(currTour){customTourData=currTour.customData;tourSpecificRenderer=currTour.customRenderer;unsafe=currTour.unsafe;if(Array.isArray(currTour.steps)){totalSteps=currTour.steps.length;isLast=(idx===totalSteps-1);}}}else{customTourData=step.customData;tourSpecificRenderer=step.customRenderer;unsafe=step.unsafe;}
if(isLast){nextBtnText=utils.getI18NString('doneBtn');}else if(step.showSkip){nextBtnText=utils.getI18NString('skipBtn');}else{nextBtnText=utils.getI18NString('nextBtn');}
if(!step.placement&&step.orientation){step.placement=step.orientation;}
this.placement=step.placement;opts={i18n:{prevBtn:utils.getI18NString('prevBtn'),nextBtn:nextBtnText,closeTooltip:utils.getI18NString('closeTooltip'),stepNum:this._getStepI18nNum(idx),},buttons:{showPrev:(utils.valOrDefault(step.showPrevButton,this.opt.showPrevButton)&&(idx>0)),showNext:utils.valOrDefault(step.showNextButton,this.opt.showNextButton),showCTA:utils.valOrDefault((step.showCTAButton&&step.ctaLabel),false),ctaLabel:step.ctaLabel,showClose:utils.valOrDefault(this.opt.showCloseButton,true)},step:{num:idx,isLast:utils.valOrDefault(isLast,false),title:(step.title||''),content:(step.content||''),placement:step.placement,padding:utils.valOrDefault(step.padding,this.opt.bubblePadding),width:utils.getPixelValue(step.width)||this.opt.bubbleWidth,customData:(step.customData||{})},tour:{isTour:this.opt.isTourBubble,numSteps:totalSteps,unsafe:utils.valOrDefault(unsafe,false),customData:(customTourData||{})}};if(typeof tourSpecificRenderer==='function'){el.innerHTML=tourSpecificRenderer(opts);}
else if(typeof tourSpecificRenderer==='string'){if(!hopscotch.templates||(typeof hopscotch.templates[tourSpecificRenderer]!=='function')){throw'Bubble rendering failed - template "'+tourSpecificRenderer+'" is not a function.';}
el.innerHTML=hopscotch.templates[tourSpecificRenderer](opts);}
else if(customRenderer){el.innerHTML=customRenderer(opts);}
else{if(!hopscotch.templates||(typeof hopscotch.templates[templateToUse]!=='function')){throw'Bubble rendering failed - template "'+templateToUse+'" is not a function.';}
el.innerHTML=hopscotch.templates[templateToUse](opts);}
children=el.children;numChildren=children.length;for(i=0;i<numChildren;i++){node=children[i];if(utils.hasClass(node,'hopscotch-arrow')){this.arrowEl=node;}}
el.style.zIndex=(typeof step.zindex==='number')?step.zindex:'auto';this._setArrow(step.placement);this.hide(false);this.setPosition(step);if(callback){callback(!step.fixedElement);}
return this;},_getStepI18nNum:function(idx){var stepNumI18N=utils.getI18NString('stepNums');if(stepNumI18N&&idx<stepNumI18N.length){idx=stepNumI18N[idx];}
else{idx=idx+1;}
return idx;},_setArrow:function(orientation){utils.removeClass(this.arrowEl,'down up right left');if(orientation==='top'){utils.addClass(this.arrowEl,'down');}
else if(orientation==='bottom'){utils.addClass(this.arrowEl,'up');}
else if(orientation==='left'){utils.addClass(this.arrowEl,'right');}
else if(orientation==='right'){utils.addClass(this.arrowEl,'left');}},_getArrowDirection:function(){if(this.placement==='top'){return'down';}
if(this.placement==='bottom'){return'up';}
if(this.placement==='left'){return'right';}
if(this.placement==='right'){return'left';}},show:function(){var self=this,fadeClass='fade-in-'+this._getArrowDirection(),fadeDur=1000;utils.removeClass(this.element,'hide');utils.addClass(this.element,fadeClass);setTimeout(function(){utils.removeClass(self.element,'invisible');},50);setTimeout(function(){utils.removeClass(self.element,fadeClass);},fadeDur);this.isShowing=true;return this;},hide:function(remove){var el=this.element;remove=utils.valOrDefault(remove,true);el.style.top='';el.style.left='';if(remove){utils.addClass(el,'hide');utils.removeClass(el,'invisible');}
else{utils.removeClass(el,'hide');utils.addClass(el,'invisible');}
utils.removeClass(el,'animate fade-in-up fade-in-down fade-in-right fade-in-left');this.isShowing=false;return this;},destroy:function(){var el=this.element;if(el){el.parentNode.removeChild(el);}
utils.removeEvtListener(el,'click',this.clickCb);},_handleBubbleClick:function(evt){var action;evt=evt||window.event;var targetElement=evt.target||evt.srcElement;function findMatchRecur(el){if(el===evt.currentTarget){return null;}
if(utils.hasClass(el,'hopscotch-cta')){return'cta';}
if(utils.hasClass(el,'hopscotch-next')){return'next';}
if(utils.hasClass(el,'hopscotch-prev')){return'prev';}
if(utils.hasClass(el,'hopscotch-close')){return'close';}
return findMatchRecur(el.parentElement);}
action=findMatchRecur(targetElement);if(action==='cta'){if(!this.opt.isTourBubble){winHopscotch.getCalloutManager().removeCallout(this.currStep.id);}
if(this.currStep.onCTA){utils.invokeCallback(this.currStep.onCTA);}}
else if(action==='next'){winHopscotch.nextStep(true);}
else if(action==='prev'){winHopscotch.prevStep(true);}
else if(action==='close'){if(this.opt.isTourBubble){var currStepNum=winHopscotch.getCurrStepNum(),currTour=winHopscotch.getCurrTour(),doEndCallback=(currStepNum===currTour.steps.length-1);utils.invokeEventCallbacks('close');winHopscotch.endTour(true,doEndCallback);}else{if(this.opt.onClose){utils.invokeCallback(this.opt.onClose);}
if(this.opt.id&&!this.opt.isTourBubble){winHopscotch.getCalloutManager().removeCallout(this.opt.id);}
else{this.destroy();}}
utils.evtPreventDefault(evt);}},init:function(initOpt){var el=document.createElement('div'),self=this,resizeCooldown=false,onWinResize,appendToBody,children,numChildren,node,i,opt;this.element=el;opt={showPrevButton:defaultOpts.showPrevButton,showNextButton:defaultOpts.showNextButton,bubbleWidth:defaultOpts.bubbleWidth,bubblePadding:defaultOpts.bubblePadding,arrowWidth:defaultOpts.arrowWidth,showNumber:true,isTourBubble:true};initOpt=(typeof initOpt===undefinedStr?{}:initOpt);utils.extend(opt,initOpt);this.opt=opt;el.className='hopscotch-bubble animated';if(!opt.isTourBubble){utils.addClass(el,'hopscotch-callout no-number');}
onWinResize=function(){if(resizeCooldown||!self.isShowing){return;}
resizeCooldown=true;setTimeout(function(){self.setPosition(self.currStep);resizeCooldown=false;},100);};utils.addEvtListener(window,'resize',onWinResize);this.clickCb=function(evt){self._handleBubbleClick(evt);};utils.addEvtListener(el,'click',this.clickCb);this.hide();if(utils.documentIsReady()){document.body.appendChild(el);}
else{if(document.addEventListener){appendToBody=function(){document.removeEventListener('DOMContentLoaded',appendToBody);window.removeEventListener('load',appendToBody);document.body.appendChild(el);};document.addEventListener('DOMContentLoaded',appendToBody,false);}
else{appendToBody=function(){if(document.readyState==='complete'){document.detachEvent('onreadystatechange',appendToBody);window.detachEvent('onload',appendToBody);document.body.appendChild(el);}};document.attachEvent('onreadystatechange',appendToBody);}
utils.addEvtListener(window,'load',appendToBody);}}};HopscotchCalloutManager=function(){var callouts={};this.createCallout=function(opt){var callout;if(opt.id){if(callouts[opt.id]){throw'Callout by that id already exists. Please choose a unique id.';}
opt.showNextButton=opt.showPrevButton=false;opt.isTourBubble=false;callout=new HopscotchBubble(opt);callouts[opt.id]=callout;if(opt.target){callout.render(opt,null,function(){callout.show();});}}
else{throw'Must specify a callout id.';}
return callout;};this.getCallout=function(id){return callouts[id];};this.removeAllCallouts=function(){var calloutId,callout;for(calloutId in callouts){if(callouts.hasOwnProperty(calloutId)){this.removeCallout(calloutId);}}};this.removeCallout=function(id){var callout=callouts[id];callouts[id]=null;if(!callout){return;}
callout.destroy();};};Hopscotch=function(initOptions){var self=this,bubble,calloutMgr,opt,currTour,currStepNum,cookieTourId,cookieTourStep,_configure,getBubble=function(setOptions){if(!bubble){bubble=new HopscotchBubble(opt);}
if(setOptions){utils.extend(bubble.opt,{bubblePadding:getOption('bubblePadding'),bubbleWidth:getOption('bubbleWidth'),showNextButton:getOption('showNextButton'),showPrevButton:getOption('showPrevButton'),showCloseButton:getOption('showCloseButton'),arrowWidth:getOption('arrowWidth')});}
return bubble;},getOption=function(name){if(typeof opt==='undefined'){return defaultOpts[name];}
return utils.valOrDefault(opt[name],defaultOpts[name]);},getCurrStep=function(){var step;if(currStepNum<0||currStepNum>=currTour.steps.length){step=null;}
else{step=currTour.steps[currStepNum];}
return step;},targetClickNextFn=function(){self.nextStep();},adjustWindowScroll=function(cb){var bubble=getBubble(),bubbleEl=bubble.element,bubbleTop=utils.getPixelValue(bubbleEl.style.top),bubbleBottom=bubbleTop+utils.getPixelValue(bubbleEl.offsetHeight),targetEl=utils.getStepTarget(getCurrStep()),targetBounds=targetEl.getBoundingClientRect(),targetElTop=targetBounds.top+utils.getScrollTop(),targetElBottom=targetBounds.bottom+utils.getScrollTop(),targetTop=(bubbleTop<targetElTop)?bubbleTop:targetElTop,targetBottom=(bubbleBottom>targetElBottom)?bubbleBottom:targetElBottom,windowTop=utils.getScrollTop(),windowBottom=windowTop+utils.getWindowHeight(),scrollToVal=targetTop-getOption('scrollTopMargin'),scrollEl,yuiAnim,yuiEase,direction,scrollIncr,scrollTimeout,scrollTimeoutFn;if(targetTop>=windowTop&&(targetTop<=windowTop+getOption('scrollTopMargin')||targetBottom<=windowBottom)){if(cb){cb();}}
else if(!getOption('smoothScroll')){window.scrollTo(0,scrollToVal);if(cb){cb();}}
else{if(typeof YAHOO!==undefinedStr&&typeof YAHOO.env!==undefinedStr&&typeof YAHOO.env.ua!==undefinedStr&&typeof YAHOO.util!==undefinedStr&&typeof YAHOO.util.Scroll!==undefinedStr){scrollEl=YAHOO.env.ua.webkit?document.body:document.documentElement;yuiEase=YAHOO.util.Easing?YAHOO.util.Easing.easeOut:undefined;yuiAnim=new YAHOO.util.Scroll(scrollEl,{scroll:{to:[0,scrollToVal]}},getOption('scrollDuration')/1000,yuiEase);yuiAnim.onComplete.subscribe(cb);yuiAnim.animate();}
else if(hasJquery){jQuery('body, html').animate({scrollTop:scrollToVal},getOption('scrollDuration'),cb);}
else{if(scrollToVal<0){scrollToVal=0;}
direction=(windowTop>targetTop)?-1:1;scrollIncr=Math.abs(windowTop-scrollToVal)/(getOption('scrollDuration')/10);scrollTimeoutFn=function(){var scrollTop=utils.getScrollTop(),scrollTarget=scrollTop+(direction*scrollIncr);if((direction>0&&scrollTarget>=scrollToVal)||(direction<0&&scrollTarget<=scrollToVal)){scrollTarget=scrollToVal;if(cb){cb();}
window.scrollTo(0,scrollTarget);return;}
window.scrollTo(0,scrollTarget);if(utils.getScrollTop()===scrollTop){if(cb){cb();}
return;}
setTimeout(scrollTimeoutFn,10);};scrollTimeoutFn();}}},goToStepWithTarget=function(direction,cb){var target,step,goToStepFn;if(currStepNum+direction>=0&&currStepNum+direction<currTour.steps.length){currStepNum+=direction;step=getCurrStep();goToStepFn=function(){target=utils.getStepTarget(step);if(target){cb(currStepNum);}
else{utils.invokeEventCallbacks('error');goToStepWithTarget(direction,cb);}};if(step.delay){setTimeout(goToStepFn,step.delay);}
else{goToStepFn();}}
else{cb(-1);}},changeStep=function(doCallbacks,direction){var bubble=getBubble(),self=this,step,origStep,wasMultiPage,changeStepCb;bubble.hide();doCallbacks=utils.valOrDefault(doCallbacks,true);step=getCurrStep();origStep=step;if(direction>0){wasMultiPage=origStep.multipage;}
else{wasMultiPage=(currStepNum>0&&currTour.steps[currStepNum-1].multipage);}
changeStepCb=function(stepNum){var doShowFollowingStep;if(stepNum===-1){return this.endTour(true);}
if(doCallbacks){if(direction>0){doShowFollowingStep=utils.invokeEventCallbacks('next',origStep.onNext);}
else{doShowFollowingStep=utils.invokeEventCallbacks('prev',origStep.onPrev);}}
if(stepNum!==currStepNum){return;}
if(wasMultiPage){utils.setState(getOption('cookieName'),currTour.id+':'+currStepNum,1);return;}
doShowFollowingStep=utils.valOrDefault(doShowFollowingStep,true);if(doShowFollowingStep){this.showStep(stepNum);}
else{this.endTour(false);}};if(!wasMultiPage&&getOption('skipIfNoElement')){goToStepWithTarget(direction,function(stepNum){changeStepCb.call(self,stepNum);});}
else if(currStepNum+direction>=0&&currStepNum+direction<currTour.steps.length){currStepNum+=direction;step=getCurrStep();if(!utils.getStepTarget(step)&&!wasMultiPage){utils.invokeEventCallbacks('error');return this.endTour(true,false);}
changeStepCb.call(this,currStepNum);}
return this;},loadTour=function(tour){var tmpOpt={},prop,tourState,tourPair;for(prop in tour){if(tour.hasOwnProperty(prop)&&prop!=='id'&&prop!=='steps'){tmpOpt[prop]=tour[prop];}}
_configure.call(this,tmpOpt,true);tourState=utils.getState(getOption('cookieName'));if(tourState){tourPair=tourState.split(':');cookieTourId=tourPair[0];cookieTourStep=tourPair[1];cookieTourStep=parseInt(cookieTourStep,10);}
return this;},findStartingStep=function(startStepNum,cb){var step,target,stepNum;currStepNum=startStepNum||0;step=getCurrStep();target=utils.getStepTarget(step);if(target){cb(currStepNum);return;}
if(!target){utils.invokeEventCallbacks('error');if(getOption('skipIfNoElement')){goToStepWithTarget(1,cb);return;}
else{currStepNum=-1;cb(currStepNum);}}},showStepHelper=function(stepNum){var step=currTour.steps[stepNum],tourSteps=currTour.steps,numTourSteps=tourSteps.length,cookieVal=currTour.id+':'+stepNum,bubble=getBubble(),targetEl=utils.getStepTarget(step),isLast,showBubble;showBubble=function(){bubble.show();utils.invokeEventCallbacks('show',step.onShow);};currStepNum=stepNum;bubble.hide(false);isLast=(stepNum===numTourSteps-1);bubble.render(step,stepNum,function(adjustScroll){if(adjustScroll){adjustWindowScroll(showBubble);}
else{showBubble();}
if(step.nextOnTargetClick){utils.addEvtListener(targetEl,'click',targetClickNextFn);}});utils.setState(getOption('cookieName'),cookieVal,1);},init=function(initOptions){if(initOptions){this.configure(initOptions);}};this.getCalloutManager=function(){if(typeof calloutMgr===undefinedStr){calloutMgr=new HopscotchCalloutManager();}
return calloutMgr;};this.startTour=function(tour,stepNum){var bubble,currStepNum,self=this;if(!currTour){currTour=tour;loadTour.call(this,tour);}
if(typeof stepNum!==undefinedStr){if(stepNum>=currTour.steps.length){throw'Specified step number out of bounds.';}
currStepNum=stepNum;}
if(!utils.documentIsReady()){waitingToStart=true;return this;}
if(typeof currStepNum==="undefined"&&currTour.id===cookieTourId&&typeof cookieTourStep!==undefinedStr){currStepNum=cookieTourStep;}
else if(!currStepNum){currStepNum=0;}
findStartingStep(currStepNum,function(stepNum){var target=(stepNum!==-1)&&utils.getStepTarget(currTour.steps[stepNum]);if(!target){self.endTour(false,false);return;}
utils.invokeEventCallbacks('start');bubble=getBubble();bubble.hide(false);self.isActive=true;if(!utils.getStepTarget(getCurrStep())){utils.invokeEventCallbacks('error');if(getOption('skipIfNoElement')){self.nextStep(false);}}
else{self.showStep(stepNum);}});return this;};this.showStep=function(stepNum){var step=currTour.steps[stepNum];if(step.delay){setTimeout(function(){showStepHelper(stepNum);},step.delay);}
else{showStepHelper(stepNum);}
return this;};this.prevStep=function(doCallbacks){changeStep.call(this,doCallbacks,-1);return this;};this.nextStep=function(doCallbacks){var step=getCurrStep(),targetEl=utils.getStepTarget(step);if(step.nextOnTargetClick){utils.removeEvtListener(targetEl,'click',targetClickNextFn);}
changeStep.call(this,doCallbacks,1);return this;};this.endTour=function(clearState,doCallbacks){var bubble=getBubble();clearState=utils.valOrDefault(clearState,true);doCallbacks=utils.valOrDefault(doCallbacks,true);currStepNum=0;cookieTourStep=undefined;bubble.hide();if(clearState){utils.clearState(getOption('cookieName'));}
if(this.isActive){this.isActive=false;if(currTour&&doCallbacks){utils.invokeEventCallbacks('end');}}
this.removeCallbacks(null,true);this.resetDefaultOptions();currTour=null;return this;};this.getCurrTour=function(){return currTour;};this.getCurrTarget=function(){return utils.getStepTarget(getCurrStep());};this.getCurrStepNum=function(){return currStepNum;};this.refreshBubblePosition=function(){bubble.setPosition(getCurrStep());return this;};this.listen=function(evtType,cb,isTourCb){if(evtType){callbacks[evtType].push({cb:cb,fromTour:isTourCb});}
return this;};this.unlisten=function(evtType,cb){var evtCallbacks=callbacks[evtType],i,len;for(i=0,len=evtCallbacks.length;i<len;++i){if(evtCallbacks[i]===cb){evtCallbacks.splice(i,1);}}
return this;};this.removeCallbacks=function(evtName,tourOnly){var cbArr,i,len,evt;for(evt in callbacks){if(!evtName||evtName===evt){if(tourOnly){cbArr=callbacks[evt];for(i=0,len=cbArr.length;i<len;++i){if(cbArr[i].fromTour){cbArr.splice(i--,1);--len;}}}
else{callbacks[evt]=[];}}}
return this;};this.registerHelper=function(id,fn){if(typeof id==='string'&&typeof fn==='function'){helpers[id]=fn;}};this.unregisterHelper=function(id){helpers[id]=null;};this.invokeHelper=function(id){var args=[],i,len;for(i=1,len=arguments.length;i<len;++i){args.push(arguments[i]);}
if(helpers[id]){helpers[id].call(null,args);}};this.setCookieName=function(name){opt.cookieName=name;return this;};this.resetDefaultOptions=function(){opt={};return this;};this.resetDefaultI18N=function(){customI18N={};return this;};this.getState=function(){return utils.getState(getOption('cookieName'));};_configure=function(options,isTourOptions){var bubble,events=['next','prev','start','end','show','error','close'],eventPropName,callbackProp,i,len;if(!opt){this.resetDefaultOptions();}
utils.extend(opt,options);if(options){utils.extend(customI18N,options.i18n);}
for(i=0,len=events.length;i<len;++i){eventPropName='on'+events[i].charAt(0).toUpperCase()+events[i].substring(1);if(options[eventPropName]){this.listen(events[i],options[eventPropName],isTourOptions);}}
bubble=getBubble(true);return this;};this.configure=function(options){return _configure.call(this,options,false);};this.setRenderer=function(render){var typeOfRender=typeof render;if(typeOfRender==='string'){templateToUse=render;customRenderer=undefined;}
else if(typeOfRender==='function'){customRenderer=render;}
return this;};this.setEscaper=function(esc){if(typeof esc==='function'){customEscape=esc;}
return this;};init.call(this,initOptions);};winHopscotch=new Hopscotch();context[namespace]=winHopscotch;(function(){var _={};_.escape=function(str){if(customEscape){return customEscape(str);}
if(str==null)return'';return(''+str).replace(new RegExp('[&<>"\']','g'),function(match){if(match=='&'){return'&amp;'}
if(match=='<'){return'&lt;'}
if(match=='>'){return'&gt;'}
if(match=='"'){return'&quot;'}
if(match=="'"){return'&#x27;'}});}
this["hopscotch"]=this["hopscotch"]||{};this["hopscotch"]["templates"]=this["hopscotch"]["templates"]||{};this["hopscotch"]["templates"]["bubble_default"]=function(obj){obj||(obj={});var __t,__p='',__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}
with(obj){function optEscape(str,unsafe){if(unsafe){return _.escape(str);}
return str;};__p+='\n<div class="hopscotch-bubble-container" style="width: '+
((__t=(step.width))==null?'':__t)+'px; padding: '+
((__t=(step.padding))==null?'':__t)+'px;">\n  ';if(tour.isTour){;__p+='<span class="hopscotch-bubble-number">'+
((__t=(i18n.stepNum))==null?'':__t)+'</span>';};__p+='\n  <div class="hopscotch-bubble-content">\n    ';if(step.title!==''){;__p+='<h3 class="hopscotch-title">'+
((__t=(optEscape(step.title,tour.unsafe)))==null?'':__t)+'</h3>';};__p+='\n    ';if(step.content!==''){;__p+='<div class="hopscotch-content">'+
((__t=(optEscape(step.content,tour.unsafe)))==null?'':__t)+'</div>';};__p+='\n  </div>\n  <div class="hopscotch-actions">\n    ';if(buttons.showPrev){;__p+='<button class="hopscotch-nav-button prev hopscotch-prev">'+
((__t=(i18n.prevBtn))==null?'':__t)+'</button>';};__p+='\n    ';if(buttons.showCTA){;__p+='<button class="hopscotch-nav-button next hopscotch-cta">'+
((__t=(buttons.ctaLabel))==null?'':__t)+'</button>';};__p+='\n    ';if(buttons.showNext){;__p+='<button class="hopscotch-nav-button next hopscotch-next">'+
((__t=(i18n.nextBtn))==null?'':__t)+'</button>';};__p+='\n  </div>\n  ';if(buttons.showClose){;__p+='<a title="'+
((__t=(i18n.closeTooltip))==null?'':__t)+'" href="#" class="hopscotch-bubble-close hopscotch-close">'+
((__t=(i18n.closeTooltip))==null?'':__t)+'</a>';};__p+='\n</div>\n<div class="hopscotch-bubble-arrow-container hopscotch-arrow">\n  <div class="hopscotch-bubble-arrow-border"></div>\n  <div class="hopscotch-bubble-arrow"></div>\n</div>';}
return __p};}());}(window,'hopscotch'));
/*! jQuery UI - v1.11.1 - 2014-10-08
 * http://jqueryui.com
 * Includes: core.js, widget.js, mouse.js, position.js, sortable.js, tabs.js, effect.js
 * Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */
(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory);}else{factory(jQuery);}}(function($){/*!
	 * jQuery UI Core 1.11.1
	 * http://jqueryui.com
	 *
	 * Copyright 2014 jQuery Foundation and other contributors
	 * Released under the MIT license.
	 * http://jquery.org/license
	 *
	 * http://api.jqueryui.com/category/ui-core/
	 */
$.ui=$.ui||{};$.extend($.ui,{version:"1.11.1",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}});$.fn.extend({scrollParent:function(includeHidden){var position=this.css("position"),excludeStaticParent=position==="absolute",overflowRegex=includeHidden?/(auto|scroll|hidden)/:/(auto|scroll)/,scrollParent=this.parents().filter(function(){var parent=$(this);if(excludeStaticParent&&parent.css("position")==="static"){return false;}
return overflowRegex.test(parent.css("overflow")+parent.css("overflow-y")+parent.css("overflow-x"));}).eq(0);return position==="fixed"||!scrollParent.length?$(this[0].ownerDocument||document):scrollParent;},uniqueId:(function(){var uuid=0;return function(){return this.each(function(){if(!this.id){this.id="ui-id-"+(++uuid);}});};})(),removeUniqueId:function(){return this.each(function(){if(/^ui-id-\d+$/.test(this.id)){$(this).removeAttr("id");}});}});function focusable(element,isTabIndexNotNaN){var map,mapName,img,nodeName=element.nodeName.toLowerCase();if("area"===nodeName){map=element.parentNode;mapName=map.name;if(!element.href||!mapName||map.nodeName.toLowerCase()!=="map"){return false;}
img=$("img[usemap='#"+mapName+"']")[0];return!!img&&visible(img);}
return(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element);}
function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().addBack().filter(function(){return $.css(this,"visibility")==="hidden";}).length;}
$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName);};}):function(elem,i,match){return!!$.data(elem,match[3]);},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")));},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN);}});if(!$("<a>").outerWidth(1).jquery){$.each(["Width","Height"],function(i,name){var side=name==="Width"?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};function reduce(elem,size,border,margin){$.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0;if(border){size-=parseFloat($.css(elem,"border"+this+"Width"))||0;}
if(margin){size-=parseFloat($.css(elem,"margin"+this))||0;}});return size;}
$.fn["inner"+name]=function(size){if(size===undefined){return orig["inner"+name].call(this);}
return this.each(function(){$(this).css(type,reduce(this,size)+"px");});};$.fn["outer"+name]=function(size,margin){if(typeof size!=="number"){return orig["outer"+name].call(this,size);}
return this.each(function(){$(this).css(type,reduce(this,size,true,margin)+"px");});};});}
if(!$.fn.addBack){$.fn.addBack=function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector));};}
if($("<a>").data("a-b","a").removeData("a-b").data("a-b")){$.fn.removeData=(function(removeData){return function(key){if(arguments.length){return removeData.call(this,$.camelCase(key));}else{return removeData.call(this);}};})($.fn.removeData);}
$.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());$.fn.extend({focus:(function(orig){return function(delay,fn){return typeof delay==="number"?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus();if(fn){fn.call(elem);}},delay);}):orig.apply(this,arguments);};})($.fn.focus),disableSelection:(function(){var eventType="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(eventType+".ui-disableSelection",function(event){event.preventDefault();});};})(),enableSelection:function(){return this.unbind(".ui-disableSelection");},zIndex:function(zIndex){if(zIndex!==undefined){return this.css("zIndex",zIndex);}
if(this.length){var elem=$(this[0]),position,value;while(elem.length&&elem[0]!==document){position=elem.css("position");if(position==="absolute"||position==="relative"||position==="fixed"){value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&value!==0){return value;}}
elem=elem.parent();}}
return 0;}});$.ui.plugin={add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set){proto.plugins[i]=proto.plugins[i]||[];proto.plugins[i].push([option,set[i]]);}},call:function(instance,name,args,allowDisconnected){var i,set=instance.plugins[name];if(!set){return;}
if(!allowDisconnected&&(!instance.element[0].parentNode||instance.element[0].parentNode.nodeType===11)){return;}
for(i=0;i<set.length;i++){if(instance.options[set[i][0]]){set[i][1].apply(instance.element,args);}}}};/*!
	 * jQuery UI Widget 1.11.1
	 * http://jqueryui.com
	 *
	 * Copyright 2014 jQuery Foundation and other contributors
	 * Released under the MIT license.
	 * http://jquery.org/license
	 *
	 * http://api.jqueryui.com/jQuery.widget/
	 */
var widget_uuid=0,widget_slice=Array.prototype.slice;$.cleanData=(function(orig){return function(elems){var events,elem,i;for(i=0;(elem=elems[i])!=null;i++){try{events=$._data(elem,"events");if(events&&events.remove){$(elem).triggerHandler("remove");}}catch(e){}}
orig(elems);};})($.cleanData);$.widget=function(name,base,prototype){var fullName,existingConstructor,constructor,basePrototype,proxiedPrototype={},namespace=name.split(".")[0];name=name.split(".")[1];fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget;}
$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName);};$[namespace]=$[namespace]||{};existingConstructor=$[namespace][name];constructor=$[namespace][name]=function(options,element){if(!this._createWidget){return new constructor(options,element);}
if(arguments.length){this._createWidget(options,element);}};$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]});basePrototype=new base();basePrototype.options=$.widget.extend({},basePrototype.options);$.each(prototype,function(prop,value){if(!$.isFunction(value)){proxiedPrototype[prop]=value;return;}
proxiedPrototype[prop]=(function(){var _super=function(){return base.prototype[prop].apply(this,arguments);},_superApply=function(args){return base.prototype[prop].apply(this,args);};return function(){var __super=this._super,__superApply=this._superApply,returnValue;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue;};})();});constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?(basePrototype.widgetEventPrefix||name):name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName});if(existingConstructor){$.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto);});delete existingConstructor._childConstructors;}else{base._childConstructors.push(constructor);}
$.widget.bridge(name,constructor);return constructor;};$.widget.extend=function(target){var input=widget_slice.call(arguments,1),inputIndex=0,inputLength=input.length,key,value;for(;inputIndex<inputLength;inputIndex++){for(key in input[inputIndex]){value=input[inputIndex][key];if(input[inputIndex].hasOwnProperty(key)&&value!==undefined){if($.isPlainObject(value)){target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value);}else{target[key]=value;}}}}
return target;};$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall=typeof options==="string",args=widget_slice.call(arguments,1),returnValue=this;options=!isMethodCall&&args.length?$.widget.extend.apply(null,[options].concat(args)):options;if(isMethodCall){this.each(function(){var methodValue,instance=$.data(this,fullName);if(options==="instance"){returnValue=instance;return false;}
if(!instance){return $.error("cannot call methods on "+name+" prior to initialization; "+"attempted to call method '"+options+"'");}
if(!$.isFunction(instance[options])||options.charAt(0)==="_"){return $.error("no such method '"+options+"' for "+name+" widget instance");}
methodValue=instance[options].apply(instance,args);if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return false;}});}else{this.each(function(){var instance=$.data(this,fullName);if(instance){instance.option(options||{});if(instance._init){instance._init();}}else{$.data(this,fullName,new object(options,this));}});}
return returnValue;};};$.Widget=function(){};$.Widget._childConstructors=[];$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0];this.element=$(element);this.uuid=widget_uuid++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=$.widget.extend({},this.options,this._getCreateOptions(),options);this.bindings=$();this.hoverable=$();this.focusable=$();if(element!==this){$.data(element,this.widgetFullName,this);this._on(true,this.element,{remove:function(event){if(event.target===element){this.destroy();}}});this.document=$(element.style?element.ownerDocument:element.document||element);this.window=$(this.document[0].defaultView||this.document[0].parentWindow);}
this._create();this._trigger("create",null,this._getCreateEventData());this._init();},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus");},_destroy:$.noop,widget:function(){return this.element;},option:function(key,value){var options=key,parts,curOption,i;if(arguments.length===0){return $.widget.extend({},this.options);}
if(typeof key==="string"){options={};parts=key.split(".");key=parts.shift();if(parts.length){curOption=options[key]=$.widget.extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]];}
key=parts.pop();if(arguments.length===1){return curOption[key]===undefined?null:curOption[key];}
curOption[key]=value;}else{if(arguments.length===1){return this.options[key]===undefined?null:this.options[key];}
options[key]=value;}}
this._setOptions(options);return this;},_setOptions:function(options){var key;for(key in options){this._setOption(key,options[key]);}
return this;},_setOption:function(key,value){this.options[key]=value;if(key==="disabled"){this.widget().toggleClass(this.widgetFullName+"-disabled",!!value);if(value){this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus");}}
return this;},enable:function(){return this._setOptions({disabled:false});},disable:function(){return this._setOptions({disabled:true});},_on:function(suppressDisabledCheck,element,handlers){var delegateElement,instance=this;if(typeof suppressDisabledCheck!=="boolean"){handlers=element;element=suppressDisabledCheck;suppressDisabledCheck=false;}
if(!handlers){handlers=element;element=this.element;delegateElement=this.widget();}else{element=delegateElement=$(element);this.bindings=this.bindings.add(element);}
$.each(handlers,function(event,handler){function handlerProxy(){if(!suppressDisabledCheck&&(instance.options.disabled===true||$(this).hasClass("ui-state-disabled"))){return;}
return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);}
if(typeof handler!=="string"){handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++;}
var match=event.match(/^([\w:-]*)\s*(.*)$/),eventName=match[1]+instance.eventNamespace,selector=match[2];if(selector){delegateElement.delegate(selector,eventName,handlerProxy);}else{element.bind(eventName,handlerProxy);}});},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;element.unbind(eventName).undelegate(eventName);},_delay:function(handler,delay){function handlerProxy(){return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);}
var instance=this;return setTimeout(handlerProxy,delay||0);},_hoverable:function(element){this.hoverable=this.hoverable.add(element);this._on(element,{mouseenter:function(event){$(event.currentTarget).addClass("ui-state-hover");},mouseleave:function(event){$(event.currentTarget).removeClass("ui-state-hover");}});},_focusable:function(element){this.focusable=this.focusable.add(element);this._on(element,{focusin:function(event){$(event.currentTarget).addClass("ui-state-focus");},focusout:function(event){$(event.currentTarget).removeClass("ui-state-focus");}});},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];data=data||{};event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();event.target=this.element[0];orig=event.originalEvent;if(orig){for(prop in orig){if(!(prop in event)){event[prop]=orig[prop];}}}
this.element.trigger(event,data);return!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===false||event.isDefaultPrevented());}};$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){if(typeof options==="string"){options={effect:options};}
var hasOptions,effectName=!options?method:options===true||typeof options==="number"?defaultEffect:options.effect||defaultEffect;options=options||{};if(typeof options==="number"){options={duration:options};}
hasOptions=!$.isEmptyObject(options);options.complete=callback;if(options.delay){element.delay(options.delay);}
if(hasOptions&&$.effects&&$.effects.effect[effectName]){element[method](options);}else if(effectName!==method&&element[effectName]){element[effectName](options.duration,options.easing,callback);}else{element.queue(function(next){$(this)[method]();if(callback){callback.call(element[0]);}
next();});}};});var widget=$.widget;/*!
	 * jQuery UI Mouse 1.11.1
	 * http://jqueryui.com
	 *
	 * Copyright 2014 jQuery Foundation and other contributors
	 * Released under the MIT license.
	 * http://jquery.org/license
	 *
	 * http://api.jqueryui.com/mouse/
	 */
var mouseHandled=false;$(document).mouseup(function(){mouseHandled=false;});var mouse=$.widget("ui.mouse",{version:"1.11.1",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var that=this;this.element.bind("mousedown."+this.widgetName,function(event){return that._mouseDown(event);}).bind("click."+this.widgetName,function(event){if(true===$.data(event.target,that.widgetName+".preventClickEvent")){$.removeData(event.target,that.widgetName+".preventClickEvent");event.stopImmediatePropagation();return false;}});this.started=false;},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);if(this._mouseMoveDelegate){this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);}},_mouseDown:function(event){if(mouseHandled){return;}
(this._mouseStarted&&this._mouseUp(event));this._mouseDownEvent=event;var that=this,btnIsLeft=(event.which===1),elIsCancel=(typeof this.options.cancel==="string"&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:false);if(!btnIsLeft||elIsCancel||!this._mouseCapture(event)){return true;}
this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=true;},this.options.delay);}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(event)!==false);if(!this._mouseStarted){event.preventDefault();return true;}}
if(true===$.data(event.target,this.widgetName+".preventClickEvent")){$.removeData(event.target,this.widgetName+".preventClickEvent");}
this._mouseMoveDelegate=function(event){return that._mouseMove(event);};this._mouseUpDelegate=function(event){return that._mouseUp(event);};this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);event.preventDefault();mouseHandled=true;return true;},_mouseMove:function(event){if($.ui.ie&&(!document.documentMode||document.documentMode<9)&&!event.button){return this._mouseUp(event);}else if(!event.which){return this._mouseUp(event);}
if(this._mouseStarted){this._mouseDrag(event);return event.preventDefault();}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(this._mouseDownEvent,event)!==false);(this._mouseStarted?this._mouseDrag(event):this._mouseUp(event));}
return!this._mouseStarted;},_mouseUp:function(event){this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(event.target===this._mouseDownEvent.target){$.data(event.target,this.widgetName+".preventClickEvent",true);}
this._mouseStop(event);}
mouseHandled=false;return false;},_mouseDistanceMet:function(event){return(Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance);},_mouseDelayMet:function(){return this.mouseDelayMet;},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true;}});/*!
	 * jQuery UI Position 1.11.1
	 * http://jqueryui.com
	 *
	 * Copyright 2014 jQuery Foundation and other contributors
	 * Released under the MIT license.
	 * http://jquery.org/license
	 *
	 * http://api.jqueryui.com/position/
	 */
(function(){$.ui=$.ui||{};var cachedScrollbarWidth,supportsOffsetFractions,max=Math.max,abs=Math.abs,round=Math.round,rhorizontal=/left|center|right/,rvertical=/top|center|bottom/,roffset=/[\+\-]\d+(\.[\d]+)?%?/,rposition=/^\w+/,rpercent=/%$/,_position=$.fn.position;function getOffsets(offsets,width,height){return[parseFloat(offsets[0])*(rpercent.test(offsets[0])?width / 100:1),parseFloat(offsets[1])*(rpercent.test(offsets[1])?height / 100:1)];}
function parseCss(element,property){return parseInt($.css(element,property),10)||0;}
function getDimensions(elem){var raw=elem[0];if(raw.nodeType===9){return{width:elem.width(),height:elem.height(),offset:{top:0,left:0}};}
if($.isWindow(raw)){return{width:elem.width(),height:elem.height(),offset:{top:elem.scrollTop(),left:elem.scrollLeft()}};}
if(raw.preventDefault){return{width:0,height:0,offset:{top:raw.pageY,left:raw.pageX}};}
return{width:elem.outerWidth(),height:elem.outerHeight(),offset:elem.offset()};}
$.position={scrollbarWidth:function(){if(cachedScrollbarWidth!==undefined){return cachedScrollbarWidth;}
var w1,w2,div=$("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),innerDiv=div.children()[0];$("body").append(div);w1=innerDiv.offsetWidth;div.css("overflow","scroll");w2=innerDiv.offsetWidth;if(w1===w2){w2=div[0].clientWidth;}
div.remove();return(cachedScrollbarWidth=w1-w2);},getScrollInfo:function(within){var overflowX=within.isWindow||within.isDocument?"":within.element.css("overflow-x"),overflowY=within.isWindow||within.isDocument?"":within.element.css("overflow-y"),hasOverflowX=overflowX==="scroll"||(overflowX==="auto"&&within.width<within.element[0].scrollWidth),hasOverflowY=overflowY==="scroll"||(overflowY==="auto"&&within.height<within.element[0].scrollHeight);return{width:hasOverflowY?$.position.scrollbarWidth():0,height:hasOverflowX?$.position.scrollbarWidth():0};},getWithinInfo:function(element){var withinElement=$(element||window),isWindow=$.isWindow(withinElement[0]),isDocument=!!withinElement[0]&&withinElement[0].nodeType===9;return{element:withinElement,isWindow:isWindow,isDocument:isDocument,offset:withinElement.offset()||{left:0,top:0},scrollLeft:withinElement.scrollLeft(),scrollTop:withinElement.scrollTop(),width:isWindow||isDocument?withinElement.width():withinElement.outerWidth(),height:isWindow||isDocument?withinElement.height():withinElement.outerHeight()};}};$.fn.position=function(options){if(!options||!options.of){return _position.apply(this,arguments);}
options=$.extend({},options);var atOffset,targetWidth,targetHeight,targetOffset,basePosition,dimensions,target=$(options.of),within=$.position.getWithinInfo(options.within),scrollInfo=$.position.getScrollInfo(within),collision=(options.collision||"flip").split(" "),offsets={};dimensions=getDimensions(target);if(target[0].preventDefault){options.at="left top";}
targetWidth=dimensions.width;targetHeight=dimensions.height;targetOffset=dimensions.offset;basePosition=$.extend({},targetOffset);$.each(["my","at"],function(){var pos=(options[this]||"").split(" "),horizontalOffset,verticalOffset;if(pos.length===1){pos=rhorizontal.test(pos[0])?pos.concat(["center"]):rvertical.test(pos[0])?["center"].concat(pos):["center","center"];}
pos[0]=rhorizontal.test(pos[0])?pos[0]:"center";pos[1]=rvertical.test(pos[1])?pos[1]:"center";horizontalOffset=roffset.exec(pos[0]);verticalOffset=roffset.exec(pos[1]);offsets[this]=[horizontalOffset?horizontalOffset[0]:0,verticalOffset?verticalOffset[0]:0];options[this]=[rposition.exec(pos[0])[0],rposition.exec(pos[1])[0]];});if(collision.length===1){collision[1]=collision[0];}
if(options.at[0]==="right"){basePosition.left+=targetWidth;}else if(options.at[0]==="center"){basePosition.left+=targetWidth / 2;}
if(options.at[1]==="bottom"){basePosition.top+=targetHeight;}else if(options.at[1]==="center"){basePosition.top+=targetHeight / 2;}
atOffset=getOffsets(offsets.at,targetWidth,targetHeight);basePosition.left+=atOffset[0];basePosition.top+=atOffset[1];return this.each(function(){var collisionPosition,using,elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseCss(this,"marginLeft"),marginTop=parseCss(this,"marginTop"),collisionWidth=elemWidth+marginLeft+parseCss(this,"marginRight")+scrollInfo.width,collisionHeight=elemHeight+marginTop+parseCss(this,"marginBottom")+scrollInfo.height,position=$.extend({},basePosition),myOffset=getOffsets(offsets.my,elem.outerWidth(),elem.outerHeight());if(options.my[0]==="right"){position.left-=elemWidth;}else if(options.my[0]==="center"){position.left-=elemWidth / 2;}
if(options.my[1]==="bottom"){position.top-=elemHeight;}else if(options.my[1]==="center"){position.top-=elemHeight / 2;}
position.left+=myOffset[0];position.top+=myOffset[1];if(!supportsOffsetFractions){position.left=round(position.left);position.top=round(position.top);}
collisionPosition={marginLeft:marginLeft,marginTop:marginTop};$.each(["left","top"],function(i,dir){if($.ui.position[collision[i]]){$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:[atOffset[0]+myOffset[0],atOffset[1]+myOffset[1]],my:options.my,at:options.at,within:within,elem:elem});}});if(options.using){using=function(props){var left=targetOffset.left-position.left,right=left+targetWidth-elemWidth,top=targetOffset.top-position.top,bottom=top+targetHeight-elemHeight,feedback={target:{element:target,left:targetOffset.left,top:targetOffset.top,width:targetWidth,height:targetHeight},element:{element:elem,left:position.left,top:position.top,width:elemWidth,height:elemHeight},horizontal:right<0?"left":left>0?"right":"center",vertical:bottom<0?"top":top>0?"bottom":"middle"};if(targetWidth<elemWidth&&abs(left+right)<targetWidth){feedback.horizontal="center";}
if(targetHeight<elemHeight&&abs(top+bottom)<targetHeight){feedback.vertical="middle";}
if(max(abs(left),abs(right))>max(abs(top),abs(bottom))){feedback.important="horizontal";}else{feedback.important="vertical";}
options.using.call(this,props,feedback);};}
elem.offset($.extend(position,{using:using}));});};$.ui.position={fit:{left:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollLeft:within.offset.left,outerWidth=within.width,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=withinOffset-collisionPosLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-withinOffset,newOverRight;if(data.collisionWidth>outerWidth){if(overLeft>0&&overRight<=0){newOverRight=position.left+overLeft+data.collisionWidth-outerWidth-withinOffset;position.left+=overLeft-newOverRight;}else if(overRight>0&&overLeft<=0){position.left=withinOffset;}else{if(overLeft>overRight){position.left=withinOffset+outerWidth-data.collisionWidth;}else{position.left=withinOffset;}}}else if(overLeft>0){position.left+=overLeft;}else if(overRight>0){position.left-=overRight;}else{position.left=max(position.left-collisionPosLeft,position.left);}},top:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollTop:within.offset.top,outerHeight=data.within.height,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=withinOffset-collisionPosTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-withinOffset,newOverBottom;if(data.collisionHeight>outerHeight){if(overTop>0&&overBottom<=0){newOverBottom=position.top+overTop+data.collisionHeight-outerHeight-withinOffset;position.top+=overTop-newOverBottom;}else if(overBottom>0&&overTop<=0){position.top=withinOffset;}else{if(overTop>overBottom){position.top=withinOffset+outerHeight-data.collisionHeight;}else{position.top=withinOffset;}}}else if(overTop>0){position.top+=overTop;}else if(overBottom>0){position.top-=overBottom;}else{position.top=max(position.top-collisionPosTop,position.top);}}},flip:{left:function(position,data){var within=data.within,withinOffset=within.offset.left+within.scrollLeft,outerWidth=within.width,offsetLeft=within.isWindow?within.scrollLeft:within.offset.left,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=collisionPosLeft-offsetLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-offsetLeft,myOffset=data.my[0]==="left"?-data.elemWidth:data.my[0]==="right"?data.elemWidth:0,atOffset=data.at[0]==="left"?data.targetWidth:data.at[0]==="right"?-data.targetWidth:0,offset=-2*data.offset[0],newOverRight,newOverLeft;if(overLeft<0){newOverRight=position.left+myOffset+atOffset+offset+data.collisionWidth-outerWidth-withinOffset;if(newOverRight<0||newOverRight<abs(overLeft)){position.left+=myOffset+atOffset+offset;}}else if(overRight>0){newOverLeft=position.left-data.collisionPosition.marginLeft+myOffset+atOffset+offset-offsetLeft;if(newOverLeft>0||abs(newOverLeft)<overRight){position.left+=myOffset+atOffset+offset;}}},top:function(position,data){var within=data.within,withinOffset=within.offset.top+within.scrollTop,outerHeight=within.height,offsetTop=within.isWindow?within.scrollTop:within.offset.top,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=collisionPosTop-offsetTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-offsetTop,top=data.my[1]==="top",myOffset=top?-data.elemHeight:data.my[1]==="bottom"?data.elemHeight:0,atOffset=data.at[1]==="top"?data.targetHeight:data.at[1]==="bottom"?-data.targetHeight:0,offset=-2*data.offset[1],newOverTop,newOverBottom;if(overTop<0){newOverBottom=position.top+myOffset+atOffset+offset+data.collisionHeight-outerHeight-withinOffset;if((position.top+myOffset+atOffset+offset)>overTop&&(newOverBottom<0||newOverBottom<abs(overTop))){position.top+=myOffset+atOffset+offset;}}else if(overBottom>0){newOverTop=position.top-data.collisionPosition.marginTop+myOffset+atOffset+offset-offsetTop;if((position.top+myOffset+atOffset+offset)>overBottom&&(newOverTop>0||abs(newOverTop)<overBottom)){position.top+=myOffset+atOffset+offset;}}}},flipfit:{left:function(){$.ui.position.flip.left.apply(this,arguments);$.ui.position.fit.left.apply(this,arguments);},top:function(){$.ui.position.flip.top.apply(this,arguments);$.ui.position.fit.top.apply(this,arguments);}}};(function(){var testElement,testElementParent,testElementStyle,offsetLeft,i,body=document.getElementsByTagName("body")[0],div=document.createElement("div");testElement=document.createElement(body?"div":"body");testElementStyle={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};if(body){$.extend(testElementStyle,{position:"absolute",left:"-1000px",top:"-1000px"});}
for(i in testElementStyle){testElement.style[i]=testElementStyle[i];}
testElement.appendChild(div);testElementParent=body||document.documentElement;testElementParent.insertBefore(testElement,testElementParent.firstChild);div.style.cssText="position: absolute; left: 10.7432222px;";offsetLeft=$(div).offset().left;supportsOffsetFractions=offsetLeft>10&&offsetLeft<11;testElement.innerHTML="";testElementParent.removeChild(testElement);})();})();var position=$.ui.position;/*!
	 * jQuery UI Sortable 1.11.1
	 * http://jqueryui.com
	 *
	 * Copyright 2014 jQuery Foundation and other contributors
	 * Released under the MIT license.
	 * http://jquery.org/license
	 *
	 * http://api.jqueryui.com/sortable/
	 */
var sortable=$.widget("ui.sortable",$.ui.mouse,{version:"1.11.1",widgetEventPrefix:"sort",ready:false,options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:"auto",cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:"> *",opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1000,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(x,reference,size){return(x>=reference)&&(x<(reference+size));},_isFloating:function(item){return(/left|right/).test(item.css("float"))||(/inline|table-cell/).test(item.css("display"));},_create:function(){var o=this.options;this.containerCache={};this.element.addClass("ui-sortable");this.refresh();this.floating=this.items.length?o.axis==="x"||this._isFloating(this.items[0].item):false;this.offset=this.element.offset();this._mouseInit();this._setHandleClassName();this.ready=true;},_setOption:function(key,value){this._super(key,value);if(key==="handle"){this._setHandleClassName();}},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle");$.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle");});},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle");this._mouseDestroy();for(var i=this.items.length-1;i>=0;i--){this.items[i].item.removeData(this.widgetName+"-item");}
return this;},_mouseCapture:function(event,overrideHandle){var currentItem=null,validHandle=false,that=this;if(this.reverting){return false;}
if(this.options.disabled||this.options.type==="static"){return false;}
this._refreshItems(event);$(event.target).parents().each(function(){if($.data(this,that.widgetName+"-item")===that){currentItem=$(this);return false;}});if($.data(event.target,that.widgetName+"-item")===that){currentItem=$(event.target);}
if(!currentItem){return false;}
if(this.options.handle&&!overrideHandle){$(this.options.handle,currentItem).find("*").addBack().each(function(){if(this===event.target){validHandle=true;}});if(!validHandle){return false;}}
this.currentItem=currentItem;this._removeCurrentsFromItems();return true;},_mouseStart:function(event,overrideHandle,noActivation){var i,body,o=this.options;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(event);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");this.originalPosition=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;(o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt));this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};if(this.helper[0]!==this.currentItem[0]){this.currentItem.hide();}
this._createPlaceholder();if(o.containment){this._setContainment();}
if(o.cursor&&o.cursor!=="auto"){body=this.document.find("body");this.storedCursor=body.css("cursor");body.css("cursor",o.cursor);this.storedStylesheet=$("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(body);}
if(o.opacity){if(this.helper.css("opacity")){this._storedOpacity=this.helper.css("opacity");}
this.helper.css("opacity",o.opacity);}
if(o.zIndex){if(this.helper.css("zIndex")){this._storedZIndex=this.helper.css("zIndex");}
this.helper.css("zIndex",o.zIndex);}
if(this.scrollParent[0]!==document&&this.scrollParent[0].tagName!=="HTML"){this.overflowOffset=this.scrollParent.offset();}
this._trigger("start",event,this._uiHash());if(!this._preserveHelperProportions){this._cacheHelperProportions();}
if(!noActivation){for(i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("activate",event,this._uiHash(this));}}
if($.ui.ddmanager){$.ui.ddmanager.current=this;}
if($.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event);}
this.dragging=true;this.helper.addClass("ui-sortable-helper");this._mouseDrag(event);return true;},_mouseDrag:function(event){var i,item,itemElement,intersection,o=this.options,scrolled=false;this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs){this.lastPositionAbs=this.positionAbs;}
if(this.options.scroll){if(this.scrollParent[0]!==document&&this.scrollParent[0].tagName!=="HTML"){if((this.overflowOffset.top+this.scrollParent[0].offsetHeight)-event.pageY<o.scrollSensitivity){this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop+o.scrollSpeed;}else if(event.pageY-this.overflowOffset.top<o.scrollSensitivity){this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop-o.scrollSpeed;}
if((this.overflowOffset.left+this.scrollParent[0].offsetWidth)-event.pageX<o.scrollSensitivity){this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft+o.scrollSpeed;}else if(event.pageX-this.overflowOffset.left<o.scrollSensitivity){this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft-o.scrollSpeed;}}else{if(event.pageY-$(document).scrollTop()<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed);}else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed);}
if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed);}else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed);}}
if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event);}}
this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!=="y"){this.helper[0].style.left=this.position.left+"px";}
if(!this.options.axis||this.options.axis!=="x"){this.helper[0].style.top=this.position.top+"px";}
for(i=this.items.length-1;i>=0;i--){item=this.items[i];itemElement=item.item[0];intersection=this._intersectsWithPointer(item);if(!intersection){continue;}
if(item.instance!==this.currentContainer){continue;}
if(itemElement!==this.currentItem[0]&&this.placeholder[intersection===1?"next":"prev"]()[0]!==itemElement&&!$.contains(this.placeholder[0],itemElement)&&(this.options.type==="semi-dynamic"?!$.contains(this.element[0],itemElement):true)){this.direction=intersection===1?"down":"up";if(this.options.tolerance==="pointer"||this._intersectsWithSides(item)){this._rearrange(event,item);}else{break;}
this._trigger("change",event,this._uiHash());break;}}
this._contactContainers(event);if($.ui.ddmanager){$.ui.ddmanager.drag(this,event);}
this._trigger("sort",event,this._uiHash());this.lastPositionAbs=this.positionAbs;return false;},_mouseStop:function(event,noPropagation){if(!event){return;}
if($.ui.ddmanager&&!this.options.dropBehaviour){$.ui.ddmanager.drop(this,event);}
if(this.options.revert){var that=this,cur=this.placeholder.offset(),axis=this.options.axis,animation={};if(!axis||axis==="x"){animation.left=cur.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft);}
if(!axis||axis==="y"){animation.top=cur.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop);}
this.reverting=true;$(this.helper).animate(animation,parseInt(this.options.revert,10)||500,function(){that._clear(event);});}else{this._clear(event,noPropagation);}
return false;},cancel:function(){if(this.dragging){this._mouseUp({target:null});if(this.options.helper==="original"){this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper");}else{this.currentItem.show();}
for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("deactivate",null,this._uiHash(this));if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",null,this._uiHash(this));this.containers[i].containerCache.over=0;}}}
if(this.placeholder){if(this.placeholder[0].parentNode){this.placeholder[0].parentNode.removeChild(this.placeholder[0]);}
if(this.options.helper!=="original"&&this.helper&&this.helper[0].parentNode){this.helper.remove();}
$.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});if(this.domPosition.prev){$(this.domPosition.prev).after(this.currentItem);}else{$(this.domPosition.parent).prepend(this.currentItem);}}
return this;},serialize:function(o){var items=this._getItemsAsjQuery(o&&o.connected),str=[];o=o||{};$(items).each(function(){var res=($(o.item||this).attr(o.attribute||"id")||"").match(o.expression||(/(.+)[\-=_](.+)/));if(res){str.push((o.key||res[1]+"[]")+"="+(o.key&&o.expression?res[1]:res[2]));}});if(!str.length&&o.key){str.push(o.key+"=");}
return str.join("&");},toArray:function(o){var items=this._getItemsAsjQuery(o&&o.connected),ret=[];o=o||{};items.each(function(){ret.push($(o.item||this).attr(o.attribute||"id")||"");});return ret;},_intersectsWith:function(item){var x1=this.positionAbs.left,x2=x1+this.helperProportions.width,y1=this.positionAbs.top,y2=y1+this.helperProportions.height,l=item.left,r=l+item.width,t=item.top,b=t+item.height,dyClick=this.offset.click.top,dxClick=this.offset.click.left,isOverElementHeight=(this.options.axis==="x")||((y1+dyClick)>t&&(y1+dyClick)<b),isOverElementWidth=(this.options.axis==="y")||((x1+dxClick)>l&&(x1+dxClick)<r),isOverElement=isOverElementHeight&&isOverElementWidth;if(this.options.tolerance==="pointer"||this.options.forcePointerForContainers||(this.options.tolerance!=="pointer"&&this.helperProportions[this.floating?"width":"height"]>item[this.floating?"width":"height"])){return isOverElement;}else{return(l<x1+(this.helperProportions.width / 2)&&x2-(this.helperProportions.width / 2)<r&&t<y1+(this.helperProportions.height / 2)&&y2-(this.helperProportions.height / 2)<b);}},_intersectsWithPointer:function(item){var isOverElementHeight=(this.options.axis==="x")||this._isOverAxis(this.positionAbs.top+this.offset.click.top,item.top,item.height),isOverElementWidth=(this.options.axis==="y")||this._isOverAxis(this.positionAbs.left+this.offset.click.left,item.left,item.width),isOverElement=isOverElementHeight&&isOverElementWidth,verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(!isOverElement){return false;}
return this.floating?(((horizontalDirection&&horizontalDirection==="right")||verticalDirection==="down")?2:1):(verticalDirection&&(verticalDirection==="down"?2:1));},_intersectsWithSides:function(item){var isOverBottomHalf=this._isOverAxis(this.positionAbs.top+this.offset.click.top,item.top+(item.height/2),item.height),isOverRightHalf=this._isOverAxis(this.positionAbs.left+this.offset.click.left,item.left+(item.width/2),item.width),verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(this.floating&&horizontalDirection){return((horizontalDirection==="right"&&isOverRightHalf)||(horizontalDirection==="left"&&!isOverRightHalf));}else{return verticalDirection&&((verticalDirection==="down"&&isOverBottomHalf)||(verticalDirection==="up"&&!isOverBottomHalf));}},_getDragVerticalDirection:function(){var delta=this.positionAbs.top-this.lastPositionAbs.top;return delta!==0&&(delta>0?"down":"up");},_getDragHorizontalDirection:function(){var delta=this.positionAbs.left-this.lastPositionAbs.left;return delta!==0&&(delta>0?"right":"left");},refresh:function(event){this._refreshItems(event);this._setHandleClassName();this.refreshPositions();return this;},_connectWith:function(){var options=this.options;return options.connectWith.constructor===String?[options.connectWith]:options.connectWith;},_getItemsAsjQuery:function(connected){var i,j,cur,inst,items=[],queries=[],connectWith=this._connectWith();if(connectWith&&connected){for(i=connectWith.length-1;i>=0;i--){cur=$(connectWith[i]);for(j=cur.length-1;j>=0;j--){inst=$.data(cur[j],this.widgetFullName);if(inst&&inst!==this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element):$(inst.options.items,inst.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),inst]);}}}}
queries.push([$.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):$(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);function addItems(){items.push(this);}
for(i=queries.length-1;i>=0;i--){queries[i][0].each(addItems);}
return $(items);},_removeCurrentsFromItems:function(){var list=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=$.grep(this.items,function(item){for(var j=0;j<list.length;j++){if(list[j]===item.item[0]){return false;}}
return true;});},_refreshItems:function(event){this.items=[];this.containers=[this];var i,j,cur,inst,targetData,_queries,item,queriesLength,items=this.items,queries=[[$.isFunction(this.options.items)?this.options.items.call(this.element[0],event,{item:this.currentItem}):$(this.options.items,this.element),this]],connectWith=this._connectWith();if(connectWith&&this.ready){for(i=connectWith.length-1;i>=0;i--){cur=$(connectWith[i]);for(j=cur.length-1;j>=0;j--){inst=$.data(cur[j],this.widgetFullName);if(inst&&inst!==this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element[0],event,{item:this.currentItem}):$(inst.options.items,inst.element),inst]);this.containers.push(inst);}}}}
for(i=queries.length-1;i>=0;i--){targetData=queries[i][1];_queries=queries[i][0];for(j=0,queriesLength=_queries.length;j<queriesLength;j++){item=$(_queries[j]);item.data(this.widgetName+"-item",targetData);items.push({item:item,instance:targetData,width:0,height:0,left:0,top:0});}}},refreshPositions:function(fast){if(this.offsetParent&&this.helper){this.offset.parent=this._getParentOffset();}
var i,item,t,p;for(i=this.items.length-1;i>=0;i--){item=this.items[i];if(item.instance!==this.currentContainer&&this.currentContainer&&item.item[0]!==this.currentItem[0]){continue;}
t=this.options.toleranceElement?$(this.options.toleranceElement,item.item):item.item;if(!fast){item.width=t.outerWidth();item.height=t.outerHeight();}
p=t.offset();item.left=p.left;item.top=p.top;}
if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this);}else{for(i=this.containers.length-1;i>=0;i--){p=this.containers[i].element.offset();this.containers[i].containerCache.left=p.left;this.containers[i].containerCache.top=p.top;this.containers[i].containerCache.width=this.containers[i].element.outerWidth();this.containers[i].containerCache.height=this.containers[i].element.outerHeight();}}
return this;},_createPlaceholder:function(that){that=that||this;var className,o=that.options;if(!o.placeholder||o.placeholder.constructor===String){className=o.placeholder;o.placeholder={element:function(){var nodeName=that.currentItem[0].nodeName.toLowerCase(),element=$("<"+nodeName+">",that.document[0]).addClass(className||that.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");if(nodeName==="tr"){that.currentItem.children().each(function(){$("<td>&#160;</td>",that.document[0]).attr("colspan",$(this).attr("colspan")||1).appendTo(element);});}else if(nodeName==="img"){element.attr("src",that.currentItem.attr("src"));}
if(!className){element.css("visibility","hidden");}
return element;},update:function(container,p){if(className&&!o.forcePlaceholderSize){return;}
if(!p.height()){p.height(that.currentItem.innerHeight()-parseInt(that.currentItem.css("paddingTop")||0,10)-parseInt(that.currentItem.css("paddingBottom")||0,10));}
if(!p.width()){p.width(that.currentItem.innerWidth()-parseInt(that.currentItem.css("paddingLeft")||0,10)-parseInt(that.currentItem.css("paddingRight")||0,10));}}};}
that.placeholder=$(o.placeholder.element.call(that.element,that.currentItem));that.currentItem.after(that.placeholder);o.placeholder.update(that,that.placeholder);},_contactContainers:function(event){var i,j,dist,itemWithLeastDistance,posProperty,sizeProperty,cur,nearBottom,floating,axis,innermostContainer=null,innermostIndex=null;for(i=this.containers.length-1;i>=0;i--){if($.contains(this.currentItem[0],this.containers[i].element[0])){continue;}
if(this._intersectsWith(this.containers[i].containerCache)){if(innermostContainer&&$.contains(this.containers[i].element[0],innermostContainer.element[0])){continue;}
innermostContainer=this.containers[i];innermostIndex=i;}else{if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",event,this._uiHash(this));this.containers[i].containerCache.over=0;}}}
if(!innermostContainer){return;}
if(this.containers.length===1){if(!this.containers[innermostIndex].containerCache.over){this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1;}}else{dist=10000;itemWithLeastDistance=null;floating=innermostContainer.floating||this._isFloating(this.currentItem);posProperty=floating?"left":"top";sizeProperty=floating?"width":"height";axis=floating?"clientX":"clientY";for(j=this.items.length-1;j>=0;j--){if(!$.contains(this.containers[innermostIndex].element[0],this.items[j].item[0])){continue;}
if(this.items[j].item[0]===this.currentItem[0]){continue;}
cur=this.items[j].item.offset()[posProperty];nearBottom=false;if(event[axis]-cur>this.items[j][sizeProperty]/ 2){nearBottom=true;}
if(Math.abs(event[axis]-cur)<dist){dist=Math.abs(event[axis]-cur);itemWithLeastDistance=this.items[j];this.direction=nearBottom?"up":"down";}}
if(!itemWithLeastDistance&&!this.options.dropOnEmpty){return;}
if(this.currentContainer===this.containers[innermostIndex]){return;}
itemWithLeastDistance?this._rearrange(event,itemWithLeastDistance,null,true):this._rearrange(event,null,this.containers[innermostIndex].element,true);this._trigger("change",event,this._uiHash());this.containers[innermostIndex]._trigger("change",event,this._uiHash(this));this.currentContainer=this.containers[innermostIndex];this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1;}},_createHelper:function(event){var o=this.options,helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event,this.currentItem])):(o.helper==="clone"?this.currentItem.clone():this.currentItem);if(!helper.parents("body").length){$(o.appendTo!=="parent"?o.appendTo:this.currentItem[0].parentNode)[0].appendChild(helper[0]);}
if(helper[0]===this.currentItem[0]){this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")};}
if(!helper[0].style.width||o.forceHelperSize){helper.width(this.currentItem.width());}
if(!helper[0].style.height||o.forceHelperSize){helper.height(this.currentItem.height());}
return helper;},_adjustOffsetFromHelper:function(obj){if(typeof obj==="string"){obj=obj.split(" ");}
if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0};}
if("left"in obj){this.offset.click.left=obj.left+this.margins.left;}
if("right"in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left;}
if("top"in obj){this.offset.click.top=obj.top+this.margins.top;}
if("bottom"in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top;}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();if(this.cssPosition==="absolute"&&this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop();}
if(this.offsetParent[0]===document.body||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&$.ui.ie)){po={top:0,left:0};}
return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var p=this.currentItem.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()};}else{return{top:0,left:0};}},_cacheMargins:function(){this.margins={left:(parseInt(this.currentItem.css("marginLeft"),10)||0),top:(parseInt(this.currentItem.css("marginTop"),10)||0)};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var ce,co,over,o=this.options;if(o.containment==="parent"){o.containment=this.helper[0].parentNode;}
if(o.containment==="document"||o.containment==="window"){this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,$(o.containment==="document"?document:window).width()-this.helperProportions.width-this.margins.left,($(o.containment==="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];}
if(!(/^(document|window|parent)$/).test(o.containment)){ce=$(o.containment)[0];co=$(o.containment).offset();over=($(ce).css("overflow")!=="hidden");this.containment=[co.left+(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0)-this.margins.left,co.top+(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0)-this.margins.top,co.left+(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,co.top+(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top];}},_convertPositionTo:function(d,pos){if(!pos){pos=this.position;}
var mod=d==="absolute"?1:-1,scroll=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);return{top:(pos.top+
this.offset.relative.top*mod+
this.offset.parent.top*mod-
((this.cssPosition==="fixed"?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop()))*mod)),left:(pos.left+
this.offset.relative.left*mod+
this.offset.parent.left*mod-
((this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod))};},_generatePosition:function(event){var top,left,o=this.options,pageX=event.pageX,pageY=event.pageY,scroll=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);if(this.cssPosition==="relative"&&!(this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0])){this.offset.relative=this._getRelativeOffset();}
if(this.originalPosition){if(this.containment){if(event.pageX-this.offset.click.left<this.containment[0]){pageX=this.containment[0]+this.offset.click.left;}
if(event.pageY-this.offset.click.top<this.containment[1]){pageY=this.containment[1]+this.offset.click.top;}
if(event.pageX-this.offset.click.left>this.containment[2]){pageX=this.containment[2]+this.offset.click.left;}
if(event.pageY-this.offset.click.top>this.containment[3]){pageY=this.containment[3]+this.offset.click.top;}}
if(o.grid){top=this.originalPageY+Math.round((pageY-this.originalPageY)/ o.grid[1])*o.grid[1];pageY=this.containment?((top-this.offset.click.top>=this.containment[1]&&top-this.offset.click.top<=this.containment[3])?top:((top-this.offset.click.top>=this.containment[1])?top-o.grid[1]:top+o.grid[1])):top;left=this.originalPageX+Math.round((pageX-this.originalPageX)/ o.grid[0])*o.grid[0];pageX=this.containment?((left-this.offset.click.left>=this.containment[0]&&left-this.offset.click.left<=this.containment[2])?left:((left-this.offset.click.left>=this.containment[0])?left-o.grid[0]:left+o.grid[0])):left;}}
return{top:(pageY-
this.offset.click.top-
this.offset.relative.top-
this.offset.parent.top+
((this.cssPosition==="fixed"?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop())))),left:(pageX-
this.offset.click.left-
this.offset.relative.left-
this.offset.parent.left+
((this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())))};},_rearrange:function(event,i,a,hardRefresh){a?a[0].appendChild(this.placeholder[0]):i.item[0].parentNode.insertBefore(this.placeholder[0],(this.direction==="down"?i.item[0]:i.item[0].nextSibling));this.counter=this.counter?++this.counter:1;var counter=this.counter;this._delay(function(){if(counter===this.counter){this.refreshPositions(!hardRefresh);}});},_clear:function(event,noPropagation){this.reverting=false;var i,delayedTriggers=[];if(!this._noFinalSort&&this.currentItem.parent().length){this.placeholder.before(this.currentItem);}
this._noFinalSort=null;if(this.helper[0]===this.currentItem[0]){for(i in this._storedCSS){if(this._storedCSS[i]==="auto"||this._storedCSS[i]==="static"){this._storedCSS[i]="";}}
this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper");}else{this.currentItem.show();}
if(this.fromOutside&&!noPropagation){delayedTriggers.push(function(event){this._trigger("receive",event,this._uiHash(this.fromOutside));});}
if((this.fromOutside||this.domPosition.prev!==this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!==this.currentItem.parent()[0])&&!noPropagation){delayedTriggers.push(function(event){this._trigger("update",event,this._uiHash());});}
if(this!==this.currentContainer){if(!noPropagation){delayedTriggers.push(function(event){this._trigger("remove",event,this._uiHash());});delayedTriggers.push((function(c){return function(event){c._trigger("receive",event,this._uiHash(this));};}).call(this,this.currentContainer));delayedTriggers.push((function(c){return function(event){c._trigger("update",event,this._uiHash(this));};}).call(this,this.currentContainer));}}
function delayEvent(type,instance,container){return function(event){container._trigger(type,event,instance._uiHash(instance));};}
for(i=this.containers.length-1;i>=0;i--){if(!noPropagation){delayedTriggers.push(delayEvent("deactivate",this,this.containers[i]));}
if(this.containers[i].containerCache.over){delayedTriggers.push(delayEvent("out",this,this.containers[i]));this.containers[i].containerCache.over=0;}}
if(this.storedCursor){this.document.find("body").css("cursor",this.storedCursor);this.storedStylesheet.remove();}
if(this._storedOpacity){this.helper.css("opacity",this._storedOpacity);}
if(this._storedZIndex){this.helper.css("zIndex",this._storedZIndex==="auto"?"":this._storedZIndex);}
this.dragging=false;if(this.cancelHelperRemoval){if(!noPropagation){this._trigger("beforeStop",event,this._uiHash());for(i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event);}
this._trigger("stop",event,this._uiHash());}
this.fromOutside=false;return false;}
if(!noPropagation){this._trigger("beforeStop",event,this._uiHash());}
this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.helper[0]!==this.currentItem[0]){this.helper.remove();}
this.helper=null;if(!noPropagation){for(i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event);}
this._trigger("stop",event,this._uiHash());}
this.fromOutside=false;return true;},_trigger:function(){if($.Widget.prototype._trigger.apply(this,arguments)===false){this.cancel();}},_uiHash:function(_inst){var inst=_inst||this;return{helper:inst.helper,placeholder:inst.placeholder||$([]),position:inst.position,originalPosition:inst.originalPosition,offset:inst.positionAbs,item:inst.currentItem,sender:_inst?_inst.element:null};}});/*!
	 * jQuery UI Tabs 1.11.1
	 * http://jqueryui.com
	 *
	 * Copyright 2014 jQuery Foundation and other contributors
	 * Released under the MIT license.
	 * http://jquery.org/license
	 *
	 * http://api.jqueryui.com/tabs/
	 */
var tabs=$.widget("ui.tabs",{version:"1.11.1",delay:300,options:{active:null,collapsible:false,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:(function(){var rhash=/#.*$/;return function(anchor){var anchorUrl,locationUrl;anchor=anchor.cloneNode(false);anchorUrl=anchor.href.replace(rhash,"");locationUrl=location.href.replace(rhash,"");try{anchorUrl=decodeURIComponent(anchorUrl);}catch(error){}
try{locationUrl=decodeURIComponent(locationUrl);}catch(error){}
return anchor.hash.length>1&&anchorUrl===locationUrl;};})(),_create:function(){var that=this,options=this.options;this.running=false;this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",options.collapsible);this._processTabs();options.active=this._initialActive();if($.isArray(options.disabled)){options.disabled=$.unique(options.disabled.concat($.map(this.tabs.filter(".ui-state-disabled"),function(li){return that.tabs.index(li);}))).sort();}
if(this.options.active!==false&&this.anchors.length){this.active=this._findActive(options.active);}else{this.active=$();}
this._refresh();if(this.active.length){this.load(options.active);}},_initialActive:function(){var active=this.options.active,collapsible=this.options.collapsible,locationHash=location.hash.substring(1);if(active===null){if(locationHash){this.tabs.each(function(i,tab){if($(tab).attr("aria-controls")===locationHash){active=i;return false;}});}
if(active===null){active=this.tabs.index(this.tabs.filter(".ui-tabs-active"));}
if(active===null||active===-1){active=this.tabs.length?0:false;}}
if(active!==false){active=this.tabs.index(this.tabs.eq(active));if(active===-1){active=collapsible?false:0;}}
if(!collapsible&&active===false&&this.anchors.length){active=0;}
return active;},_getCreateEventData:function(){return{tab:this.active,panel:!this.active.length?$():this._getPanelForTab(this.active)};},_tabKeydown:function(event){var focusedTab=$(this.document[0].activeElement).closest("li"),selectedIndex=this.tabs.index(focusedTab),goingForward=true;if(this._handlePageNav(event)){return;}
switch(event.keyCode){case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:selectedIndex++;break;case $.ui.keyCode.UP:case $.ui.keyCode.LEFT:goingForward=false;selectedIndex--;break;case $.ui.keyCode.END:selectedIndex=this.anchors.length-1;break;case $.ui.keyCode.HOME:selectedIndex=0;break;case $.ui.keyCode.SPACE:event.preventDefault();clearTimeout(this.activating);this._activate(selectedIndex);return;case $.ui.keyCode.ENTER:event.preventDefault();clearTimeout(this.activating);this._activate(selectedIndex===this.options.active?false:selectedIndex);return;default:return;}
event.preventDefault();clearTimeout(this.activating);selectedIndex=this._focusNextTab(selectedIndex,goingForward);if(!event.ctrlKey){focusedTab.attr("aria-selected","false");this.tabs.eq(selectedIndex).attr("aria-selected","true");this.activating=this._delay(function(){this.option("active",selectedIndex);},this.delay);}},_panelKeydown:function(event){if(this._handlePageNav(event)){return;}
if(event.ctrlKey&&event.keyCode===$.ui.keyCode.UP){event.preventDefault();this.active.focus();}},_handlePageNav:function(event){if(event.altKey&&event.keyCode===$.ui.keyCode.PAGE_UP){this._activate(this._focusNextTab(this.options.active-1,false));return true;}
if(event.altKey&&event.keyCode===$.ui.keyCode.PAGE_DOWN){this._activate(this._focusNextTab(this.options.active+1,true));return true;}},_findNextTab:function(index,goingForward){var lastTabIndex=this.tabs.length-1;function constrain(){if(index>lastTabIndex){index=0;}
if(index<0){index=lastTabIndex;}
return index;}
while($.inArray(constrain(),this.options.disabled)!==-1){index=goingForward?index+1:index-1;}
return index;},_focusNextTab:function(index,goingForward){index=this._findNextTab(index,goingForward);this.tabs.eq(index).focus();return index;},_setOption:function(key,value){if(key==="active"){this._activate(value);return;}
if(key==="disabled"){this._setupDisabled(value);return;}
this._super(key,value);if(key==="collapsible"){this.element.toggleClass("ui-tabs-collapsible",value);if(!value&&this.options.active===false){this._activate(0);}}
if(key==="event"){this._setupEvents(value);}
if(key==="heightStyle"){this._setupHeightStyle(value);}},_sanitizeSelector:function(hash){return hash?hash.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):"";},refresh:function(){var options=this.options,lis=this.tablist.children(":has(a[href])");options.disabled=$.map(lis.filter(".ui-state-disabled"),function(tab){return lis.index(tab);});this._processTabs();if(options.active===false||!this.anchors.length){options.active=false;this.active=$();}else if(this.active.length&&!$.contains(this.tablist[0],this.active[0])){if(this.tabs.length===options.disabled.length){options.active=false;this.active=$();}else{this._activate(this._findNextTab(Math.max(0,options.active-1),false));}}else{options.active=this.tabs.index(this.active);}
this._refresh();},_refresh:function(){this._setupDisabled(this.options.disabled);this._setupEvents(this.options.event);this._setupHeightStyle(this.options.heightStyle);this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1});this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"});if(!this.active.length){this.tabs.eq(0).attr("tabIndex",0);}else{this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0});this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"});}},_processTabs:function(){var that=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist").delegate("> li","mousedown"+this.eventNamespace,function(event){if($(this).is(".ui-state-disabled")){event.preventDefault();}}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){if($(this).closest("li").is(".ui-state-disabled")){this.blur();}});this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1});this.anchors=this.tabs.map(function(){return $("a",this)[0];}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1});this.panels=$();this.anchors.each(function(i,anchor){var selector,panel,panelId,anchorId=$(anchor).uniqueId().attr("id"),tab=$(anchor).closest("li"),originalAriaControls=tab.attr("aria-controls");if(that._isLocal(anchor)){selector=anchor.hash;panelId=selector.substring(1);panel=that.element.find(that._sanitizeSelector(selector));}else{panelId=tab.attr("aria-controls")||$({}).uniqueId()[0].id;selector="#"+panelId;panel=that.element.find(selector);if(!panel.length){panel=that._createPanel(panelId);panel.insertAfter(that.panels[i-1]||that.tablist);}
panel.attr("aria-live","polite");}
if(panel.length){that.panels=that.panels.add(panel);}
if(originalAriaControls){tab.data("ui-tabs-aria-controls",originalAriaControls);}
tab.attr({"aria-controls":panelId,"aria-labelledby":anchorId});panel.attr("aria-labelledby",anchorId);});this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel");},_getList:function(){return this.tablist||this.element.find("ol,ul").eq(0);},_createPanel:function(id){return $("<div>").attr("id",id).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",true);},_setupDisabled:function(disabled){if($.isArray(disabled)){if(!disabled.length){disabled=false;}else if(disabled.length===this.anchors.length){disabled=true;}}
for(var i=0,li;(li=this.tabs[i]);i++){if(disabled===true||$.inArray(i,disabled)!==-1){$(li).addClass("ui-state-disabled").attr("aria-disabled","true");}else{$(li).removeClass("ui-state-disabled").removeAttr("aria-disabled");}}
this.options.disabled=disabled;},_setupEvents:function(event){var events={};if(event){$.each(event.split(" "),function(index,eventName){events[eventName]="_eventHandler";});}
this._off(this.anchors.add(this.tabs).add(this.panels));this._on(true,this.anchors,{click:function(event){event.preventDefault();}});this._on(this.anchors,events);this._on(this.tabs,{keydown:"_tabKeydown"});this._on(this.panels,{keydown:"_panelKeydown"});this._focusable(this.tabs);this._hoverable(this.tabs);},_setupHeightStyle:function(heightStyle){var maxHeight,parent=this.element.parent();if(heightStyle==="fill"){maxHeight=parent.height();maxHeight-=this.element.outerHeight()-this.element.height();this.element.siblings(":visible").each(function(){var elem=$(this),position=elem.css("position");if(position==="absolute"||position==="fixed"){return;}
maxHeight-=elem.outerHeight(true);});this.element.children().not(this.panels).each(function(){maxHeight-=$(this).outerHeight(true);});this.panels.each(function(){$(this).height(Math.max(0,maxHeight-
$(this).innerHeight()+$(this).height()));}).css("overflow","auto");}else if(heightStyle==="auto"){maxHeight=0;this.panels.each(function(){maxHeight=Math.max(maxHeight,$(this).height("").height());}).height(maxHeight);}},_eventHandler:function(event){var options=this.options,active=this.active,anchor=$(event.currentTarget),tab=anchor.closest("li"),clickedIsActive=tab[0]===active[0],collapsing=clickedIsActive&&options.collapsible,toShow=collapsing?$():this._getPanelForTab(tab),toHide=!active.length?$():this._getPanelForTab(active),eventData={oldTab:active,oldPanel:toHide,newTab:collapsing?$():tab,newPanel:toShow};event.preventDefault();if(tab.hasClass("ui-state-disabled")||tab.hasClass("ui-tabs-loading")||this.running||(clickedIsActive&&!options.collapsible)||(this._trigger("beforeActivate",event,eventData)===false)){return;}
options.active=collapsing?false:this.tabs.index(tab);this.active=clickedIsActive?$():tab;if(this.xhr){this.xhr.abort();}
if(!toHide.length&&!toShow.length){$.error("jQuery UI Tabs: Mismatching fragment identifier.");}
if(toShow.length){this.load(this.tabs.index(tab),event);}
this._toggle(event,eventData);},_toggle:function(event,eventData){var that=this,toShow=eventData.newPanel,toHide=eventData.oldPanel;this.running=true;function complete(){that.running=false;that._trigger("activate",event,eventData);}
function show(){eventData.newTab.closest("li").addClass("ui-tabs-active ui-state-active");if(toShow.length&&that.options.show){that._show(toShow,that.options.show,complete);}else{toShow.show();complete();}}
if(toHide.length&&this.options.hide){this._hide(toHide,this.options.hide,function(){eventData.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active");show();});}else{eventData.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active");toHide.hide();show();}
toHide.attr("aria-hidden","true");eventData.oldTab.attr({"aria-selected":"false","aria-expanded":"false"});if(toShow.length&&toHide.length){eventData.oldTab.attr("tabIndex",-1);}else if(toShow.length){this.tabs.filter(function(){return $(this).attr("tabIndex")===0;}).attr("tabIndex",-1);}
toShow.attr("aria-hidden","false");eventData.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0});},_activate:function(index){var anchor,active=this._findActive(index);if(active[0]===this.active[0]){return;}
if(!active.length){active=this.active;}
anchor=active.find(".ui-tabs-anchor")[0];this._eventHandler({target:anchor,currentTarget:anchor,preventDefault:$.noop});},_findActive:function(index){return index===false?$():this.tabs.eq(index);},_getIndex:function(index){if(typeof index==="string"){index=this.anchors.index(this.anchors.filter("[href$='"+index+"']"));}
return index;},_destroy:function(){if(this.xhr){this.xhr.abort();}
this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible");this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role");this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId();this.tablist.unbind(this.eventNamespace);this.tabs.add(this.panels).each(function(){if($.data(this,"ui-tabs-destroy")){$(this).remove();}else{$(this).removeClass("ui-state-default ui-state-active ui-state-disabled "+"ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role");}});this.tabs.each(function(){var li=$(this),prev=li.data("ui-tabs-aria-controls");if(prev){li.attr("aria-controls",prev).removeData("ui-tabs-aria-controls");}else{li.removeAttr("aria-controls");}});this.panels.show();if(this.options.heightStyle!=="content"){this.panels.css("height","");}},enable:function(index){var disabled=this.options.disabled;if(disabled===false){return;}
if(index===undefined){disabled=false;}else{index=this._getIndex(index);if($.isArray(disabled)){disabled=$.map(disabled,function(num){return num!==index?num:null;});}else{disabled=$.map(this.tabs,function(li,num){return num!==index?num:null;});}}
this._setupDisabled(disabled);},disable:function(index){var disabled=this.options.disabled;if(disabled===true){return;}
if(index===undefined){disabled=true;}else{index=this._getIndex(index);if($.inArray(index,disabled)!==-1){return;}
if($.isArray(disabled)){disabled=$.merge([index],disabled).sort();}else{disabled=[index];}}
this._setupDisabled(disabled);},load:function(index,event){index=this._getIndex(index);var that=this,tab=this.tabs.eq(index),anchor=tab.find(".ui-tabs-anchor"),panel=this._getPanelForTab(tab),eventData={tab:tab,panel:panel};if(this._isLocal(anchor[0])){return;}
this.xhr=$.ajax(this._ajaxSettings(anchor,event,eventData));if(this.xhr&&this.xhr.statusText!=="canceled"){tab.addClass("ui-tabs-loading");panel.attr("aria-busy","true");this.xhr.success(function(response){setTimeout(function(){panel.html(response);that._trigger("load",event,eventData);},1);}).complete(function(jqXHR,status){setTimeout(function(){if(status==="abort"){that.panels.stop(false,true);}
tab.removeClass("ui-tabs-loading");panel.removeAttr("aria-busy");if(jqXHR===that.xhr){delete that.xhr;}},1);});}},_ajaxSettings:function(anchor,event,eventData){var that=this;return{url:anchor.attr("href"),beforeSend:function(jqXHR,settings){return that._trigger("beforeLoad",event,$.extend({jqXHR:jqXHR,ajaxSettings:settings},eventData));}};},_getPanelForTab:function(tab){var id=$(tab).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+id));}});/*!
	 * jQuery UI Effects 1.11.1
	 * http://jqueryui.com
	 *
	 * Copyright 2014 jQuery Foundation and other contributors
	 * Released under the MIT license.
	 * http://jquery.org/license
	 *
	 * http://api.jqueryui.com/category/effects-core/
	 */
var dataSpace="ui-effects-",jQuery=$;$.effects={effect:{}};/*!
	 * jQuery Color Animations v2.1.2
	 * https://github.com/jquery/jquery-color
	 *
	 * Copyright 2014 jQuery Foundation and other contributors
	 * Released under the MIT license.
	 * http://jquery.org/license
	 *
	 * Date: Wed Jan 16 08:47:09 2013 -0600
	 */
(function(jQuery,undefined){var stepHooks="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",rplusequals=/^([\-+])=\s*(\d+\.?\d*)/,stringParsers=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[execResult[1],execResult[2],execResult[3],execResult[4]];}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[execResult[1]*2.55,execResult[2]*2.55,execResult[3]*2.55,execResult[4]];}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(execResult){return[parseInt(execResult[1],16),parseInt(execResult[2],16),parseInt(execResult[3],16)];}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(execResult){return[parseInt(execResult[1]+execResult[1],16),parseInt(execResult[2]+execResult[2],16),parseInt(execResult[3]+execResult[3],16)];}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(execResult){return[execResult[1],execResult[2]/ 100,execResult[3]/ 100,execResult[4]];}}],color=jQuery.Color=function(color,green,blue,alpha){return new jQuery.Color.fn.parse(color,green,blue,alpha);},spaces={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},propTypes={"byte":{floor:true,max:255},"percent":{max:1},"degrees":{mod:360,floor:true}},support=color.support={},supportElem=jQuery("<p>")[0],colors,each=jQuery.each;supportElem.style.cssText="background-color:rgba(1,1,1,.5)";support.rgba=supportElem.style.backgroundColor.indexOf("rgba")>-1;each(spaces,function(spaceName,space){space.cache="_"+spaceName;space.props.alpha={idx:3,type:"percent",def:1};});function clamp(value,prop,allowEmpty){var type=propTypes[prop.type]||{};if(value==null){return(allowEmpty||!prop.def)?null:prop.def;}
value=type.floor?~~value:parseFloat(value);if(isNaN(value)){return prop.def;}
if(type.mod){return(value+type.mod)%type.mod;}
return 0>value?0:type.max<value?type.max:value;}
function stringParse(string){var inst=color(),rgba=inst._rgba=[];string=string.toLowerCase();each(stringParsers,function(i,parser){var parsed,match=parser.re.exec(string),values=match&&parser.parse(match),spaceName=parser.space||"rgba";if(values){parsed=inst[spaceName](values);inst[spaces[spaceName].cache]=parsed[spaces[spaceName].cache];rgba=inst._rgba=parsed._rgba;return false;}});if(rgba.length){if(rgba.join()==="0,0,0,0"){jQuery.extend(rgba,colors.transparent);}
return inst;}
return colors[string];}
color.fn=jQuery.extend(color.prototype,{parse:function(red,green,blue,alpha){if(red===undefined){this._rgba=[null,null,null,null];return this;}
if(red.jquery||red.nodeType){red=jQuery(red).css(green);green=undefined;}
var inst=this,type=jQuery.type(red),rgba=this._rgba=[];if(green!==undefined){red=[red,green,blue,alpha];type="array";}
if(type==="string"){return this.parse(stringParse(red)||colors._default);}
if(type==="array"){each(spaces.rgba.props,function(key,prop){rgba[prop.idx]=clamp(red[prop.idx],prop);});return this;}
if(type==="object"){if(red instanceof color){each(spaces,function(spaceName,space){if(red[space.cache]){inst[space.cache]=red[space.cache].slice();}});}else{each(spaces,function(spaceName,space){var cache=space.cache;each(space.props,function(key,prop){if(!inst[cache]&&space.to){if(key==="alpha"||red[key]==null){return;}
inst[cache]=space.to(inst._rgba);}
inst[cache][prop.idx]=clamp(red[key],prop,true);});if(inst[cache]&&jQuery.inArray(null,inst[cache].slice(0,3))<0){inst[cache][3]=1;if(space.from){inst._rgba=space.from(inst[cache]);}}});}
return this;}},is:function(compare){var is=color(compare),same=true,inst=this;each(spaces,function(_,space){var localCache,isCache=is[space.cache];if(isCache){localCache=inst[space.cache]||space.to&&space.to(inst._rgba)||[];each(space.props,function(_,prop){if(isCache[prop.idx]!=null){same=(isCache[prop.idx]===localCache[prop.idx]);return same;}});}
return same;});return same;},_space:function(){var used=[],inst=this;each(spaces,function(spaceName,space){if(inst[space.cache]){used.push(spaceName);}});return used.pop();},transition:function(other,distance){var end=color(other),spaceName=end._space(),space=spaces[spaceName],startColor=this.alpha()===0?color("transparent"):this,start=startColor[space.cache]||space.to(startColor._rgba),result=start.slice();end=end[space.cache];each(space.props,function(key,prop){var index=prop.idx,startValue=start[index],endValue=end[index],type=propTypes[prop.type]||{};if(endValue===null){return;}
if(startValue===null){result[index]=endValue;}else{if(type.mod){if(endValue-startValue>type.mod / 2){startValue+=type.mod;}else if(startValue-endValue>type.mod / 2){startValue-=type.mod;}}
result[index]=clamp((endValue-startValue)*distance+startValue,prop);}});return this[spaceName](result);},blend:function(opaque){if(this._rgba[3]===1){return this;}
var rgb=this._rgba.slice(),a=rgb.pop(),blend=color(opaque)._rgba;return color(jQuery.map(rgb,function(v,i){return(1-a)*blend[i]+a*v;}));},toRgbaString:function(){var prefix="rgba(",rgba=jQuery.map(this._rgba,function(v,i){return v==null?(i>2?1:0):v;});if(rgba[3]===1){rgba.pop();prefix="rgb(";}
return prefix+rgba.join()+")";},toHslaString:function(){var prefix="hsla(",hsla=jQuery.map(this.hsla(),function(v,i){if(v==null){v=i>2?1:0;}
if(i&&i<3){v=Math.round(v*100)+"%";}
return v;});if(hsla[3]===1){hsla.pop();prefix="hsl(";}
return prefix+hsla.join()+")";},toHexString:function(includeAlpha){var rgba=this._rgba.slice(),alpha=rgba.pop();if(includeAlpha){rgba.push(~~(alpha*255));}
return"#"+jQuery.map(rgba,function(v){v=(v||0).toString(16);return v.length===1?"0"+v:v;}).join("");},toString:function(){return this._rgba[3]===0?"transparent":this.toRgbaString();}});color.fn.parse.prototype=color.fn;function hue2rgb(p,q,h){h=(h+1)%1;if(h*6<1){return p+(q-p)*h*6;}
if(h*2<1){return q;}
if(h*3<2){return p+(q-p)*((2 / 3)-h)*6;}
return p;}
spaces.hsla.to=function(rgba){if(rgba[0]==null||rgba[1]==null||rgba[2]==null){return[null,null,null,rgba[3]];}
var r=rgba[0]/ 255,g=rgba[1]/ 255,b=rgba[2]/ 255,a=rgba[3],max=Math.max(r,g,b),min=Math.min(r,g,b),diff=max-min,add=max+min,l=add*0.5,h,s;if(min===max){h=0;}else if(r===max){h=(60*(g-b)/ diff)+360;}else if(g===max){h=(60*(b-r)/ diff)+120;}else{h=(60*(r-g)/ diff)+240;}
if(diff===0){s=0;}else if(l<=0.5){s=diff / add;}else{s=diff /(2-add);}
return[Math.round(h)%360,s,l,a==null?1:a];};spaces.hsla.from=function(hsla){if(hsla[0]==null||hsla[1]==null||hsla[2]==null){return[null,null,null,hsla[3]];}
var h=hsla[0]/ 360,s=hsla[1],l=hsla[2],a=hsla[3],q=l<=0.5?l*(1+s):l+s-l*s,p=2*l-q;return[Math.round(hue2rgb(p,q,h+(1 / 3))*255),Math.round(hue2rgb(p,q,h)*255),Math.round(hue2rgb(p,q,h-(1 / 3))*255),a];};each(spaces,function(spaceName,space){var props=space.props,cache=space.cache,to=space.to,from=space.from;color.fn[spaceName]=function(value){if(to&&!this[cache]){this[cache]=to(this._rgba);}
if(value===undefined){return this[cache].slice();}
var ret,type=jQuery.type(value),arr=(type==="array"||type==="object")?value:arguments,local=this[cache].slice();each(props,function(key,prop){var val=arr[type==="object"?key:prop.idx];if(val==null){val=local[prop.idx];}
local[prop.idx]=clamp(val,prop);});if(from){ret=color(from(local));ret[cache]=local;return ret;}else{return color(local);}};each(props,function(key,prop){if(color.fn[key]){return;}
color.fn[key]=function(value){var vtype=jQuery.type(value),fn=(key==="alpha"?(this._hsla?"hsla":"rgba"):spaceName),local=this[fn](),cur=local[prop.idx],match;if(vtype==="undefined"){return cur;}
if(vtype==="function"){value=value.call(this,cur);vtype=jQuery.type(value);}
if(value==null&&prop.empty){return this;}
if(vtype==="string"){match=rplusequals.exec(value);if(match){value=cur+parseFloat(match[2])*(match[1]==="+"?1:-1);}}
local[prop.idx]=value;return this[fn](local);};});});color.hook=function(hook){var hooks=hook.split(" ");each(hooks,function(i,hook){jQuery.cssHooks[hook]={set:function(elem,value){var parsed,curElem,backgroundColor="";if(value!=="transparent"&&(jQuery.type(value)!=="string"||(parsed=stringParse(value)))){value=color(parsed||value);if(!support.rgba&&value._rgba[3]!==1){curElem=hook==="backgroundColor"?elem.parentNode:elem;while((backgroundColor===""||backgroundColor==="transparent")&&curElem&&curElem.style){try{backgroundColor=jQuery.css(curElem,"backgroundColor");curElem=curElem.parentNode;}catch(e){}}
value=value.blend(backgroundColor&&backgroundColor!=="transparent"?backgroundColor:"_default");}
value=value.toRgbaString();}
try{elem.style[hook]=value;}catch(e){}}};jQuery.fx.step[hook]=function(fx){if(!fx.colorInit){fx.start=color(fx.elem,hook);fx.end=color(fx.end);fx.colorInit=true;}
jQuery.cssHooks[hook].set(fx.elem,fx.start.transition(fx.end,fx.pos));};});};color.hook(stepHooks);jQuery.cssHooks.borderColor={expand:function(value){var expanded={};each(["Top","Right","Bottom","Left"],function(i,part){expanded["border"+part+"Color"]=value;});return expanded;}};colors=jQuery.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"};})(jQuery);(function(){var classAnimationActions=["add","remove","toggle"],shorthandStyles={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};$.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(_,prop){$.fx.step[prop]=function(fx){if(fx.end!=="none"&&!fx.setAttr||fx.pos===1&&!fx.setAttr){jQuery.style(fx.elem,prop,fx.end);fx.setAttr=true;}};});function getElementStyles(elem){var key,len,style=elem.ownerDocument.defaultView?elem.ownerDocument.defaultView.getComputedStyle(elem,null):elem.currentStyle,styles={};if(style&&style.length&&style[0]&&style[style[0]]){len=style.length;while(len--){key=style[len];if(typeof style[key]==="string"){styles[$.camelCase(key)]=style[key];}}}else{for(key in style){if(typeof style[key]==="string"){styles[key]=style[key];}}}
return styles;}
function styleDifference(oldStyle,newStyle){var diff={},name,value;for(name in newStyle){value=newStyle[name];if(oldStyle[name]!==value){if(!shorthandStyles[name]){if($.fx.step[name]||!isNaN(parseFloat(value))){diff[name]=value;}}}}
return diff;}
if(!$.fn.addBack){$.fn.addBack=function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector));};}
$.effects.animateClass=function(value,duration,easing,callback){var o=$.speed(duration,easing,callback);return this.queue(function(){var animated=$(this),baseClass=animated.attr("class")||"",applyClassChange,allAnimations=o.children?animated.find("*").addBack():animated;allAnimations=allAnimations.map(function(){var el=$(this);return{el:el,start:getElementStyles(this)};});applyClassChange=function(){$.each(classAnimationActions,function(i,action){if(value[action]){animated[action+"Class"](value[action]);}});};applyClassChange();allAnimations=allAnimations.map(function(){this.end=getElementStyles(this.el[0]);this.diff=styleDifference(this.start,this.end);return this;});animated.attr("class",baseClass);allAnimations=allAnimations.map(function(){var styleInfo=this,dfd=$.Deferred(),opts=$.extend({},o,{queue:false,complete:function(){dfd.resolve(styleInfo);}});this.el.animate(this.diff,opts);return dfd.promise();});$.when.apply($,allAnimations.get()).done(function(){applyClassChange();$.each(arguments,function(){var el=this.el;$.each(this.diff,function(key){el.css(key,"");});});o.complete.call(animated[0]);});});};$.fn.extend({addClass:(function(orig){return function(classNames,speed,easing,callback){return speed?$.effects.animateClass.call(this,{add:classNames},speed,easing,callback):orig.apply(this,arguments);};})($.fn.addClass),removeClass:(function(orig){return function(classNames,speed,easing,callback){return arguments.length>1?$.effects.animateClass.call(this,{remove:classNames},speed,easing,callback):orig.apply(this,arguments);};})($.fn.removeClass),toggleClass:(function(orig){return function(classNames,force,speed,easing,callback){if(typeof force==="boolean"||force===undefined){if(!speed){return orig.apply(this,arguments);}else{return $.effects.animateClass.call(this,(force?{add:classNames}:{remove:classNames}),speed,easing,callback);}}else{return $.effects.animateClass.call(this,{toggle:classNames},force,speed,easing);}};})($.fn.toggleClass),switchClass:function(remove,add,speed,easing,callback){return $.effects.animateClass.call(this,{add:add,remove:remove},speed,easing,callback);}});})();(function(){$.extend($.effects,{version:"1.11.1",save:function(element,set){for(var i=0;i<set.length;i++){if(set[i]!==null){element.data(dataSpace+set[i],element[0].style[set[i]]);}}},restore:function(element,set){var val,i;for(i=0;i<set.length;i++){if(set[i]!==null){val=element.data(dataSpace+set[i]);if(val===undefined){val="";}
element.css(set[i],val);}}},setMode:function(el,mode){if(mode==="toggle"){mode=el.is(":hidden")?"show":"hide";}
return mode;},getBaseline:function(origin,original){var y,x;switch(origin[0]){case"top":y=0;break;case"middle":y=0.5;break;case"bottom":y=1;break;default:y=origin[0]/ original.height;}
switch(origin[1]){case"left":x=0;break;case"center":x=0.5;break;case"right":x=1;break;default:x=origin[1]/ original.width;}
return{x:x,y:y};},createWrapper:function(element){if(element.parent().is(".ui-effects-wrapper")){return element.parent();}
var props={width:element.outerWidth(true),height:element.outerHeight(true),"float":element.css("float")},wrapper=$("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),size={width:element.width(),height:element.height()},active=document.activeElement;try{active.id;}catch(e){active=document.body;}
element.wrap(wrapper);if(element[0]===active||$.contains(element[0],active)){$(active).focus();}
wrapper=element.parent();if(element.css("position")==="static"){wrapper.css({position:"relative"});element.css({position:"relative"});}else{$.extend(props,{position:element.css("position"),zIndex:element.css("z-index")});$.each(["top","left","bottom","right"],function(i,pos){props[pos]=element.css(pos);if(isNaN(parseInt(props[pos],10))){props[pos]="auto";}});element.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"});}
element.css(size);return wrapper.css(props).show();},removeWrapper:function(element){var active=document.activeElement;if(element.parent().is(".ui-effects-wrapper")){element.parent().replaceWith(element);if(element[0]===active||$.contains(element[0],active)){$(active).focus();}}
return element;},setTransition:function(element,list,factor,value){value=value||{};$.each(list,function(i,x){var unit=element.cssUnit(x);if(unit[0]>0){value[x]=unit[0]*factor+unit[1];}});return value;}});function _normalizeArguments(effect,options,speed,callback){if($.isPlainObject(effect)){options=effect;effect=effect.effect;}
effect={effect:effect};if(options==null){options={};}
if($.isFunction(options)){callback=options;speed=null;options={};}
if(typeof options==="number"||$.fx.speeds[options]){callback=speed;speed=options;options={};}
if($.isFunction(speed)){callback=speed;speed=null;}
if(options){$.extend(effect,options);}
speed=speed||options.duration;effect.duration=$.fx.off?0:typeof speed==="number"?speed:speed in $.fx.speeds?$.fx.speeds[speed]:$.fx.speeds._default;effect.complete=callback||options.complete;return effect;}
function standardAnimationOption(option){if(!option||typeof option==="number"||$.fx.speeds[option]){return true;}
if(typeof option==="string"&&!$.effects.effect[option]){return true;}
if($.isFunction(option)){return true;}
if(typeof option==="object"&&!option.effect){return true;}
return false;}
$.fn.extend({effect:function(){var args=_normalizeArguments.apply(this,arguments),mode=args.mode,queue=args.queue,effectMethod=$.effects.effect[args.effect];if($.fx.off||!effectMethod){if(mode){return this[mode](args.duration,args.complete);}else{return this.each(function(){if(args.complete){args.complete.call(this);}});}}
function run(next){var elem=$(this),complete=args.complete,mode=args.mode;function done(){if($.isFunction(complete)){complete.call(elem[0]);}
if($.isFunction(next)){next();}}
if(elem.is(":hidden")?mode==="hide":mode==="show"){elem[mode]();done();}else{effectMethod.call(elem[0],args,done);}}
return queue===false?this.each(run):this.queue(queue||"fx",run);},show:(function(orig){return function(option){if(standardAnimationOption(option)){return orig.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args.mode="show";return this.effect.call(this,args);}};})($.fn.show),hide:(function(orig){return function(option){if(standardAnimationOption(option)){return orig.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args.mode="hide";return this.effect.call(this,args);}};})($.fn.hide),toggle:(function(orig){return function(option){if(standardAnimationOption(option)||typeof option==="boolean"){return orig.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args.mode="toggle";return this.effect.call(this,args);}};})($.fn.toggle),cssUnit:function(key){var style=this.css(key),val=[];$.each(["em","px","%","pt"],function(i,unit){if(style.indexOf(unit)>0){val=[parseFloat(style),unit];}});return val;}});})();(function(){var baseEasings={};$.each(["Quad","Cubic","Quart","Quint","Expo"],function(i,name){baseEasings[name]=function(p){return Math.pow(p,i+2);};});$.extend(baseEasings,{Sine:function(p){return 1-Math.cos(p*Math.PI / 2);},Circ:function(p){return 1-Math.sqrt(1-p*p);},Elastic:function(p){return p===0||p===1?p:-Math.pow(2,8*(p-1))*Math.sin(((p-1)*80-7.5)*Math.PI / 15);},Back:function(p){return p*p*(3*p-2);},Bounce:function(p){var pow2,bounce=4;while(p<((pow2=Math.pow(2,--bounce))-1)/ 11){}
return 1 / Math.pow(4,3-bounce)-7.5625*Math.pow((pow2*3-2)/ 22-p,2);}});$.each(baseEasings,function(name,easeIn){$.easing["easeIn"+name]=easeIn;$.easing["easeOut"+name]=function(p){return 1-easeIn(1-p);};$.easing["easeInOut"+name]=function(p){return p<0.5?easeIn(p*2)/ 2:1-easeIn(p*-2+2)/ 2;};});})();var effect=$.effects;}));;(function($,window,document){var pluginName="tooltipster",defaults={animation:'fade',arrow:true,arrowColor:'',autoClose:true,content:null,contentAsHTML:false,contentCloning:true,debug:true,delay:200,minWidth:0,maxWidth:null,functionInit:function(origin,content){},functionBefore:function(origin,continueTooltip){continueTooltip();},functionReady:function(origin,tooltip){},functionAfter:function(origin){},icon:'(?)',iconCloning:true,iconDesktop:false,iconTouch:false,iconTheme:'tooltipster-icon',interactive:false,interactiveTolerance:350,multiple:false,offsetX:0,offsetY:0,onlyOne:false,position:'top',positionTracker:false,speed:350,timer:0,theme:'tooltipster-default',touchDevices:true,trigger:'hover',updateAnimation:true};function Plugin(element,options){this.bodyOverflowX;this.callbacks={hide:[],show:[]};this.checkInterval=null;this.Content;this.$el=$(element);this.$elProxy;this.elProxyPosition;this.enabled=true;this.options=$.extend({},defaults,options);this.mouseIsOverProxy=false;this.namespace='tooltipster-'+Math.round(Math.random()*100000);this.Status='hidden';this.timerHide=null;this.timerShow=null;this.$tooltip;this.options.iconTheme=this.options.iconTheme.replace('.','');this.options.theme=this.options.theme.replace('.','');this._init();}
Plugin.prototype={_init:function(){var self=this;if(document.querySelector){if(self.options.content!==null){self._content_set(self.options.content);}
else{var t=self.$el.attr('title');if(typeof t==='undefined')t=null;self._content_set(t);}
var c=self.options.functionInit.call(self.$el,self.$el,self.Content);if(typeof c!=='undefined')self._content_set(c);self.$el.removeAttr('title').addClass('tooltipstered');if((!deviceHasTouchCapability&&self.options.iconDesktop)||(deviceHasTouchCapability&&self.options.iconTouch)){if(typeof self.options.icon==='string'){self.$elProxy=$('<span class="'+self.options.iconTheme+'"></span>');self.$elProxy.text(self.options.icon);}
else{if(self.options.iconCloning)self.$elProxy=self.options.icon.clone(true);else self.$elProxy=self.options.icon;}
self.$elProxy.insertAfter(self.$el);}
else{self.$elProxy=self.$el;}
if(self.options.trigger=='hover'){self.$elProxy.on('mouseenter.'+self.namespace,function(){if(!deviceIsPureTouch()||self.options.touchDevices){self.mouseIsOverProxy=true;self._show();}}).on('mouseleave.'+self.namespace,function(){if(!deviceIsPureTouch()||self.options.touchDevices){self.mouseIsOverProxy=false;}});if(deviceHasTouchCapability&&self.options.touchDevices){self.$elProxy.on('touchstart.'+self.namespace,function(){self._showNow();});}}
else if(self.options.trigger=='click'){self.$elProxy.on('click.'+self.namespace,function(){if(!deviceIsPureTouch()||self.options.touchDevices){self._show();}});}}},_show:function(){var self=this;if(self.Status!='shown'&&self.Status!='appearing'){if(self.options.delay){self.timerShow=setTimeout(function(){if(self.options.trigger=='click'||(self.options.trigger=='hover'&&self.mouseIsOverProxy)){self._showNow();}},self.options.delay);}
else self._showNow();}},_showNow:function(callback){var self=this;self.options.functionBefore.call(self.$el,self.$el,function(){if(self.enabled&&self.Content!==null){if(callback)self.callbacks.show.push(callback);self.callbacks.hide=[];clearTimeout(self.timerShow);self.timerShow=null;clearTimeout(self.timerHide);self.timerHide=null;if(self.options.onlyOne){$('.tooltipstered').not(self.$el).each(function(i,el){var $el=$(el),nss=$el.data('tooltipster-ns');$.each(nss,function(i,ns){var instance=$el.data(ns),s=instance.status(),ac=instance.option('autoClose');if(s!=='hidden'&&s!=='disappearing'&&ac){instance.hide();}});});}
var finish=function(){self.Status='shown';$.each(self.callbacks.show,function(i,c){c.call(self.$el);});self.callbacks.show=[];};if(self.Status!=='hidden'){var extraTime=0;if(self.Status==='disappearing'){self.Status='appearing';if(supportsTransitions()){self.$tooltip.clearQueue().removeClass('tooltipster-dying').addClass('tooltipster-'+self.options.animation+'-show');if(self.options.speed>0)self.$tooltip.delay(self.options.speed);self.$tooltip.queue(finish);}
else{self.$tooltip.stop().fadeIn(finish);}}
else if(self.Status==='shown'){finish();}}
else{self.Status='appearing';var extraTime=self.options.speed;self.bodyOverflowX=$('body').css('overflow-x');$('body').css('overflow-x','hidden');var animation='tooltipster-'+self.options.animation,animationSpeed='-webkit-transition-duration: '+self.options.speed+'ms; -webkit-animation-duration: '+self.options.speed+'ms; -moz-transition-duration: '+self.options.speed+'ms; -moz-animation-duration: '+self.options.speed+'ms; -o-transition-duration: '+self.options.speed+'ms; -o-animation-duration: '+self.options.speed+'ms; -ms-transition-duration: '+self.options.speed+'ms; -ms-animation-duration: '+self.options.speed+'ms; transition-duration: '+self.options.speed+'ms; animation-duration: '+self.options.speed+'ms;',minWidth=self.options.minWidth?'min-width:'+Math.round(self.options.minWidth)+'px;':'',maxWidth=self.options.maxWidth?'max-width:'+Math.round(self.options.maxWidth)+'px;':'',pointerEvents=self.options.interactive?'pointer-events: auto;':'';self.$tooltip=$('<div class="tooltipster-base '+self.options.theme+'" style="'+minWidth+' '+maxWidth+' '+pointerEvents+' '+animationSpeed+'"><div class="tooltipster-content"></div></div>');if(supportsTransitions())self.$tooltip.addClass(animation);self._content_insert();self.$tooltip.appendTo('body');self.reposition();self.options.functionReady.call(self.$el,self.$el,self.$tooltip);if(supportsTransitions()){self.$tooltip.addClass(animation+'-show');if(self.options.speed>0)self.$tooltip.delay(self.options.speed);self.$tooltip.queue(finish);}
else{self.$tooltip.css('display','none').fadeIn(self.options.speed,finish);}
self._interval_set();$(window).on('scroll.'+self.namespace+' resize.'+self.namespace,function(){self.reposition();});if(self.options.autoClose){$('body').off('.'+self.namespace);if(self.options.trigger=='hover'){if(deviceHasTouchCapability){setTimeout(function(){$('body').on('touchstart.'+self.namespace,function(){self.hide();});},0);}
if(self.options.interactive){if(deviceHasTouchCapability){self.$tooltip.on('touchstart.'+self.namespace,function(event){event.stopPropagation();});}
var tolerance=null;self.$elProxy.add(self.$tooltip).on('mouseleave.'+self.namespace+'-autoClose',function(){clearTimeout(tolerance);tolerance=setTimeout(function(){self.hide();},self.options.interactiveTolerance);}).on('mouseenter.'+self.namespace+'-autoClose',function(){clearTimeout(tolerance);});}
else{self.$elProxy.on('mouseleave.'+self.namespace+'-autoClose',function(){self.hide();});}}
else if(self.options.trigger=='click'){setTimeout(function(){$('body').on('click.'+self.namespace+' touchstart.'+self.namespace,function(){self.hide();});},0);if(self.options.interactive){self.$tooltip.on('click.'+self.namespace+' touchstart.'+self.namespace,function(event){event.stopPropagation();});}}}}
if(self.options.timer>0){self.timerHide=setTimeout(function(){self.timerHide=null;self.hide();},self.options.timer+extraTime);}}});},_interval_set:function(){var self=this;self.checkInterval=setInterval(function(){if($('body').find(self.$el).length===0||$('body').find(self.$elProxy).length===0||self.Status=='hidden'||$('body').find(self.$tooltip).length===0){if(self.Status=='shown'||self.Status=='appearing')self.hide();self._interval_cancel();}
else{if(self.options.positionTracker){var p=self._repositionInfo(self.$elProxy),identical=false;if(areEqual(p.dimension,self.elProxyPosition.dimension)){if(self.$elProxy.css('position')==='fixed'){if(areEqual(p.position,self.elProxyPosition.position))identical=true;}
else{if(areEqual(p.offset,self.elProxyPosition.offset))identical=true;}}
if(!identical){self.reposition();}}}},200);},_interval_cancel:function(){clearInterval(this.checkInterval);this.checkInterval=null;},_content_set:function(content){if(typeof content==='object'&&content!==null&&this.options.contentCloning){content=content.clone(true);}
this.Content=content;},_content_insert:function(){var self=this,$d=this.$tooltip.find('.tooltipster-content');if(typeof self.Content==='string'&&!self.options.contentAsHTML){$d.text(self.Content);}
else{$d.empty().append(self.Content);}},_update:function(content){var self=this;self._content_set(content);if(self.Content!==null){if(self.Status!=='hidden'){self._content_insert();self.reposition();if(self.options.updateAnimation){if(supportsTransitions()){self.$tooltip.css({'width':'','-webkit-transition':'all '+self.options.speed+'ms, width 0ms, height 0ms, left 0ms, top 0ms','-moz-transition':'all '+self.options.speed+'ms, width 0ms, height 0ms, left 0ms, top 0ms','-o-transition':'all '+self.options.speed+'ms, width 0ms, height 0ms, left 0ms, top 0ms','-ms-transition':'all '+self.options.speed+'ms, width 0ms, height 0ms, left 0ms, top 0ms','transition':'all '+self.options.speed+'ms, width 0ms, height 0ms, left 0ms, top 0ms'}).addClass('tooltipster-content-changing');setTimeout(function(){if(self.Status!='hidden'){self.$tooltip.removeClass('tooltipster-content-changing');setTimeout(function(){if(self.Status!=='hidden'){self.$tooltip.css({'-webkit-transition':self.options.speed+'ms','-moz-transition':self.options.speed+'ms','-o-transition':self.options.speed+'ms','-ms-transition':self.options.speed+'ms','transition':self.options.speed+'ms'});}},self.options.speed);}},self.options.speed);}
else{self.$tooltip.fadeTo(self.options.speed,0.5,function(){if(self.Status!='hidden'){self.$tooltip.fadeTo(self.options.speed,1);}});}}}}
else{self.hide();}},_repositionInfo:function($el){return{dimension:{height:$el.outerHeight(false),width:$el.outerWidth(false)},offset:$el.offset(),position:{left:parseInt($el.css('left')),top:parseInt($el.css('top'))}};},hide:function(callback){var self=this;if(callback)self.callbacks.hide.push(callback);self.callbacks.show=[];clearTimeout(self.timerShow);self.timerShow=null;clearTimeout(self.timerHide);self.timerHide=null;var finishCallbacks=function(){$.each(self.callbacks.hide,function(i,c){c.call(self.$el);});self.callbacks.hide=[];};if(self.Status=='shown'||self.Status=='appearing'){self.Status='disappearing';var finish=function(){self.Status='hidden';if(typeof self.Content=='object'&&self.Content!==null){self.Content.detach();}
self.$tooltip.remove();self.$tooltip=null;$(window).off('.'+self.namespace);$('body').off('.'+self.namespace).css('overflow-x',self.bodyOverflowX);$('body').off('.'+self.namespace);self.$elProxy.off('.'+self.namespace+'-autoClose');self.options.functionAfter.call(self.$el,self.$el);finishCallbacks();};if(supportsTransitions()){self.$tooltip.clearQueue().removeClass('tooltipster-'+self.options.animation+'-show').addClass('tooltipster-dying');if(self.options.speed>0)self.$tooltip.delay(self.options.speed);self.$tooltip.queue(finish);}
else{self.$tooltip.stop().fadeOut(self.options.speed,finish);}}
else if(self.Status=='hidden'){finishCallbacks();}
return self;},show:function(callback){this._showNow(callback);return this;},update:function(c){return this.content(c);},content:function(c){if(typeof c==='undefined'){return this.Content;}
else{this._update(c);return this;}},reposition:function(){var self=this;if($('body').find(self.$tooltip).length!==0){self.$tooltip.css('width','');self.elProxyPosition=self._repositionInfo(self.$elProxy);var arrowReposition=null,windowWidth=$(window).width(),proxy=self.elProxyPosition,tooltipWidth=self.$tooltip.outerWidth(false),tooltipInnerWidth=self.$tooltip.innerWidth()+1,tooltipHeight=self.$tooltip.outerHeight(false);if(self.$elProxy.is('area')){var areaShape=self.$elProxy.attr('shape'),mapName=self.$elProxy.parent().attr('name'),map=$('img[usemap="#'+mapName+'"]'),mapOffsetLeft=map.offset().left,mapOffsetTop=map.offset().top,areaMeasurements=self.$elProxy.attr('coords')!==undefined?self.$elProxy.attr('coords').split(','):undefined;if(areaShape=='circle'){var areaLeft=parseInt(areaMeasurements[0]),areaTop=parseInt(areaMeasurements[1]),areaWidth=parseInt(areaMeasurements[2]);proxy.dimension.height=areaWidth*2;proxy.dimension.width=areaWidth*2;proxy.offset.top=mapOffsetTop+areaTop-areaWidth;proxy.offset.left=mapOffsetLeft+areaLeft-areaWidth;}
else if(areaShape=='rect'){var areaLeft=parseInt(areaMeasurements[0]),areaTop=parseInt(areaMeasurements[1]),areaRight=parseInt(areaMeasurements[2]),areaBottom=parseInt(areaMeasurements[3]);proxy.dimension.height=areaBottom-areaTop;proxy.dimension.width=areaRight-areaLeft;proxy.offset.top=mapOffsetTop+areaTop;proxy.offset.left=mapOffsetLeft+areaLeft;}
else if(areaShape=='poly'){var areaXs=[],areaYs=[],areaSmallestX=0,areaSmallestY=0,areaGreatestX=0,areaGreatestY=0,arrayAlternate='even';for(var i=0;i<areaMeasurements.length;i++){var areaNumber=parseInt(areaMeasurements[i]);if(arrayAlternate=='even'){if(areaNumber>areaGreatestX){areaGreatestX=areaNumber;if(i===0){areaSmallestX=areaGreatestX;}}
if(areaNumber<areaSmallestX){areaSmallestX=areaNumber;}
arrayAlternate='odd';}
else{if(areaNumber>areaGreatestY){areaGreatestY=areaNumber;if(i==1){areaSmallestY=areaGreatestY;}}
if(areaNumber<areaSmallestY){areaSmallestY=areaNumber;}
arrayAlternate='even';}}
proxy.dimension.height=areaGreatestY-areaSmallestY;proxy.dimension.width=areaGreatestX-areaSmallestX;proxy.offset.top=mapOffsetTop+areaSmallestY;proxy.offset.left=mapOffsetLeft+areaSmallestX;}
else{proxy.dimension.height=map.outerHeight(false);proxy.dimension.width=map.outerWidth(false);proxy.offset.top=mapOffsetTop;proxy.offset.left=mapOffsetLeft;}}
var myLeft=0,myLeftMirror=0,myTop=0,offsetY=parseInt(self.options.offsetY),offsetX=parseInt(self.options.offsetX),practicalPosition=self.options.position;function dontGoOffScreenX(){var windowLeft=$(window).scrollLeft();if((myLeft-windowLeft)<0){arrowReposition=myLeft-windowLeft;myLeft=windowLeft;}
if(((myLeft+tooltipWidth)-windowLeft)>windowWidth){arrowReposition=myLeft-((windowWidth+windowLeft)-tooltipWidth);myLeft=(windowWidth+windowLeft)-tooltipWidth;}}
function dontGoOffScreenY(switchTo,switchFrom){if(((proxy.offset.top-$(window).scrollTop()-tooltipHeight-offsetY-12)<0)&&(switchFrom.indexOf('top')>-1)){practicalPosition=switchTo;}
if(((proxy.offset.top+proxy.dimension.height+tooltipHeight+12+offsetY)>($(window).scrollTop()+$(window).height()))&&(switchFrom.indexOf('bottom')>-1)){practicalPosition=switchTo;myTop=(proxy.offset.top-tooltipHeight)-offsetY-12;}}
if(practicalPosition=='top'){var leftDifference=(proxy.offset.left+tooltipWidth)-(proxy.offset.left+proxy.dimension.width);myLeft=(proxy.offset.left+offsetX)-(leftDifference / 2);myTop=(proxy.offset.top-tooltipHeight)-offsetY-12;dontGoOffScreenX();dontGoOffScreenY('bottom','top');}
if(practicalPosition=='top-left'){myLeft=proxy.offset.left+offsetX;myTop=(proxy.offset.top-tooltipHeight)-offsetY-12;dontGoOffScreenX();dontGoOffScreenY('bottom-left','top-left');}
if(practicalPosition=='top-right'){myLeft=(proxy.offset.left+proxy.dimension.width+offsetX)-tooltipWidth;myTop=(proxy.offset.top-tooltipHeight)-offsetY-12;dontGoOffScreenX();dontGoOffScreenY('bottom-right','top-right');}
if(practicalPosition=='bottom'){var leftDifference=(proxy.offset.left+tooltipWidth)-(proxy.offset.left+proxy.dimension.width);myLeft=proxy.offset.left-(leftDifference / 2)+offsetX;myTop=(proxy.offset.top+proxy.dimension.height)+offsetY+12;dontGoOffScreenX();dontGoOffScreenY('top','bottom');}
if(practicalPosition=='bottom-left'){myLeft=proxy.offset.left+offsetX;myTop=(proxy.offset.top+proxy.dimension.height)+offsetY+12;dontGoOffScreenX();dontGoOffScreenY('top-left','bottom-left');}
if(practicalPosition=='bottom-right'){myLeft=(proxy.offset.left+proxy.dimension.width+offsetX)-tooltipWidth;myTop=(proxy.offset.top+proxy.dimension.height)+offsetY+12;dontGoOffScreenX();dontGoOffScreenY('top-right','bottom-right');}
if(practicalPosition=='left'){myLeft=proxy.offset.left-offsetX-tooltipWidth-12;myLeftMirror=proxy.offset.left+offsetX+proxy.dimension.width+12;var topDifference=(proxy.offset.top+tooltipHeight)-(proxy.offset.top+proxy.dimension.height);myTop=proxy.offset.top-(topDifference / 2)-offsetY;if((myLeft<0)&&((myLeftMirror+tooltipWidth)>windowWidth)){var borderWidth=parseFloat(self.$tooltip.css('border-width'))*2,newWidth=(tooltipWidth+myLeft)-borderWidth;self.$tooltip.css('width',newWidth+'px');tooltipHeight=self.$tooltip.outerHeight(false);myLeft=proxy.offset.left-offsetX-newWidth-12-borderWidth;topDifference=(proxy.offset.top+tooltipHeight)-(proxy.offset.top+proxy.dimension.height);myTop=proxy.offset.top-(topDifference / 2)-offsetY;}
else if(myLeft<0){myLeft=proxy.offset.left+offsetX+proxy.dimension.width+12;arrowReposition='left';}}
if(practicalPosition=='right'){myLeft=proxy.offset.left+offsetX+proxy.dimension.width+12;myLeftMirror=proxy.offset.left-offsetX-tooltipWidth-12;var topDifference=(proxy.offset.top+tooltipHeight)-(proxy.offset.top+proxy.dimension.height);myTop=proxy.offset.top-(topDifference / 2)-offsetY;if(((myLeft+tooltipWidth)>windowWidth)&&(myLeftMirror<0)){var borderWidth=parseFloat(self.$tooltip.css('border-width'))*2,newWidth=(windowWidth-myLeft)-borderWidth;self.$tooltip.css('width',newWidth+'px');tooltipHeight=self.$tooltip.outerHeight(false);topDifference=(proxy.offset.top+tooltipHeight)-(proxy.offset.top+proxy.dimension.height);myTop=proxy.offset.top-(topDifference / 2)-offsetY;}
else if((myLeft+tooltipWidth)>windowWidth){myLeft=proxy.offset.left-offsetX-tooltipWidth-12;arrowReposition='right';}}
if(self.options.arrow){var arrowClass='tooltipster-arrow-'+practicalPosition;if(self.options.arrowColor.length<1){var arrowColor=self.$tooltip.css('background-color');}
else{var arrowColor=self.options.arrowColor;}
if(!arrowReposition){arrowReposition='';}
else if(arrowReposition=='left'){arrowClass='tooltipster-arrow-right';arrowReposition='';}
else if(arrowReposition=='right'){arrowClass='tooltipster-arrow-left';arrowReposition='';}
else{arrowReposition='left:'+Math.round(arrowReposition)+'px;';}
if((practicalPosition=='top')||(practicalPosition=='top-left')||(practicalPosition=='top-right')){var tooltipBorderWidth=parseFloat(self.$tooltip.css('border-bottom-width')),tooltipBorderColor=self.$tooltip.css('border-bottom-color');}
else if((practicalPosition=='bottom')||(practicalPosition=='bottom-left')||(practicalPosition=='bottom-right')){var tooltipBorderWidth=parseFloat(self.$tooltip.css('border-top-width')),tooltipBorderColor=self.$tooltip.css('border-top-color');}
else if(practicalPosition=='left'){var tooltipBorderWidth=parseFloat(self.$tooltip.css('border-right-width')),tooltipBorderColor=self.$tooltip.css('border-right-color');}
else if(practicalPosition=='right'){var tooltipBorderWidth=parseFloat(self.$tooltip.css('border-left-width')),tooltipBorderColor=self.$tooltip.css('border-left-color');}
else{var tooltipBorderWidth=parseFloat(self.$tooltip.css('border-bottom-width')),tooltipBorderColor=self.$tooltip.css('border-bottom-color');}
if(tooltipBorderWidth>1){tooltipBorderWidth++;}
var arrowBorder='';if(tooltipBorderWidth!==0){var arrowBorderSize='',arrowBorderColor='border-color: '+tooltipBorderColor+';';if(arrowClass.indexOf('bottom')!==-1){arrowBorderSize='margin-top: -'+Math.round(tooltipBorderWidth)+'px;';}
else if(arrowClass.indexOf('top')!==-1){arrowBorderSize='margin-bottom: -'+Math.round(tooltipBorderWidth)+'px;';}
else if(arrowClass.indexOf('left')!==-1){arrowBorderSize='margin-right: -'+Math.round(tooltipBorderWidth)+'px;';}
else if(arrowClass.indexOf('right')!==-1){arrowBorderSize='margin-left: -'+Math.round(tooltipBorderWidth)+'px;';}
arrowBorder='<span class="tooltipster-arrow-border" style="'+arrowBorderSize+' '+arrowBorderColor+';"></span>';}
self.$tooltip.find('.tooltipster-arrow').remove();var arrowConstruct='<div class="'+arrowClass+' tooltipster-arrow" style="'+arrowReposition+'">'+arrowBorder+'<span style="border-color:'+arrowColor+';"></span></div>';self.$tooltip.append(arrowConstruct);}
self.$tooltip.css({'top':Math.round(myTop)+'px','left':Math.round(myLeft)+'px'});}
return self;},enable:function(){this.enabled=true;return this;},disable:function(){this.hide();this.enabled=false;return this;},destroy:function(){var self=this;self.hide();if(self.$el[0]!==self.$elProxy[0])self.$elProxy.remove();self.$el.removeData(self.namespace).off('.'+self.namespace);var ns=self.$el.data('tooltipster-ns');if(ns.length===1){var stringifiedContent=(typeof self.Content==='string')?self.Content:$('<div></div>').append(self.Content).html();self.$el.removeClass('tooltipstered').attr('title',stringifiedContent).removeData(self.namespace).removeData('tooltipster-ns').off('.'+self.namespace);}
else{ns=$.grep(ns,function(el,i){return el!==self.namespace;});self.$el.data('tooltipster-ns',ns);}
return self;},elementIcon:function(){return(this.$el[0]!==this.$elProxy[0])?this.$elProxy[0]:undefined;},elementTooltip:function(){return this.$tooltip?this.$tooltip[0]:undefined;},option:function(o,val){if(typeof val=='undefined')return this.options[o];else{this.options[o]=val;return this;}},status:function(){return this.Status;}};$.fn[pluginName]=function(){var args=arguments;if(this.length===0){if(typeof args[0]==='string'){var methodIsStatic=true;switch(args[0]){case'setDefaults':$.extend(defaults,args[1]);break;default:methodIsStatic=false;break;}
if(methodIsStatic)return true;else return this;}
else{return this;}}
else{if(typeof args[0]==='string'){var v='#*$~&';this.each(function(){var ns=$(this).data('tooltipster-ns'),self=ns?$(this).data(ns[0]):null;if(self){if(typeof self[args[0]]==='function'){var resp=self[args[0]](args[1],args[2]);}
else{throw new Error('Unknown method .tooltipster("'+args[0]+'")');}
if(resp!==self){v=resp;return false;}}
else{throw new Error('You called Tooltipster\'s "'+args[0]+'" method on an uninitialized element');}});return(v!=='#*$~&')?v:this;}
else{var instances=[],multipleIsSet=args[0]&&typeof args[0].multiple!=='undefined',multiple=(multipleIsSet&&args[0].multiple)||(!multipleIsSet&&defaults.multiple),debugIsSet=args[0]&&typeof args[0].debug!=='undefined',debug=(debugIsSet&&args[0].debug)||(!debugIsSet&&defaults.debug);this.each(function(){var go=false,ns=$(this).data('tooltipster-ns'),instance=null;if(!ns){go=true;}
else if(multiple){go=true;}
else if(debug){console.log('Tooltipster: one or more tooltips are already attached to this element: ignoring. Use the "multiple" option to attach more tooltips.');}
if(go){instance=new Plugin(this,args[0]);if(!ns)ns=[];ns.push(instance.namespace);$(this).data('tooltipster-ns',ns);$(this).data(instance.namespace,instance);}
instances.push(instance);});if(multiple)return instances;else return this;}}};function areEqual(a,b){var same=true;$.each(a,function(i,el){if(typeof b[i]==='undefined'||a[i]!==b[i]){same=false;return false;}});return same;}
var deviceHasTouchCapability=!!('ontouchstart'in window);var deviceHasMouse=false;$('body').one('mousemove',function(){deviceHasMouse=true;});function deviceIsPureTouch(){return(!deviceHasMouse&&deviceHasTouchCapability);}
function supportsTransitions(){var b=document.body||document.documentElement,s=b.style,p='transition';if(typeof s[p]=='string'){return true;}
v=['Moz','Webkit','Khtml','O','ms'],p=p.charAt(0).toUpperCase()+p.substr(1);for(var i=0;i<v.length;i++){if(typeof s[v[i]+p]=='string'){return true;}}
return false;}})(jQuery,window,document);
/*!
 * jQuery Cookie Plugin v1.4.0
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function(factory){if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else if(typeof exports==='object'){factory(require('jquery'));}else{factory(jQuery);}}(function($){var pluses=/\+/g;function encode(s){return config.raw?s:encodeURIComponent(s);}
function decode(s){return config.raw?s:decodeURIComponent(s);}
function stringifyCookieValue(value){return encode(config.json?JSON.stringify(value):String(value));}
function parseCookieValue(s){if(s.indexOf('"')===0){s=s.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,'\\');}
try{s=decodeURIComponent(s.replace(pluses,' '));return config.json?JSON.parse(s):s;}catch(e){}}
function read(s,converter){var value=config.raw?s:parseCookieValue(s);return $.isFunction(converter)?converter(value):value;}
var config=$.cookie=function(key,value,options){if(value!==undefined&&!$.isFunction(value)){options=$.extend({},config.defaults,options);if(typeof options.expires==='number'){var days=options.expires,t=options.expires=new Date();t.setTime(+t+days*864e+5);}
return(document.cookie=[encode(key),'=',stringifyCookieValue(value),options.expires?'; expires='+options.expires.toUTCString():'',options.path?'; path='+options.path:'',options.domain?'; domain='+options.domain:'',options.secure?'; secure':''].join(''));}
var result=key?undefined:{};var cookies=document.cookie?document.cookie.split('; '):[];for(var i=0,l=cookies.length;i<l;i++){var parts=cookies[i].split('=');var name=decode(parts.shift());var cookie=parts.join('=');if(key&&key===name){result=read(cookie,value);break;}
if(!key&&(cookie=read(cookie))!==undefined){result[name]=cookie;}}
return result;};config.defaults={};$.removeCookie=function(key,options){if($.cookie(key)===undefined){return false;}
$.cookie(key,'',$.extend({},options,{expires:-1}));return!$.cookie(key);};}));
/*!
 * Smooth Scroll - v1.4.13 - 2013-11-02
 * https://github.com/kswedberg/jquery-smooth-scroll
 * Copyright (c) 2013 Karl Swedberg
 * Licensed MIT (https://github.com/kswedberg/jquery-smooth-scroll/blob/master/LICENSE-MIT)
 */
(function($){var version='1.4.13',optionOverrides={},defaults={exclude:[],excludeWithin:[],offset:0,direction:'top',scrollElement:null,scrollTarget:null,beforeScroll:function(){},afterScroll:function(){},easing:'swing',speed:400,autoCoefficent:2,preventDefault:true},getScrollable=function(opts){var scrollable=[],scrolled=false,dir=opts.dir&&opts.dir=='left'?'scrollLeft':'scrollTop';this.each(function(){if(this==document||this==window){return;}
var el=$(this);if(el[dir]()>0){scrollable.push(this);}else{el[dir](1);scrolled=el[dir]()>0;if(scrolled){scrollable.push(this);}
el[dir](0);}});if(!scrollable.length){this.each(function(index){if(this.nodeName==='BODY'){scrollable=[this];}});}
if(opts.el==='first'&&scrollable.length>1){scrollable=[scrollable[0]];}
return scrollable;},isTouch='ontouchend'in document;$.fn.extend({scrollable:function(dir){var scrl=getScrollable.call(this,{dir:dir});return this.pushStack(scrl);},firstScrollable:function(dir){var scrl=getScrollable.call(this,{el:'first',dir:dir});return this.pushStack(scrl);},smoothScroll:function(options,extra){options=options||{};if(options==='options'){if(!extra){return this.first().data('ssOpts');}
return this.each(function(){var $this=$(this),opts=$.extend($this.data('ssOpts')||{},extra);$(this).data('ssOpts',opts);});}
var opts=$.extend({},$.fn.smoothScroll.defaults,options),locationPath=$.smoothScroll.filterPath(location.pathname);this.unbind('click.smoothscroll').bind('click.smoothscroll',function(event){var link=this,$link=$(this),thisOpts=$.extend({},opts,$link.data('ssOpts')||{}),exclude=opts.exclude,excludeWithin=thisOpts.excludeWithin,elCounter=0,ewlCounter=0,include=true,clickOpts={},hostMatch=((location.hostname===link.hostname)||!link.hostname),pathMatch=thisOpts.scrollTarget||($.smoothScroll.filterPath(link.pathname)||locationPath)===locationPath,thisHash=escapeSelector(link.hash);if(!thisOpts.scrollTarget&&(!hostMatch||!pathMatch||!thisHash)){include=false;}else{while(include&&elCounter<exclude.length){if($link.is(escapeSelector(exclude[elCounter++]))){include=false;}}
while(include&&ewlCounter<excludeWithin.length){if($link.closest(excludeWithin[ewlCounter++]).length){include=false;}}}
if(include){if(thisOpts.preventDefault){event.preventDefault();}
$.extend(clickOpts,thisOpts,{scrollTarget:thisOpts.scrollTarget||thisHash,link:link});$.smoothScroll(clickOpts);}});return this;}});$.smoothScroll=function(options,px){if(options==='options'&&typeof px==='object'){return $.extend(optionOverrides,px);}
var opts,$scroller,scrollTargetOffset,speed,scrollerOffset=0,offPos='offset',scrollDir='scrollTop',aniProps={},aniOpts={},scrollprops=[];if(typeof options==='number'){opts=$.extend({link:null},$.fn.smoothScroll.defaults,optionOverrides);scrollTargetOffset=options;}else{opts=$.extend({link:null},$.fn.smoothScroll.defaults,options||{},optionOverrides);if(opts.scrollElement){offPos='position';if(opts.scrollElement.css('position')=='static'){opts.scrollElement.css('position','relative');}}}
scrollDir=opts.direction=='left'?'scrollLeft':scrollDir;if(opts.scrollElement){$scroller=opts.scrollElement;if(!(/^(?:HTML|BODY)$/).test($scroller[0].nodeName)){scrollerOffset=$scroller[scrollDir]();}}else{$scroller=$('html, body').firstScrollable(opts.direction);}
opts.beforeScroll.call($scroller,opts);scrollTargetOffset=(typeof options==='number')?options:px||($(opts.scrollTarget)[offPos]()&&$(opts.scrollTarget)[offPos]()[opts.direction])||0;aniProps[scrollDir]=scrollTargetOffset+scrollerOffset+opts.offset;speed=opts.speed;if(speed==='auto'){speed=aniProps[scrollDir]||$scroller.scrollTop();speed=speed / opts.autoCoefficent;}
aniOpts={duration:speed,easing:opts.easing,complete:function(){opts.afterScroll.call(opts.link,opts);}};if(opts.step){aniOpts.step=opts.step;}
if($scroller.length){$scroller.stop().animate(aniProps,aniOpts);}else{opts.afterScroll.call(opts.link,opts);}};$.smoothScroll.version=version;$.smoothScroll.filterPath=function(string){return string.replace(/^\//,'').replace(/(?:index|default).[a-zA-Z]{3,4}$/,'').replace(/\/$/,'');};$.fn.smoothScroll.defaults=defaults;function escapeSelector(str){return str.replace(/(:|\.)/g,'\\$1');}})(jQuery);(function(){var root=this;var previousUnderscore=root._;var breaker={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var
push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var
nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj;};if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){exports=module.exports=_;}
exports._=_;}else{root._=_;}
_.VERSION='1.5.2';var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return;if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context);}else if(obj.length===+obj.length){for(var i=0,length=obj.length;i<length;i++){if(iterator.call(context,obj[i],i,obj)===breaker)return;}}else{var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){if(iterator.call(context,obj[keys[i]],keys[i],obj)===breaker)return;}}};_.map=_.collect=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);each(obj,function(value,index,list){results.push(iterator.call(context,value,index,list));});return results;};var reduceError='Reduce of empty array with no initial value';_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduce&&obj.reduce===nativeReduce){if(context)iterator=_.bind(iterator,context);return initial?obj.reduce(iterator,memo):obj.reduce(iterator);}
each(obj,function(value,index,list){if(!initial){memo=value;initial=true;}else{memo=iterator.call(context,memo,value,index,list);}});if(!initial)throw new TypeError(reduceError);return memo;};_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduceRight&&obj.reduceRight===nativeReduceRight){if(context)iterator=_.bind(iterator,context);return initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);}
var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length;}
each(obj,function(value,index,list){index=keys?keys[--length]:--length;if(!initial){memo=obj[index];initial=true;}else{memo=iterator.call(context,memo,obj[index],index,list);}});if(!initial)throw new TypeError(reduceError);return memo;};_.find=_.detect=function(obj,iterator,context){var result;any(obj,function(value,index,list){if(iterator.call(context,value,index,list)){result=value;return true;}});return result;};_.filter=_.select=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeFilter&&obj.filter===nativeFilter)return obj.filter(iterator,context);each(obj,function(value,index,list){if(iterator.call(context,value,index,list))results.push(value);});return results;};_.reject=function(obj,iterator,context){return _.filter(obj,function(value,index,list){return!iterator.call(context,value,index,list);},context);};_.every=_.all=function(obj,iterator,context){iterator||(iterator=_.identity);var result=true;if(obj==null)return result;if(nativeEvery&&obj.every===nativeEvery)return obj.every(iterator,context);each(obj,function(value,index,list){if(!(result=result&&iterator.call(context,value,index,list)))return breaker;});return!!result;};var any=_.some=_.any=function(obj,iterator,context){iterator||(iterator=_.identity);var result=false;if(obj==null)return result;if(nativeSome&&obj.some===nativeSome)return obj.some(iterator,context);each(obj,function(value,index,list){if(result||(result=iterator.call(context,value,index,list)))return breaker;});return!!result;};_.contains=_.include=function(obj,target){if(obj==null)return false;if(nativeIndexOf&&obj.indexOf===nativeIndexOf)return obj.indexOf(target)!=-1;return any(obj,function(value){return value===target;});};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args);});};_.pluck=function(obj,key){return _.map(obj,function(value){return value[key];});};_.where=function(obj,attrs,first){if(_.isEmpty(attrs))return first?void 0:[];return _[first?'find':'filter'](obj,function(value){for(var key in attrs){if(attrs[key]!==value[key])return false;}
return true;});};_.findWhere=function(obj,attrs){return _.where(obj,attrs,true);};_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.max.apply(Math,obj);}
if(!iterator&&_.isEmpty(obj))return-Infinity;var result={computed:-Infinity,value:-Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>result.computed&&(result={value:value,computed:computed});});return result.value;};_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.min.apply(Math,obj);}
if(!iterator&&_.isEmpty(obj))return Infinity;var result={computed:Infinity,value:Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed});});return result.value;};_.shuffle=function(obj){var rand;var index=0;var shuffled=[];each(obj,function(value){rand=_.random(index++);shuffled[index-1]=shuffled[rand];shuffled[rand]=value;});return shuffled;};_.sample=function(obj,n,guard){if(arguments.length<2||guard){return obj[_.random(obj.length-1)];}
return _.shuffle(obj).slice(0,Math.max(0,n));};var lookupIterator=function(value){return _.isFunction(value)?value:function(obj){return obj[value];};};_.sortBy=function(obj,value,context){var iterator=lookupIterator(value);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)};}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1;}
return left.index-right.index;}),'value');};var group=function(behavior){return function(obj,value,context){var result={};var iterator=value==null?_.identity:lookupIterator(value);each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value);});return result;};};_.groupBy=group(function(result,key,value){(_.has(result,key)?result[key]:(result[key]=[])).push(value);});_.indexBy=group(function(result,key,value){result[key]=value;});_.countBy=group(function(result,key){_.has(result,key)?result[key]++:result[key]=1;});_.sortedIndex=function(array,obj,iterator,context){iterator=iterator==null?_.identity:lookupIterator(iterator);var value=iterator.call(context,obj);var low=0,high=array.length;while(low<high){var mid=(low+high)>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid;}
return low;};_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(obj.length===+obj.length)return _.map(obj,_.identity);return _.values(obj);};_.size=function(obj){if(obj==null)return 0;return(obj.length===+obj.length)?obj.length:_.keys(obj).length;};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;return(n==null)||guard?array[0]:slice.call(array,0,n);};_.initial=function(array,n,guard){return slice.call(array,0,array.length-((n==null)||guard?1:n));};_.last=function(array,n,guard){if(array==null)return void 0;if((n==null)||guard){return array[array.length-1];}else{return slice.call(array,Math.max(array.length-n,0));}};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,(n==null)||guard?1:n);};_.compact=function(array){return _.filter(array,_.identity);};var flatten=function(input,shallow,output){if(shallow&&_.every(input,_.isArray)){return concat.apply(output,input);}
each(input,function(value){if(_.isArray(value)||_.isArguments(value)){shallow?push.apply(output,value):flatten(value,shallow,output);}else{output.push(value);}});return output;};_.flatten=function(array,shallow){return flatten(array,shallow,[]);};_.without=function(array){return _.difference(array,slice.call(arguments,1));};_.uniq=_.unique=function(array,isSorted,iterator,context){if(_.isFunction(isSorted)){context=iterator;iterator=isSorted;isSorted=false;}
var initial=iterator?_.map(array,iterator,context):array;var results=[];var seen=[];each(initial,function(value,index){if(isSorted?(!index||seen[seen.length-1]!==value):!_.contains(seen,value)){seen.push(value);results.push(array[index]);}});return results;};_.union=function(){return _.uniq(_.flatten(arguments,true));};_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0;});});};_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value);});};_.zip=function(){var length=_.max(_.pluck(arguments,"length").concat(0));var results=new Array(length);for(var i=0;i<length;i++){results[i]=_.pluck(arguments,''+i);}
return results;};_.object=function(list,values){if(list==null)return{};var result={};for(var i=0,length=list.length;i<length;i++){if(values){result[list[i]]=values[i];}else{result[list[i][0]]=list[i][1];}}
return result;};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i=0,length=array.length;if(isSorted){if(typeof isSorted=='number'){i=(isSorted<0?Math.max(0,length+isSorted):isSorted);}else{i=_.sortedIndex(array,item);return array[i]===item?i:-1;}}
if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;i<length;i++)if(array[i]===item)return i;return-1;};_.lastIndexOf=function(array,item,from){if(array==null)return-1;var hasIndex=from!=null;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf){return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item);}
var i=(hasIndex?from:array.length);while(i--)if(array[i]===item)return i;return-1;};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0;}
step=arguments[2]||1;var length=Math.max(Math.ceil((stop-start)/ step),0);var idx=0;var range=new Array(length);while(idx<length){range[idx++]=start;start+=step;}
return range;};var ctor=function(){};_.bind=function(func,context){var args,bound;if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;args=slice.call(arguments,2);return bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor;ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));if(Object(result)===result)return result;return self;};};_.partial=function(func){var args=slice.call(arguments,1);return function(){return func.apply(this,args.concat(slice.call(arguments)));};};_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length===0)throw new Error("bindAll must be passed function names");each(funcs,function(f){obj[f]=_.bind(obj[f],obj);});return obj;};_.memoize=function(func,hasher){var memo={};hasher||(hasher=_.identity);return function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:(memo[key]=func.apply(this,arguments));};};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args);},wait);};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)));};_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;options||(options={});var later=function(){previous=options.leading===false?0:new Date;timeout=null;result=func.apply(context,args);};return function(){var now=new Date;if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args);}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining);}
return result;};};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;return function(){context=this;args=arguments;timestamp=new Date();var later=function(){var last=(new Date())-timestamp;if(last<wait){timeout=setTimeout(later,wait-last);}else{timeout=null;if(!immediate)result=func.apply(context,args);}};var callNow=immediate&&!timeout;if(!timeout){timeout=setTimeout(later,wait);}
if(callNow)result=func.apply(context,args);return result;};};_.once=function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;memo=func.apply(this,arguments);func=null;return memo;};};_.wrap=function(func,wrapper){return function(){var args=[func];push.apply(args,arguments);return wrapper.apply(this,args);};};_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=funcs.length-1;i>=0;i--){args=[funcs[i].apply(this,args)];}
return args[0];};};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments);}};};_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError('Invalid object');var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);return keys;};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=new Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]];}
return values;};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=new Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]];}
return pairs;};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i];}
return result;};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key);}
return names.sort();};_.extend=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){obj[prop]=source[prop];}}});return obj;};_.pick=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));each(keys,function(key){if(key in obj)copy[key]=obj[key];});return copy;};_.omit=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj){if(!_.contains(keys,key))copy[key]=obj[key];}
return copy;};_.defaults=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){if(obj[prop]===void 0)obj[prop]=source[prop];}}});return obj;};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj);};_.tap=function(obj,interceptor){interceptor(obj);return obj;};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1 / a==1 / b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!=toString.call(b))return false;switch(className){case'[object String]':return a==String(b);case'[object Number]':return a!=+a?b!=+b:(a==0?1 / a==1 / b:a==+b);case'[object Date]':case'[object Boolean]':return+a==+b;case'[object RegExp]':return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase;}
if(typeof a!='object'||typeof b!='object')return false;var length=aStack.length;while(length--){if(aStack[length]==a)return bStack[length]==b;}
var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&(aCtor instanceof aCtor)&&_.isFunction(bCtor)&&(bCtor instanceof bCtor))){return false;}
aStack.push(a);bStack.push(b);var size=0,result=true;if(className=='[object Array]'){size=a.length;result=size==b.length;if(result){while(size--){if(!(result=eq(a[size],b[size],aStack,bStack)))break;}}}else{for(var key in a){if(_.has(a,key)){size++;if(!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))break;}}
if(result){for(key in b){if(_.has(b,key)&&!(size--))break;}
result=!size;}}
aStack.pop();bStack.pop();return result;};_.isEqual=function(a,b){return eq(a,b,[],[]);};_.isEmpty=function(obj){if(obj==null)return true;if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return false;return true;};_.isElement=function(obj){return!!(obj&&obj.nodeType===1);};_.isArray=nativeIsArray||function(obj){return toString.call(obj)=='[object Array]';};_.isObject=function(obj){return obj===Object(obj);};each(['Arguments','Function','String','Number','Date','RegExp'],function(name){_['is'+name]=function(obj){return toString.call(obj)=='[object '+name+']';};});if(!_.isArguments(arguments)){_.isArguments=function(obj){return!!(obj&&_.has(obj,'callee'));};}
if(typeof(/./)!=='function'){_.isFunction=function(obj){return typeof obj==='function';};}
_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj));};_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj;};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)=='[object Boolean]';};_.isNull=function(obj){return obj===null;};_.isUndefined=function(obj){return obj===void 0;};_.has=function(obj,key){return hasOwnProperty.call(obj,key);};_.noConflict=function(){root._=previousUnderscore;return this;};_.identity=function(value){return value;};_.times=function(n,iterator,context){var accum=Array(Math.max(0,n));for(var i=0;i<n;i++)accum[i]=iterator.call(context,i);return accum;};_.random=function(min,max){if(max==null){max=min;min=0;}
return min+Math.floor(Math.random()*(max-min+1));};var entityMap={escape:{'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#x27;'}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp('['+_.keys(entityMap.escape).join('')+']','g'),unescape:new RegExp('('+_.keys(entityMap.unescape).join('|')+')','g')};_.each(['escape','unescape'],function(method){_[method]=function(string){if(string==null)return'';return(''+string).replace(entityRegexes[method],function(match){return entityMap[method][match];});};});_.result=function(object,property){if(object==null)return void 0;var value=object[property];return _.isFunction(value)?value.call(object):value;};_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result.call(this,func.apply(_,args));};});};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+'';return prefix?prefix+id:id;};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'",'\\':'\\','\r':'r','\n':'n','\t':'t','\u2028':'u2028','\u2029':'u2029'};var escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){var render;settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join('|')+'|$','g');var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,function(match){return'\\'+escapes[match];});if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'";}
if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'";}
if(evaluate){source+="';\n"+evaluate+"\n__p+='";}
index=offset+match.length;return match;});source+="';\n";if(!settings.variable)source='with(obj||{}){\n'+source+'}\n';source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+
source+"return __p;\n";try{render=new Function(settings.variable||'obj','_',source);}catch(e){e.source=source;throw e;}
if(data)return render(data,_);var template=function(data){return render.call(this,data,_);};template.source='function('+(settings.variable||'obj')+'){\n'+source+'}';return template;};_.chain=function(obj){return _(obj).chain();};var result=function(obj){return this._chain?_(obj).chain():obj;};_.mixin(_);each(['pop','push','reverse','shift','sort','splice','unshift'],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name=='shift'||name=='splice')&&obj.length===0)delete obj[0];return result.call(this,obj);};});each(['concat','join','slice'],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments));};});_.extend(_.prototype,{chain:function(){this._chain=true;return this;},value:function(){return this._wrapped;}});}).call(this);(function(){var root=this;var previousBackbone=root.Backbone;var array=[];var push=array.push;var slice=array.slice;var splice=array.splice;var Backbone;if(typeof exports!=='undefined'){Backbone=exports;}else{Backbone=root.Backbone={};}
Backbone.VERSION='1.1.0';var _=root._;if(!_&&(typeof require!=='undefined'))_=require('underscore');Backbone.$=root.jQuery||root.Zepto||root.ender||root.$;Backbone.noConflict=function(){root.Backbone=previousBackbone;return this;};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,'on',name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);events.push({callback:callback,context:context,ctx:context||this});return this;},once:function(name,callback,context){if(!eventsApi(this,'once',name,[callback,context])||!callback)return this;var self=this;var once=_.once(function(){self.off(name,once);callback.apply(this,arguments);});once._callback=callback;return this.on(name,once,context);},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,'off',name,[callback,context]))return this;if(!name&&!callback&&!context){this._events={};return this;}
names=name?[name]:_.keys(this._events);for(i=0,l=names.length;i<l;i++){name=names[i];if(events=this._events[name]){this._events[name]=retain=[];if(callback||context){for(j=0,k=events.length;j<k;j++){ev=events[j];if((callback&&callback!==ev.callback&&callback!==ev.callback._callback)||(context&&context!==ev.context)){retain.push(ev);}}}
if(!retain.length)delete this._events[name];}}
return this;},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,'trigger',name,args))return this;var events=this._events[name];var allEvents=this._events.all;if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,arguments);return this;},stopListening:function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var remove=!name&&!callback;if(!callback&&typeof name==='object')callback=this;if(obj)(listeningTo={})[obj._listenId]=obj;for(var id in listeningTo){obj=listeningTo[id];obj.off(name,callback,this);if(remove||_.isEmpty(obj._events))delete this._listeningTo[id];}
return this;}};var eventSplitter=/\s+/;var eventsApi=function(obj,action,name,rest){if(!name)return true;if(typeof name==='object'){for(var key in name){obj[action].apply(obj,[key,name[key]].concat(rest));}
return false;}
if(eventSplitter.test(name)){var names=name.split(eventSplitter);for(var i=0,l=names.length;i<l;i++){obj[action].apply(obj,[names[i]].concat(rest));}
return false;}
return true;};var triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:while(++i<l)(ev=events[i]).callback.call(ev.ctx);return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args);}};var listenMethods={listenTo:'on',listenToOnce:'once'};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeningTo=this._listeningTo||(this._listeningTo={});var id=obj._listenId||(obj._listenId=_.uniqueId('l'));listeningTo[id]=obj;if(!callback&&typeof name==='object')callback=this;obj[implementation](name,callback,this);return this;};});Events.bind=Events.on;Events.unbind=Events.off;_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={});this.cid=_.uniqueId('c');this.attributes={};if(options.collection)this.collection=options.collection;if(options.parse)attrs=this.parse(attrs,options)||{};attrs=_.defaults({},attrs,_.result(this,'defaults'));this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments);};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:'id',initialize:function(){},toJSON:function(options){return _.clone(this.attributes);},sync:function(){return Backbone.sync.apply(this,arguments);},get:function(attr){return this.attributes[attr];},escape:function(attr){return _.escape(this.get(attr));},has:function(attr){return this.get(attr)!=null;},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(key==null)return this;if(typeof key==='object'){attrs=key;options=val;}else{(attrs={})[key]=val;}
options||(options={});if(!this._validate(attrs,options))return false;unset=options.unset;silent=options.silent;changes=[];changing=this._changing;this._changing=true;if(!changing){this._previousAttributes=_.clone(this.attributes);this.changed={};}
current=this.attributes,prev=this._previousAttributes;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];for(attr in attrs){val=attrs[attr];if(!_.isEqual(current[attr],val))changes.push(attr);if(!_.isEqual(prev[attr],val)){this.changed[attr]=val;}else{delete this.changed[attr];}
unset?delete current[attr]:current[attr]=val;}
if(!silent){if(changes.length)this._pending=true;for(var i=0,l=changes.length;i<l;i++){this.trigger('change:'+changes[i],this,current[changes[i]],options);}}
if(changing)return this;if(!silent){while(this._pending){this._pending=false;this.trigger('change',this,options);}}
this._pending=false;this._changing=false;return this;},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:true}));},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:true}));},hasChanged:function(attr){if(attr==null)return!_.isEmpty(this.changed);return _.has(this.changed,attr);},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false;var old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff){if(_.isEqual(old[attr],(val=diff[attr])))continue;(changed||(changed={}))[attr]=val;}
return changed;},previous:function(attr){if(attr==null||!this._previousAttributes)return null;return this._previousAttributes[attr];},previousAttributes:function(){return _.clone(this._previousAttributes);},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){if(!model.set(model.parse(resp,options),options))return false;if(success)success(model,resp,options);model.trigger('sync',model,resp,options);};wrapError(this,options);return this.sync('read',this,options);},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(key==null||typeof key==='object'){attrs=key;options=val;}else{(attrs={})[key]=val;}
options=_.extend({validate:true},options);if(attrs&&!options.wait){if(!this.set(attrs,options))return false;}else{if(!this._validate(attrs,options))return false;}
if(attrs&&options.wait){this.attributes=_.extend({},attributes,attrs);}
if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);if(options.wait)serverAttrs=_.extend(attrs||{},serverAttrs);if(_.isObject(serverAttrs)&&!model.set(serverAttrs,options)){return false;}
if(success)success(model,resp,options);model.trigger('sync',model,resp,options);};wrapError(this,options);method=this.isNew()?'create':(options.patch?'patch':'update');if(method==='patch')options.attrs=attrs;xhr=this.sync(method,this,options);if(attrs&&options.wait)this.attributes=attributes;return xhr;},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var destroy=function(){model.trigger('destroy',model,model.collection,options);};options.success=function(resp){if(options.wait||model.isNew())destroy();if(success)success(model,resp,options);if(!model.isNew())model.trigger('sync',model,resp,options);};if(this.isNew()){options.success();return false;}
wrapError(this,options);var xhr=this.sync('delete',this,options);if(!options.wait)destroy();return xhr;},url:function(){var base=_.result(this,'urlRoot')||_.result(this.collection,'url')||urlError();if(this.isNew())return base;return base+(base.charAt(base.length-1)==='/'?'':'/')+encodeURIComponent(this.id);},parse:function(resp,options){return resp;},clone:function(){return new this.constructor(this.attributes);},isNew:function(){return this.id==null;},isValid:function(options){return this._validate({},_.extend(options||{},{validate:true}));},_validate:function(attrs,options){if(!options.validate||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;if(!error)return true;this.trigger('invalid',this,error,_.extend(options,{validationError:error}));return false;}});var modelMethods=['keys','values','pairs','invert','pick','omit'];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.attributes);return _[method].apply(_,args);};});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator!==void 0)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,_.extend({silent:true},options));};var setOptions={add:true,remove:true,merge:true};var addOptions={add:true,remove:false};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options);});},sync:function(){return Backbone.sync.apply(this,arguments);},add:function(models,options){return this.set(models,_.extend({merge:false},options,addOptions));},remove:function(models,options){var singular=!_.isArray(models);models=singular?[models]:_.clone(models);options||(options={});var i,l,index,model;for(i=0,l=models.length;i<l;i++){model=models[i]=this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byId[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger('remove',model,this,options);}
this._removeReference(model);}
return singular?models[0]:models;},set:function(models,options){options=_.defaults({},options,setOptions);if(options.parse)models=this.parse(models,options);var singular=!_.isArray(models);models=singular?(models?[models]:[]):_.clone(models);var i,l,id,model,attrs,existing,sort;var at=options.at;var targetModel=this.model;var sortable=this.comparator&&(at==null)&&options.sort!==false;var sortAttr=_.isString(this.comparator)?this.comparator:null;var toAdd=[],toRemove=[],modelMap={};var add=options.add,merge=options.merge,remove=options.remove;var order=!sortable&&add&&remove?[]:false;for(i=0,l=models.length;i<l;i++){attrs=models[i];if(attrs instanceof Model){id=model=attrs;}else{id=attrs[targetModel.prototype.idAttribute];}
if(existing=this.get(id)){if(remove)modelMap[existing.cid]=true;if(merge){attrs=attrs===model?model.attributes:attrs;if(options.parse)attrs=existing.parse(attrs,options);existing.set(attrs,options);if(sortable&&!sort&&existing.hasChanged(sortAttr))sort=true;}
models[i]=existing;}else if(add){model=models[i]=this._prepareModel(attrs,options);if(!model)continue;toAdd.push(model);model.on('all',this._onModelEvent,this);this._byId[model.cid]=model;if(model.id!=null)this._byId[model.id]=model;}
if(order)order.push(existing||model);}
if(remove){for(i=0,l=this.length;i<l;++i){if(!modelMap[(model=this.models[i]).cid])toRemove.push(model);}
if(toRemove.length)this.remove(toRemove,options);}
if(toAdd.length||(order&&order.length)){if(sortable)sort=true;this.length+=toAdd.length;if(at!=null){for(i=0,l=toAdd.length;i<l;i++){this.models.splice(at+i,0,toAdd[i]);}}else{if(order)this.models.length=0;var orderedModels=order||toAdd;for(i=0,l=orderedModels.length;i<l;i++){this.models.push(orderedModels[i]);}}}
if(sort)this.sort({silent:true});if(!options.silent){for(i=0,l=toAdd.length;i<l;i++){(model=toAdd[i]).trigger('add',model,this,options);}
if(sort||(order&&order.length))this.trigger('sort',this,options);}
return singular?models[0]:models;},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i]);}
options.previousModels=this.models;this._reset();models=this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger('reset',this,options);return models;},push:function(model,options){return this.add(model,_.extend({at:this.length},options));},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model;},unshift:function(model,options){return this.add(model,_.extend({at:0},options));},shift:function(options){var model=this.at(0);this.remove(model,options);return model;},slice:function(){return slice.apply(this.models,arguments);},get:function(obj){if(obj==null)return void 0;return this._byId[obj.id]||this._byId[obj.cid]||this._byId[obj];},at:function(index){return this.models[index];},where:function(attrs,first){if(_.isEmpty(attrs))return first?void 0:[];return this[first?'find':'filter'](function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false;}
return true;});},findWhere:function(attrs){return this.where(attrs,true);},sort:function(options){if(!this.comparator)throw new Error('Cannot sort a set without a comparator');options||(options={});if(_.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this);}else{this.models.sort(_.bind(this.comparator,this));}
if(!options.silent)this.trigger('sort',this,options);return this;},pluck:function(attr){return _.invoke(this.models,'get',attr);},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var success=options.success;var collection=this;options.success=function(resp){var method=options.reset?'reset':'set';collection[method](resp,options);if(success)success(collection,resp,options);collection.trigger('sync',collection,resp,options);};wrapError(this,options);return this.sync('read',this,options);},create:function(model,options){options=options?_.clone(options):{};if(!(model=this._prepareModel(model,options)))return false;if(!options.wait)this.add(model,options);var collection=this;var success=options.success;options.success=function(model,resp,options){if(options.wait)collection.add(model,options);if(success)success(model,resp,options);};model.save(null,options);return model;},parse:function(resp,options){return resp;},clone:function(){return new this.constructor(this.models);},_reset:function(){this.length=0;this.models=[];this._byId={};},_prepareModel:function(attrs,options){if(attrs instanceof Model){if(!attrs.collection)attrs.collection=this;return attrs;}
options=options?_.clone(options):{};options.collection=this;var model=new this.model(attrs,options);if(!model.validationError)return model;this.trigger('invalid',this,model.validationError,options);return false;},_removeReference:function(model){if(this===model.collection)delete model.collection;model.off('all',this._onModelEvent,this);},_onModelEvent:function(event,model,collection,options){if((event==='add'||event==='remove')&&collection!==this)return;if(event==='destroy')this.remove(model,options);if(model&&event==='change:'+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];if(model.id!=null)this._byId[model.id]=model;}
this.trigger.apply(this,arguments);}});var methods=['forEach','each','map','collect','reduce','foldl','inject','reduceRight','foldr','find','detect','filter','select','reject','every','all','some','any','include','contains','invoke','max','min','toArray','size','first','head','take','initial','rest','tail','drop','last','without','difference','indexOf','shuffle','lastIndexOf','isEmpty','chain'];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.models);return _[method].apply(_,args);};});var attributeMethods=['groupBy','countBy','sortBy'];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value);};return _[method](this.models,iterator,context);};});var View=Backbone.View=function(options){this.cid=_.uniqueId('view');options||(options={});_.extend(this,_.pick(options,viewOptions));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents();};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=['model','collection','el','id','attributes','className','tagName','events'];_.extend(View.prototype,Events,{tagName:'div',$:function(selector){return this.$el.find(selector);},initialize:function(){},render:function(){return this;},remove:function(){this.$el.remove();this.stopListening();return this;},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=element instanceof Backbone.$?element:Backbone.$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this;},delegateEvents:function(events){if(!(events||(events=_.result(this,'events'))))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)continue;var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+='.delegateEvents'+this.cid;if(selector===''){this.$el.on(eventName,method);}else{this.$el.on(eventName,selector,method);}}
return this;},undelegateEvents:function(){this.$el.off('.delegateEvents'+this.cid);return this;},_ensureElement:function(){if(!this.el){var attrs=_.extend({},_.result(this,'attributes'));if(this.id)attrs.id=_.result(this,'id');if(this.className)attrs['class']=_.result(this,'className');var $el=Backbone.$('<'+_.result(this,'tagName')+'>').attr(attrs);this.setElement($el,false);}else{this.setElement(_.result(this,'el'),false);}}});Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:'json'};if(!options.url){params.url=_.result(model,'url')||urlError();}
if(options.data==null&&model&&(method==='create'||method==='update'||method==='patch')){params.contentType='application/json';params.data=JSON.stringify(options.attrs||model.toJSON(options));}
if(options.emulateJSON){params.contentType='application/x-www-form-urlencoded';params.data=params.data?{model:params.data}:{};}
if(options.emulateHTTP&&(type==='PUT'||type==='DELETE'||type==='PATCH')){params.type='POST';if(options.emulateJSON)params.data._method=type;var beforeSend=options.beforeSend;options.beforeSend=function(xhr){xhr.setRequestHeader('X-HTTP-Method-Override',type);if(beforeSend)return beforeSend.apply(this,arguments);};}
if(params.type!=='GET'&&!options.emulateJSON){params.processData=false;}
if(params.type==='PATCH'&&noXhrPatch){params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP");};}
var xhr=options.xhr=Backbone.ajax(_.extend(params,options));model.trigger('request',model,xhr,options);return xhr;};var noXhrPatch=typeof window!=='undefined'&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);var methodMap={'create':'POST','update':'PUT','patch':'PATCH','delete':'DELETE','read':'GET'};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments);};var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments);};var optionalParam=/\((.*?)\)/g;var namedParam=/(\(\?)?:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){if(!_.isRegExp(route))route=this._routeToRegExp(route);if(_.isFunction(name)){callback=name;name='';}
if(!callback)callback=this[name];var router=this;Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);callback&&callback.apply(router,args);router.trigger.apply(router,['route:'+name].concat(args));router.trigger('route',name,args);Backbone.history.trigger('route',router,name,args);});return this;},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);return this;},_bindRoutes:function(){if(!this.routes)return;this.routes=_.result(this,'routes');var route,routes=_.keys(this.routes);while((route=routes.pop())!=null){this.route(route,this.routes[route]);}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,'\\$&').replace(optionalParam,'(?:$1)?').replace(namedParam,function(match,optional){return optional?match:'([^\/]+)';}).replace(splatParam,'(.*?)');return new RegExp('^'+route+'$');},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param){return param?decodeURIComponent(param):null;});}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,'checkUrl');if(typeof window!=='undefined'){this.location=window.location;this.history=window.history;}};var routeStripper=/^[#\/]|\s+$/g;var rootStripper=/^\/+|\/+$/g;var isExplorer=/msie [\w.]+/;var trailingSlash=/\/$/;var pathStripper=/[?#].*$/;History.started=false;_.extend(History.prototype,Events,{interval:50,getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:'';},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=this.location.pathname;var root=this.root.replace(trailingSlash,'');if(!fragment.indexOf(root))fragment=fragment.slice(root.length);}else{fragment=this.getHash();}}
return fragment.replace(routeStripper,'');},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({root:'/'},this.options,options);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=(isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7));this.root=('/'+this.root+'/').replace(rootStripper,'/');if(oldIE&&this._wantsHashChange){this.iframe=Backbone.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo('body')[0].contentWindow;this.navigate(fragment);}
if(this._hasPushState){Backbone.$(window).on('popstate',this.checkUrl);}else if(this._wantsHashChange&&('onhashchange'in window)&&!oldIE){Backbone.$(window).on('hashchange',this.checkUrl);}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval);}
this.fragment=fragment;var loc=this.location;var atRoot=loc.pathname.replace(/[^\/]$/,'$&/')===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!atRoot){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+'#'+this.fragment);return true;}else if(this._hasPushState&&atRoot&&loc.hash){this.fragment=this.getHash().replace(routeStripper,'');this.history.replaceState({},document.title,this.root+this.fragment+loc.search);}}
if(!this.options.silent)return this.loadUrl();},stop:function(){Backbone.$(window).off('popstate',this.checkUrl).off('hashchange',this.checkUrl);clearInterval(this._checkUrlInterval);History.started=false;},route:function(route,callback){this.handlers.unshift({route:route,callback:callback});},checkUrl:function(e){var current=this.getFragment();if(current===this.fragment&&this.iframe){current=this.getFragment(this.getHash(this.iframe));}
if(current===this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl();},loadUrl:function(fragment){fragment=this.fragment=this.getFragment(fragment);return _.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true;}});},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:!!options};var url=this.root+(fragment=this.getFragment(fragment||''));fragment=fragment.replace(pathStripper,'');if(this.fragment===fragment)return;this.fragment=fragment;if(fragment===''&&url!=='/')url=url.slice(0,-1);if(this._hasPushState){this.history[options.replace?'replaceState':'pushState']({},document.title,url);}else if(this._wantsHashChange){this._updateHash(this.location,fragment,options.replace);if(this.iframe&&(fragment!==this.getFragment(this.getHash(this.iframe)))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,fragment,options.replace);}}else{return this.location.assign(url);}
if(options.trigger)return this.loadUrl(fragment);},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,'');location.replace(href+'#'+fragment);}else{location.hash='#'+fragment;}}});Backbone.history=new History;var extend=function(protoProps,staticProps){var parent=this;var child;if(protoProps&&_.has(protoProps,'constructor')){child=protoProps.constructor;}else{child=function(){return parent.apply(this,arguments);};}
_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child;};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate;if(protoProps)_.extend(child.prototype,protoProps);child.__super__=parent.prototype;return child;};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified');};var wrapError=function(model,options){var error=options.error;options.error=function(resp){if(error)error(model,resp,options);model.trigger('error',model,resp,options);};};}).call(this);
/*!
 * Includes BabySitter
 * https://github.com/marionettejs/backbone.babysitter/
 *
 * Includes Wreqr
 * https://github.com/marionettejs/backbone.wreqr/
 */
Backbone.ChildViewContainer=(function(Backbone,_){var Container=function(views){this._views={};this._indexByModel={};this._indexByCustom={};this._updateLength();_.each(views,this.add,this);};_.extend(Container.prototype,{add:function(view,customIndex){var viewCid=view.cid;this._views[viewCid]=view;if(view.model){this._indexByModel[view.model.cid]=viewCid;}
if(customIndex){this._indexByCustom[customIndex]=viewCid;}
this._updateLength();},findByModel:function(model){return this.findByModelCid(model.cid);},findByModelCid:function(modelCid){var viewCid=this._indexByModel[modelCid];return this.findByCid(viewCid);},findByCustom:function(index){var viewCid=this._indexByCustom[index];return this.findByCid(viewCid);},findByIndex:function(index){return _.values(this._views)[index];},findByCid:function(cid){return this._views[cid];},remove:function(view){var viewCid=view.cid;if(view.model){delete this._indexByModel[view.model.cid];}
_.any(this._indexByCustom,function(cid,key){if(cid===viewCid){delete this._indexByCustom[key];return true;}},this);delete this._views[viewCid];this._updateLength();},call:function(method){this.apply(method,_.tail(arguments));},apply:function(method,args){_.each(this._views,function(view){if(_.isFunction(view[method])){view[method].apply(view,args||[]);}});},_updateLength:function(){this.length=_.size(this._views);}});var methods=['forEach','each','map','find','detect','filter','select','reject','every','all','some','any','include','contains','invoke','toArray','first','initial','rest','last','without','isEmpty','pluck'];_.each(methods,function(method){Container.prototype[method]=function(){var views=_.values(this._views);var args=[views].concat(_.toArray(arguments));return _[method].apply(_,args);};});return Container;})(Backbone,_);Backbone.Wreqr=(function(Backbone,Marionette,_){"use strict";var Wreqr={};Wreqr.Handlers=(function(Backbone,_){"use strict";var Handlers=function(options){this.options=options;this._wreqrHandlers={};if(_.isFunction(this.initialize)){this.initialize(options);}};Handlers.extend=Backbone.Model.extend;_.extend(Handlers.prototype,Backbone.Events,{setHandlers:function(handlers){_.each(handlers,function(handler,name){var context=null;if(_.isObject(handler)&&!_.isFunction(handler)){context=handler.context;handler=handler.callback;}
this.setHandler(name,handler,context);},this);},setHandler:function(name,handler,context){var config={callback:handler,context:context};this._wreqrHandlers[name]=config;this.trigger("handler:add",name,handler,context);},hasHandler:function(name){return!!this._wreqrHandlers[name];},getHandler:function(name){var config=this._wreqrHandlers[name];if(!config){throw new Error("Handler not found for '"+name+"'");}
return function(){var args=Array.prototype.slice.apply(arguments);return config.callback.apply(config.context,args);};},removeHandler:function(name){delete this._wreqrHandlers[name];},removeAllHandlers:function(){this._wreqrHandlers={};}});return Handlers;})(Backbone,_);Wreqr.CommandStorage=(function(){"use strict";var CommandStorage=function(options){this.options=options;this._commands={};if(_.isFunction(this.initialize)){this.initialize(options);}};_.extend(CommandStorage.prototype,Backbone.Events,{getCommands:function(commandName){var commands=this._commands[commandName];if(!commands){commands={command:commandName,instances:[]};this._commands[commandName]=commands;}
return commands;},addCommand:function(commandName,args){var command=this.getCommands(commandName);command.instances.push(args);},clearCommands:function(commandName){var command=this.getCommands(commandName);command.instances=[];}});return CommandStorage;})();Wreqr.Commands=(function(Wreqr){"use strict";return Wreqr.Handlers.extend({storageType:Wreqr.CommandStorage,constructor:function(options){this.options=options||{};this._initializeStorage(this.options);this.on("handler:add",this._executeCommands,this);var args=Array.prototype.slice.call(arguments);Wreqr.Handlers.prototype.constructor.apply(this,args);},execute:function(name,args){name=arguments[0];args=Array.prototype.slice.call(arguments,1);if(this.hasHandler(name)){this.getHandler(name).apply(this,args);}else{this.storage.addCommand(name,args);}},_executeCommands:function(name,handler,context){var command=this.storage.getCommands(name);_.each(command.instances,function(args){handler.apply(context,args);});this.storage.clearCommands(name);},_initializeStorage:function(options){var storage;var StorageType=options.storageType||this.storageType;if(_.isFunction(StorageType)){storage=new StorageType();}else{storage=StorageType;}
this.storage=storage;}});})(Wreqr);Wreqr.RequestResponse=(function(Wreqr){"use strict";return Wreqr.Handlers.extend({request:function(){var name=arguments[0];var args=Array.prototype.slice.call(arguments,1);return this.getHandler(name).apply(this,args);}});})(Wreqr);Wreqr.EventAggregator=(function(Backbone,_){"use strict";var EA=function(){};EA.extend=Backbone.Model.extend;_.extend(EA.prototype,Backbone.Events);return EA;})(Backbone,_);return Wreqr;})(Backbone,Backbone.Marionette,_);var Marionette=(function(global,Backbone,_){"use strict";var Marionette={};Backbone.Marionette=Marionette;Marionette.$=Backbone.$;var protoSlice=Array.prototype.slice;function slice(args){return protoSlice.call(args);}
function throwError(message,name){var error=new Error(message);error.name=name||'Error';throw error;}
Marionette.extend=Backbone.Model.extend;Marionette.getOption=function(target,optionName){if(!target||!optionName){return;}
var value;if(target.options&&(optionName in target.options)&&(target.options[optionName]!==undefined)){value=target.options[optionName];}else{value=target[optionName];}
return value;};Marionette.normalizeMethods=function(hash){var normalizedHash={},method;_.each(hash,function(fn,name){method=fn;if(!_.isFunction(method)){method=this[method];}
if(!method){return;}
normalizedHash[name]=method;},this);return normalizedHash;};Marionette.triggerMethod=(function(){var splitter=/(^|:)(\w)/gi;function getEventName(match,prefix,eventName){return eventName.toUpperCase();}
var triggerMethod=function(event){var methodName='on'+event.replace(splitter,getEventName);var method=this[methodName];if(_.isFunction(this.trigger)){this.trigger.apply(this,arguments);}
if(_.isFunction(method)){return method.apply(this,_.tail(arguments));}};return triggerMethod;})();Marionette.MonitorDOMRefresh=(function(documentElement){function handleShow(view){view._isShown=true;triggerDOMRefresh(view);}
function handleRender(view){view._isRendered=true;triggerDOMRefresh(view);}
function triggerDOMRefresh(view){if(view._isShown&&view._isRendered&&isInDOM(view)){if(_.isFunction(view.triggerMethod)){view.triggerMethod("dom:refresh");}}}
function isInDOM(view){return documentElement.contains(view.el);}
return function(view){view.listenTo(view,"show",function(){handleShow(view);});view.listenTo(view,"render",function(){handleRender(view);});};})(document.documentElement);(function(Marionette){"use strict";function bindFromStrings(target,entity,evt,methods){var methodNames=methods.split(/\s+/);_.each(methodNames,function(methodName){var method=target[methodName];if(!method){throwError("Method '"+methodName+"' was configured as an event handler, but does not exist.");}
target.listenTo(entity,evt,method,target);});}
function bindToFunction(target,entity,evt,method){target.listenTo(entity,evt,method,target);}
function unbindFromStrings(target,entity,evt,methods){var methodNames=methods.split(/\s+/);_.each(methodNames,function(methodName){var method=target[methodName];target.stopListening(entity,evt,method,target);});}
function unbindToFunction(target,entity,evt,method){target.stopListening(entity,evt,method,target);}
function iterateEvents(target,entity,bindings,functionCallback,stringCallback){if(!entity||!bindings){return;}
if(_.isFunction(bindings)){bindings=bindings.call(target);}
_.each(bindings,function(methods,evt){if(_.isFunction(methods)){functionCallback(target,entity,evt,methods);}else{stringCallback(target,entity,evt,methods);}});}
Marionette.bindEntityEvents=function(target,entity,bindings){iterateEvents(target,entity,bindings,bindToFunction,bindFromStrings);};Marionette.unbindEntityEvents=function(target,entity,bindings){iterateEvents(target,entity,bindings,unbindToFunction,unbindFromStrings);};})(Marionette);Marionette.Callbacks=function(){this._deferred=Marionette.$.Deferred();this._callbacks=[];};_.extend(Marionette.Callbacks.prototype,{add:function(callback,contextOverride){this._callbacks.push({cb:callback,ctx:contextOverride});this._deferred.done(function(context,options){if(contextOverride){context=contextOverride;}
callback.call(context,options);});},run:function(options,context){this._deferred.resolve(context,options);},reset:function(){var callbacks=this._callbacks;this._deferred=Marionette.$.Deferred();this._callbacks=[];_.each(callbacks,function(cb){this.add(cb.cb,cb.ctx);},this);}});Marionette.Controller=function(options){this.triggerMethod=Marionette.triggerMethod;this.options=options||{};if(_.isFunction(this.initialize)){this.initialize(this.options);}};Marionette.Controller.extend=Marionette.extend;_.extend(Marionette.Controller.prototype,Backbone.Events,{close:function(){this.stopListening();this.triggerMethod("close");this.unbind();}});Marionette.Region=function(options){this.options=options||{};this.el=Marionette.getOption(this,"el");if(!this.el){var err=new Error("An 'el' must be specified for a region.");err.name="NoElError";throw err;}
if(this.initialize){var args=Array.prototype.slice.apply(arguments);this.initialize.apply(this,args);}};_.extend(Marionette.Region,{buildRegion:function(regionConfig,defaultRegionType){var regionIsString=(typeof regionConfig==="string");var regionSelectorIsString=(typeof regionConfig.selector==="string");var regionTypeIsUndefined=(typeof regionConfig.regionType==="undefined");var regionIsType=(typeof regionConfig==="function");if(!regionIsType&&!regionIsString&&!regionSelectorIsString){throw new Error("Region must be specified as a Region type, a selector string or an object with selector property");}
var selector,RegionType;if(regionIsString){selector=regionConfig;}
if(regionConfig.selector){selector=regionConfig.selector;delete regionConfig.selector;}
if(regionIsType){RegionType=regionConfig;}
if(!regionIsType&&regionTypeIsUndefined){RegionType=defaultRegionType;}
if(regionConfig.regionType){RegionType=regionConfig.regionType;delete regionConfig.regionType;}
if(regionIsString||regionIsType){regionConfig={};}
regionConfig.el=selector;var region=new RegionType(regionConfig);if(regionConfig.parentEl){region.getEl=function(selector){var parentEl=regionConfig.parentEl;if(_.isFunction(parentEl)){parentEl=parentEl();}
return parentEl.find(selector);};}
return region;}});_.extend(Marionette.Region.prototype,Backbone.Events,{show:function(view){this.ensureEl();var isViewClosed=view.isClosed||_.isUndefined(view.$el);var isDifferentView=view!==this.currentView;if(isDifferentView){this.close();}
view.render();if(isDifferentView||isViewClosed){this.open(view);}
this.currentView=view;Marionette.triggerMethod.call(this,"show",view);Marionette.triggerMethod.call(view,"show");},ensureEl:function(){if(!this.$el||this.$el.length===0){this.$el=this.getEl(this.el);}},getEl:function(selector){return Marionette.$(selector);},open:function(view){this.$el.empty().append(view.el);},close:function(){var view=this.currentView;if(!view||view.isClosed){return;}
if(view.close){view.close();}
else if(view.remove){view.remove();}
Marionette.triggerMethod.call(this,"close",view);delete this.currentView;},attachView:function(view){this.currentView=view;},reset:function(){this.close();delete this.$el;}});Marionette.Region.extend=Marionette.extend;Marionette.RegionManager=(function(Marionette){var RegionManager=Marionette.Controller.extend({constructor:function(options){this._regions={};Marionette.Controller.prototype.constructor.call(this,options);},addRegions:function(regionDefinitions,defaults){var regions={};_.each(regionDefinitions,function(definition,name){if(typeof definition==="string"){definition={selector:definition};}
if(definition.selector){definition=_.defaults({},definition,defaults);}
var region=this.addRegion(name,definition);regions[name]=region;},this);return regions;},addRegion:function(name,definition){var region;var isObject=_.isObject(definition);var isString=_.isString(definition);var hasSelector=!!definition.selector;if(isString||(isObject&&hasSelector)){region=Marionette.Region.buildRegion(definition,Marionette.Region);}else if(_.isFunction(definition)){region=Marionette.Region.buildRegion(definition,Marionette.Region);}else{region=definition;}
this._store(name,region);this.triggerMethod("region:add",name,region);return region;},get:function(name){return this._regions[name];},removeRegion:function(name){var region=this._regions[name];this._remove(name,region);},removeRegions:function(){_.each(this._regions,function(region,name){this._remove(name,region);},this);},closeRegions:function(){_.each(this._regions,function(region,name){region.close();},this);},close:function(){this.removeRegions();var args=Array.prototype.slice.call(arguments);Marionette.Controller.prototype.close.apply(this,args);},_store:function(name,region){this._regions[name]=region;this._setLength();},_remove:function(name,region){region.close();delete this._regions[name];this._setLength();this.triggerMethod("region:remove",name,region);},_setLength:function(){this.length=_.size(this._regions);}});var methods=['forEach','each','map','find','detect','filter','select','reject','every','all','some','any','include','contains','invoke','toArray','first','initial','rest','last','without','isEmpty','pluck'];_.each(methods,function(method){RegionManager.prototype[method]=function(){var regions=_.values(this._regions);var args=[regions].concat(_.toArray(arguments));return _[method].apply(_,args);};});return RegionManager;})(Marionette);Marionette.TemplateCache=function(templateId){this.templateId=templateId;};_.extend(Marionette.TemplateCache,{templateCaches:{},get:function(templateId){var cachedTemplate=this.templateCaches[templateId];if(!cachedTemplate){cachedTemplate=new Marionette.TemplateCache(templateId);this.templateCaches[templateId]=cachedTemplate;}
return cachedTemplate.load();},clear:function(){var i;var args=slice(arguments);var length=args.length;if(length>0){for(i=0;i<length;i++){delete this.templateCaches[args[i]];}}else{this.templateCaches={};}}});_.extend(Marionette.TemplateCache.prototype,{load:function(){if(this.compiledTemplate){return this.compiledTemplate;}
var template=this.loadTemplate(this.templateId);this.compiledTemplate=this.compileTemplate(template);return this.compiledTemplate;},loadTemplate:function(templateId){var template=Marionette.$(templateId).html();if(!template||template.length===0){throwError("Could not find template: '"+templateId+"'","NoTemplateError");}
return template;},compileTemplate:function(rawTemplate){return _.template(rawTemplate);}});Marionette.Renderer={render:function(template,data){if(!template){var error=new Error("Cannot render the template since it's false, null or undefined.");error.name="TemplateNotFoundError";throw error;}
var templateFunc;if(typeof template==="function"){templateFunc=template;}else{templateFunc=Marionette.TemplateCache.get(template);}
return templateFunc(data);}};Marionette.View=Backbone.View.extend({constructor:function(options){_.bindAll(this,"render");var args=Array.prototype.slice.apply(arguments);this.options=_.extend({},_.result(this,'options'),_.isFunction(options)?options.call(this):options);this.events=this.normalizeUIKeys(_.result(this,'events'));Backbone.View.prototype.constructor.apply(this,args);Marionette.MonitorDOMRefresh(this);this.listenTo(this,"show",this.onShowCalled,this);},triggerMethod:Marionette.triggerMethod,normalizeMethods:Marionette.normalizeMethods,getTemplate:function(){return Marionette.getOption(this,"template");},mixinTemplateHelpers:function(target){target=target||{};var templateHelpers=Marionette.getOption(this,"templateHelpers");if(_.isFunction(templateHelpers)){templateHelpers=templateHelpers.call(this);}
return _.extend(target,templateHelpers);},normalizeUIKeys:function(hash){if(typeof(hash)==="undefined"){return;}
_.each(_.keys(hash),function(v){var split=v.split("@ui.");if(split.length===2){hash[split[0]+this.ui[split[1]]]=hash[v];delete hash[v];}},this);return hash;},configureTriggers:function(){if(!this.triggers){return;}
var triggerEvents={};var triggers=this.normalizeUIKeys(_.result(this,"triggers"));_.each(triggers,function(value,key){var hasOptions=_.isObject(value);var eventName=hasOptions?value.event:value;triggerEvents[key]=function(e){if(e){var prevent=e.preventDefault;var stop=e.stopPropagation;var shouldPrevent=hasOptions?value.preventDefault:prevent;var shouldStop=hasOptions?value.stopPropagation:stop;if(shouldPrevent&&prevent){prevent.apply(e);}
if(shouldStop&&stop){stop.apply(e);}}
var args={view:this,model:this.model,collection:this.collection};this.triggerMethod(eventName,args);};},this);return triggerEvents;},delegateEvents:function(events){this._delegateDOMEvents(events);Marionette.bindEntityEvents(this,this.model,Marionette.getOption(this,"modelEvents"));Marionette.bindEntityEvents(this,this.collection,Marionette.getOption(this,"collectionEvents"));},_delegateDOMEvents:function(events){events=events||this.events;if(_.isFunction(events)){events=events.call(this);}
var combinedEvents={};var triggers=this.configureTriggers();_.extend(combinedEvents,events,triggers);Backbone.View.prototype.delegateEvents.call(this,combinedEvents);},undelegateEvents:function(){var args=Array.prototype.slice.call(arguments);Backbone.View.prototype.undelegateEvents.apply(this,args);Marionette.unbindEntityEvents(this,this.model,Marionette.getOption(this,"modelEvents"));Marionette.unbindEntityEvents(this,this.collection,Marionette.getOption(this,"collectionEvents"));},onShowCalled:function(){},close:function(){if(this.isClosed){return;}
var shouldClose=this.triggerMethod("before:close");if(shouldClose===false){return;}
this.isClosed=true;this.triggerMethod("close");this.unbindUIElements();this.remove();},bindUIElements:function(){if(!this.ui){return;}
if(!this._uiBindings){this._uiBindings=this.ui;}
var bindings=_.result(this,"_uiBindings");this.ui={};_.each(_.keys(bindings),function(key){var selector=bindings[key];this.ui[key]=this.$(selector);},this);},unbindUIElements:function(){if(!this.ui||!this._uiBindings){return;}
_.each(this.ui,function($el,name){delete this.ui[name];},this);this.ui=this._uiBindings;delete this._uiBindings;}});Marionette.ItemView=Marionette.View.extend({constructor:function(){Marionette.View.prototype.constructor.apply(this,slice(arguments));},serializeData:function(){var data={};if(this.model){data=this.model.toJSON();}
else if(this.collection){data={items:this.collection.toJSON()};}
return data;},render:function(){this.isClosed=false;this.triggerMethod("before:render",this);this.triggerMethod("item:before:render",this);var data=this.serializeData();data=this.mixinTemplateHelpers(data);var template=this.getTemplate();var html=Marionette.Renderer.render(template,data);this.$el.html(html);this.bindUIElements();this.triggerMethod("render",this);this.triggerMethod("item:rendered",this);return this;},close:function(){if(this.isClosed){return;}
this.triggerMethod('item:before:close');Marionette.View.prototype.close.apply(this,slice(arguments));this.triggerMethod('item:closed');}});Marionette.CollectionView=Marionette.View.extend({itemViewEventPrefix:"itemview",constructor:function(options){this._initChildViewStorage();Marionette.View.prototype.constructor.apply(this,slice(arguments));this._initialEvents();this.initRenderBuffer();},initRenderBuffer:function(){this.elBuffer=document.createDocumentFragment();this._bufferedChildren=[];},startBuffering:function(){this.initRenderBuffer();this.isBuffering=true;},endBuffering:function(){this.isBuffering=false;this.appendBuffer(this,this.elBuffer);this._triggerShowBufferedChildren();this.initRenderBuffer();},_triggerShowBufferedChildren:function(){if(this._isShown){_.each(this._bufferedChildren,function(child){Marionette.triggerMethod.call(child,"show");});this._bufferedChildren=[];}},_initialEvents:function(){if(this.collection){this.listenTo(this.collection,"add",this.addChildView,this);this.listenTo(this.collection,"remove",this.removeItemView,this);this.listenTo(this.collection,"reset",this.render,this);}},addChildView:function(item,collection,options){this.closeEmptyView();var ItemView=this.getItemView(item);var index=this.collection.indexOf(item);this.addItemView(item,ItemView,index);},onShowCalled:function(){this.children.each(function(child){Marionette.triggerMethod.call(child,"show");});},triggerBeforeRender:function(){this.triggerMethod("before:render",this);this.triggerMethod("collection:before:render",this);},triggerRendered:function(){this.triggerMethod("render",this);this.triggerMethod("collection:rendered",this);},render:function(){this.isClosed=false;this.triggerBeforeRender();this._renderChildren();this.triggerRendered();return this;},_renderChildren:function(){this.startBuffering();this.closeEmptyView();this.closeChildren();if(!this.isEmpty(this.collection)){this.showCollection();}else{this.showEmptyView();}
this.endBuffering();},showCollection:function(){var ItemView;this.collection.each(function(item,index){ItemView=this.getItemView(item);this.addItemView(item,ItemView,index);},this);},showEmptyView:function(){var EmptyView=this.getEmptyView();if(EmptyView&&!this._showingEmptyView){this._showingEmptyView=true;var model=new Backbone.Model();this.addItemView(model,EmptyView,0);}},closeEmptyView:function(){if(this._showingEmptyView){this.closeChildren();delete this._showingEmptyView;}},getEmptyView:function(){return Marionette.getOption(this,"emptyView");},getItemView:function(item){var itemView=Marionette.getOption(this,"itemView");if(!itemView){throwError("An `itemView` must be specified","NoItemViewError");}
return itemView;},addItemView:function(item,ItemView,index){var itemViewOptions=Marionette.getOption(this,"itemViewOptions");if(_.isFunction(itemViewOptions)){itemViewOptions=itemViewOptions.call(this,item,index);}
var view=this.buildItemView(item,ItemView,itemViewOptions);this.addChildViewEventForwarding(view);this.triggerMethod("before:item:added",view);this.children.add(view);this.renderItemView(view,index);if(this._isShown&&!this.isBuffering){Marionette.triggerMethod.call(view,"show");}
this.triggerMethod("after:item:added",view);return view;},addChildViewEventForwarding:function(view){var prefix=Marionette.getOption(this,"itemViewEventPrefix");this.listenTo(view,"all",function(){var args=slice(arguments);var rootEvent=args[0];var itemEvents=this.normalizeMethods(this.getItemEvents());args[0]=prefix+":"+rootEvent;args.splice(1,0,view);if(typeof itemEvents!=="undefined"&&_.isFunction(itemEvents[rootEvent])){itemEvents[rootEvent].apply(this,args);}
Marionette.triggerMethod.apply(this,args);},this);},getItemEvents:function(){if(_.isFunction(this.itemEvents)){return this.itemEvents.call(this);}
return this.itemEvents;},renderItemView:function(view,index){view.render();this.appendHtml(this,view,index);},buildItemView:function(item,ItemViewType,itemViewOptions){var options=_.extend({model:item},itemViewOptions);return new ItemViewType(options);},removeItemView:function(item){var view=this.children.findByModel(item);this.removeChildView(view);this.checkEmpty();},removeChildView:function(view){if(view){this.stopListening(view);if(view.close){view.close();}
else if(view.remove){view.remove();}
this.children.remove(view);}
this.triggerMethod("item:removed",view);},isEmpty:function(collection){return!this.collection||this.collection.length===0;},checkEmpty:function(){if(this.isEmpty(this.collection)){this.showEmptyView();}},appendBuffer:function(collectionView,buffer){collectionView.$el.append(buffer);},appendHtml:function(collectionView,itemView,index){if(collectionView.isBuffering){collectionView.elBuffer.appendChild(itemView.el);collectionView._bufferedChildren.push(itemView);}
else{collectionView.$el.append(itemView.el);}},_initChildViewStorage:function(){this.children=new Backbone.ChildViewContainer();},close:function(){if(this.isClosed){return;}
this.triggerMethod("collection:before:close");this.closeChildren();this.triggerMethod("collection:closed");Marionette.View.prototype.close.apply(this,slice(arguments));},closeChildren:function(){this.children.each(function(child){this.removeChildView(child);},this);this.checkEmpty();}});Marionette.CompositeView=Marionette.CollectionView.extend({constructor:function(){Marionette.CollectionView.prototype.constructor.apply(this,slice(arguments));},_initialEvents:function(){this.once('render',function(){if(this.collection){this.listenTo(this.collection,"add",this.addChildView,this);this.listenTo(this.collection,"remove",this.removeItemView,this);this.listenTo(this.collection,"reset",this._renderChildren,this);}});},getItemView:function(item){var itemView=Marionette.getOption(this,"itemView")||this.constructor;if(!itemView){throwError("An `itemView` must be specified","NoItemViewError");}
return itemView;},serializeData:function(){var data={};if(this.model){data=this.model.toJSON();}
return data;},render:function(){this.isRendered=true;this.isClosed=false;this.resetItemViewContainer();this.triggerBeforeRender();var html=this.renderModel();this.$el.html(html);this.bindUIElements();this.triggerMethod("composite:model:rendered");this._renderChildren();this.triggerMethod("composite:rendered");this.triggerRendered();return this;},_renderChildren:function(){if(this.isRendered){this.triggerMethod("composite:collection:before:render");Marionette.CollectionView.prototype._renderChildren.call(this);this.triggerMethod("composite:collection:rendered");}},renderModel:function(){var data={};data=this.serializeData();data=this.mixinTemplateHelpers(data);var template=this.getTemplate();return Marionette.Renderer.render(template,data);},appendBuffer:function(compositeView,buffer){var $container=this.getItemViewContainer(compositeView);$container.append(buffer);},appendHtml:function(compositeView,itemView,index){if(compositeView.isBuffering){compositeView.elBuffer.appendChild(itemView.el);compositeView._bufferedChildren.push(itemView);}
else{var $container=this.getItemViewContainer(compositeView);$container.append(itemView.el);}},getItemViewContainer:function(containerView){if("$itemViewContainer"in containerView){return containerView.$itemViewContainer;}
var container;var itemViewContainer=Marionette.getOption(containerView,"itemViewContainer");if(itemViewContainer){var selector=_.isFunction(itemViewContainer)?itemViewContainer.call(this):itemViewContainer;container=containerView.$(selector);if(container.length<=0){throwError("The specified `itemViewContainer` was not found: "+containerView.itemViewContainer,"ItemViewContainerMissingError");}}else{container=containerView.$el;}
containerView.$itemViewContainer=container;return container;},resetItemViewContainer:function(){if(this.$itemViewContainer){delete this.$itemViewContainer;}}});Marionette.Layout=Marionette.ItemView.extend({regionType:Marionette.Region,constructor:function(options){options=options||{};this._firstRender=true;this._initializeRegions(options);Marionette.ItemView.prototype.constructor.call(this,options);},render:function(){if(this.isClosed){this._initializeRegions();}
if(this._firstRender){this._firstRender=false;}else if(!this.isClosed){this._reInitializeRegions();}
var args=Array.prototype.slice.apply(arguments);var result=Marionette.ItemView.prototype.render.apply(this,args);return result;},close:function(){if(this.isClosed){return;}
this.regionManager.close();var args=Array.prototype.slice.apply(arguments);Marionette.ItemView.prototype.close.apply(this,args);},addRegion:function(name,definition){var regions={};regions[name]=definition;return this._buildRegions(regions)[name];},addRegions:function(regions){this.regions=_.extend({},this.regions,regions);return this._buildRegions(regions);},removeRegion:function(name){delete this.regions[name];return this.regionManager.removeRegion(name);},_buildRegions:function(regions){var that=this;var defaults={regionType:Marionette.getOption(this,"regionType"),parentEl:function(){return that.$el;}};return this.regionManager.addRegions(regions,defaults);},_initializeRegions:function(options){var regions;this._initRegionManager();if(_.isFunction(this.regions)){regions=this.regions(options);}else{regions=this.regions||{};}
this.addRegions(regions);},_reInitializeRegions:function(){this.regionManager.closeRegions();this.regionManager.each(function(region){region.reset();});},_initRegionManager:function(){this.regionManager=new Marionette.RegionManager();this.listenTo(this.regionManager,"region:add",function(name,region){this[name]=region;this.trigger("region:add",name,region);});this.listenTo(this.regionManager,"region:remove",function(name,region){delete this[name];this.trigger("region:remove",name,region);});}});Marionette.AppRouter=Backbone.Router.extend({constructor:function(options){Backbone.Router.prototype.constructor.apply(this,slice(arguments));this.options=options||{};var appRoutes=Marionette.getOption(this,"appRoutes");var controller=this._getController();this.processAppRoutes(controller,appRoutes);},appRoute:function(route,methodName){var controller=this._getController();this._addAppRoute(controller,route,methodName);},processAppRoutes:function(controller,appRoutes){if(!appRoutes){return;}
var routeNames=_.keys(appRoutes).reverse();_.each(routeNames,function(route){this._addAppRoute(controller,route,appRoutes[route]);},this);},_getController:function(){return Marionette.getOption(this,"controller");},_addAppRoute:function(controller,route,methodName){var method=controller[methodName];if(!method){throw new Error("Method '"+methodName+"' was not found on the controller");}
this.route(route,methodName,_.bind(method,controller));}});Marionette.Application=function(options){this._initRegionManager();this._initCallbacks=new Marionette.Callbacks();this.vent=new Backbone.Wreqr.EventAggregator();this.commands=new Backbone.Wreqr.Commands();this.reqres=new Backbone.Wreqr.RequestResponse();this.submodules={};_.extend(this,options);this.triggerMethod=Marionette.triggerMethod;};_.extend(Marionette.Application.prototype,Backbone.Events,{execute:function(){var args=Array.prototype.slice.apply(arguments);this.commands.execute.apply(this.commands,args);},request:function(){var args=Array.prototype.slice.apply(arguments);return this.reqres.request.apply(this.reqres,args);},addInitializer:function(initializer){this._initCallbacks.add(initializer);},start:function(options){this.triggerMethod("initialize:before",options);this._initCallbacks.run(options,this);this.triggerMethod("initialize:after",options);this.triggerMethod("start",options);},addRegions:function(regions){return this._regionManager.addRegions(regions);},closeRegions:function(){this._regionManager.closeRegions();},removeRegion:function(region){this._regionManager.removeRegion(region);},getRegion:function(region){return this._regionManager.get(region);},module:function(moduleNames,moduleDefinition){var ModuleClass=Marionette.Module;if(moduleDefinition){ModuleClass=moduleDefinition.moduleClass||ModuleClass;}
var args=slice(arguments);args.unshift(this);return ModuleClass.create.apply(ModuleClass,args);},_initRegionManager:function(){this._regionManager=new Marionette.RegionManager();this.listenTo(this._regionManager,"region:add",function(name,region){this[name]=region;});this.listenTo(this._regionManager,"region:remove",function(name,region){delete this[name];});}});Marionette.Application.extend=Marionette.extend;Marionette.Module=function(moduleName,app,options){this.moduleName=moduleName;this.options=_.extend({},this.options,options);this.initialize=options.initialize||this.initialize;this.submodules={};this._setupInitializersAndFinalizers();this.app=app;this.startWithParent=true;this.triggerMethod=Marionette.triggerMethod;if(_.isFunction(this.initialize)){this.initialize(this.options,moduleName,app);}};Marionette.Module.extend=Marionette.extend;_.extend(Marionette.Module.prototype,Backbone.Events,{initialize:function(){},addInitializer:function(callback){this._initializerCallbacks.add(callback);},addFinalizer:function(callback){this._finalizerCallbacks.add(callback);},start:function(options){if(this._isInitialized){return;}
_.each(this.submodules,function(mod){if(mod.startWithParent){mod.start(options);}});this.triggerMethod("before:start",options);this._initializerCallbacks.run(options,this);this._isInitialized=true;this.triggerMethod("start",options);},stop:function(){if(!this._isInitialized){return;}
this._isInitialized=false;Marionette.triggerMethod.call(this,"before:stop");_.each(this.submodules,function(mod){mod.stop();});this._finalizerCallbacks.run(undefined,this);this._initializerCallbacks.reset();this._finalizerCallbacks.reset();Marionette.triggerMethod.call(this,"stop");},addDefinition:function(moduleDefinition,customArgs){this._runModuleDefinition(moduleDefinition,customArgs);},_runModuleDefinition:function(definition,customArgs){if(!definition){return;}
var args=_.flatten([this,this.app,Backbone,Marionette,Marionette.$,_,customArgs]);definition.apply(this,args);},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new Marionette.Callbacks();this._finalizerCallbacks=new Marionette.Callbacks();}});_.extend(Marionette.Module,{create:function(app,moduleNames,moduleDefinition){var module=app;var customArgs=slice(arguments);customArgs.splice(0,3);moduleNames=moduleNames.split(".");var length=moduleNames.length;var moduleDefinitions=[];moduleDefinitions[length-1]=moduleDefinition;_.each(moduleNames,function(moduleName,i){var parentModule=module;module=this._getModule(parentModule,moduleName,app,moduleDefinition);this._addModuleDefinition(parentModule,module,moduleDefinitions[i],customArgs);},this);return module;},_getModule:function(parentModule,moduleName,app,def,args){var ModuleClass=Marionette.Module;var options=_.extend({},def);if(def){ModuleClass=def.moduleClass||ModuleClass;}
var module=parentModule[moduleName];if(!module){module=new ModuleClass(moduleName,app,options);parentModule[moduleName]=module;parentModule.submodules[moduleName]=module;}
return module;},_addModuleDefinition:function(parentModule,module,def,args){var fn;var startWithParent;if(_.isFunction(def)){fn=def;startWithParent=true;}else if(_.isObject(def)){fn=def.define;startWithParent=(typeof def.startWithParent!=='undefined')?def.startWithParent:true;}else{startWithParent=true;}
if(fn){module.addDefinition(fn,args);}
module.startWithParent=module.startWithParent&&startWithParent;if(module.startWithParent&&!module.startWithParentIsConfigured){module.startWithParentIsConfigured=true;parentModule.addInitializer(function(options){if(module.startWithParent){module.start(options);}});}}});return Marionette;})(this,Backbone,_);Backbone.Picky=(function(Backbone,_){var Picky={};Picky.SingleSelect=function(collection,models){this._pickyCid=_.uniqueId('singleSelect-');this.collection=collection;if(arguments.length>1){_.each(models||[],function(model){registerCollectionWithModel(model,this);if(model.selected)this.selected=model;},this);this.collection.listenTo(this.collection,'_selected',this.select);this.collection.listenTo(this.collection,'_deselected',this.deselect);this.collection.listenTo(this.collection,'reset',onResetSingleSelect);this.collection.listenTo(this.collection,'add',onAdd);this.collection.listenTo(this.collection,'remove',onRemove);}};_.extend(Picky.SingleSelect.prototype,{select:function(model,options){options||(options={});if(model&&this.selected===model){return;}
this.deselect(undefined,_.omit(options,"_localSilent"));this.selected=model;this.selected.select(_.omit(options,"_localSilent"));if(!(options.silent||options._localSilent))this.trigger("select:one",model);},deselect:function(model,options){options||(options={});if(!this.selected){return;}
model=model||this.selected;if(this.selected!==model){return;}
delete this.selected;if(!options._skipModelCall)model.deselect(_.omit(options,"_localSilent"));if(!(options.silent||options._localSilent))this.trigger("deselect:one",model);},close:function(){this.stopListening();}});Picky.MultiSelect=function(collection,models){this._pickyCid=_.uniqueId('multiSelect-');this.collection=collection;this.selected={};if(arguments.length>1){_.each(models||[],function(model){registerCollectionWithModel(model,this);if(model.selected)this.selected[model.cid]=model;},this);this.collection.listenTo(this.collection,'_selected',this.select);this.collection.listenTo(this.collection,'_deselected',this.deselect);this.collection.listenTo(this.collection,'reset',onResetMultiSelect);this.collection.listenTo(this.collection,'add',onAdd);this.collection.listenTo(this.collection,'remove',onRemove);}};_.extend(Picky.MultiSelect.prototype,{select:function(model,options){if(this.selected[model.cid]){return;}
this.selected[model.cid]=model;this.selectedLength=_.size(this.selected);model.select(_.omit(options,"_localSilent"));triggerMultiSelectEvents(this,options);},deselect:function(model,options){options||(options={});if(!this.selected[model.cid]){return;}
delete this.selected[model.cid];this.selectedLength=_.size(this.selected);if(!options._skipModelCall)model.deselect(_.omit(options,"_localSilent"));triggerMultiSelectEvents(this,options);},selectAll:function(options){this.selectedLength=0;this.each(function(model){this.selectedLength++;model.select(_.omit(options,"_localSilent"));},this);triggerMultiSelectEvents(this,options);},deselectAll:function(options){if(this.selectedLength===0){return;}
this.each(function(model){if(model.selected)this.selectedLength--;model.deselect(_.omit(options,"_localSilent"));},this);this.selectedLength=0;triggerMultiSelectEvents(this,options);},selectNone:function(options){this.deselectAll(options);},toggleSelectAll:function(options){if(this.selectedLength===this.length){this.deselectAll(options);}else{this.selectAll(options);}},close:function(){this.stopListening();}});Picky.Selectable=function(model){this.model=model;};_.extend(Picky.Selectable.prototype,{select:function(options){options||(options={});if(this.selected){return;}
this.selected=true;if(this._pickyCollections){this.trigger("_selected",this,_.omit(options,"_localSilent"));}else if(this.collection){this.collection.select(this,_.omit(options,"_localSilent"));}
if(!(options.silent||options._localSilent))this.trigger("selected",this);},deselect:function(options){options||(options={});if(!this.selected){return;}
this.selected=false;if(this._pickyCollections){this.trigger("_deselected",this,_.omit(options,"_localSilent"));}else if(this.collection){this.collection.deselect(this,_.omit(options,"_localSilent"));}
if(!(options.silent||options._localSilent))this.trigger("deselected",this);},toggleSelected:function(options){if(this.selected){this.deselect(options);}else{this.select(options);}}});var triggerMultiSelectEvents=function(collection,options){options||(options={});if(options.silent||options._localSilent)return;var selectedLength=collection.selectedLength;var length=collection.length;if(selectedLength===length){collection.trigger("select:all",collection);return;}
if(selectedLength===0){collection.trigger("select:none",collection);return;}
if(selectedLength>0&&selectedLength<length){collection.trigger("select:some",collection);return;}};function onAdd(model,collection){registerCollectionWithModel(model,collection);if(model.selected)collection.select(model);}
function onRemove(model,collection,options){if(model._pickyCollections)model._pickyCollections=_.without(model._pickyCollections,collection._pickyCid);if(model.selected){if(model._pickyCollections&&model._pickyCollections.length==0){collection.deselect(model,options);}else{collection.deselect(model,_.extend({},options,{_skipModelCall:true}));}}}
function onResetSingleSelect(collection,options){var selected,excessiveSelections,deselectOnRemove=_.find(options.previousModels,function(model){return model.selected;});if(deselectOnRemove)onRemove(deselectOnRemove,collection,{_localSilent:true});selected=collection.filter(function(model){return model.selected;});excessiveSelections=_.initial(selected);if(excessiveSelections.length)_.each(excessiveSelections,function(model){model.deselect();});if(selected.length)collection.select(_.last(selected),{silent:true});}
function onResetMultiSelect(collection,options){var select,deselect=_.filter(options.previousModels,function(model){return model.selected;});if(deselect)_.each(deselect,function(model){onRemove(model,collection,{_localSilent:true});});select=collection.filter(function(model){return model.selected;});if(select.length)_.each(select,function(model){collection.select(model,{silent:true});});}
function registerCollectionWithModel(model,collection){model._pickyCollections||(model._pickyCollections=[]);model._pickyCollections.push(collection._pickyCid);}
return Picky;})(Backbone,_);(function(factory){if(typeof define==='function'&&define.amd){define(['underscore','backbone','exports'],factory);}
else if(typeof exports==='object'){factory(require('underscore'),require('backbone'),exports);}
else{factory(_,Backbone,{});}}(function(_,Backbone,Stickit){Stickit._handlers=[];Stickit.addHandler=function(handlers){handlers=_.map(_.flatten([handlers]),function(handler){return _.defaults({},handler,{updateModel:true,updateView:true,updateMethod:'text'});});this._handlers=this._handlers.concat(handlers);};Stickit.ViewMixin={_modelBindings:null,unstickit:function(model,bindingSelector){if(_.isObject(bindingSelector)){_.each(bindingSelector,function(v,selector){this.unstickit(model,selector);},this);return;}
var models=[],destroyFns=[],bindings=_.clone(this._modelBindings);_.each(bindings,function(binding,i){if(model&&binding.model!==model)return;if(bindingSelector&&binding.config.selector!=bindingSelector)return;binding.model.off(binding.event,binding.fn);destroyFns.push(binding.config._destroy);models.push(binding.model);delete this._modelBindings[i];},this);_.invoke(_.uniq(models),'trigger','stickit:unstuck',this.cid);_.each(_.uniq(destroyFns),function(fn){fn.call(this);},this);this._modelBindings=_.compact(this._modelBindings);this.$el.off('.stickit'+(model?'.'+model.cid:''),bindingSelector);},stickit:function(optionalModel,optionalBindingsConfig){var model=optionalModel||this.model,bindings=optionalBindingsConfig||_.result(this,"bindings")||{};this._modelBindings||(this._modelBindings=[]);this.addBinding(model,bindings);var remove=this.remove;if(!remove.stickitWrapped){this.remove=function(){var ret=this;this.unstickit();if(remove)ret=remove.apply(this,arguments);return ret;};}
this.remove.stickitWrapped=true;return this;},addBinding:function(optionalModel,selector,binding){var model=optionalModel||this.model,namespace='.stickit.'+model.cid,binding=binding||{};if(_.isObject(selector)){var bindings=selector;_.each(bindings,function(val,key){this.addBinding(model,key,val);},this);return;}
var $el=selector===':el'?this.$el:this.$(selector);this.unstickit(model,selector);if(!$el.length)return;if(_.isString(binding))binding={observe:binding};if(_.isFunction(binding.observe))binding.observe=binding.observe.call(this);var config=getConfiguration($el,binding);var modelAttr=config.observe;config.selector=selector;config.view=this;var bindId=config.bindId=_.uniqueId();var options=_.extend({stickitChange:config},config.setOptions);config._destroy=function(){applyViewFn.call(this,config.destroy,$el,model,config);};initializeAttributes($el,config,model,modelAttr);initializeVisible($el,config,model,modelAttr);initializeClasses($el,config,model,modelAttr);if(modelAttr){_.each(config.events,function(type){var eventName=type+namespace;var listener=function(event){var val=applyViewFn.call(this,config.getVal,$el,event,config,slice.call(arguments,1));var currentVal=evaluateBoolean(config.updateModel,val,event,config);if(currentVal)setAttr(model,modelAttr,val,options,config);};var sel=selector===':el'?'':selector;this.$el.on(eventName,sel,_.bind(listener,this));},this);_.each(_.flatten([modelAttr]),function(attr){observeModelEvent(model,'change:'+attr,config,function(model,val,options){var changeId=options&&options.stickitChange&&options.stickitChange.bindId;if(changeId!==bindId){var currentVal=getAttr(model,modelAttr,config);updateViewBindEl($el,config,currentVal,model);}});});var currentVal=getAttr(model,modelAttr,config);updateViewBindEl($el,config,currentVal,model,true);}
applyViewFn.call(this,config.initialize,$el,model,config);}};_.extend(Backbone.View.prototype,Stickit.ViewMixin);var slice=[].slice;var evaluatePath=function(obj,path){var parts=(path||'').split('.');var result=_.reduce(parts,function(memo,i){return memo[i];},obj);return result==null?obj:result;};var applyViewFn=function(fn){fn=_.isString(fn)?evaluatePath(this,fn):fn;if(fn)return(fn).apply(this,slice.call(arguments,1));};var evaluateBoolean=function(reference,val,config){if(_.isBoolean(reference)){return reference;}else if(_.isFunction(reference)||_.isString(reference)){var view=_.last(arguments).view;return applyViewFn.apply(view,arguments);}
return false;};var observeModelEvent=function(model,event,config,fn){var view=config.view;model.on(event,fn,view);view._modelBindings.push({model:model,event:event,fn:fn,config:config});};var setAttr=function(model,attr,val,options,config){var value={},view=config.view;if(config.onSet){val=applyViewFn.call(view,config.onSet,val,config);}
if(config.set){applyViewFn.call(view,config.set,attr,val,options,config);}else{value[attr]=val;if(_.isArray(attr)&&_.isArray(val)){value=_.reduce(attr,function(memo,attribute,index){memo[attribute]=_.has(val,index)?val[index]:null;return memo;},{});}
model.set(value,options);}};var getAttr=function(model,attr,config){var view=config.view;var retrieveVal=function(field){return model[config.escape?'escape':'get'](field);};var sanitizeVal=function(val){return val==null?'':val;};var val=_.isArray(attr)?_.map(attr,retrieveVal):retrieveVal(attr);if(config.onGet)val=applyViewFn.call(view,config.onGet,val,config);return _.isArray(val)?_.map(val,sanitizeVal):sanitizeVal(val);};var getConfiguration=Stickit.getConfiguration=function($el,binding){var handlers=[{updateModel:false,updateMethod:'text',update:function($el,val,m,opts){if($el[opts.updateMethod])$el[opts.updateMethod](val);},getVal:function($el,e,opts){return $el[opts.updateMethod]();}}];handlers=handlers.concat(_.filter(Stickit._handlers,function(handler){return $el.is(handler.selector);}));handlers.push(binding);var config=_.extend.apply(_,handlers);if(!_.has(config,'updateView'))config.updateView=!config.visible;return config;};var initializeAttributes=function($el,config,model,modelAttr){var props=['autofocus','autoplay','async','checked','controls','defer','disabled','hidden','indeterminate','loop','multiple','open','readonly','required','scoped','selected'];var view=config.view;_.each(config.attributes||[],function(attrConfig){attrConfig=_.clone(attrConfig);attrConfig.view=view;var lastClass='';var observed=attrConfig.observe||(attrConfig.observe=modelAttr);var updateAttr=function(){var updateType=_.contains(props,attrConfig.name)?'prop':'attr',val=getAttr(model,observed,attrConfig);if(attrConfig.name==='class'){$el.removeClass(lastClass).addClass(val);lastClass=val;}else{$el[updateType](attrConfig.name,val);}};_.each(_.flatten([observed]),function(attr){observeModelEvent(model,'change:'+attr,config,updateAttr);});updateAttr();});};var initializeClasses=function($el,config,model,modelAttr){_.each(config.classes||[],function(classConfig,name){if(_.isString(classConfig))classConfig={observe:classConfig};classConfig.view=config.view;var observed=classConfig.observe;var updateClass=function(){var val=getAttr(model,observed,classConfig);$el.toggleClass(name,!!val);};_.each(_.flatten([observed]),function(attr){observeModelEvent(model,'change:'+attr,config,updateClass);});updateClass();});};var initializeVisible=function($el,config,model,modelAttr){if(config.visible==null)return;var view=config.view;var visibleCb=function(){var visible=config.visible,visibleFn=config.visibleFn,val=getAttr(model,modelAttr,config),isVisible=!!val;if(_.isFunction(visible)||_.isString(visible)){isVisible=!!applyViewFn.call(view,visible,val,config);}
if(visibleFn){applyViewFn.call(view,visibleFn,$el,isVisible,config);}else{$el.toggle(isVisible);}};_.each(_.flatten([modelAttr]),function(attr){observeModelEvent(model,'change:'+attr,config,visibleCb);});visibleCb();};var updateViewBindEl=function($el,config,val,model,isInitializing){var view=config.view;if(!evaluateBoolean(config.updateView,val,config))return;applyViewFn.call(view,config.update,$el,val,model,config);if(!isInitializing)applyViewFn.call(view,config.afterUpdate,$el,val,config);};Stickit.addHandler([{selector:'[contenteditable="true"]',updateMethod:'html',events:['input','change']},{selector:'input',events:['propertychange','input','change'],update:function($el,val){$el.val(val);},getVal:function($el){return $el.val();}},{selector:'textarea',events:['propertychange','input','change'],update:function($el,val){$el.val(val);},getVal:function($el){return $el.val();}},{selector:'input[type="radio"]',events:['change'],update:function($el,val){$el.filter('[value="'+val+'"]').prop('checked',true);},getVal:function($el){return $el.filter(':checked').val();}},{selector:'input[type="checkbox"]',events:['change'],update:function($el,val,model,options){if($el.length>1){val||(val=[]);$el.each(function(i,el){var checkbox=Backbone.$(el);var checked=_.contains(val,checkbox.val());checkbox.prop('checked',checked);});}else{var checked=_.isBoolean(val)?val:val===$el.val();$el.prop('checked',checked);}},getVal:function($el){var val;if($el.length>1){val=_.reduce($el,function(memo,el){var checkbox=Backbone.$(el);if(checkbox.prop('checked'))memo.push(checkbox.val());return memo;},[]);}else{val=$el.prop('checked');var boxval=$el.val();if(boxval!=='on'&&boxval!=null){val=val?$el.val():null;}}
return val;}},{selector:'select',events:['change'],update:function($el,val,model,options){var optList,selectConfig=options.selectOptions,list=selectConfig&&selectConfig.collection||undefined,isMultiple=$el.prop('multiple');if(!selectConfig){selectConfig={};var getList=function($el){return $el.map(function(){return{value:this.value,label:this.text};}).get();};if($el.find('optgroup').length){list={opt_labels:[]};if($el.find('> option').length){list.opt_labels.push(undefined);_.each($el.find('> option'),function(el){list[undefined]=getList(Backbone.$(el));});}
_.each($el.find('optgroup'),function(el){var label=Backbone.$(el).attr('label');list.opt_labels.push(label);list[label]=getList(Backbone.$(el).find('option'));});}else{list=getList($el.find('option'));}}
selectConfig.valuePath=selectConfig.valuePath||'value';selectConfig.labelPath=selectConfig.labelPath||'label';var addSelectOptions=function(optList,$el,fieldVal){_.each(optList,function(obj){var option=Backbone.$('<option/>'),optionVal=obj;var fillOption=function(text,val){option.text(text);optionVal=val;option.data('stickit_bind_val',optionVal);if(!_.isArray(optionVal)&&!_.isObject(optionVal))option.val(optionVal);};var text,val;if(obj==='__default__'){text=fieldVal.label,val=fieldVal.value;}else{text=evaluatePath(obj,selectConfig.labelPath),val=evaluatePath(obj,selectConfig.valuePath);}
fillOption(text,val);var isSelected=function(){if(!isMultiple&&optionVal!=null&&fieldVal!=null&&optionVal===fieldVal){return true}else if(_.isObject(fieldVal)&&_.isEqual(optionVal,fieldVal)){return true;}
return false;}
if(isSelected()){option.prop('selected',true);}else if(isMultiple&&_.isArray(fieldVal)){_.each(fieldVal,function(val){if(_.isObject(val))val=evaluatePath(val,selectConfig.valuePath);if(val===optionVal||(_.isObject(val)&&_.isEqual(optionVal,val)))
option.prop('selected',true);});}
$el.append(option);});};$el.find('*').remove();if(_.isString(list)){var context=window;if(list.indexOf('this.')===0)context=this;list=list.replace(/^[a-z]*\.(.+)$/,'$1');optList=evaluatePath(context,list);}else if(_.isFunction(list)){optList=applyViewFn.call(this,list,$el,options);}else{optList=list;}
if(optList instanceof Backbone.Collection)optList=optList.toJSON();if(selectConfig.defaultOption){var option=_.isFunction(selectConfig.defaultOption)?selectConfig.defaultOption.call(this,$el,options):selectConfig.defaultOption;addSelectOptions(["__default__"],$el,option);}
if(_.isArray(optList)){addSelectOptions(optList,$el,val);}else if(optList.opt_labels){_.each(optList.opt_labels,function(label){var $group=Backbone.$('<optgroup/>').attr('label',label);addSelectOptions(optList[label],$group,val);$el.append($group);});}else{var opts=[],opt;for(var i in optList){opt={};opt[selectConfig.valuePath]=i;opt[selectConfig.labelPath]=optList[i];opts.push(opt);}
opts=_.sortBy(opts,selectConfig.comparator||selectConfig.labelPath);addSelectOptions(opts,$el,val);}},getVal:function($el){var selected=$el.find('option:selected');if($el.prop('multiple')){return _.map(selected,function(el){return Backbone.$(el).data('stickit_bind_val');});}else{return selected.data('stickit_bind_val');}}}]);Backbone.Stickit=Stickit;return Backbone.Stickit;}));(function(factory){if(typeof define==='function'&&define.amd){define(['backbone','underscore'],factory);}else if(typeof exports==='object'){module.exports=factory(require('backbone'),require('underscore'));}else{factory(window.Backbone,window._);}})(function(Backbone,_){'use strict';var Validator=Backbone.Validator={version:'0.3.0',validate:function(attrs,validations,context){var errors={};_.each(attrs,function(attrValue,attrName){var validation=validations[attrName];if(validation){var error=this._validateAll(validation,attrName,attrValue,context,attrs);if(error.length){errors[attrName]=_.uniq(error);}}},this);return _.size(errors)?errors:null;},_validateAll:function(validations,attrName,attrValue,context,allAttrs){context=context||this;return _.inject(_.flatten([validations||[]]),function(errors,validation){_.chain(validation).omit('message').each(function(attrExpectation,validatorName){var validator=this._validators[validatorName];if(!validator){throw new Error('Missed validator: '+validatorName);}
var result=validator.fn.apply(context,[attrValue,attrExpectation,allAttrs]);if(result!==true){var error=validation.message||result||createErrorMessage(attrName,attrValue,attrExpectation,validatorName,context)||validator.message||'Invalid';if(_.isFunction(error)){error=error.apply(context,[attrName,attrValue,attrExpectation,validatorName]);}
errors.push(error);}},this);return errors;},[],this);},add:function(validatorName,validatorFn,errorMessage){this._validators[validatorName]={fn:validatorFn,message:errorMessage};},_validators:{}};Validator.Extensions={View:{bindValidation:function(model,options){model=model||this.model;if(!model){throw'Model is not provided';}
this.listenTo(model,'validated',function(model,attributes,errors){var callbacks=_.extend({},Validator.ViewCallbacks,_.pick(this,'onInvalidField','onValidField'),options);errors=errors||{};_.each(attributes,function(value,name){var attrErrors=errors[name];if(attrErrors&&attrErrors.length){callbacks.onInvalidField.call(this,name,value,attrErrors,model);}else{callbacks.onValidField.call(this,name,value,model);}},this);});}},Model:{validate:function(attributes,options){var validation=_.result(this,'validation')||{},attrs=getAttrsToValidate(this,attributes),errors=Validator.validate(attrs,validation,this);options=options||{};errors=options.processErrors?options.processErrors(errors):Validator.ModelCallbacks.processErrors(errors);if(!options.silent){_.defer(_.bind(this.triggerValidated,this),attrs,errors);}
return options&&options.suppress?null:errors;},_validate:function(attributes,options){if(!options.validate||!this.validate)return true;var attrs=getAttrsToValidate(this,attributes),errors=this.validationError=this.validate(attrs,options)||null;if(errors){this.trigger('invalid',this,errors,_.extend(options||{},{validationError:errors}));}
return!errors;},triggerValidated:function(attributes,errors){var attrs=getAttrsToValidate(this,attributes),errs=getCleanErrors(errors);this.validationError=errs;this.trigger('validated',this,attrs,errs);this.trigger('validated:'+(errs?'invalid':'valid'),this,attrs,errs);},isValid:function(attributes,options){var attrs=getAttrsToValidate(this,attributes);return!this.validate||!this.validate(attrs,options);}}};var pick=function(object,keys){return _.inject(_.flatten([keys]),function(memo,key){memo[key]=object[key];return memo;},{});};var getAttrsToValidate=function(model,passedAttrs){var modelAttrs=model.attributes,validationAttrs=_.result(model,'validation'),attrs,all;if(_.isArray(passedAttrs)||_.isString(passedAttrs)){attrs=pick(modelAttrs,passedAttrs);}else if(!passedAttrs){all=_.extend({},modelAttrs,validationAttrs||{});attrs=pick(modelAttrs,_.keys(all));}else{attrs=passedAttrs;}
return attrs;};var getCleanErrors=function(allErrors){var cleanErrors=_.inject(allErrors,function(memo,fieldErrors,attr){if(fieldErrors.length){memo[attr]=_.isString(fieldErrors)?[fieldErrors]:fieldErrors;}
return memo;},{});return _.size(cleanErrors)?cleanErrors:null;};var createErrorMessage=function(){return Validator.createMessage?Validator.createMessage.apply(null,arguments):false;};Validator.ViewCallbacks={onValidField:function(name){var input=this.$('input[name="'+name+'"]');input.removeClass('error');input.next('.error-text').remove();},onInvalidField:function(name,value,errors){var input=this.$('input[name="'+name+'"]');input.next('.error-text').remove();input.addClass('error').after('<div class="error-text">'+errors.join(', ')+'</div>');}};Validator.ModelCallbacks={processErrors:function(errors){return errors;}};var validators=[{name:'required',message:'Is required',fn:function(value,expectation){return expectation===false||!!value;}},{name:'blank',message:'Could not be blank',fn:function(value,expectation){if(expectation===true){return true;}
if(_.isString(value)){return!value.match(/^[\s\t\r\n]*$/);}if(_.isArray(value)){return!!value.length;}else if(_.isObject(value)){return!_.isEmpty(value);}else{return!!value;}}},{name:'collection',fn:function(collection,expectation){if(expectation===false||!collection){return true;}
if(typeof expectation==='function'){collection=expectation.call(this,collection);}
var errors=_.inject(collection.models||collection,function(memo,model,index){var error=model.validate();if(error){memo.push([index,error]);}
return memo;},[]);return errors.length?errors:true;}},{name:'model',fn:function(model,expectation){if(expectation===false||!model){return true;}
if(typeof expectation==='function'){model=expectation.call(this,model);}
return model.validate()||true;}},{name:'minLength',message:'Is too short',fn:function(value,expectation){return!value||value.length>=expectation;}},{name:'maxLength',message:'Is too long',fn:function(value,expectation){return!value||value.length<=expectation;}},{name:'format',message:'Does not match format',fn:function(value,expectation){return!value||!!value.toString().match(Validator.formats[expectation]||expectation);}},{name:'fn',fn:function(value,expectation,allAttrs){return expectation.call(this,value,allAttrs);}}];Validator.formats={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i};_.each(validators,function(validator){Validator.add(validator.name,validator.fn,validator.message);});_.extend(Backbone.Model.prototype,Validator.Extensions.Model);_.extend(Backbone.View.prototype,Validator.Extensions.View);return Validator;});
/*!
 * Backbone.GoogleMaps
 * A Backbone JS layer for the GoogleMaps API
 * Copyright (c)2012 Edan Schwartz
 * Distributed under MIT license
 * https://github.com/eschwartz/backbone.googlemaps
 */
(function(root,factory){if(typeof define==='function'&&define.amd){define(['backbone','underscore','jquery'],factory);}
else{factory(root.Backbone,root._,root.jQuery||root.Zepto||root.ender);}}(this,function(Backbone,_,$){'use strict';var GoogleMaps={};GoogleMaps.Location=Backbone.Model.extend({constructor:function(){_.bindAll(this,'select','deselect','toggleSelect','getLatLng','getLatlng');this.defaults=_.extend({},{lat:0,lng:0,selected:false,highlighted:false,title:""},this.defaults);Backbone.Model.prototype.constructor.apply(this,arguments);this.on("change:selected",function(model,isSelected){var topic=isSelected?"selected":"deselected";this.trigger(topic,this);},this);},select:function(){this.set("selected",true);},deselect:function(){this.set("selected",false);},highlight:function(){this.set("highlighted",true);},dehighlight:function(){this.set("highlighted",false);},toggleSelect:function(){this.set("selected",!this.get("selected"));},getLatlng:function(){return this.getLatLng();},getLatLng:function(){return new google.maps.LatLng(this.get("lat"),this.get("lng"));}});GoogleMaps.LocationCollection=Backbone.Collection.extend({constructor:function(opt_models,opt_options){var options=_.defaults({},opt_options,{model:GoogleMaps.Location});options.model||(options.model=GoogleMaps.Location);Backbone.Collection.prototype.constructor.call(this,opt_models,options);this.on("change:selected",function(selectedModel,isSelected){if(isSelected){this.each(function(model){if(selectedModel.cid!==model.cid){model.deselect();}});}},this);}});GoogleMaps.MapView=Backbone.View.extend({constructor:function(options){_.bindAll(this,'render','close');this.mapEvents=this.mapEvents||{};this.overlayOptions=this.overlayOptions||{};Backbone.View.prototype.constructor.apply(this,arguments);this.options=options;if(!google||!google.maps)throw new Error("Google maps API is not loaded.");if(!this.options.map&&!this.map)throw new Error("A map must be specified.");this.gOverlay=this.map=this.options.map||this.map;_.extend(this.overlayOptions,this.options.overlayOptions);},bindMapEvents:function(mapEvents,opt_context){var context=opt_context||this;mapEvents||(mapEvents=this.mapEvents);_.each(mapEvents,function(handlerRef,topic){var handler=this._getHandlerFromReference(handlerRef);this._addGoogleMapsListener(topic,handler,context);},this);},_getHandlerFromReference:function(handlerRef){var handler=_.isString(handlerRef)?this[handlerRef]:handlerRef;if(!_.isFunction(handler)){throw new Error("Unable to bind map event. "+handlerRef+" is not a valid event handler method");}
return handler;},_addGoogleMapsListener:function(topic,handler,opt_context){if(opt_context){handler=_.bind(handler,opt_context);}
google.maps.event.addListener(this.gOverlay,topic,handler);},render:function(){this.trigger('before:render');if(this.beforeRender){this.beforeRender();}
this.bindMapEvents();this.trigger('render');if(this.onRender){this.onRender();}
return this;},close:function(){this.trigger('before:close');if(this.beforeClose){this.beforeClose();}
google.maps.event.clearInstanceListeners(this.gOverlay);if(this.gOverlay.setMap){this.gOverlay.setMap(null);}
this.gOverlay=null;this.trigger('close');if(this.onClose){this.onClose();}}});GoogleMaps.InfoWindow=GoogleMaps.MapView.extend({constructor:function(){GoogleMaps.MapView.prototype.constructor.apply(this,arguments);_.bindAll(this,'render','close');if(!this.options.marker&&!this.marker)throw new Error("A marker must be specified for InfoWindow view.");this.marker=this.options.marker||this.marker;this.template=this.template||this.options.template;},render:function(){this.trigger('before:render');if(this.beforeRender){this.beforeRender();}
GoogleMaps.MapView.prototype.render.apply(this,arguments);var tmpl=(this.template)?$(this.template).html():'<h2><%=title %></h2>';this.$el.html(_.template(tmpl,this.model.toJSON()));this.gOverlay=new google.maps.InfoWindow(_.extend({content:this.$el[0]},this.overlayOptions));this.gOverlay.open(this.map,this.marker);this.trigger('render');if(this.onRender){this.onRender();}
return this;},close:function(){this.trigger('before:close');if(this.beforeClose){this.beforeClose();}
GoogleMaps.MapView.prototype.close.apply(this,arguments);this.trigger('close');if(this.onClose){this.onClose();}
return this;}});GoogleMaps.MarkerView=GoogleMaps.MapView.extend({constructor:function(){this.infoWindow=this.infoWindow||GoogleMaps.InfoWindow;GoogleMaps.MapView.prototype.constructor.apply(this,arguments);_.bindAll(this,'render','close','openDetail','closeDetail','toggleSelect');if(!this.model)throw new Error("A model must be specified for a MarkerView");this.gOverlay=new google.maps.Marker(_.extend({position:this.model.getLatLng(),map:this.map,title:this.model.get('title'),animation:google.maps.Animation.DROP,visible:false},this.overlayOptions));_.extend(this.mapEvents,{'click':'toggleSelect'});this.model.on("change:selected",function(model,isSelected){if(isSelected){this.openDetail();}
else{this.closeDetail();}},this);this.model.on("change:lat change:lng",this.refreshOverlay,this);this.bindMapEvents({'position_changed':'updateModelPosition'});},refreshOverlay:function(){if(!this.model.getLatLng().equals(this.gOverlay.getPosition())){this.gOverlay.setOptions({position:this.model.getLatLng()});}},updateModelPosition:function(){var newPosition=this.gOverlay.getPosition();if(!this.model.getLatLng().equals(newPosition)){this.model.set({lat:newPosition.lat(),lng:newPosition.lng()});}},toggleSelect:function(){this.model.toggleSelect();},render:function(){this.trigger('before:render');if(this.beforeRender){this.beforeRender();}
GoogleMaps.MapView.prototype.render.apply(this,arguments);this.gOverlay.setVisible(true);this.trigger('render');if(this.onRender){this.onRender();}
return this;},close:function(){this.trigger('before:close');if(this.beforeClose){this.beforeClose();}
this.closeDetail();GoogleMaps.MapView.prototype.close.apply(this,arguments);this.model.off();this.trigger('close');if(this.onClose){this.onClose()}
return this;},openDetail:function(){this.detailView=new this.infoWindow({model:this.model,map:this.map,marker:this.gOverlay});this.detailView.render();},closeDetail:function(){if(this.detailView){this.detailView.close();this.detailView=null;}}});GoogleMaps.MarkerCollectionView=Backbone.View.extend({constructor:function(options){this.markerView=this.markerView||GoogleMaps.MarkerView;this.markerViewChildren=this.markerViewChildren||{};Backbone.View.prototype.constructor.apply(this,arguments);this.options=options;_.bindAll(this,'render','closeChildren','closeChild','addChild','refresh','close');if(!this.options.map&&!this.map)throw new Error("A map must be specified on MarkerCollectionView instantiation");this.map||(this.map=this.options.map);this.collection.on("reset",this.refresh,this);this.collection.on("add",this.addChild,this);this.collection.on("remove",this.closeChild,this);},render:function(collection){var collection=collection||this.collection;this.trigger('before:render');if(this.beforeRender){this.beforeRender();}
collection.each(this.addChild);this.trigger('render');if(this.onRender){this.onRender();}
return this;},closeChildren:function(){for(var cid in this.markerViewChildren){this.closeChild(this.markerViewChildren[cid]);}},closeChild:function(child){var childView=(child instanceof Backbone.Model)?this.markerViewChildren[child.cid]:child;childView.close();delete this.markerViewChildren[childView.model.cid];},addChild:function(childModel){var markerView=new this.markerView({model:childModel,map:this.map});this.markerViewChildren[childModel.cid]=markerView;markerView.render();},refresh:function(){this.closeChildren();this.render();},close:function(){this.closeChildren();this.collection.off();}});Backbone.GoogleMaps=GoogleMaps;return GoogleMaps;}));(function(factory){if(typeof exports=="object"){module.exports=factory(require("underscore"),require("backbone"));}
else if(typeof define=="function"&&define.amd){define(["underscore","backbone"],factory);}
else if(typeof _!=="undefined"&&typeof Backbone!=="undefined"){var oldPageableCollection=Backbone.PageableCollection;var PageableCollection=factory(_,Backbone);Backbone.PageableCollection.noConflict=function(){Backbone.PageableCollection=oldPageableCollection;return PageableCollection;};}}(function(_,Backbone){"use strict";var _extend=_.extend;var _omit=_.omit;var _clone=_.clone;var _each=_.each;var _pick=_.pick;var _contains=_.contains;var _isEmpty=_.isEmpty;var _pairs=_.pairs;var _invert=_.invert;var _isArray=_.isArray;var _isFunction=_.isFunction;var _isObject=_.isObject;var _keys=_.keys;var _isUndefined=_.isUndefined;var _result=_.result;var ceil=Math.ceil;var floor=Math.floor;var max=Math.max;var BBColProto=Backbone.Collection.prototype;function finiteInt(val,name){if(!_.isNumber(val)||_.isNaN(val)||!_.isFinite(val)||~~val!==val){throw new TypeError("`"+name+"` must be a finite integer");}
return val;}
function queryStringToParams(qs){var kvp,k,v,ls,params={},decode=decodeURIComponent;var kvps=qs.split('&');for(var i=0,l=kvps.length;i<l;i++){var param=kvps[i];kvp=param.split('='),k=kvp[0],v=kvp[1]||true;k=decode(k),v=decode(v),ls=params[k];if(_isArray(ls))ls.push(v);else if(ls)params[k]=[ls,v];else params[k]=v;}
return params;}
function runOnceAtLastHandler(col,event,func){var eventHandlers=col._events[event];if(eventHandlers&&eventHandlers.length){var lastHandler=eventHandlers[eventHandlers.length-1];var oldCallback=lastHandler.callback;lastHandler.callback=function(){try{oldCallback.apply(this,arguments);func();}
catch(e){throw e;}
finally{lastHandler.callback=oldCallback;}};}
else func();}
var PARAM_TRIM_RE=/[\s'"]/g;var URL_TRIM_RE=/[<>\s'"]/g;var PageableCollection=Backbone.PageableCollection=Backbone.Collection.extend({state:{firstPage:1,lastPage:null,currentPage:null,pageSize:25,totalPages:null,totalRecords:null,sortKey:null,order:-1},mode:"server",queryParams:{currentPage:"page",pageSize:"per_page",totalPages:"total_pages",totalRecords:"total_entries",sortKey:"sort_by",order:"order",directions:{"-1":"asc","1":"desc"}},constructor:function(models,options){BBColProto.constructor.apply(this,arguments);options=options||{};var mode=this.mode=options.mode||this.mode||PageableProto.mode;var queryParams=_extend({},PageableProto.queryParams,this.queryParams,options.queryParams||{});queryParams.directions=_extend({},PageableProto.queryParams.directions,this.queryParams.directions,queryParams.directions||{});this.queryParams=queryParams;var state=this.state=_extend({},PageableProto.state,this.state,options.state||{});state.currentPage=state.currentPage==null?state.firstPage:state.currentPage;if(!_isArray(models))models=models?[models]:[];models=models.slice();if(mode!="server"&&state.totalRecords==null&&!_isEmpty(models)){state.totalRecords=models.length;}
this.switchMode(mode,_extend({fetch:false,resetState:false,models:models},options));var comparator=options.comparator;if(state.sortKey&&!comparator){this.setSorting(state.sortKey,state.order,options);}
if(mode!="server"){var fullCollection=this.fullCollection;if(comparator&&options.full){this.comparator=null;fullCollection.comparator=comparator;}
if(options.full)fullCollection.sort();if(models&&!_isEmpty(models)){this.reset(models,_extend({silent:true},options));this.getPage(state.currentPage);models.splice.apply(models,[0,models.length].concat(this.models));}}
this._initState=_clone(this.state);},_makeFullCollection:function(models,options){var properties=["url","model","sync","comparator"];var thisProto=this.constructor.prototype;var i,length,prop;var proto={};for(i=0,length=properties.length;i<length;i++){prop=properties[i];if(!_isUndefined(thisProto[prop])){proto[prop]=thisProto[prop];}}
var fullCollection=new(Backbone.Collection.extend(proto))(models,options);for(i=0,length=properties.length;i<length;i++){prop=properties[i];if(this[prop]!==thisProto[prop]){fullCollection[prop]=this[prop];}}
return fullCollection;},_makeCollectionEventHandler:function(pageCol,fullCol){return function collectionEventHandler(event,model,collection,options){var handlers=pageCol._handlers;_each(_keys(handlers),function(event){var handler=handlers[event];pageCol.off(event,handler);fullCol.off(event,handler);});var state=_clone(pageCol.state);var firstPage=state.firstPage;var currentPage=firstPage===0?state.currentPage:state.currentPage-1;var pageSize=state.pageSize;var pageStart=currentPage*pageSize,pageEnd=pageStart+pageSize;if(event=="add"){var pageIndex,fullIndex,addAt,colToAdd,options=options||{};if(collection==fullCol){fullIndex=fullCol.indexOf(model);if(fullIndex>=pageStart&&fullIndex<pageEnd){colToAdd=pageCol;pageIndex=addAt=fullIndex-pageStart;}}
else{pageIndex=pageCol.indexOf(model);fullIndex=pageStart+pageIndex;colToAdd=fullCol;var addAt=!_isUndefined(options.at)?options.at+pageStart:fullIndex;}
if(!options.onRemove){++state.totalRecords;delete options.onRemove;}
pageCol.state=pageCol._checkState(state);if(colToAdd){colToAdd.add(model,_extend({},options||{},{at:addAt}));var modelToRemove=pageIndex>=pageSize?model:!_isUndefined(options.at)&&addAt<pageEnd&&pageCol.length>pageSize?pageCol.at(pageSize):null;if(modelToRemove){runOnceAtLastHandler(collection,event,function(){pageCol.remove(modelToRemove,{onAdd:true});});}}}
if(event=="remove"){if(!options.onAdd){if(!--state.totalRecords){state.totalRecords=null;state.totalPages=null;}
else{var totalPages=state.totalPages=ceil(state.totalRecords / pageSize);state.lastPage=firstPage===0?totalPages-1:totalPages||firstPage;if(state.currentPage>totalPages)state.currentPage=state.lastPage;}
pageCol.state=pageCol._checkState(state);var nextModel,removedIndex=options.index;if(collection==pageCol){if(nextModel=fullCol.at(pageEnd)){runOnceAtLastHandler(pageCol,event,function(){pageCol.push(nextModel,{onRemove:true});});}
fullCol.remove(model);}
else if(removedIndex>=pageStart&&removedIndex<pageEnd){if(nextModel=fullCol.at(pageEnd-1)){runOnceAtLastHandler(pageCol,event,function(){pageCol.push(nextModel,{onRemove:true});});}
pageCol.remove(model);}}
else delete options.onAdd;}
if(event=="reset"){options=collection;collection=model;if(collection==pageCol&&options.from==null&&options.to==null){var head=fullCol.models.slice(0,pageStart);var tail=fullCol.models.slice(pageStart+pageCol.models.length);fullCol.reset(head.concat(pageCol.models).concat(tail),options);}
else if(collection==fullCol){if(!(state.totalRecords=fullCol.models.length)){state.totalRecords=null;state.totalPages=null;}
if(pageCol.mode=="client"){state.lastPage=state.currentPage=state.firstPage;}
pageCol.state=pageCol._checkState(state);pageCol.reset(fullCol.models.slice(pageStart,pageEnd),_extend({},options,{parse:false}));}}
if(event=="sort"){options=collection;collection=model;if(collection===fullCol){pageCol.reset(fullCol.models.slice(pageStart,pageEnd),_extend({},options,{parse:false}));}}
_each(_keys(handlers),function(event){var handler=handlers[event];_each([pageCol,fullCol],function(col){col.on(event,handler);var callbacks=col._events[event]||[];callbacks.unshift(callbacks.pop());});});};},_checkState:function(state){var mode=this.mode;var links=this.links;var totalRecords=state.totalRecords;var pageSize=state.pageSize;var currentPage=state.currentPage;var firstPage=state.firstPage;var totalPages=state.totalPages;if(totalRecords!=null&&pageSize!=null&&currentPage!=null&&firstPage!=null&&(mode=="infinite"?links:true)){totalRecords=finiteInt(totalRecords,"totalRecords");pageSize=finiteInt(pageSize,"pageSize");currentPage=finiteInt(currentPage,"currentPage");firstPage=finiteInt(firstPage,"firstPage");if(pageSize<1){throw new RangeError("`pageSize` must be >= 1");}
totalPages=state.totalPages=ceil(totalRecords / pageSize);if(firstPage<0||firstPage>1){throw new RangeError("`firstPage must be 0 or 1`");}
state.lastPage=firstPage===0?max(0,totalPages-1):totalPages||firstPage;if(mode=="infinite"){if(!links[currentPage+'']){throw new RangeError("No link found for page "+currentPage);}}
else if(currentPage<firstPage||(totalPages>0&&(firstPage?currentPage>totalPages:currentPage>=totalPages))){throw new RangeError("`currentPage` must be firstPage <= currentPage "+
(firstPage?">":">=")+" totalPages if "+firstPage+"-based. Got "+
currentPage+'.');}}
return state;},setPageSize:function(pageSize,options){pageSize=finiteInt(pageSize,"pageSize");options=options||{first:false};var state=this.state;var totalPages=ceil(state.totalRecords / pageSize);var currentPage=totalPages?max(state.firstPage,floor(totalPages*state.currentPage / state.totalPages)):state.firstPage;state=this.state=this._checkState(_extend({},state,{pageSize:pageSize,currentPage:options.first?state.firstPage:currentPage,totalPages:totalPages}));return this.getPage(state.currentPage,_omit(options,["first"]));},switchMode:function(mode,options){if(!_contains(["server","client","infinite"],mode)){throw new TypeError('`mode` must be one of "server", "client" or "infinite"');}
options=options||{fetch:true,resetState:true};var state=this.state=options.resetState?_clone(this._initState):this._checkState(_extend({},this.state));this.mode=mode;var self=this;var fullCollection=this.fullCollection;var handlers=this._handlers=this._handlers||{},handler;if(mode!="server"&&!fullCollection){fullCollection=this._makeFullCollection(options.models||[],options);fullCollection.pageableCollection=this;this.fullCollection=fullCollection;var allHandler=this._makeCollectionEventHandler(this,fullCollection);_each(["add","remove","reset","sort"],function(event){handlers[event]=handler=_.bind(allHandler,{},event);self.on(event,handler);fullCollection.on(event,handler);});fullCollection.comparator=this._fullComparator;}
else if(mode=="server"&&fullCollection){_each(_keys(handlers),function(event){handler=handlers[event];self.off(event,handler);fullCollection.off(event,handler);});delete this._handlers;this._fullComparator=fullCollection.comparator;delete this.fullCollection;}
if(mode=="infinite"){var links=this.links={};var firstPage=state.firstPage;var totalPages=ceil(state.totalRecords / state.pageSize);var lastPage=firstPage===0?max(0,totalPages-1):totalPages||firstPage;for(var i=state.firstPage;i<=lastPage;i++){links[i]=this.url;}}
else if(this.links)delete this.links;return options.fetch?this.fetch(_omit(options,"fetch","resetState")):this;},hasPreviousPage:function(){var state=this.state;var currentPage=state.currentPage;if(this.mode!="infinite")return currentPage>state.firstPage;return!!this.links[currentPage-1];},hasNextPage:function(){var state=this.state;var currentPage=this.state.currentPage;if(this.mode!="infinite")return currentPage<state.lastPage;return!!this.links[currentPage+1];},getFirstPage:function(options){return this.getPage("first",options);},getPreviousPage:function(options){return this.getPage("prev",options);},getNextPage:function(options){return this.getPage("next",options);},getLastPage:function(options){return this.getPage("last",options);},getPage:function(index,options){var mode=this.mode,fullCollection=this.fullCollection;options=options||{fetch:false};var state=this.state,firstPage=state.firstPage,currentPage=state.currentPage,lastPage=state.lastPage,pageSize=state.pageSize;var pageNum=index;switch(index){case"first":pageNum=firstPage;break;case"prev":pageNum=currentPage-1;break;case"next":pageNum=currentPage+1;break;case"last":pageNum=lastPage;break;default:pageNum=finiteInt(index,"index");}
this.state=this._checkState(_extend({},state,{currentPage:pageNum}));options.from=currentPage,options.to=pageNum;var pageStart=(firstPage===0?pageNum:pageNum-1)*pageSize;var pageModels=fullCollection&&fullCollection.length?fullCollection.models.slice(pageStart,pageStart+pageSize):[];if((mode=="client"||(mode=="infinite"&&!_isEmpty(pageModels)))&&!options.fetch){this.reset(pageModels,_omit(options,"fetch"));return this;}
if(mode=="infinite")options.url=this.links[pageNum];return this.fetch(_omit(options,"fetch"));},getPageByOffset:function(offset,options){if(offset<0){throw new RangeError("`offset must be > 0`");}
offset=finiteInt(offset);var page=floor(offset / this.state.pageSize);if(this.state.firstPage!==0)page++;if(page>this.state.lastPage)page=this.state.lastPage;return this.getPage(page,options);},sync:function(method,model,options){var self=this;if(self.mode=="infinite"){var success=options.success;var currentPage=self.state.currentPage;options.success=function(resp,status,xhr){var links=self.links;var newLinks=self.parseLinks(resp,_extend({xhr:xhr},options));if(newLinks.first)links[self.state.firstPage]=newLinks.first;if(newLinks.prev)links[currentPage-1]=newLinks.prev;if(newLinks.next)links[currentPage+1]=newLinks.next;if(success)success(resp,status,xhr);};}
return(BBColProto.sync||Backbone.sync).call(self,method,model,options);},parseLinks:function(resp,options){var links={};var linkHeader=options.xhr.getResponseHeader("Link");if(linkHeader){var relations=["first","prev","next"];_each(linkHeader.split(","),function(linkValue){var linkParts=linkValue.split(";");var url=linkParts[0].replace(URL_TRIM_RE,'');var params=linkParts.slice(1);_each(params,function(param){var paramParts=param.split("=");var key=paramParts[0].replace(PARAM_TRIM_RE,'');var value=paramParts[1].replace(PARAM_TRIM_RE,'');if(key=="rel"&&_contains(relations,value))links[value]=url;});});}
return links;},parse:function(resp,options){var newState=this.parseState(resp,_clone(this.queryParams),_clone(this.state),options);if(newState)this.state=this._checkState(_extend({},this.state,newState));return this.parseRecords(resp,options);},parseState:function(resp,queryParams,state,options){if(resp&&resp.length===2&&_isObject(resp[0])&&_isArray(resp[1])){var newState=_clone(state);var serverState=resp[0];_each(_pairs(_omit(queryParams,"directions")),function(kvp){var k=kvp[0],v=kvp[1];var serverVal=serverState[v];if(!_isUndefined(serverVal)&&!_.isNull(serverVal))newState[k]=serverState[v];});if(serverState.order){newState.order=_invert(queryParams.directions)[serverState.order]*1;}
return newState;}},parseRecords:function(resp,options){if(resp&&resp.length===2&&_isObject(resp[0])&&_isArray(resp[1])){return resp[1];}
return resp;},fetch:function(options){options=options||{};var state=this._checkState(this.state);var mode=this.mode;if(mode=="infinite"&&!options.url){options.url=this.links[state.currentPage];}
var data=options.data||{};var url=_result(options,"url")||_result(this,"url")||'';var qsi=url.indexOf('?');if(qsi!=-1){_extend(data,queryStringToParams(url.slice(qsi+1)));url=url.slice(0,qsi);}
options.url=url;options.data=data;var queryParams=this.mode=="client"?_pick(this.queryParams,"sortKey","order"):_omit(_pick(this.queryParams,_keys(PageableProto.queryParams)),"directions");var i,kvp,k,v,kvps=_pairs(queryParams),thisCopy=_clone(this);for(i=0;i<kvps.length;i++){kvp=kvps[i],k=kvp[0],v=kvp[1];v=_isFunction(v)?v.call(thisCopy):v;if(state[k]!=null&&v!=null){data[v]=state[k];}}
if(state.sortKey&&state.order){var o=_isFunction(queryParams.order)?queryParams.order.call(thisCopy):queryParams.order;data[o]=this.queryParams.directions[state.order+""];}
else if(!state.sortKey)delete data[queryParams.order];var extraKvps=_pairs(_omit(this.queryParams,_keys(PageableProto.queryParams)));for(i=0;i<extraKvps.length;i++){kvp=extraKvps[i];v=kvp[1];v=_isFunction(v)?v.call(thisCopy):v;if(v!=null)data[kvp[0]]=v;}
if(mode!="server"){var self=this,fullCol=this.fullCollection;var success=options.success;options.success=function(col,resp,opts){opts=opts||{};if(_isUndefined(options.silent))delete opts.silent;else opts.silent=options.silent;var models=col.models;if(mode=="client")fullCol.reset(models,opts);else{fullCol.add(models,_extend({at:fullCol.length},_extend(opts,{parse:false})));self.trigger("reset",self,opts);}
if(success)success(col,resp,opts);};return BBColProto.fetch.call(this,_extend({},options,{silent:true}));}
return BBColProto.fetch.call(this,options);},_makeComparator:function(sortKey,order,sortValue){var state=this.state;sortKey=sortKey||state.sortKey;order=order||state.order;if(!sortKey||!order)return;if(!sortValue)sortValue=function(model,attr){return model.get(attr);};return function(left,right){var l=sortValue(left,sortKey),r=sortValue(right,sortKey),t;if(order===1)t=l,l=r,r=t;if(l===r)return 0;else if(l<r)return-1;return 1;};},setSorting:function(sortKey,order,options){var state=this.state;state.sortKey=sortKey;state.order=order=order||state.order;var fullCollection=this.fullCollection;var delComp=false,delFullComp=false;if(!sortKey)delComp=delFullComp=true;var mode=this.mode;options=_extend({side:mode=="client"?mode:"server",full:true},options);var comparator=this._makeComparator(sortKey,order,options.sortValue);var full=options.full,side=options.side;if(side=="client"){if(full){if(fullCollection)fullCollection.comparator=comparator;delComp=true;}
else{this.comparator=comparator;delFullComp=true;}}
else if(side=="server"&&!full){this.comparator=comparator;}
if(delComp)this.comparator=null;if(delFullComp&&fullCollection)fullCollection.comparator=null;return this;}});var PageableProto=PageableCollection.prototype;return PageableCollection;}));Handlebars.registerHelper('ifCond',function(v1,operator,v2,options){switch(operator){case'==':return(v1==v2)?options.fn(this):options.inverse(this);case'===':return(v1===v2)?options.fn(this):options.inverse(this);case'<':return(v1<v2)?options.fn(this):options.inverse(this);case'<=':return(v1<=v2)?options.fn(this):options.inverse(this);case'>':return(v1>v2)?options.fn(this):options.inverse(this);case'>=':return(v1>=v2)?options.fn(this):options.inverse(this);case'&&':return(v1&&v2)?options.fn(this):options.inverse(this);case'||':return(v1||v2)?options.fn(this):options.inverse(this);case'!==':return(v1!==v2)?options.fn(this):options.inverse(this);default:return options.inverse(this);}});Handlebars.registerHelper("last",function(array){return array[array.length-1];});Backbone.Marionette.TemplateCache.prototype.compileTemplate=function(rawTemplate){return Handlebars.compile(rawTemplate);};var HotspotsManager=new Marionette.Application();HotspotsManager.navigate=function(route,options){options||(options={});Backbone.history.navigate(route,options);};HotspotsManager.Router=Marionette.AppRouter.extend({routes:{':lat/:lng/:z(/cats/:cats)(/page/:page)(/search/:search)(/hotspot/:hotspot)':'init'},init:function(lat,lng,z,cats,page,search,hotspot){var filter=HotspotsManager.request('filter:entity');HotspotsManager.trigger('map:coordinates',lat,lng,z);if(cats){var catCollection=HotspotsManager.request('category:entities');var catIds=cats.split(';');catCollection.deselectAll();_.each(catIds,function(value){catCollection.select(catCollection.get(value));});}
if(page){filter.set('page',parseInt(page,10))}
if(search){filter.set('search',search);}
if(hotspot){filter.set('hotspot:selected',hotspot);var collection=HotspotsManager.request('hotspots:collection');collection.once('sync',function(){var model=collection.get(hotspot);HotspotsManager.trigger('hotspot:selected',model);});}}});HotspotsManager.getCurrentRoute=function(){return Backbone.history.fragment};HotspotsManager.on('initialize:after',function(options){Backbone.history.start();});HotspotsManager.addInitializer(function(){new HotspotsManager.Router();});jQuery(document).ready(function(){HotspotsManager.start();});HotspotsManager.module("Entities",function(Entities,HotspotsManager,Backbone,Marionette,$,_){Entities.Map=Backbone.Model.extend({defaults:{myLocation:'',mapStartPosition:HotspotsConfig.mapStartPosition,zoom:HotspotsConfig.mapStartZoom,backgroundColor:HotspotsConfig.mapBackgroundColor,mapTypeId:google.maps.MapTypeId[{0:"ROADMAP",1:"ROADMAP",2:"SATELLITE",3:"HYBRID",4:"TERRAIN"}[HotspotsConfig.mapType]],panControl:HotspotsConfig.panControl,panControlOptions:{position:google.maps.ControlPosition[HotspotsConfig.panControlPosition]},zoomControl:HotspotsConfig.zoomControl,zoomControlOptions:{style:google.maps.ZoomControlStyle[HotspotsConfig.zoomControlStyle],position:google.maps.ControlPosition[HotspotsConfig.zoomControlPosition]},mapTypeControl:HotspotsConfig.mapTypeControl,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle[HotspotsConfig.mapTypeControlStyle],position:google.maps.ControlPosition[HotspotsConfig.mapTypeControlPosition]},scaleControl:HotspotsConfig.scaleControl,streetViewControl:HotspotsConfig.streetViewControl,streetViewControlOptions:{position:google.maps.ControlPosition[HotspotsConfig.streetViewPosition]},overviewMapControl:HotspotsConfig.overviewMapControl,scrollwheel:HotspotsConfig.scrollwheel,gestureHandling:HotspotsConfig.gestureHandling,weatherLayer:HotspotsConfig.weatherLayer,weatherTemperatureUnit:HotspotsConfig.weatherTemperatureUnit,trafficLayer:HotspotsConfig.trafficLayer,transitLayer:HotspotsConfig.transitLayer,bicyclingLayer:HotspotsConfig.bicyclingLayer,fullscreenControl:HotspotsConfig.fullscreenControl},setCenter:function(){var self=this,myLocation=this.getMyLocation();if(myLocation){this.geocoder.geocode({'address':myLocation},function(results,status){self.set('center',results[0].geometry.location);});}else{var center=this.get('mapStartPosition'),type;if(((center).replace(/\s+/g,'')).match(/^-?\d+\.\d+\,-?\d+\.\d+$/)){center=(center.replace(/\s+/g,'')).split(',');for(var i=0;i<center.length;i++){center[i]=parseFloat(center[i]);}}
type=typeof center;if(type==='string'){this.geocoder.geocode({'address':center},function(point){if(!point.length){alert(center+" "+this.options.notFound);}else{self.set('center',point[0].geometry.location);}});}
if(type==='object'&&_.isArray(center)){this.set('center',new google.maps.LatLng(center[0],center[1]));}
if(HotspotsConfig.centerType==2&&HotspotsConfig.highAccuracy){navigator.geolocation.getCurrentPosition(function(position){self.set('center',new google.maps.LatLng(position.coords.latitude,position.coords.longitude));});}}},getMyLocation:function(){return $.cookie('hs-my-location');},setMyLocation:function(){$.cookie('hs-my-location',this.get('myLocation'),{expires:7,path:'/'});},initialize:function(){if(HotspotsConfig.styledMaps){try{this.set('styles',JSON.parse(HotspotsConfig.styledMaps));}catch(exception){console.log('Hotspots error: provided map style is incorrect');}}
this.trafficLayer=new google.maps.TrafficLayer();this.transitLayer=new google.maps.TransitLayer();this.bicyclingLayer=new google.maps.BicyclingLayer();this.geocoder=new google.maps.Geocoder();this.svService=new google.maps.StreetViewService();this.on('change:myLocation',this.setMyLocation,this);this.set('myLocation',this.getMyLocation());this.getBounds();},getBounds:function(){if(HotspotsManager.reqres.hasHandler('category:entities')){var cats=HotspotsManager.request('category:entities'),selected=cats.selected,south,west,north,east;if(!_.isEmpty(selected)){cats=new Backbone.Collection(_.values(selected));}
cats.each(function(cat){var bounds=cat.get('boundaries');if(bounds){south=south?Math.min(south,bounds.south):bounds.south;west=west?Math.min(west,bounds.west):bounds.west;north=north?Math.max(north,bounds.north):bounds.north;east=east?Math.max(east,bounds.east):bounds.east;}},this);if(south&&west&&north&&east){this.set('boundaries',new google.maps.LatLngBounds(new google.maps.LatLng(south,west),new google.maps.LatLng(north,east)));}}}});var API={model:false,getMapEntity:function(){if(!this.model){this.model=new Entities.Map()}
return this.model;}};HotspotsManager.reqres.setHandler("map:entity",function(){return API.getMapEntity();});});HotspotsManager.module("Entities",function(Entities,HotspotsManager,Backbone,Marionette,$,_){Entities.Hotspot=Backbone.Model.extend({initialize:function(){var selectable=new Backbone.Picky.Selectable(this);_.extend(this,selectable);},getFormatedAddress:function(){var address=[];address.push(this.get('street'));address.push(this.get('zip'));address.push(this.get('city'));address.push(this.get('state'));address.push(this.get('country'));address=_.uniq(_.compact(address));return address;}});Entities.HotspotCollection=Backbone.PageableCollection.extend({mode:"server",model:Entities.Hotspot,initialize:function(options){var self=this,filter=HotspotsManager.request('filter:entity');this.state.currentPage=filter.get('page');this.listenTo(filter,'change:page',function(model,page){page=page||1;self.getPage(parseInt(page,10));self.trigger("page:change:after");});filter.on('change:search',function(){self.fs=filter.get('search')?1:0;});var singleSelect=new Backbone.Picky.SingleSelect(this);_.extend(this,singleSelect);},url:function(params){var filter=HotspotsManager.request('filter:entity');var query=['option=com_hotspots','view=jsonv4','task=gethotspots','hs-language='+HotspotsConfig.language];return HotspotsConfig.baseUrl+'?'+query.join('&');},state:{pageSize:HotspotsConfig.listLength,pagesInRange:1},queryParams:{'search':function(){var filter=HotspotsManager.request('filter:entity');if(filter.get('search')){return filter.get('search');}},'cat':function(){var filter=HotspotsManager.request('filter:entity');return filter.getCatIds().join(';');},'level':function(){var filter=HotspotsManager.request('filter:entity');return filter.get('level')},'ne':function(){var filter=HotspotsManager.request('filter:entity');return filter.get('ne');},'sw':function(){var filter=HotspotsManager.request('filter:entity');return filter.get('sw');},'c':function(){var filter=HotspotsManager.request('filter:entity');return filter.get('center').toUrlValue();},'fs':function(){var filter=HotspotsManager.request('filter:entity');return filter.hasChanged('search')?1:0;},'offset':function(){var filter=HotspotsManager.request('filter:entity');return this.state.currentPage*this.state.pageSize-this.state.pageSize;},'format':'raw'},setPagination:function(info){var pages=[],i=0,l=0;var ADJACENTx2=info.pagesInRange*2,LASTPAGE=info.totalPages;if(LASTPAGE>1){if(LASTPAGE<=(1+ADJACENTx2)){for(i=1,l=LASTPAGE;i<=l;i++){pages.push(i);}}
else{if(info.currentPage<=(info.pagesInRange+1)){for(i=1,l=2+ADJACENTx2;i<l;i++){pages.push(i);}}
else if(LASTPAGE-info.pagesInRange>info.currentPage&&info.currentPage>info.pagesInRange){for(i=info.currentPage-info.pagesInRange;i<=info.currentPage+info.pagesInRange;i++){pages.push(i);}}
else{for(i=LASTPAGE-ADJACENTx2;i<=LASTPAGE;i++){pages.push(i);}}}}
return pages;},parseState:function(resp,queryParams,state,options){var filter=HotspotsManager.request('filter:entity');filter.set('total',resp.total_entries);return{totalRecords:resp.total_entries};},parseRecords:function(resp,xhr){var cats=HotspotsManager.request('category:entities'),hotspots=resp.items;if(resp.boundaries)
{HotspotsManager.trigger('hotspots:newboundaries',resp.boundaries)}
hotspots.forEach(function(hotspot,key){if(!hotspot.icon){hotspot.icon=cats.get(hotspot.catid).get('cat_icon');}});return hotspots;}});var API={request:false,collection:false,getCollection:function(){if(!this.collection){this.collection=new Entities.HotspotCollection;}
return this.collection;},getHotspotEntities:function(options){var hotspots=this.getCollection();if(this.request&&this.request.readyState>0&&this.request.readyState<4){this.request.abort();}
var defer=$.Deferred();this.request=hotspots.fetch({success:function(data){defer.resolve(data);}});return defer.promise();}};HotspotsManager.reqres.setHandler("hotspots:entities",function(options){return API.getHotspotEntities(options);});HotspotsManager.reqres.setHandler("hotspots:collection",function(){return API.getCollection();});});HotspotsManager.module("Entities",function(Entities,HotspotsManager,Backbone,Marionette,$,_){Entities.TabCollection=Backbone.Collection.extend();var initTabEntities=function(){Entities.tabs=new Entities.TabCollection(HotspotsConfig.tabs);};var API={getTabs:function(){if(Entities.tabs===undefined){initTabEntities();}
return Entities.tabs;}};HotspotsManager.reqres.setHandler("tab:entities",function(){return API.getTabs();});});HotspotsManager.module("Entities",function(Entities,HotspotsManager,Backbone,Marionette,$,_){Entities.Category=Backbone.Model.extend({initialize:function(){var selectable=new Backbone.Picky.Selectable(this);_.extend(this,selectable);}});Entities.CategoryCollection=Backbone.Collection.extend({model:Entities.Category,initialize:function(){var MultiSelect=new Backbone.Picky.MultiSelect(this);_.extend(this,MultiSelect);}});var API={active:false,getCategoryEntities:function(){if(!this.active){this.active=new Entities.CategoryCollection(HotspotsConfig.categories);HotspotsConfig.startCat.forEach(function(value){this.active.select(this.active.get(value));},this);}
return this.active;}};HotspotsManager.reqres.setHandler("category:entities",function(){return API.getCategoryEntities();});});HotspotsManager.module("Entities",function(Entities,HotspotsManager,Backbone,Marionette,$,_){Entities.Direction=Backbone.Model.extend({defaults:{origin:'',originDisplayName:'',destination:'',destinationDisplayName:'',waypoints:[],mode:'DRIVING',units:'METRIC',avoidHighways:false,avoidTolls:false},validation:{origin:{required:true,message:HotspotsConfig.translations.enterValidAddress}},initialize:function(){this.on('change:origin',function(model,value){var self=this;if(typeof value==='object'){this.set('origin',new google.maps.LatLng(value.lat,value.lng),{silent:true});if(value.name.length){this.set('originDisplayName',value.name,{silent:true});}else{var geocoder=new google.maps.Geocoder();geocoder.geocode({location:{lat:value.lat,lng:value.lng}},function(results,status){if(status==google.maps.GeocoderStatus.OK){self.set('originDisplayName',results[0].formatted_address,{silent:true});}});}}else{this.set('originDisplayName',value);}});this.on('change:destination',function(model,value){var self=this;if(typeof value==='object'){this.set('destination',new google.maps.LatLng(value.lat,value.lng),{silent:true});if(value.name.length){this.set('destinationDisplayName',value.name,{silent:true});}else{var geocoder=new google.maps.Geocoder();geocoder.geocode({location:{lat:value.lat,lng:value.lng}},function(results,status){if(status==google.maps.GeocoderStatus.OK){self.set('destinationDisplayName',results[0].formatted_address,{silent:true});}});}}else{this.set('destinationDisplayName',value);}});},searchAddress:function(){var geocoder=new google.maps.Geocoder();geocoder.geocode({'address':this.get('origin')},function(results,status){HotspotsManager.trigger('directions:address',results,status);});},searchDirections:function(){var directions=new google.maps.DirectionsService();var request={origin:this.get('origin'),destination:this.get('destination'),waypoints:this.get('waypoints'),travelMode:google.maps.DirectionsTravelMode[this.get('mode')],unitSystem:google.maps.UnitSystem[this.get('units')],avoidHighways:this.get('avoidHighways'),avoidTolls:this.get('avoidTolls')};directions.route(request,function(result,status){HotspotsManager.trigger('directions:directions',result,status);});}});var API={renderer:false,entity:false,getDirectionEntity:function(){if(!this.entity){this.entity=new Entities.Direction();}
return this.entity;},getDirectionRenderer:function(){if(!this.renderer){this.renderer=new google.maps.DirectionsRenderer({draggable:true});}
return this.renderer;}};HotspotsManager.reqres.setHandler("direction:entity",function(){return API.getDirectionEntity();});HotspotsManager.reqres.setHandler("direction:renderer",function(){return API.getDirectionRenderer();});});HotspotsManager.module("Entities",function(Entities,HotspotsManager,Backbone,Marionette,$,_){Entities.Filter=Backbone.Model.extend({defaults:{search:'',total:0},initialize:function(){var cats=HotspotsManager.request('category:entities');this.set('cats',cats.selected);},getCatIds:function(){var cats=[];_.each(this.get('cats'),function(value){cats.push(value.get('id'));});return cats;}});var API={filter:false,getFilterEntity:function(options){if(!this.filter){this.filter=new Entities.Filter(options);}
return this.filter;}};HotspotsManager.reqres.setHandler("filter:entity",function(options){return API.getFilterEntity(options);});this.listenTo(HotspotsManager,"map:init",function(map){var filter=API.getFilterEntity();var b=map.getBounds();filter.set('level',map.getZoom());filter.set('ne',b.getNorthEast().toUrlValue());filter.set('sw',b.getSouthWest().toUrlValue());filter.set('center',map.getCenter());filter.set('zoom',map.getZoom());filter.set('offset',false);HotspotsManager.trigger('filter:changed',filter);});this.listenTo(HotspotsManager,"map:changedposition",function(map){var filter=API.getFilterEntity();var b=map.getBounds();filter.set('level',map.getZoom());filter.set('ne',b.getNorthEast().toUrlValue());filter.set('sw',b.getSouthWest().toUrlValue());filter.set('center',map.getCenter());filter.set('zoom',map.getZoom());filter.unset('page');HotspotsManager.trigger('filter:changed',filter);HotspotsManager.trigger('filter:updated',filter);});this.listenTo(HotspotsManager,"marker:selected",function(model,isSelected){var filter=API.getFilterEntity();filter.set('hotspot:selected',model.get('id'));HotspotsManager.trigger('filter:updated',filter);});this.listenTo(HotspotsManager,'hotspots:page',function(page){var filter=API.getFilterEntity();filter.set('page',page);filter.unset('hotspot:selected');HotspotsManager.trigger('filter:updated',filter);});this.listenTo(HotspotsManager,"filter:search",function(){var filter=API.getFilterEntity();HotspotsManager.trigger('filter:updated',filter);});this.listenTo(HotspotsManager,"search:newboundaries",function(n,e,s,w){var filter=API.getFilterEntity();filter.set('ne',b.getNorthEast().toUrlValue());filter.set('sw',b.getSouthWest().toUrlValue());HotspotsManager.trigger('filter:updated',filter);})});HotspotsManager.module("Entities",function(Entities,HotspotsManager,Backbone,Marionette,$,_){Entities.Marker=Backbone.GoogleMaps.Location.extend({});Entities.MarkerCollection=Backbone.Collection.extend({model:Entities.Marker,coord:{x:0,y:0},url:function(){var map=HotspotsManager.request('map:object'),filter=HotspotsManager.request('filter:entity'),zoom=map.mapObj.getZoom(),categories=filter.getCatIds().join(';'),search=filter.get('search'),params=['x='+this.coord.x,'y='+this.coord.y,'z='+zoom,'hs-language='+HotspotsConfig.language];if(categories){params.push('cats='+categories);}
if(search){params.push('search='+search);}
return HotspotsConfig.baseUrl+'?option=com_hotspots&view=tile&format=json&'+params.join('&');}});var entity;var API={getMarkerCollection:function(){return new Entities.MarkerCollection();},getMarkerEntity:function(){if(!entity)
{entity=new Entities.Marker(HotspotsMarker);}
return entity;}};HotspotsManager.reqres.setHandler("marker:collection",function(options){return API.getMarkerCollection();});HotspotsManager.reqres.setHandler("marker:entity",function(){return API.getMarkerEntity();});});HotspotsManager.module("Entities",function(Entities,HotspotsManager,Backbone,Marionette,$,_){Entities.Mail=Backbone.Model.extend({defaults:{mailto:'',sender:'',message:'',sent:false,url:Backbone.history.location.href},validation:{mailto:{required:true,format:'email',message:'Does not match format'},message:{required:true,minLength:10},subject:{required:true,minLength:5}},url:function(){return HotspotsConfig.rootUrl+'?option=com_hotspots&task=mail.send&format=raw'},sync:_.wrap(Backbone.sync,function(sync,method,model,options){this.set('url',Backbone.history.location.href);var newOptions=_.extend(options,{emulateJSON:true,emulateHTTP:true});return sync(method,model,newOptions);})});var API={getMail:function(){return new Entities.Mail();}};HotspotsManager.reqres.setHandler("mail:entity",function(){return API.getMail();});});HotspotsManager.module("Common.Views",function(Views,ContactManager,Backbone,Marionette,$,_){Views.PaginatedView=Marionette.Layout.extend({template:"#paginated-view",regions:{paginationControlsRegionTop:"#js-pagination-controls-top",paginationControlsRegionBottom:"#js-pagination-controls-bottom",paginationMainRegion:".js-pagination-main"},initialize:function(options){var self=this,listView,topControls,bottomControls;this.collection=options.collection;this.listenTo(this.collection,'request',this.loading);this.listenTo(this.collection,'sync',this.hide);this.listenTo(this.collection,'error',this.hide);listView=new options.mainView({collection:this.collection});topControls=new Views.PaginationControls({paginatedCollection:this.collection});bottomControls=new Views.PaginationControls({paginatedCollection:this.collection});this.listenTo(topControls,'page:change',function(page){self.trigger('page:change',page);});this.listenTo(bottomControls,'page:change',function(page){self.trigger('page:change',page);});this.on("show",function(){this.paginationControlsRegionTop.show(bottomControls);this.paginationControlsRegionBottom.show(topControls);this.paginationMainRegion.show(listView);});},loading:function(){this.$el.addClass('hs-loading');},hide:function(){this.$el.removeClass('hs-loading');}});Views.PaginationControls=Marionette.ItemView.extend({template:"#pagination-controls",className:"pagination pagination-mini text-center",events:{'click a[class=navigatable]':'navigateToPage'},initialize:function(options){this.paginatedCollection=options.paginatedCollection;this.listenTo(this.paginatedCollection,'sync',this.render);this.listenTo(this.paginatedCollection,"page:change:after",this.render);},navigateToPage:function(e){e.preventDefault();var page=parseInt($(e.target).data('page'),10);HotspotsManager.trigger('hotspots:page',page);this.trigger('page:change',page);},serializeData:function(){var info=_.clone(this.paginatedCollection.state);info.pageSet=this.paginatedCollection.setPagination(info);if(info.currentPage>1){info.previous=info.currentPage-1;}
if(info.currentPage<info.totalPages){info.next=info.currentPage+1;}
return info;}});Views.Loading=Marionette.ItemView.extend({template:"#loading-view",className:'hs-init-loading'});});HotspotsManager.module("Common.MapApp",function(MapApp,HotspotsManager,Backbone,Marionette,$,_){MapApp.MapView=Backbone.View.extend({template:'#map-template',id:'map'});MapApp.Map=Marionette.ItemView.extend({tagName:"div",template:'#main-map-template',id:'map-container',className:'hs-map-container',widthRestriction:0,events:{'click .js-hs-fullscreen-toggle':function(e){e.stopPropagation();HotspotsManager.trigger('map:fullscreen');var span=$(e.currentTarget).find('span');if(span.hasClass('fa-expand')){span.removeClass('fa-expand').addClass('fa-compress');}else{span.removeClass('fa-compress').addClass('fa-expand');}
this.resize();google.maps.event.trigger(this.mapObj,'resize');},'click .js-hs-geocode-center':'findUserPosition','click .js-hs-hotspots-share-mail':function(){HotspotsManager.trigger('share:mail');}},modelEvents:{'change:weatherLayer':function(){this.weather();},'change:trafficLayer':function(){this.setLayer('trafficLayer')},'change:transitLayer':function(){this.setLayer('transitLayer')},'change:bicyclingLayer':function(){this.setLayer('bicyclingLayer')},'change:center':function(){this.mapObj.setCenter(this.model.get('center'));},'change:zoom':function(){this.mapObj.setZoom(this.model.get('zoom'));}},kmlLayers:[],initialize:function(){var self=this;this.mapView=new MapApp.MapView();this.mapObj=new google.maps.Map(this.mapView.el,this.model.toJSON());HotspotsManager.on('directions:directions',function(results,status){self.renderDirections(results,status);});HotspotsManager.on('directions:clear',function(){self.clearDirections();});this.addCustomButtons();},addCustomButtons:function(){var topRight=document.createElement('div');topRight.innerHTML=$('#hs-fullscreen-template').html();topRight.index=-1;this.mapObj.controls[google.maps.ControlPosition.TOP_RIGHT].push(topRight);var rightBottom=document.createElement('div');rightBottom.innerHTML=$('#hs-action-buttons-map-template').html();rightBottom.index=-1;this.mapObj.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(rightBottom);},renderDirections:function(results,status){var directionsDisplay=HotspotsManager.request('direction:renderer');directionsDisplay.setMap(this.mapObj);},clearDirections:function(){var directionsDisplay=HotspotsManager.request('direction:renderer');directionsDisplay.setMap(null);},onRender:function(){this.$el.html(this.mapView.el);},onShow:function(){this.resize();},weather:function(){HotspotsManager.trigger('weather:toggle',this.mapObj);},setLayer:function(name){if(this.model.get(name)){this.model[name].setMap(this.mapObj);}
else{this.model[name].setMap(null);}},setWidthRestriction:function(width){this.widthRestriction=width;},zoomOnPoint:function(point,zoom){this.mapObj.setCenter(point);this.mapObj.setZoom(zoom);},streetView:function(pano,close){var panorama=this.mapObj.getStreetView();if(close){if(panorama.getVisible()){panorama.setVisible(false);}}else{panorama.setPano(pano);panorama.setVisible(panorama.getVisible()?false:true);}},findUserPosition:function(e){var self=this;$(e.target).removeClass('fa-crosshairs').addClass('fa-refresh fa-spin');navigator.geolocation.getCurrentPosition(function(position){var latlng=new google.maps.LatLng(position.coords.latitude,position.coords.longitude),imgUrl=HotspotsConfig.rootUrl+'/media/com_hotspots/images/v4/icons/bluedot_retina.png';self.zoomOnPoint(latlng,15);$(e.target).removeClass('fa-refresh fa-spin').addClass('fa-crosshairs');var image=new google.maps.MarkerImage(imgUrl,null,null,new google.maps.Point(8,8),new google.maps.Size(17,17));new google.maps.Marker({flat:true,icon:image,optimized:false,position:latlng,map:self.mapObj,title:HotspotsConfig.translations.myLocation,visible:true});setTimeout(function(){self.$el.find('div.gmnoprint:has(img[src="'+imgUrl+'"])').addClass('hs-my-position-dot')},2000)});},showKmlLayers:function(kmls){var self=this;_.each(self.kmlLayers,function(layer){layer.setMap(null);});self.kmlLayers.length=0;_.each(kmls,function(kml){var kmlLayer=new google.maps.KmlLayer(kml.file,{preserveViewport:true});kmlLayer.setMap(self.mapObj);self.kmlLayers.push(kmlLayer);});}});});HotspotsManager.module("AppApp",function(AppApp,HotspotsManager,Backbone,Marionette,$,_){HotspotsManager.on('initialize:before',function(options){var layout=new AppApp.Main.Layout();layout.on('show',function(){if(HotspotsConfig.startFullscreen){HotspotsManager.trigger('map:fullscreen');}});HotspotsManager.mainRegion.show(layout);});});HotspotsManager.module("AppApp.Main",function(Main,HotspotsManager,Backbone,Marionette,$,_){var mainRegion=Backbone.Marionette.Region.extend({el:'#js-hs-main-app',onShow:function(){var height=HotspotsConfig.mapHeight;if(this.$window.height()<HotspotsConfig.mapHeight){height=this.$window.height()}
this.$el.css('height',height+'px');this.resize();},cssCache:{},initialize:function(){var self=this;this.$window=$(window);this.listenTo(HotspotsManager,'map:fullscreen',function(){self.fullScreen();});$(window).resize(function(){self.resize();HotspotsManager.trigger('window:resize');});},resize:function(){if(this.$window.width()<650){$(document.body).addClass('hs-small-device');}else{$(document.body).removeClass('hs-small-device');}
if(this.$el.hasClass('hs-fullscreen'))
{this.$el.height(this.$window.height());}},fullScreen:function(){var self=this,$=jQuery;if(!this.$el.hasClass('hs-fullscreen')){this.$el.addClass('hs-fullscreen');this.cssCache.height=self.$el.height();$(document.body).css('overflow','hidden').addClass('hotspots-fullscreen');this.$el.height($(window).height());}else{this.$el.removeClass('hs-fullscreen');$(document.body).css('overflow','auto').removeClass('hotspots-fullscreen');this.$el.height(self.cssCache.height);}}});HotspotsManager.addRegions({mainRegion:new mainRegion,mapRegion:"#js-map-region",menuRegion:'#js-menu-region',infoWindowRegion:'#js-hs-infowindow-region'});Main.Layout=Marionette.Layout.extend({template:"#js-hs-main-region"});});HotspotsManager.module("MapApp",function(MapApp,HotspotsManager,Backbone,Marionette,$,_){var API={show:function(){var mapModel=HotspotsManager.request('map:entity');if(HotspotsConfig.centerType==1){if(mapModel.get('boundaries')){MapApp.Show.Controller.fitBounds(mapModel.get('boundaries'));}else{mapModel.setCenter();}}else{mapModel.setCenter();}
MapApp.Show.Controller.show();this.tiles();},markers:function(hotspots){MapApp.Markers.Controller.draw(hotspots);},weather:function(map){var model=HotspotsManager.request('map:entity');if(model.get('weatherLayer'))
{MapApp.Weather&&MapApp.Weather.Controller.draw(map);}},weatherToggle:function(map){MapApp.Weather&&MapApp.Weather.Controller.toggle(map);},address:function(results,status){MapApp.Markers.Controller.renderAddress(results,status);},coordinates:function(lat,lng,z)
{var mapModel=HotspotsManager.request('map:entity');mapModel.set('center',new google.maps.LatLng(lat,lng));mapModel.set('zoom',parseInt(z,10));MapApp.Show.Controller.show();this.tiles();},clearAddress:function(){MapApp.Markers.Controller.clearAddressMarker();},setWidthRestriction:function(type,menuView){MapApp.Show.Controller.setWidthRestriction(type,menuView);},markerZoomIn:function(model){MapApp.Show.Controller.zoomInOnModel(model);},markerStreetMap:function(pano){MapApp.Show.Controller.streetView(pano,false);},markerSelected:function(model){MapApp.Show.Controller.streetView('',true);MapApp.Markers.Controller.selected(model);},markerHighlighted:function(model){MapApp.Markers.Controller.highlighted(model);},markerDehighlighted:function(model){MapApp.Markers.Controller.dehighlighted(model);},fetchMarkers:function(){MapApp.Markers.Controller.fetchMarkers();},tiles:function(){if(HotspotsConfig.tiles){MapApp.Tiles.Controller.show();}},tilesMarkers:function(collection){MapApp.Tiles.Controller.renderTilesMarkers(collection);},tileMarkerClosed:function(model){MapApp.Tiles.Controller.tileMarkerClosed(model);},kmls:function(collection){MapApp.Show.Controller.kmlLayer(collection.toJSON());},resizeMap:function(){MapApp.Show.Controller.resize();},changeBounds:function(bounds)
{var boundaries=new google.maps.LatLngBounds(new google.maps.LatLng(bounds.s,bounds.w),new google.maps.LatLng(bounds.n,bounds.e))
MapApp.Show.Controller.fitBounds(boundaries);}};this.listenTo(HotspotsManager,"map:show",function(){API.show();});this.listenTo(HotspotsManager,'map:coordinates',function(lat,lng,z){API.coordinates(lat,lng,z);});this.listenTo(HotspotsManager,"filter:search",function(){API.tiles();});this.listenTo(HotspotsManager,"filter:updated",function(filter){var coordinate=filter.get('center').lat().toFixed(7)+'/'+filter.get('center').lng().toFixed(7)+'/'+filter.get('zoom');var cats='';if(!_.isEmpty(filter.get('cats'))){cats='/cats/'+filter.getCatIds().join(';');}
var hotspot='';if(filter.get('hotspot:selected')){hotspot='/hotspot/'+filter.get('hotspot:selected');}
var page='';if(filter.get('page')){page='/page/'+filter.get('page');}
var search='';if(filter.get('search')){search='/search/'+filter.get('search');}
HotspotsManager.navigate(coordinate+cats+page+search+hotspot);});this.listenTo(HotspotsManager,"tiles:markers",function(collection){API.tilesMarkers(collection);});this.listenTo(HotspotsManager,"map:changedposition",function(map){API.weather(map);});this.listenTo(HotspotsManager,"weather:toggle",function(map){API.weatherToggle(map);});this.listenTo(HotspotsManager,"tile:marker:closed",function(model){API.tileMarkerClosed(model);});this.listenTo(HotspotsManager,"kmls:fetched",function(collection){API.kmls(collection);});this.listenTo(HotspotsManager,"hotspots:fetchedData",function(hotspots){return API.markers(hotspots);});this.listenTo(HotspotsManager,'directions:address',function(results,status){API.address(results,status);});this.listenTo(HotspotsManager,'directions:clearAddress',function(){API.clearAddress();});this.listenTo(HotspotsManager,'marker:zoomIn',function(model){API.markerZoomIn(model);});this.listenTo(HotspotsManager,'hotspot:selected',function(model){API.markerSelected(model);});this.listenTo(HotspotsManager,'marker:highlighted',function(model){API.markerHighlighted(model);});this.listenTo(HotspotsManager,'marker:dehighlighted',function(model){API.markerDehighlighted(model);});this.listenTo(HotspotsManager,'marker:streetView',function(pano){API.markerStreetMap(pano);});this.listenTo(HotspotsManager,'initialize:after',function(options){if(HotspotsManager.getCurrentRoute()===""){HotspotsManager.trigger('map:show');}});this.listenTo(HotspotsManager,'menu:slide',function(type,menuView){API.setWidthRestriction(type,menuView);API.resizeMap();});this.listenTo(HotspotsManager,'menu:resized',function(menuView){API.setWidthRestriction(menuView.opened,menuView);});this.listenTo(HotspotsManager,"filter:changed",function(){API.fetchMarkers();});this.listenTo(HotspotsManager,'window:resize',function(){API.resizeMap();});this.listenTo(HotspotsManager,'hotspots:newboundaries',function(bounds){API.changeBounds(bounds);});});HotspotsManager.module("MapApp.Show",function(Show,HotspotsManager,Backbone,Marionette,$,_){var Controller=Marionette.Controller.extend({tiles:[],show:function(){var self=this,view=HotspotsManager.request("map:object");google.maps.event.addListenerOnce(view.mapObj,'tilesloaded',function(){self.lastCenterBounds=self.controlCenterBounds();HotspotsManager.trigger('map:init',view.mapObj);google.maps.event.addListener(view.mapObj,'zoom_changed',function(){HotspotsManager.trigger('map:changedposition',view.mapObj);});google.maps.event.addListener(view.mapObj,'center_changed',function(){self.changePosition();});view.weather();});google.maps.event.addListener(view.mapObj,'mousemove',function(mev){var TILE_SIZE=256,proj=view.mapObj.getProjection(),numTiles=1<<view.mapObj.getZoom(),worldCoordinate=proj.fromLatLngToPoint(mev.latLng),pixelCoordinate=new google.maps.Point(worldCoordinate.x*numTiles,worldCoordinate.y*numTiles),tileCoordinate=new google.maps.Point(Math.floor(pixelCoordinate.x / TILE_SIZE),Math.floor(pixelCoordinate.y / TILE_SIZE)),coord=tileCoordinate.x+","+tileCoordinate.y+','+view.mapObj.getZoom();if(!self.tiles[coord]){HotspotsManager.trigger('tiles:mousemove',coord,tileCoordinate);self.tiles[coord]=true;}});['trafficLayer','transitLayer','bicyclingLayer'].forEach(function(layer){view.setLayer(layer);});HotspotsManager.mapRegion.show(view);},changePosition:function(){var self=this,view=HotspotsManager.request("map:object"),gmbounds=view.mapObj.getBounds(),center=view.mapObj.getCenter();if(!(gmbounds.contains(self.lastCenterBounds.getNorthEast())&&gmbounds.contains(self.lastCenterBounds.getSouthWest()))){self.lastCenterBounds=self.controlCenterBounds();HotspotsManager.trigger('map:changedposition',view.mapObj);}},controlCenterBounds:function(){var view=HotspotsManager.request("map:object"),center=view.mapObj.getCenter(),b=view.mapObj.getBounds(),x=(b.getNorthEast().lat()-center.lat())/ 1.5,y=(b.getNorthEast().lng()-center.lng())/ 1.5,east=center.lat()+x,north=center.lng()+y,west=center.lat()-x,south=center.lng()-y;return new google.maps.LatLngBounds(new google.maps.LatLng(west,south),new google.maps.LatLng(east,north));},zoomInOnModel:function(model){var view=HotspotsManager.request("map:object");var point={lat:model.get('lat'),lng:model.get('lng')};view.zoomOnPoint(point,15);},streetView:function(pano,close){var view=HotspotsManager.request("map:object");view.streetView(pano,close);},kmlLayer:function(kmls){var view=HotspotsManager.request("map:object");view.showKmlLayers(kmls);},fitBounds:function(bounds){var view=HotspotsManager.request("map:object");view.mapObj.fitBounds(bounds);},resize:function(){var view=HotspotsManager.request("map:object");view.resize();},setWidthRestriction:function(type,menuView){var mapView=HotspotsManager.request("map:object");mapView.setWidthRestriction(type?menuView.$el.width():0);}});Show.Controller=new Controller();});HotspotsManager.module("MapApp.Show",function(Show,HotspotsManager,Backbone,Marionette,$,_){Show.MapView=HotspotsManager.Common.MapApp.MapView;Show.Map=HotspotsManager.Common.MapApp.Map.extend({resize:function(){var height=200;if($(document.body).hasClass('hs-small-device')){this.$el.css('width','100%');if($(window).height()<480){height=150;}
this.mapView.$el.css('height',height);}else{this.$el.css('width','100%').css('width','-='+this.widthRestriction+'px');this.mapView.$el.css('height',HotspotsManager.mainRegion.$el.height());}
google.maps.event.trigger(this.mapObj,'resize');}});var map;HotspotsManager.reqres.setHandler("map:object",function(){return(function(){if(!map){var model=HotspotsManager.request('map:entity');map=new Show.Map({model:model});}
return map;}());});});HotspotsManager.module("MapApp.Markers",function(Markers,HotspotsManager,Backbone,Marionette,$,_){Markers.Location=Backbone.GoogleMaps.LocationCollection.extend({initialize:function(){this.on("change:highlighted",function(selectedModel,isSelected){if(isSelected){this.each(function(model){if(selectedModel.cid!==model.cid){model.dehighlight();}});}},this);}});Markers.Controller={places:false,render:false,addressMarker:'',getMarkerCollection:function(){if(!this.places){this.places=new Markers.Location();}
return this.places;},draw:function(hotspots){if(!this.render){this.places=this.getMarkerCollection();this.places.reset(hotspots.toJSON());hotspots.on('sync',function(){this.places.set(hotspots.toJSON());},this);var map=HotspotsManager.request("map:object");this.markerCollectionView=new Markers.MarkerCollectionView({collection:this.places,map:map.mapObj});this.markerCollectionView.render();this.render=true;}},fetchMarkers:function(){var entities=HotspotsManager.request('hotspots:entities');entities.done(function(hotspots){HotspotsManager.trigger('hotspots:fetchedData',hotspots);});},selected:function(model){var selected=this.places.get(model.get('id'));selected.select();this.places.add(selected);},highlighted:function(model){var highlighted=this.places.get(model.get('id'));highlighted.highlight();},dehighlighted:function(model){var dehighlighted=this.places.get(model.get('id'));dehighlighted.dehighlight();},renderAddress:function(results,status){var map=HotspotsManager.request("map:object");if(status==google.maps.GeocoderStatus.OK){map.mapObj.setCenter(results[0].geometry.location);this.addressMarker=new google.maps.Marker({map:map.mapObj,position:results[0].geometry.location});}},clearAddressMarker:function(){this.addressMarker.setMap(null);}};});HotspotsManager.module("MapApp.Markers",function(Markers,HotspotsManager,Backbone,Marionette,$,_){Markers.MarkerView=Backbone.GoogleMaps.MarkerView.extend({initialize:function(){this.model.on('change:highlighted',function(model,isSelected){if(isSelected){if(!model.get('selected')){this.highligtedMarker=new google.maps.Marker(_.extend({position:this.model.getLatLng(),map:this.map,icon:HotspotsConfig.rootUrl+'/media/com_hotspots/images/v4/icons/pin-highlight.png',zIndex:9999}));}}
else{this.highligtedMarker&&this.highligtedMarker.setMap(null);}},this);this.model.on("change:selected",function(model,isSelected){if(isSelected){var self=this;this.highligtedMarker&&this.highligtedMarker.setMap(null);this.gOverlay.setIcon(HotspotsConfig.rootUrl+'/media/com_hotspots/images/v4/icons/pin.png');this.gOverlay.setZIndex(9999);this.gOverlay.setAnimation(google.maps.Animation.BOUNCE);setTimeout(function(){self.gOverlay.setAnimation(null);},2000);HotspotsManager.trigger('marker:selected',model,isSelected);}
else{this.closeDetail();this.gOverlay.setIcon(this.model.get('icon'));this.gOverlay.setAnimation(null);}},this);},beforeRender:function(){this.gOverlay.setIcon(this.model.get('icon'));},openDetail:function(){}});Markers.MarkerCollectionView=Backbone.GoogleMaps.MarkerCollectionView.extend({markerView:Markers.MarkerView});});HotspotsManager.module("ShareApp",function(ShareApp,HotspotsManager,Backbone,Marionette,$,_){var API={mail:function(){ShareApp.Mail.Controller.show();}};HotspotsManager.on('share:mail',function(){API.mail();});});HotspotsManager.module("ShareApp.Mail",function(Mail,HotspotsManager,Backbone,Marionette,$,_){Mail.Controller={show:function(){var model=HotspotsManager.request('mail:entity');var view=new Mail.Item({model:model});HotspotsManager.trigger('tabs:add',4,'<span class="fa fa-envelope"></span>Send Map',view,'mail');HotspotsManager.trigger('tabs:refresh');HotspotsManager.trigger('tabs:change','mail');}};});HotspotsManager.module("ShareApp.Mail",function(Mail,HotspotsManager,Backbone,Marionette,$,_){Mail.Item=Marionette.ItemView.extend({tagName:"div",template:"#js-hs-send-map-template",events:{'click .js-hs-cancel':'cancel','click .js-hs-submit':'send'},bindings:{'input.js-hs-mail-mailto':'mailto','input.js-hs-mail-sender':'sender','input.js-hs-mail-sender-email':'sender-email','input.js-hs-mail-subject':'subject','textarea.js-hs-mail-textarea':'message'},initialize:function(){this.listenTo(this.model,'request',this.loading);this.listenTo(this.model,'sync',this.hide);this.listenTo(this.model,'error',this.hide);},onRender:function(){this.bindValidation();this.stickit();var token=this.$el.find('input[type=hidden]');this.model.set(token.attr('name'),token.val());},cancel:function(e){e.preventDefault();HotspotsManager.trigger('tabs:remove','mail')},send:function(e){e.preventDefault();var errorDiv=$(e.target).siblings('.alert'),errors=this.model.validate();if(errors){errorDiv.removeClass('hide');Object.each(errors,function(value){errorDiv.append('<div>'+value+'</div>');});}else{errorDiv.addClass('hide');this.model.save();}},loading:function(){this.$el.addClass('hs-loading');},hide:function(){this.template='#js-hs-send-map-template-sent-response';this.render();this.$el.removeClass('hs-loading');}});});HotspotsManager.module("FilterApp.Show",function(Show,HotspotsManager,Backbone,Marionette,$,_){Show.FilterView=Marionette.ItemView.extend({template:'#js-hs-filter-template',modelEvents:{"change:total":'render'},events:{'click .js-hs-show-filter':'showFilters','click input[type=checkbox]':'selectCat','click .js-hs-submit-search':'search','keypress input[name=search]':function(e){if(e.which==13){this.search();}},'click .js-hs-close':'deselectCat'},bindings:{'input[name=search]':'search'},search:function(){this.$el.find('.js-hs-show-filter').removeClass('hide');this.$el.find('.js-hs-filter-options').addClass('hide');this.$el.find('.js-hs-active-filters ').removeClass('hide');this.trigger('filter:show',1);HotspotsManager.trigger('filter:search');HotspotsManager.trigger('filter:changed');},initialize:function(){this.cats=HotspotsManager.request('category:entities');this.cats.on('selected',this.renderSelectedCats,this);this.cats.on('deselected',this.renderSelectedCats,this);},onRender:function(){this.renderSelectedCats();this.checkCategories();this.$el.find('.js-hs-filter-options label').tooltipster({contentAsHTML:true,maxWidth:250});this.stickit();},renderSelectedCats:function(){var activeCats=this.$el.find('.js-hs-active-filters').empty();_.each(this.model.get('cats'),function(value){var img=$('<img>').attr({'src':value.get('cat_icon')});var span=$('<span>').attr({class:'fa fa-times js-hs-close','title':'<strong>'+value.get('cat_name')+'</strong> '+value.get('cat_description'),'data-cat-id':value.get('id')});var container=$('<div class="hs-quick-filter-img"></div>');activeCats.append(container.append(span).append(img));});this.$el.find('.js-hs-active-filters span').tooltipster({contentAsHTML:true,maxWidth:200,position:'bottom'});},showFilters:function(e){this.$el.find('.js-hs-show-filter').addClass('hide');this.$el.find('.js-hs-filter-options').removeClass('hide');this.$el.find('.js-hs-filter-counter').addClass('hide');this.$el.find('.js-hs-active-filters ').addClass('hide');this.trigger('filter:show',this.$el.find('.js-hs-filter-options').hasClass('hide'));},selectCat:function(e){var clicked=$(e.currentTarget),self=this;if(clicked.is(':checked')){self.cats.select(this.cats.get(clicked.val()));clicked.parents('li').first().find('input').each(function(){var input=jQuery(this);input.prop("checked",true);self.cats.select(self.cats.get(input.val()));});}else{this.cats.deselect(this.cats.get(clicked.val()));clicked.parents('li').first().find('input').each(function(){var input=jQuery(this);input.prop("checked",false);self.cats.deselect(self.cats.get(input.val()));});}},deselectCat:function(e){var clicked=$(e.currentTarget);var id=clicked.data('cat-id');this.cats.deselect(this.cats.get(id));clicked.closest('div').remove();this.checkCategories();this.search();},checkCategories:function(){var cats=this.$el.find('.js-hs-filter-options input[name=cats]'),ids=[];_.each(this.model.get('cats'),function(value){ids.push(value.get('id'));});cats.each(function(key,value){var checkbox=$(value);checkbox.prop('checked',false);if(_.indexOf(ids,checkbox.val())>=0){checkbox.prop('checked',true);}});}});});HotspotsManager.module("MenuApp",function(MenuApp,HotspotsManager,Backbone,Marionette,$,_){var API={show:function(){MenuApp.Show.Controller.show();},open:function(){MenuApp.Show.Controller.open();},resize:function(){MenuApp.Show.Controller.resize();}};this.listenTo(HotspotsManager,'initialize:before',function(options){API.show();});this.listenTo(HotspotsManager,'marker:selected',function(model){API.open();});this.listenTo(HotspotsManager,'window:resize',function(){API.resize();})});HotspotsManager.module("MenuApp.Show",function(Show,HotspotsManager,Backbone,Marionette,$,_){Show.Controller={show:function(){this.view=new Show.MenuView();this.view.on("show",function(){HotspotsManager.trigger('tabs:list');});HotspotsManager.menuRegion.show(this.view);},open:function(){if(this.view&&!this.view.opened){this.view.toggleMenu();}},resize:function(){this.view&&this.view.resize();}};});HotspotsManager.module("MenuApp.Show",function(Show,HotspotsManager,Backbone,Marionette,$,_){Show.MenuView=Marionette.ItemView.extend({tagName:'div',className:'slide_menu',id:'slide_menu',template:'#menu-layout-template',events:{'click .toggle':'toggleMenu'},toggleMenu:function(){var self=this;if(this.opened){this.opened=false;this.$el.animate({'marginLeft':0});this.$el.find('#toggle-menu').switchClass('toggle-on','toggle-off');HotspotsManager.trigger('menu:slide',0,self);}
else{this.$el.animate({'marginLeft':'-'+this.$el.width()},{complete:function(){HotspotsManager.trigger('menu:slide',1,self);}});this.opened=true;this.$el.find('#toggle-menu').switchClass('toggle-off','toggle-on');}},initialize:function(){this.listenTo(HotspotsManager,'map:fullscreen',function(){this.resize();});},resize:function(){if($(document.body).hasClass('hs-small-device')){var height=200;if($(window).height()<480){height=150;}
this.$el.css('height',HotspotsManager.mainRegion.$el.height()-height);HotspotsManager.menuRegion.$el.css('top',height);}else{this.$el.css('height',HotspotsManager.mainRegion.$el.height());HotspotsManager.menuRegion.$el.css('top',0);}
HotspotsManager.trigger('menu:resized',this);},onShow:function(){if(!HotspotsConfig.startClosedMenu){this.toggleMenu();}
this.resize();}});});HotspotsManager.module("TabsApp",function(TabsApp,HotspotsManager,Backbone,Marionette,$,_){var API={listTabs:function(){TabsApp.List.Controller.create();},addTab:function(id,title,content,dataName){TabsApp.Save.Controller.add(id,title,content,dataName);},refresh:function(){TabsApp.List.Controller.refresh();},change:function(name){TabsApp.List.Controller.change(name);},remove:function(name){TabsApp.Remove.Controller.remove(name);this.change('hotspots');}};HotspotsManager.on('tabs:list',function(){API.listTabs();});HotspotsManager.on('tabs:refresh',function(){API.refresh();});HotspotsManager.on('tabs:add',function(id,title,content,dataName){API.addTab(id,title,content,dataName);});HotspotsManager.on('tabs:change',function(name){API.change(name);});HotspotsManager.on('tabs:remove',function(name){API.remove(name);});HotspotsManager.on('tabs:ready',function(name){API.change(HotspotsConfig.startTab);});});HotspotsManager.module("TabsApp.List",function(List,HotspotsManager,Backbone,Marionette,$,_){List.Controller={tabs:null,initTabs:function(){if(!this.tabs){jQuery.ui.tabs.prototype._isLocal=function(){return true;};this.tabs=$("#js-hs-tab-container").tabs();}
return this.tabs;},create:function(){var tabCollection=HotspotsManager.request("tab:entities");var layout=new List.TabsLayout();var region=new Backbone.Marionette.Region({el:"#js-tabs-region"});var tabView=new HotspotsManager.TabsApp.TabItem.View({collection:tabCollection});var tabContentView=new HotspotsManager.TabsApp.TabContentItem.View({collection:tabCollection});region.show(layout);layout.tabs.show(tabView);layout.tabContent.show(tabContentView);this.initTabs();HotspotsManager.trigger('tabs:ready');},refresh:function(){this.initTabs().tabs('refresh');},change:function(name){var $lis,$li,index;$lis=this.tabs.find('#js-hs-tabs ul li');$li=this.tabs.find("#js-hs-tabs ul li[data-name='"+name+"']");index=$lis.index($li);this.initTabs().tabs('option','active',index)}};});HotspotsManager.module("TabsApp.List",function(List,HotspotsManager,Backbone,Marionette,$,_){List.TabsLayout=Marionette.Layout.extend({template:'#tabs-template',id:'js-hs-tab-container',regions:{tabs:"#js-hs-tabs",tabContent:"#js-hs-tabs-content"}});});HotspotsManager.module("TabsApp.TabItem",function(TabItem,HotspotsManager,Backbone,Marionette,$,_){TabItem.Item=Marionette.ItemView.extend({tagName:"li",template:"#tab-template",attributes:function(){return{'data-name':this.model.get('dataName')}}});TabItem.View=Marionette.CollectionView.extend({itemView:TabItem.Item,itemViewContainer:"ul",tagName:"ul"});});HotspotsManager.module("TabsApp.TabContentItem",function(TabContentItem,HotspotsManager,Backbone,Marionette,$,_){TabContentItem.Item=Marionette.ItemView.extend({tagName:"div",template:"#tab-content-template",className:'hs-tab-content',initialize:function(){this.$el.attr('id','tabs-'+this.model.get('id'));},modelEvents:{'change:content':'onShow'},onShow:function(){if(typeof this.model.get('content')==='object'){var region=new Backbone.Marionette.Region({el:"#hs-tab-content-region-"+this.model.get('id')});region.show(this.model.get('content'));}}});TabContentItem.View=Marionette.CollectionView.extend({itemView:TabContentItem.Item,itemViewContainer:"div",initialize:function(){var self=this;this.listenTo(HotspotsManager,'map:fullscreen',function(){self.resize();});this.listenTo(HotspotsManager,'window:resize',function(){self.resize();});this.listenTo(HotspotsManager,'menu:resized',function(){self.resize();});},onShow:function(){this.resize();},resize:function(){this.$el.height(HotspotsManager.mainRegion.$el.height()-this.$el.position().top-HotspotsManager.menuRegion.$el.position().top);}});});HotspotsManager.module("TabsApp.Save",function(Save,HotspotsManager,Backbone,Marionette,$,_){Save.Controller={add:function(id,title,content,dataName){var tabs=HotspotsManager.request("tab:entities"),tab={id:id,tabName:title,content:content};if(dataName){tab.dataName=dataName;}
tabs.add(tab,{merge:true});}}});HotspotsManager.module("TabsApp.Remove",function(Remove,HotspotsManager,Backbone,Marionette,$,_){Remove.Controller={remove:function(dataName){var tabs=HotspotsManager.request("tab:entities");tabs.remove(tabs.where({dataName:dataName}));}}});HotspotsManager.module("HotspotsApp",function(HotspotsApp,HotspotsManager,Backbone,Marionette,$,_){var API={renderHotspotsInTab:function(){HotspotsApp.Tabs.Controller.render();},showList:function(hotspots){HotspotsApp.List.Controller.showList(hotspots);},markerSelected:function(model,isSelected){HotspotsApp.List.Controller.selected(model,isSelected);},setPage:function(page){HotspotsApp.List.Controller.setPage(page);},shotTileHotspot:function(hotspot){HotspotsApp.List.Controller.shotTileHotspot(hotspot);}};HotspotsManager.on('start:page',function(page){API.setPage(page);});HotspotsManager.on("tabs:ready",function(){API.renderHotspotsInTab();});this.listenTo(HotspotsManager,"hotspots:fetchedData",function(hotspots){return API.showList(hotspots);});HotspotsManager.on("marker:selected",function(model,isSelected){API.markerSelected(model,isSelected);});HotspotsManager.on("tile:hotspot:loaded",function(model){API.shotTileHotspot(model);});});HotspotsManager.module("HotspotsApp.List",function(List,HotspotsManager,Backbone,Marionette,$,_){List.Controller={init:function(){var hotspots=HotspotsManager.request('hotspots:collection');this.hotspotsListLayout=new HotspotsManager.HotspotsApp.List.Layout();var model=HotspotsManager.request('filter:entity');this.filterView=new HotspotsManager.FilterApp.Show.FilterView({model:model});this.filterView.on('filter:show',function(toggle){if(toggle){this.hotspotsListLayout.list.$el.show();}
else{this.hotspotsListLayout.list.$el.hide();}},this);this.hotspotsListLayout.on("show",function(){var loadingView=new HotspotsManager.Common.Views.Loading();this.hotspotsListLayout.list.show(loadingView);this.hotspotsListLayout.filter.show(this.filterView);},this);return this.hotspotsListLayout;},shotTileHotspot:function(model){var self=this;var view=new List.TileHotspot({model:model});view.on('close',function(){HotspotsManager.trigger('tile:marker:closed',model);self.hotspotsListLayout.tile.close();});this.hotspotsListLayout.tile.show(view);},showList:function(hotspots){if(!this.hotspotsListView){this.hotspotsListView=new HotspotsManager.Common.Views.PaginatedView({collection:hotspots,mainView:HotspotsManager.HotspotsApp.List.Hotspots});this.hotspotsListLayout.list.show(this.hotspotsListView);}
this.hotspots=hotspots;},selected:function(model,isSelected){var selected=this.hotspots.get(model.get('id'));HotspotsManager.trigger('tabs:change','hotspots');selected.select(true);},setPage:function(page){this.page=page;}}});HotspotsManager.module("HotspotsApp.List",function(List,HotspotsManager,Backbone,Marionette,$,_){List.Layout=Marionette.Layout.extend({template:"#hs-tab-list-layout-template",regions:{filter:'#js-hs-tab-filter-region',list:"#hs-tab-list-hotspots-region",tile:'#js-hs-tab-hotspots-tile-region',hotspotsRegion:"#hotspots-region"}});var HotspotView=Marionette.ItemView.extend({events:{'keypress .js-hs-get-directions input':'keypressSearchDir','click .js-hs-show-directions':'displayDirForm','click .hs-quick-dir':'changeDir','click .js-hs-get-directions .js-hs-close':'displayDirForm','click .js-hs-get-directions .js-hs-search':'searchDir','click .js-hs-zoom-in':function(e){e.stopPropagation();HotspotsManager.trigger('marker:zoomIn',this.model);}},initialize:function(){this.$el.prop("id","hs-hotspot-id-"+this.model.get("id"));this.$el.attr("data-id",this.model.get("id"));HotspotsManager.request('category:entities');},displayDirForm:function(e){e.stopPropagation();this.$el.find('.hs-get-directions').toggle();this.$el.find('.hs-get-directions input').focus();},keypressSearchDir:function(e){if(e.which===13){this.searchDir(e);}},searchDir:function(e){e.stopPropagation();var input=this.$el.find('.hs-get-directions input'),active=this.$el.find('.hs-quick-dir.active').data('id'),origin,destination;if(active=='from'){origin=input.val();destination={lat:this.model.get('lat'),lng:this.model.get('lng'),name:this.model.getFormatedAddress()}}else{destination=input.val();origin={lat:this.model.get('lat'),lng:this.model.get('lng'),name:this.model.getFormatedAddress()}}
HotspotsManager.trigger('directions:search',origin,destination);},changeDir:function(e){e.stopPropagation();$(e.currentTarget).closest('.hs-get-directions').find('.hs-quick-dir').each(function(key,el){$(el).removeClass('active');});$(e.currentTarget).addClass('active');},selected:function(){var self=this,latLng=new google.maps.LatLng(this.model.get('lat'),this.model.get('lng')),mapModel=HotspotsManager.request('map:entity'),content=this.$el.closest('#js-hs-tabs-content > div'),top,bottom,height;mapModel.svService.getPanoramaByLocation(latLng,100,function(data,status){if(status==google.maps.StreetViewStatus.OK){if(data.links.length){var pano=data.links[0].pano;var url='https://maps.googleapis.com/maps/api/streetview?size=260x90&sensor=false&pano='+pano+'&key='+HotspotsConfig.apiKey;self.$el.find('.hs-streetmap').unbind('click');self.$el.find('.hs-streetmap').css({'background':'url('+url+')','display':'block'}).on('click',function(e){e.stopPropagation();HotspotsManager.trigger('marker:streetView',pano);});}}});this.$el.addClass('hs-selected');top=this.$el.position().top;bottom=this.$el.position().top+this.$el.outerHeight(true);height=content.height();if(!((top>0&&top<height)&&(bottom>0&&bottom<height))){$.smoothScroll({scrollElement:content,scrollTarget:this.$el});}
this.$el.find('.js-hs-place-user-with-avatar').tooltipster({content:function(){return self.$el.find('.js-hs-place-avatar-hidden').html()},maxWidth:200,interactive:true});}});List.Hotspot=HotspotView.extend({template:"#hotspot-list-item",tagName:'div',className:'hs-tab-list-item',genericEvents:{'click':function(e){this.select();}},modelEvents:{'selected':'selected','deselected':'deselected'},initialize:function(){this.$el.prop("id","hs-hotspot-id-"+this.model.get("id"));this.$el.attr("data-id",this.model.get("id"));this.events=_.extend({},this.genericEvents,this.events);HotspotsManager.request('category:entities');},deselected:function(){this.$el.find('.hs-get-directions').css('display','none');this.$el.find('.hs-streetmap').css('display','none');this.$el.removeClass('hs-selected');},select:function(silent){this.model.select();if(!silent){HotspotsManager.trigger('hotspot:selected',this.model);}},onRender:function(){var model=this.model,$galleria='';if(model.get('multimedia'))
{$galleria=this.$el.find(".hs-galleria");setTimeout(function(){$galleria.onImpression({offset:0,callback:function(){Galleria.run($galleria,{dataSource:model.get('multimedia')});},scrollable:'#js-hs-tabs-content > div'});},0)}}});List.TileHotspot=HotspotView.extend({template:"#hotspot-list-item",tagName:'div',className:'hs-tab-list-item hs-tab-list-item-tile',triggers:{'click .js-hs-close':'close'},initialize:function(){this.$el.prop("id","hs-hotspot-id-"+this.model.get("id"));this.$el.attr("data-id",this.model.get("id"));},onShow:function(){this.selected();this.$el.prepend('<div class="js-hs-close pull-right fa fa-times"></div>');}});List.NoHotspots=Marionette.ItemView.extend({template:"#js-hs-empty-list-template",className:"alert"});List.Hotspots=Marionette.CollectionView.extend({emptyView:List.NoHotspots,itemView:List.Hotspot,timeout:null,events:{'mouseenter .hs-tab-list-item':'highlight','mouseleave .hs-tab-list-item':'dehighlight'},highlight:function(e){e.preventDefault();var id=$(e.currentTarget).data("id");HotspotsManager.trigger('marker:highlighted',this.collection.get(id));},dehighlight:function(e){e.preventDefault();var id=$(e.currentTarget).data("id");HotspotsManager.trigger('marker:dehighlighted',this.collection.get(id));}});});HotspotsManager.module("HotspotsApp.Tabs",function(Tabs,HotspotsManager,Backbone,Marionette,$,_){Tabs.Controller={render:function(){this.hotspotsListLayot=HotspotsManager.HotspotsApp.List.Controller.init();HotspotsManager.trigger('tabs:add',2,'hotspots',this.hotspotsListLayot);HotspotsManager.trigger('tabs:refresh');}}});HotspotsManager.module("DirectionsApp",function(DirectionsApp,HotspotsManager,Backbone,Marionette,$,_){var API={show:function(){DirectionsApp.Show.Controller.show();},search:function(origin,destination){DirectionsApp.Show.Controller.search(origin,destination);}};HotspotsManager.on('directions:search',function(origin,destination){API.search(origin,destination);});HotspotsManager.on('tabs:ready',function(){API.show();});});HotspotsManager.module("DirectionsApp.Show",function(Show,HotspotsManager,Backbone,Marionette,$,_){Show.Controller={show:function(){var model=HotspotsManager.request('direction:entity');var view=new Show.DirectionsView({model:model});HotspotsManager.trigger('tabs:add',1,'directions',view);HotspotsManager.trigger('tabs:refresh');},search:function(origin,destination){var model=HotspotsManager.request('direction:entity');model.set('origin',origin);model.set('destination',destination);var view=new Show.DirectionsView({model:model});HotspotsManager.trigger('tabs:add',1,'directions',view);HotspotsManager.trigger('tabs:refresh');view.searchDestination();HotspotsManager.trigger('tabs:change','directions');}};});HotspotsManager.module("DirectionsApp.Show",function(Show,HotspotsManager,Backbone,Marionette,$,_){Show.DirectionsView=Marionette.ItemView.extend({tagName:'div',className:'hs-directions',bindings:{'.search-location .origin':{observe:'origin',onGet:function(value,options){if(this.model.get('originDisplayName')){return this.model.get('originDisplayName');}
return value;}},'.js-hs-search-directions input[name=units]':'units','#js-hs-avoid-highways':{observe:'avoidHighways',onSet:function(value,option){return value?true:false;}},'#js-hs-avoid-tolls':{observe:'avoidTolls',onSet:function(value,option){return value?true:false;}}},events:{'submit #js-hs-search-address-form':'search','submit #js-hs-search-directions-form':'getDirections','click .js-hs-show-directions':'showDirections','click .js-hs-get-directions':'getDirections','click button.js-hs-directions-search':'search','click .hs-close':'close','click .js-hs-add-stop':'addStop','click .js-hs-direction-options':'showOptions','click .hs-routing-mode div':'changeMode','click .js-hs-clear-search':'clearDirections','click .js-hs-clear-address-search':'clearAddressSearch','click .js-hs-back-address':'backToAddress'},selectors:{dirInputs:'.js-hs-search-directions input[type=text]'},ui:{address:'.search-location input',drag:'.sortable span.hs-drag',dirInputs:'.js-hs-search-directions input[type=text]'},template:'#hs-directions-template',clearDirections:function(){HotspotsManager.trigger('directions:clear');var directionsDisplay=HotspotsManager.request("direction:renderer");$(directionsDisplay.getPanel()).html('');var inputs=this.$el.find(this.selectors.dirInputs).toArray();_.each(inputs,function(input){$(input).val('');});inputs.shift().focus();this.$el.find('.js-hs-clear-search').css('display','none');},backToAddress:function(){this.$el.find('.hs-hide').css({'display':'none'});this.$el.find('.search-location').css('display','block');this.$el.find('.hs-search-results').css('display','block');},clearAddressSearch:function(){HotspotsManager.trigger('directions:clearAddress');this.$el.find('.hs-search-results').html('');this.$el.find('.js-hs-clear-address-search').css('display','none');this.ui.address.val('').focus();},showOptions:function(e){var el=$(e.currentTarget),container=this.$el.find('.hs-directions-options-container');el.toggleClass('fa-angle-double-down').toggleClass('fa-angle-double-up');container.toggle();},close:function(e){var el=$(e.currentTarget),row=el.closest('.row-fluid'),inputs=this.$el.find(this.selectors.dirInputs);if(inputs.length==2){this.$el.find('.hs-hide').css({'display':'none'});this.$el.find('.search-location').css('display','block');this.$el.find('.hs-search-results').css('display','block');}else{row.remove();$('.js-hs-add-stop').show();this.$el.find('.sortable span.hs-drag').last().removeClass('fa-circle-o').addClass('fa-map-marker');if(this.$el.find(this.selectors.dirInputs).length==2){this.$el.find('.js-hs-drag-info').css('display','none');}}},addStop:function(e){var span=this.$el.find('.sortable span.hs-drag').last();span.removeClass('fa-map-marker').addClass('fa-circle-o');this.$el.find(this.selectors.dirInputs).closest('.row-fluid').last().after($('#hs-directions-single-row-template').html());var inputs=this.$el.find(this.selectors.dirInputs);this.$el.find('.hs-search-directions .control-group.error').removeClass('error');this.$el.find('.hs-search-directions .help-block.error').remove();if(inputs.length>=3){this.$el.find('.js-hs-drag-info').css('display','block');}
inputs.last().focus();if(inputs.length==10){e.currentTarget.hide();}},changeMode:function(e){var modes=this.$el.find('.hs-routing-mode div'),mode=$(e.target);modes.removeClass('active');mode.addClass('active');this.model.set('mode',mode.data('type'));},showDirections:function(){var self=this,inputs=this.$el.find(this.selectors.dirInputs),origin,destination;this.$el.find('.hs-hide').css({'display':'block'});this.$el.find('.search-location').css('display','none');this.$el.find('.hs-search-results').css('display','none');origin=inputs.first();origin.focus();if(!origin.val()){if(this.model.get('originDisplayName')){origin.val(this.model.get('originDisplayName'));}else{origin.val(this.model.get('origin'));}}
if(this.model.get('destination')){destination=inputs.last();destination.focus();if(this.model.get('destinationDisplayName')){destination.val(this.model.get('destinationDisplayName'));}else{destination.val(this.model.get('destination'));}}
$(".sortable").sortable({axis:"y",stop:function(event,ui){var spans=self.$el.find('.sortable span.hs-drag');_.each(spans,function(span,key){$(span).removeClass('fa-map-marker').addClass('fa-circle-o');});spans.last().removeClass('fa-circle-o').addClass('fa-map-marker');}});},searchDestination:function(){this.showDirections();this.model.searchDirections();},getDirections:function(e){var locations=this.$el.find('.hs-search-directions input[type=text]').toArray();var origin=$(locations.shift()),destination=$(locations.pop()),waypoints=[];e.preventDefault();this.model.set('origin',origin.val());this.model.set('destination',destination.val());this.$el.find('.hs-search-directions .control-group.error').removeClass('error');this.$el.find('.hs-search-directions .help-block.error').remove();if(!origin.val()){this.outputDirError(origin,HotspotsConfig.translations.provideStartAddress);}
if(!destination.val()){this.outputDirError(destination,HotspotsConfig.translations.provideEndAddress);}
if(!origin.val()||!destination.val()){return;}
if(locations.length)
{locations.forEach(function(location){if(location.value){waypoints.push({location:location.value,stopover:true});}else{$(location).closest('.row-fluid').remove();}})}
if(waypoints.length){this.model.set('waypoints',waypoints);}
this.$el.find('.js-hs-clear-search').css('display','inline-block');this.model.searchDirections();},outputDirError:function(el,errors){var parent=el.parent();parent.find('.help-block.error').remove();var $errorEl=$('<div>',{class:'help-block small muted error',text:errors});el.parent().append($errorEl).addClass('error');},renderDirections:function(results,status){var map=HotspotsManager.request("map:object");var directionsDisplay=HotspotsManager.request("direction:renderer");directionsDisplay.setPanel(this.$el.find('.hs-directions-results')[0]);if(status==google.maps.DirectionsStatus.OK){$(directionsDisplay.getPanel()).html('');directionsDisplay.setDirections(results);}else if(status==google.maps.DirectionsStatus.NOT_FOUND){self.directionsDisplay.getPanel().set('html',self.locale.locationNotFound);}else if(status==google.maps.DirectionsStatus.ZERO_RESULTS){self.directionsDisplay.getPanel().set('html',self.locale.locationZeroResults);}},search:function(e){e.preventDefault();if(this.model.isValid('origin')){this.$el.find('.js-hs-clear-address-search').css('display','block');var addon=this.$el.find('.search-location .add-on span');addon.removeClass('hs-drag fa-map-marker').addClass('fa-spinner fa-spin');this.model.searchAddress();}},renderAddress:function(results,status){var renderEl=$('.hs-search-results').css('display','block');if(status==google.maps.GeocoderStatus.OK){var addon=this.$el.find('.search-location .add-on span');addon.removeClass('fa-spinner fa-spin').addClass('hs-drag fa-map-marker');var html=Marionette.Renderer.render('#hs-address-result-template',{address:results[0].formatted_address});}
renderEl.html(html);},onRender:function(){var self=this;HotspotsManager.on('directions:address',function(results,status){self.renderAddress(results,status);});HotspotsManager.on('directions:directions',function(results,status){self.renderDirections(results,status);});this.bindValidation();this.stickit();},onValidField:function(attrName,attrValue,model){var el=this.$el.find('.search-location .'+attrName),parent=el.parent();parent.removeClass('error');parent.find('.help-block.error').remove();},onInvalidField:function(attrName,attrValue,errors,model){var el=this.$el.find('.search-location .'+attrName),parent=el.parent();parent.find('.help-block.error').remove();var $errorEl=$('<div>',{class:'help-block small muted error',text:errors});el.parent().append($errorEl).addClass('error');}});});HotspotsManager.module("SettingsApp",function(SettingsApp,HotspotsManager,Backbone,Marionette,$,_){var API={show:function(){SettingsApp.Show.Controller.show();}};HotspotsManager.on('tabs:ready',function(options){API.show();});});HotspotsManager.module("SettingsApp.Show",function(Show,HotspotsManager,Backbone,Marionette,$,_){Show.Controller={show:function(){var model=HotspotsManager.request('map:entity');var view=new Show.SettingsView({model:model});HotspotsManager.trigger('tabs:add',3,'settings',view);HotspotsManager.trigger('tabs:refresh');}};});HotspotsManager.module("SettingsApp.Show",function(Show,HotspotsManager,Backbone,Marionette,$,_){Show.SettingsView=Marionette.ItemView.extend({tagName:'div',className:'hs-settings',bindings:{'input[name=mylocation]':'myLocation','input[name=weather]':'weatherLayer','input[name=traffic]':'trafficLayer','input[name=transit]':'transitLayer','input[name=bicycle]':'bicyclingLayer',},events:{'click .js-hs-mylocation':'findMyLocation'},template:'#hs-settings-template',onRender:function(){Backbone.Stickit.addHandler({selector:'input[type=checkbox].js-hs-stickit',update:function($el,val,model,options){if($el.length>1){val||(val=[]);$el.each(function(i,el){var checkbox=Backbone.$(el);var checked=_.indexOf(val,checkbox.val())>-1;checkbox.prop('checked',checked);});}else{var checked=(val===1)?val:val===$el.val();$el.prop('checked',checked);}}});this.stickit();},findMyLocation:function(){var self=this;navigator.geolocation.getCurrentPosition(function(position){var latlng=new google.maps.LatLng(position.coords.latitude,position.coords.longitude);self.model.geocoder.geocode({latLng:latlng},function(results,status){if(status==google.maps.GeocoderStatus.OK){self.model.set('myLocation',results[0].formatted_address)}});});}});});var HotspotsTour={"id":"hotspots-tour","onEnd":"cookie","onClose":"cookie","steps":[{"title":"Bienvenidos al Mapa de Instituciones Edutcativas del Distrito","content":"You can access the documentation & support forums at compojoom.com.<br \/>If you want to change this text or remove it completely navigate to your backend and turn it off in the options of the component.<br \/>Before you start exploring the locations, do you want to take a small tour?","target":"js-hs-main-app","placement":"top","xOffset":"center","zindex":9999,"arrowOffset":"center","onShow":"startEnd"},{"title":"La pesta\u00f1a de Instituciones","content":"En la pesta\u00f1a de instituciones educativas, ver\u00e1 las ubicaciones en su vista actual. Cuando mueva el mapa, acercar \/ alejar las ubicaciones aqu\u00ed se actualizar\u00e1.","target":"#js-tabs-region li[data-name='hotspots']","placement":"bottom","zindex":9999,"xOffset":"center","arrowOffset":"center","onShow":"hotspotsTab"},{"title":"The filters","content":"Puede usar los filtros para mostrar zonas activas de una categor\u00eda espec\u00edfica o el cuadro de b\u00fasqueda para mostrar solo las ubicaciones que coincidan con una palabra clave deseada.","target":"#js-hs-tab-filter-region","placement":"bottom","xOffset":"center","arrowOffset":"center","zindex":9999,"showPrevButton":true,"onShow":"hotspotsTab"},{"title":"Center & Fullscreen","content":"El bot\u00f3n central intentar\u00e1 buscar autom\u00e1ticamente su ubicaci\u00f3n y centrar\u00e1 el mapa en ella. Use el bot\u00f3n de pantalla completa si desea navegar por un mapa m\u00e1s grande.","target":".hs-buttons-map","placement":"left","yOffset":-20,"zindex":9999,"showPrevButton":true},{"title":"That's it!","content":"\u00a1Ahora sabe d\u00f3nde se encuentran las funciones m\u00e1s importantes! \u00a1Divi\u00e9rtete usando el mapa!","target":"#js-hs-main-app","placement":"top","zindex":9999,"showPrevButton":true,"xOffset":"center","arrowOffset":"center","onShow":"startEnd"}],"i18n":{"nextBtn":"Sigue","prevBtn":"Atras","doneBtn":"Done"}};hopscotch.registerHelper('hotspotsTab',function(){hsOpenMenuForBubble();jQuery("#js-tabs-region li[data-name='hotspots'] a").trigger('click');hopscotch.refreshBubblePosition();});hopscotch.registerHelper('directionsTab',function(){hsOpenMenuForBubble();jQuery("#js-tabs-region li[data-name='directions'] a").trigger('click');hopscotch.refreshBubblePosition();});hopscotch.registerHelper('cookie',function(){jQuery.cookie("hs-toured","toured");});var hsTop=0;hopscotch.registerHelper('startEnd',function(){var bubble=jQuery('.hopscotch-bubble');if(!hsTop){hsTop=bubble.height()+parseInt(bubble.css('top'))+50;bubble.css('top',hsTop);}
else{bubble.css('top',hsTop);}
jQuery('.hopscotch-bubble-arrow-container').hide();});if(!jQuery.cookie('hs-toured')){jQuery(document).ready(function(){$map=jQuery("#js-hs-main-app");setTimeout(function(){$map.onImpression({offset:0,callback:function(){hopscotch.startTour(HotspotsTour);}});},0)});}
function hsOpenMenuForBubble(){var $=jQuery;if($('#toggle-menu').hasClass('toggle-off'))
{$('#toggle-menu').trigger('click');}
HotspotsManager.on('menu:slide',function(){hopscotch.refreshBubblePosition();})}